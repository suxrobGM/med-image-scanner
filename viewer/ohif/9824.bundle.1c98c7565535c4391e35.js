"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9824,2568],{78491:(e,a,n)=>{n.r(a),n.d(a,{default:()=>f});const t=JSON.parse('{"u2":"@ohif/extension-cornerstone-dicom-pmap"}').u2,r=`${t}.sopClassHandlerModule.dicom-pmap`;var s=n(43001),o=n(84793),i=n(12651),c=n(91202),d=n(15516);const l="cornerstoneStreamingImageVolume",u=["1.2.840.10008.5.1.4.1.1.30"];function S(e,a,n){const t=e[0],{StudyInstanceUID:s,SeriesInstanceUID:S,SOPInstanceUID:m,SeriesDescription:p,SeriesNumber:I,SeriesDate:g,SOPClassUID:f,wadoRoot:D,wadoUri:y,wadoUriRoot:U}=t,h={Modality:"PMAP",isReconstructable:!0,displaySetInstanceUID:`pmap.${o.utils.guid()}`,SeriesDescription:p,SeriesNumber:I,SeriesDate:g,SOPInstanceUID:m,SeriesInstanceUID:S,StudyInstanceUID:s,SOPClassHandlerId:r,SOPClassUID:f,referencedImages:null,referencedSeriesInstanceUID:null,referencedDisplaySetInstanceUID:null,referencedVolumeURI:null,referencedVolumeId:null,isDerivedDisplaySet:!0,loadStatus:{loading:!1,loaded:!1},sopClassUids:u,instance:t,instances:[t],wadoRoot:D,wadoUriRoot:U,wadoUri:y,isOverlayDisplaySet:!0},w=t.ReferencedSeriesSequence;if(!w)return void console.error("ReferencedSeriesSequence is missing for the parametric map");const v=w[0]||w;return h.referencedImages=t.ReferencedSeriesSequence.ReferencedInstanceSequence,h.referencedSeriesInstanceUID=v.SeriesInstanceUID,h.getReferenceDisplaySet=()=>{const{displaySetService:e}=a.services;if(h.referencedDisplaySetInstanceUID)return e.getDisplaySetByUID(h.referencedDisplaySetInstanceUID);const n=e.getDisplaySetsForSeries(h.referencedSeriesInstanceUID);if(!n||0===n.length)throw new Error("Referenced displaySet is missing for the parametric map");const t=n[0];return h.referencedDisplaySetInstanceUID=t.displaySetInstanceUID,t},h.getReferencedVolumeId=()=>{if(h.referencedVolumeId)return h.referencedVolumeId;const e=h.getReferenceDisplaySet().displaySetInstanceUID,a=`${l}:${e}`;return h.referencedVolumeURI=e,h.referencedVolumeId=a,a},h.load=async({headers:e})=>await async function(e,a,n,t){const r=`${l}:${e.displaySetInstanceUID}`,s=i.cache.getVolumeLoadObject(r);if(s)return s.promise;e.loadStatus.loading=!0;const o=async function({extensionManager:e,displaySet:a,headers:n}){const t=await d.dicomLoaderService.findDicomDataPromise(a,null,n),r=a.getReferencedVolumeId(),s=i.cache.getVolume(r);if(!s)throw new Error("Referenced Volume is missing for the PMAP, and stack viewport PMAP is not supported yet");const{imageIds:o}=s,l=await c.adaptersPMAP.Cornerstone3D.ParametricMap.generateToolState(o,t,i.metaData),{pixelData:u}=l,S=u.constructor,m=a.displaySetInstanceUID,p=await i.volumeLoader.createAndCacheDerivedVolume(r,{volumeId:m,targetBuffer:{type:S.name}});p.getScalarData().set(u);const I=p.imageData.getPointData().getScalars().getRange(),g=i.utilities.windowLevel.toWindowLevel(I[0],I[1]);return p.metadata.voiLut=[g],p.loadStatus={loaded:!0},p}({extensionManager:n,displaySet:e,headers:t});return i.cache.putVolumeLoadObject(r,{promise:o}).catch((e=>{throw e})),o.then((()=>{e.loadStatus.loading=!1,e.loadStatus.loaded=!0})).catch((a=>{throw e.loadStatus.loading=!1,a})),o}(h,0,n,e),[h]}const m=function({servicesManager:e,extensionManager:a}){return[{name:"dicom-pmap",sopClassUids:u,getDisplaySetsFromSeries:n=>S(n,e,a)}]};function p(){return p=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},p.apply(null,arguments)}const I=s.lazy((()=>n.e(2898).then(n.bind(n,22898)))),g=e=>s.createElement(s.Suspense,{fallback:s.createElement("div",null,"Loading...")},s.createElement(I,e)),f={id:t,getViewportModule:({servicesManager:e,extensionManager:a,commandsManager:n})=>[{name:"dicom-pmap",component:t=>s.createElement(g,p({servicesManager:e,extensionManager:a,commandsManager:n},t))}],getSopClassHandlerModule:m}}}]);
//# sourceMappingURL=9824.bundle.1c98c7565535c4391e35.js.map
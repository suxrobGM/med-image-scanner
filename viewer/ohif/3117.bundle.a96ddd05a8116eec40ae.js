/*! For license information please see 3117.bundle.a96ddd05a8116eec40ae.js.LICENSE.txt */
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[3117,3497],{49001:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var o=n(72076),i=n(7187),a=n(30023),r=n(30742),s=n(56309),l=n(77614),c=n(25281),d=n(40046),u=n(82253);class h extends l.Z{constructor(e){super({...e,canvas:e.canvas||(0,c.uy)(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),!1===this.isPlaying&&this.renderFrame(),!0),this.getNumberOfSlices=()=>{const e=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(e)?this.numberOfFrames:e},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const e=this.canvas,{clientWidth:t,clientHeight:n}=e;e.width===t&&e.height===n||(e.width=t,e.height=n),this.refreshRenderValues(),!1===this.isPlaying&&this.renderFrame()},this.canvasToWorld=(e,t=[0,0,0])=>{const n=this.videoCamera.panWorld,o=this.getWorldToCanvasRatio(),i=[n[0]*o,n[1]*o],a=[e[0]-i[0],e[1]-i[1]];return t.splice(0,2,a[0]/o,a[1]/o),t},this.worldToCanvas=e=>{const t=this.videoCamera.panWorld,n=this.getWorldToCanvasRatio();return[(e[0]+t[0])*n,(e[1]+t[1])*n]},this.getRotation=()=>0,this.canvasToIndex=e=>{const t=this.getTransform();return t.invert(),t.transformPoint(e.map((e=>e*devicePixelRatio)))},this.indexToCanvas=e=>this.getTransform().transformPoint(e).map((e=>e/devicePixelRatio)),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{const e=this.getTransform().getMatrix(),t=this.canvasContext;t.resetTransform(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.drawImage(this.videoElement,0,0,this.videoWidth||1024,this.videoHeight||1024);for(const e of this.getActors())e.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),(0,s.triggerEvent)(this.element,i.Events.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(0,s.triggerEvent)(this.element,i.Events.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),this.initialRender?.();const n=this.getFrameNumber();this.isPlaying&&(n<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):n>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(i.Events.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(i.Events.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const t="string"==typeof e?e:e.imageId,n=a.get(i.MetadataModules.IMAGE_PLANE,t);let r=n.rowCosines,s=n.columnCosines;null!=r&&null!=s||(r=[1,0,0],s=[0,1,0]);const l=o.R3.fromValues(r[0],r[1],r[2]),c=o.R3.fromValues(s[0],s[1],s[2]),{rows:d,columns:u}=n,h=o.R3.create();o.R3.cross(h,l,c);let g=n.imagePositionPatient;null==g&&(g=[0,0,0]);const m=n.columnPixelSpacing||1,p=n.rowPixelSpacing||1,f=n.columns,v=n.rows;return this.hasPixelSpacing=!!n.columnPixelSpacing,{bitsAllocated:8,numComps:3,origin:g,rows:d,columns:u,direction:[...l,...c,...h],dimensions:[f,v,1],spacing:[m,p,1],hasPixelSpacing:this.hasPixelSpacing,numVoxels:f*v*1,imagePlaneModule:n}}setDataIds(e,t){this.setVideo(e[0],t?.viewReference?.sliceIndex||1)}setVideo(e,t){this.imageId=Array.isArray(e)?e[0]:e;const n=a.get(i.MetadataModules.IMAGE_URL,e);if(!n?.rendered)throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:o}=n,r=a.get(i.MetadataModules.GENERAL_SERIES,e);this.modality=r?.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:s,numberOfFrames:l}=a.get(i.MetadataModules.CINE,e);return this.numberOfFrames=l,this.setVideoURL(o).then((()=>(l&&1!==l||(l=Math.round(this.videoElement.duration*(s||30))),s||(s=Math.round(l/this.videoElement.duration)),this.fps=s,this.numberOfFrames=l,this.setFrameRange([1,l]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(t||1)},new Promise((e=>{window.setTimeout((()=>{this.setFrameNumber(t||1),e(this)}),25)})))))}async setVideoURL(e){return new Promise((t=>{this.videoElement.src=e,this.videoElement.preload="auto";const n=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",n),this.refreshRenderValues(),t(!0)};this.videoElement.addEventListener("loadedmetadata",n)}))}getImageIds(){const e=new Array(this.numberOfFrames),t=this.imageId.replace(/[0-9]+$/,"");for(let n=0;n<this.numberOfFrames;n++)e[n]=`${t}${n+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch(e){}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch(e){}}async scroll(e=1){await this.pause();const t=this.videoElement,n=this.renderFrame,o=t.currentTime+e*this.scrollSpeed/this.fps;t.currentTime=o;const i=e=>{n(),t.removeEventListener("seeked",i)};t.addEventListener("seeked",i)}async start(){const e=this.videoElement,t=this.renderFrame;if(e.currentTime=0,e.paused){const n=o=>{t(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async end(){const e=this.videoElement,t=this.renderFrame;if(e.currentTime=e.duration,e.paused){const n=o=>{t(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async setTime(e){const t=this.videoElement,n=this.renderFrame;if(t.currentTime=e,t.paused){const e=o=>{n(),t.removeEventListener("seeked",e)};t.addEventListener("seeked",e)}}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){e?2===e.length&&e[0]!==e[1]&&(this.frameRange=[e[0],e[1]]):this.frameRange=[1,this.numberOfFrames]}getFrameRange(){return this.frameRange}setProperties(e){void 0!==e.loop&&(this.videoElement.loop=e.loop),void 0!==e.muted&&(this.videoElement.muted=e.muted),void 0!==e.playbackRate&&this.setPlaybackRate(e.playbackRate),void 0!==e.scrollSpeed&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){this.playbackRate=e,e<.0625?this.pause():this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,t=i.VideoEnums.SpeedUnit.FRAME){this.scrollSpeed=t===i.VideoEnums.SpeedUnit.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){if(this.scalarData?.frameNumber===this.getFrameNumber())return this.scalarData;const e=document.createElement("canvas");e.width=this.videoWidth,e.height=this.videoHeight;const t=e.getContext("2d");t.drawImage(this.videoElement,0,0);const n=t.getImageData(0,0,this.videoWidth,this.videoHeight).data;return n.getRange=()=>[0,255],n.frameNumber=this.getFrameNumber(),this.scalarData=n,n}getImageData(){const{metadata:e}=this,t=e.spacing,n={dimensions:e.dimensions,spacing:t,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},getScalarData:()=>this.getScalarData(),imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:e=>{const t=this.worldToCanvas(e),n=this.canvasToIndex(t);return[n[0],n[1],0]},indexToWorld:(e,t)=>{const n=this.indexToCanvas([e[0],e[1]]);return this.canvasToWorld(n,t)}},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(n,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),n}hasImageURI(e){const t=e.match(h.frameRangeExtractor),n=t?e.substring(0,t.index):e;return-1!==this.imageId.indexOf(n)}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,t=128){const n=t-e/2,o=t+e/2-1;this.setVOI({lower:n,upper:o}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite)return void(this.feFilter=null);const e=this.averageWhite||[255,255,255],t=Math.max(...e),n=e.map((e=>t/e)),{lower:o=0,upper:i=255}=this.voiRange||{},a=(i-o+1)/255,r=o/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${n[0]*a} 0 0 0 ${r}           0 ${n[1]*a} 0 0 ${r}           0 0 ${n[2]*a} 0 ${r}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:t,focalPoint:n}=e;if(t&&(this.videoCamera.parallelScale=this.element.clientHeight/2/t),void 0!==n){const e=this.worldToCanvas(n),t=[this.element.clientWidth/2,this.element.clientHeight/2],o=[(e[0]-t[0])/this.videoCamera.parallelScale,(e[1]-t[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-o[0],this.videoCamera.panWorld[1]-o[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),!1===this.isPlaying&&this.renderFrame()}getCurrentImageId(){return this.imageId.replace("/frames/1",this.isPlaying?`/frames/${this.frameRange[0]}-${this.frameRange[1]}`:`/frames/${this.getFrameNumber()}`)}getReferenceId(e={}){const{sliceIndex:t}=e;if(void 0===t)return`videoId:${this.getCurrentImageId()}`;if(Array.isArray(t))return`videoId:${this.imageId.substring(0,this.imageId.length-1)}${t[0]+1}-${t[1]+1}`;return`videoId:${this.imageId.replace("/frames/1",`/frames/${1+t}`)}`}isReferenceViewable(e,t={}){let{imageURI:n}=t;const{referencedImageId:o,sliceIndex:i}=e;if(!super.isReferenceViewable(e))return!1;const a=this.getCurrentImageId();if(!n){const e=a.indexOf(":");n=a.substring(e+1,a.length-1)}if(t.withNavigation)return!0;const r=this.getSliceIndex();if(Array.isArray(i))return r>=i[0]&&r<=i[1];if(void 0!==i)return r===i;if(!o)return!1;const s=o.match(h.frameRangeExtractor);if(!s||!s[2])return!0;const l=s[2].split("-").map((e=>Number(e))),c=r+1;return l[0]<=c&&c<=(l[1]??l[0])}setViewReference(e){"number"==typeof e.sliceIndex?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){let t=e?.sliceIndex;return t||(t=this.isPlaying?[this.frameRange[0]-1,this.frameRange[1]-1]:this.getCurrentImageIdIndex()),{...super.getViewReference(e),referencedImageId:this.getReferenceId(e),sliceIndex:t}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,t=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(t),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const t=Math.floor(this.videoWidth*e),n=Math.floor(this.videoHeight*e),o=(this.canvas.offsetWidth-t)/2/e,i=(this.canvas.offsetHeight-n)/2/e;this.videoCamera.panWorld=[o,i],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,t=window.devicePixelRatio||1,n=this.getWorldToCanvasRatio(),o=this.getCanvasToWorldRatio(),i=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],a=[i[0]*o,i[1]*o],s=new r.w;return s.scale(t,t),s.translate(i[0],i[1]),s.scale(n,n),s.translate(e[0],e[1]),s.translate(-a[0],-a[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const t=this.getActors();e.forEach((e=>{const n=u.ZP.getImage(e.imageId),o=this.createActorMapper(n);o&&(t.push({uid:e.actorUID,actor:o}),e.callback&&e.callback({imageActor:o,imageId:e.imageId}))})),this.setActors(t)}createActorMapper(e){return new d.Z(this,e)}}const g=h},68467:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const o=async function(e,t,n){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!n.addImages)return void console.warn(`Viewport with Id ${t} does not have addImages. Cannot add image segmentation to this viewport.`)}const o=n.map((async n=>e.getViewport(n).addImages(t)));await Promise.all(o)}},87301:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(36205);const i=async function(e,t,n,i=!1,a=!1){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!(n instanceof o.Z))return void console.warn(`Viewport with Id ${t} is not a BaseVolumeViewport. Cannot add volume to this viewport.`)}const r=n.map((async n=>{const o=e.getViewport(n);await o.addVolumes(t,i,a)}));await Promise.all(r)}},43877:(e,t,n)=>{"use strict";n.d(t,{Wl:()=>o.Z,yP:()=>l});var o=n(51945),i=n(52813);const a=[0,0,0,0];function r(e,t){let n=0,o=e.length-1;for(;n<=o;){const i=n+Math.floor((o-n)/2),a=e[i];if(a===t)return i;t<a?o=i-1:n=i+1}return n}function s(e,t,n){let o;const i=[],a=[],s=[],l=[];for(n=null===n?1:n,o=0;o<t.length;o++){const n=t[o];i.push((e-1)*n[0]),a.push(n[1]),s.push(n[1])}const c=function(e,t,n){const o=(t-e)/((n=null===n?100:n)-1),i=[];for(;n-- >0;)i.push(e),e+=o;return i[i.length-1]=t,i}(0,1,e);for(o=0;o<e;o++)c[o]=(e-1)*Math.pow(c[o],n);const d=function(e,t){let n;const o=[],i=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<i;n++)o[n]=r(e,t[n]);return o}(i,c);for(o=1;o<e-1;o++){const e=d[o],t=(c[o]-i[e-1])/(i[e]-i[e-1]),n=a[e]-s[e-1];l[o]=t*n+s[e-1]}return l[0]=s[0],l[e-1]=a[t.length-1],l}function l(e,t){let n=i.Z[e];n||(n=i.Z[e]=t||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=function(e,t,n){let o;const i=[];n=null===n?1:n;const a=s(t=null===t?256:t,e.red,n),r=s(t,e.green,n),l=s(t,e.blue,n);for(o=0;o<t;o++){const e=[Math.round(255*a[o]),Math.round(255*r[o]),Math.round(255*l[o]),255];i.push(e)}return i}(n.segmentedData,n.numColors,n.gamma));return{getId:()=>e,getColorSchemeName:()=>n.name,setColorSchemeName(e){n.name=e},getNumberOfColors:()=>n.colors.length,setNumberOfColors(e){for(;n.colors.length<e;)n.colors.push(a);n.colors.length=e},getColor(e){return this.isValidIndex(e)?n.colors[e]:a},getColorRepeating(e){const t=n.colors.length;return e=t?e%t:0,this.getColor(e)},setColor(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor(e){n.colors.push(e)},insertColor(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors(){n.colors=[]},buildLookupTable(e){if(!e)return;const t=n.colors.length;e.setNumberOfTableValues(t);for(let o=0;o<t;o++)e.setTableValue(o,n.colors[o])},createLookupTable(){const e=new o.Z;return this.buildLookupTable(e),e},isValidIndex:e=>e>=0&&e<n.colors.length}}},98165:(e,t,n)=>{"use strict";function o(){return window.performance?performance.now():Date.now()}function i(e,t,n){return n?function(e){const t=Math.max(...e.lut).toString(2).length-8,n=e.lut[0]>>t,o=e.lut[e.lut.length-1]>>t,i=e.firstValueMapped+e.lut.length-1;return function(a){return a<e.firstValueMapped?n:a>=i?o:e.lut[a-e.firstValueMapped]>>t}}(n):function(e,t){return function(n){const o=255*((n-(t-.5))/(e-1)+.5);return Math.min(Math.max(o,0),255)}}(e,t)}n.d(t,{Z:()=>b});var a=n(77327);function r(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const o=(0,a.Z)(e,n).getMatrix();t.setTransform(o[0],o[1],o[2],o[3],o[4],o[5])}function s(e,t){const n=e.renderingTools.lastRenderedImageId,o=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!o||o.windowCenter!==e.viewport.voi.windowCenter||o.windowWidth!==e.viewport.voi.windowWidth||o.invert!==e.viewport.invert||o.rotation!==e.viewport.rotation||o.hflip!==e.viewport.hflip||o.vflip!==e.viewport.vflip||o.modalityLUT!==e.viewport.modalityLUT||o.voiLUT!==e.viewport.voiLUT||o.colormap!==e.viewport.colormap}function l(e,t){const n=e.renderingTools.renderCanvas;n.width=t.width,n.height=t.height;const o=n.getContext("2d");o.fillStyle="white",o.fillRect(0,0,n.width,n.height);const i=o.getImageData(0,0,t.width,t.height);e.renderingTools.renderCanvasContext=o,e.renderingTools.renderCanvasData=i}function c(e){const t=e.image.imageId,n=e.viewport,o=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=o,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools}function d(e,t){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&e.cachedLut.invert===t.invert||(function(e,t,n,o,a){const r=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0);if(void 0===e.cachedLut){const t=r-l+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(t)}const c=e.cachedLut.lutArray,d=i(Array.isArray(t)?t[0]:t,Array.isArray(n)?n[0]:n,a);if(!0===o)for(let e=s;e<=r;e++)c[e+-l]=255-d(e);else for(let e=s;e<=r;e++)c[e+-l]=d(e)}(e,t.voi.windowWidth,t.voi.windowCenter,t.invert),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert),e.cachedLut.lutArray}function u(e,t,n){const i=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&i||(e.renderingTools.renderCanvas=document.createElement("canvas"));const a=e.renderingTools.renderCanvas,{windowWidth:r,windowCenter:c}=e.viewport.voi;if((256===r||255===r)&&(128===c||127===c)&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas())return t.getCanvas();if(!1===s(e,t)&&!0!==n)return a;a.width===t.width&&a.height===t.height||l(e,t);let u=o();const h=d(t,e.viewport);t.stats=t.stats||{},t.stats.lastLutGenerateTime=o()-u;const g=e.renderingTools.renderCanvasData,m=e.renderingTools.renderCanvasContext;return t.rgba?function(e,t,n){let i=o();const a=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const r=e.minPixelValue;let s=0,l=0;const c=a.length;if(i=o(),r<0)for(;l<c;)n[s++]=t[a[l++]+-r],n[s++]=t[a[l++]+-r],n[s++]=t[a[l++]+-r],n[s++]=a[l++];else for(;l<c;)n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s++]=a[l++];e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,h,g.data):function(e,t,n){let i=o();const a=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const r=e.minPixelValue;let s=0,l=0;const c=a.length;if(i=o(),r<0)for(;l<c;)n[s++]=t[a[l++]+-r],n[s++]=t[a[l++]+-r],n[s]=t[a[l]+-r],l+=2,s+=2;else for(;l<c;)n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s]=t[a[l]],l+=2,s+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,h,g.data),u=o(),m.putImageData(g,0,0),t.stats.lastPutImageDataTime=o()-u,a}function h(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");const o=e.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0),o.fillStyle="black",o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,r(e,o);const i=u(e,n,t),a=e.viewport.displayedArea.tlhc.x-1,s=e.viewport.displayedArea.tlhc.y-1,l=e.viewport.displayedArea.brhc.x-a,d=e.viewport.displayedArea.brhc.y-s;o.drawImage(i,a,s,l,d,0,0,l,d),e.renderingTools=c(e)}function g(e,t){if(function(e){const t=e.voiLUT&&e.voiLUT.lut&&e.voiLUT.lut.length>0;return t||void 0!==e.voi.windowWidth&&void 0!==e.voi.windowCenter}(e))return;const n=t.maxPixelValue*t.slope+t.intercept,o=t.minPixelValue*t.slope+t.intercept,i=n-o,a=(n+o)/2;void 0===e.voi?e.voi={windowWidth:i,windowCenter:a}:(e.voi.windowWidth=i,e.voi.windowCenter=a)}function m(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}function p(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&m(e.cachedLut.modalityLUT,t.modalityLUT)&&m(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(g(t,e),function(e,t,n,o,a,r){const s=e.maxPixelValue,l=e.minPixelValue,c=Math.min(l,0);if(void 0===e.cachedLut){const t=s-c+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(t)}const d=e.cachedLut.lutArray,u=function(e,t,n){return n?function(e){const t=e.lut[0],n=e.lut[e.lut.length-1],o=e.firstValueMapped+e.lut.length;return i=>i<e.firstValueMapped?t:i>=o?n:e.lut[i]}(n):function(e,t){return n=>n*e+t}(e,t)}(e.slope,e.intercept,a),h=i(t,n,r);if(e.isPreScaled)if(!0===o)for(let e=l;e<=s;e++)d[e+-c]=255-h(e);else for(let e=l;e<=s;e++)d[e+-c]=h(e);else if(!0===o)for(let e=l;e<=s;e++)d[e+-c]=255-h(u(e));else for(let e=l;e<=s;e++)d[e+-c]=h(u(e))}(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray}function f(e,t,n,i=!0){const a=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&!a||(e.renderingTools.renderCanvas=document.createElement("canvas"),l(e,t));const r=e.renderingTools.renderCanvas;if(!1===s(e,t)&&!0!==n)return r;r.width===t.width&&r.height===t.height||l(e,t),t.stats=t.stats||{};const c=e.renderingTools.renderCanvasData,d=e.renderingTools.renderCanvasContext;let u=o();t.stats.lastLutGenerateTime=o()-u;const{viewport:h}=e;if("PT"===h.modality&&t.isPreScaled){const{windowWidth:e,windowCenter:n}=h.voi,i=n-e/2,a=255/(n+e/2-i);let r;r=h.invert?e=>255-(e-i)*a:e=>(e-i)*a,function(e,t,n){let i=o();const a=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const r=a.length;let s=3,l=0;for(i=o();l<r;)n[s]=t(a[l++]),s+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,r,c.data)}else{const e=p(t,h,n);i?function(e,t,n){let i=o();const a=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const r=a.length,s=e.minPixelValue;let l=3,c=0;if(i=o(),a instanceof Int16Array)if(s<0)for(;c<r;)n[l]=t[a[c++]+-s],l+=4;else for(;c<r;)n[l]=t[a[c++]],l+=4;else if(a instanceof Uint16Array)for(;c<r;)n[l]=t[a[c++]],l+=4;else if(s<0)for(;c<r;)n[l]=t[a[c++]+-s],l+=4;else for(;c<r;)n[l]=t[a[c++]],l+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,e,c.data):function(e,t,n){let i=o();const a=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const r=a.length,s=e.minPixelValue;let l,c=0,d=0;if(i=o(),a instanceof Int16Array)if(s<0)for(;d<r;)l=t[a[d++]+-s],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else for(;d<r;)l=t[a[d++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else if(a instanceof Uint16Array)for(;d<r;)l=t[a[d++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else if(s<0)for(;d<r;)l=t[a[d++]+-s],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else for(;d<r;)l=t[a[d++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,e,c.data)}return u=o(),d.putImageData(c,0,0),t.stats.lastPutImageDataTime=o()-u,r}function v(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");const o=e.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0),o.fillStyle="black",o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,r(e,o);const i=f(e,n,t),a=e.viewport.displayedArea.tlhc.x-1,s=e.viewport.displayedArea.tlhc.y-1,l=e.viewport.displayedArea.brhc.x-a,d=e.viewport.displayedArea.brhc.y-s;o.drawImage(i,a,s,l,d,0,0,l,d),e.renderingTools=c(e)}var w=n(43877);const y=function(e,t,n,i){let a=o();const r=e.getPixelData();e.stats.lastGetPixelDataTime=o()-a;const s=r.length,l=e.minPixelValue;let c,d,u,h=0,g=0;if(a=o(),u=n instanceof w.Wl?n.Table:n,l<0)for(;g<s;)c=t[r[g++]+-l],d=u[c],i[h++]=d[0],i[h++]=d[1],i[h++]=d[2],i[h++]=d[3];else for(;g<s;)c=t[r[g++]],d=u[c],i[h++]=d[0],i[h++]=d[1],i[h++]=d[2],i[h++]=d[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-a};const I=function(e,t,n,i){let a=o();const r=e.getPixelData();e.stats.lastGetPixelDataTime=o()-a;const s=r.length,l=e.minPixelValue;let c,d,u,h=0,g=0;if(a=o(),u=n instanceof w.Wl?n.Table:n,l<0)for(;g<s;)c=t(r[g++]+-l),d=u[c],i[h++]=d[0],i[h++]=d[1],i[h++]=d[2],i[h++]=d[3];else for(;g<s;)c=t(r[g++]),d=u[c],i[h++]=d[0],i[h++]=d[1],i[h++]=d[2],i[h++]=d[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-a};var C=n(56309);function x(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");const i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,r(e,i);const a=function(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));const i=e.renderingTools.renderCanvas;let a=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),a&&"string"==typeof a&&(a=w.yP(a)),!a)throw new Error("renderPseudoColorImage: colormap not found.");const r=a.getId();if(!1===s(e,t)&&!0!==n&&e.renderingTools.colormapId===r)return i;i.width===t.width&&i.height===t.height||l(e,t);let c=o();e.renderingTools.colorLUT&&!n&&e.renderingTools.colormapId===r||(a.setNumberOfColors(256),e.renderingTools.colorLUT=a.createLookupTable(),e.renderingTools.colormapId=r);const d=e.renderingTools.renderCanvasData,u=e.renderingTools.renderCanvasContext,{viewport:h}=e,g=e.renderingTools.colorLUT;if("PT"===h.modality){const{windowWidth:e,windowCenter:n}=h.voi,o=n-e/2,i=255/(n+e/2-o);let a;a=h.invert?e=>(0,C.clamp)(Math.floor(255-(e-o)*i),0,255):e=>(0,C.clamp)(Math.floor((e-o)*i),0,255),I(t,a,g,d.data)}else{const i=p(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=o()-c,y(t,i,g,d.data)}return c=o(),u.putImageData(d,0,0),t.stats.lastPutImageDataTime=o()-c,i}(e,n,t),d=e.viewport.displayedArea.tlhc.x-1,u=e.viewport.displayedArea.tlhc.y-1,h=e.viewport.displayedArea.brhc.x-d,g=e.viewport.displayedArea.brhc.y-u;i.drawImage(a,d,u,h,g,0,0,h,g),e.renderingTools=c(e)}function b(e,t){const n=e.image;if(!e.canvas||!e.image)return;const i=o();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let o=n.render;o||(o=e.viewport.colormap?x:n.color?h:v),o(e,t)}const a=o()-i;n.stats.lastRenderTime=a,e.invalid=!1,e.needsRedraw=!1}},77327:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(30742);function i(e,t){const n=new o.w;if(!e.viewport.displayedArea)return n;n.translate(e.canvas.width/2,e.canvas.height/2);const i=e.viewport.rotation;0!==i&&n.rotate(i*Math.PI/180);let a=e.viewport.scale,r=e.viewport.scale;const s=e.viewport.displayedArea.brhc.x-(e.viewport.displayedArea.tlhc.x-1),l=e.viewport.displayedArea.brhc.y-(e.viewport.displayedArea.tlhc.y-1);if("NONE"===e.viewport.displayedArea.presentationSizeMode)e.image.rowPixelSpacing<e.image.columnPixelSpacing?a*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(r*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);else if(a=e.viewport.displayedArea.columnPixelSpacing,r=e.viewport.displayedArea.rowPixelSpacing,"SCALE TO FIT"===e.viewport.displayedArea.presentationSizeMode){const t=e.canvas.height/(l*r),n=e.canvas.width/(s*a);a=r=Math.min(n,t),e.viewport.displayedArea.rowPixelSpacing<e.viewport.displayedArea.columnPixelSpacing?a*=e.viewport.displayedArea.columnPixelSpacing/e.viewport.displayedArea.rowPixelSpacing:e.viewport.displayedArea.columnPixelSpacing<e.viewport.displayedArea.rowPixelSpacing&&(r*=e.viewport.displayedArea.rowPixelSpacing/e.viewport.displayedArea.columnPixelSpacing)}return n.scale(a,r),0!==i&&n.rotate(-i*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==i&&n.rotate(i*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-l/2),n}},62705:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(55469);function i(e,t){const n=(0,o.Z)(e);return n.invert(),n.transformPoint(t)}},14419:(e,t,n)=>{"use strict";function o(e,t){const{hflip:n,vflip:o,rotation:i}=t;if(e.x*=n?-1:1,e.y*=o?-1:1,0!==i){const t=i*Math.PI/180,n=Math.cos(t),o=Math.sin(t),a=e.x*n-e.y*o,r=e.x*o+e.y*n;e.x=a,e.y=r}return e}n.d(t,{Z:()=>o})},69687:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});const o={viewport:{}};var i=n(37023);function a(e,t,n,a){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(void 0===t)return function(){const e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}};return Object.assign({},e,o.viewport)}();const r=(0,i.Z)(e,t,0).scaleFactor;let s;return"PT"===n&&t.isPreScaled?s={windowWidth:5,windowCenter:2.5}:void 0!==t.windowWidth&&void 0!==t.windowCenter&&(s={windowWidth:Array.isArray(t.windowWidth)?t.windowWidth[0]:t.windowWidth,windowCenter:Array.isArray(t.windowCenter)?t.windowCenter[0]:t.windowCenter}),{scale:r,translation:{x:0,y:0},voi:s,invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,modality:n,voiLUT:t.voiLUT,colormap:void 0!==a?a:t.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:t.columns,y:t.rows},rowPixelSpacing:void 0===t.rowPixelSpacing?1:t.rowPixelSpacing,columnPixelSpacing:void 0===t.columnPixelSpacing?1:t.columnPixelSpacing,presentationSizeMode:"NONE"}}}},37023:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(6737),i=n(19369);function a(e,t,n=null){(0,o.T)(e,"getImageScale: parameter canvas must not be undefined"),(0,o.T)(t,"getImageScale: parameter image must not be undefined");const a=(0,i.Z)(t,n),r=t.rowPixelSpacing||1,s=t.columnPixelSpacing||1;let l=1,c=1;r<s?c=s/r:l=r/s;const d=e.height/a.height/l,u=e.width/a.width/c;return{verticalScale:d,horizontalScale:u,scaleFactor:Math.min(u,d)}}},19369:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(6737);function i(e,t=null){return(0,o.T)(e,"getImageSize: parameter image must not be undefined"),(0,o.T)(e.width,"getImageSize: parameter image must have width"),(0,o.T)(e.height,"getImageSize: parameter image must have height"),function(e){return!(null==e||0===e||180===e)}(t)?{height:e.width,width:e.height}:{width:e.width,height:e.height}}},55469:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(77327);function i(e){return(0,o.Z)(e)}},48467:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(55469);function i(e,t){return(0,o.Z)(e).transformPoint(t)}},22982:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(37023);function i(e,t=!0,n=!0){const{canvas:i,image:a,viewport:r}=e,s=(0,o.Z)(i,a,0).scaleFactor;r.vflip=!1,r.hflip=!1,t&&(r.translation.x=0,r.translation.y=0),n&&(r.displayedArea.tlhc.x=1,r.displayedArea.tlhc.y=1,r.displayedArea.brhc.x=a.columns,r.displayedArea.brhc.y=a.rows,r.scale=s)}},34343:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(37023);var i=n(19369);function a(e,t=!1){const n=e.canvas.width,a=e.canvas.height;!function(e){const{canvas:t}=e,{clientWidth:n,clientHeight:o}=t;t.width===n&&t.height===o||(t.width=n,t.height=o)}(e),void 0!==e.image&&(t||function(e,t,n){const o=e.viewport.scale,a=(0,i.Z)(e.image,e.viewport.rotation),r=Math.round(a.width*o),s=Math.round(a.height*o),l=e.viewport.translation.x,c=e.viewport.translation.y;return r===t&&s<=n||r<=t&&s===n&&0===l&&0===c}(e,n,a)?function(e){const{image:t}=e;e.viewport.scale=(0,o.Z)(e.canvas,t,e.viewport.rotation).scaleFactor,e.viewport.translation.x=0,e.viewport.translation.y=0}(e):function(e,t,n){const o=e.viewport.scale,i=e.canvas.width/t,a=e.canvas.height/n,r=Math.sqrt(i*a);e.viewport.scale=r*o}(e,n,a))}},30742:(e,t,n)=>{"use strict";n.d(t,{w:()=>o});class o{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new o;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const t=this.m[0]*e[0]+this.m[2]*e[1],n=this.m[1]*e[0]+this.m[3]*e[1],o=this.m[0]*e[2]+this.m[2]*e[3],i=this.m[1]*e[2]+this.m[3]*e[3],a=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],r=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=i,this.m[4]=a,this.m[5]=r}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,o=-this.m[2]*e,i=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=i,this.m[4]=a,this.m[5]=r}rotate(e){const t=Math.cos(e),n=Math.sin(e),o=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,a=this.m[0]*-n+this.m[2]*t,r=this.m[1]*-n+this.m[3]*t;this.m[0]=o,this.m[1]=i,this.m[2]=a,this.m[3]=r}translate(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}scale(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}transformPoint(e){const t=e[0],n=e[1];return[t*this.m[0]+n*this.m[2]+this.m[4],t*this.m[1]+n*this.m[3]+this.m[5]]}}},6737:(e,t,n)=>{"use strict";function o(e,t){if(null==e)throw new Error(t)}n.d(t,{T:()=>o})},24109:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var o=n(72076),i=n(68470),a=n(91382),r=n(49445),s=n(6123);const{vtkDebugMacro:l}=i.m;const c={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),r.ZP.extend(e,t,n),t.boundsMTime={},i.m.obj(t.boundsMTime),i.m.set(e,t,["property"]),i.m.setGet(e,t,["mapper"]),i.m.getArray(e,t,["bounds"],6),function(e,t){t.classHierarchy.push("vtkVolume"),e.getVolumes=()=>e,e.makeProperty=s.ZP.newInstance,e.getProperty=()=>(null===t.property&&(t.property=e.makeProperty()),t.property),e.getBounds=()=>{if(null===t.mapper)return t.bounds;const n=t.mapper.getBounds();if(!n||6!==n.length)return n;if(n[0]>n[1])return t.mapperBounds=n.concat(),t.bounds=[1,-1,1,-1,1,-1],t.boundsMTime.modified(),n;if(!t.mapperBounds||!(i=[n,t.mapperBounds],i[0].map(((e,t)=>i.map((e=>e[t]))))).reduce(((e,t)=>e&&t[0]===t[1]),!0)||e.getMTime()>t.boundsMTime.getMTime()){l("Recomputing bounds..."),t.mapperBounds=n.map((e=>e));const i=[];a.ZP.getCorners(n,i),e.computeMatrix();const r=new Float64Array(16);o._E.transpose(r,t.matrix),i.forEach((e=>o.R3.transformMat4(e,e,r))),t.bounds[0]=t.bounds[2]=t.bounds[4]=Number.MAX_VALUE,t.bounds[1]=t.bounds[3]=t.bounds[5]=-Number.MAX_VALUE,t.bounds=t.bounds.map(((e,t)=>t%2==0?i.reduce(((e,n)=>e>n[t/2]?n[t/2]:e),e):i.reduce(((e,n)=>e<n[(t-1)/2]?n[(t-1)/2]:e),e))),t.boundsMTime.modified()}var i;return t.bounds},e.getMTime=()=>{let e=t.mtime;if(null!==t.property){const n=t.property.getMTime();e=n>e?n:e}return e},e.getRedrawMTime=()=>{let e=t.mtime;if(null!==t.mapper){let n=t.mapper.getMTime();e=n>e?n:e,null!==t.mapper.getInput()&&(t.mapper.getInputAlgorithm().update(),n=t.mapper.getInput().getMTime(),e=n>e?n:e)}return e}}(e,t)}var u={newInstance:i.m.newInstance(d,"vtkVolume"),extend:d},h=n(18588),g=n(49046),m=n(56309),p=n(7187),f=n(98230);const v=async function(e,t,n,o=!1,i=!1){const{volumeId:a,callback:r,blendMode:s}=e,l=await(0,h.loadVolume)(a);if(!l)throw new Error(`imageVolume with id: ${l.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:d}=l,v=(0,g.Z)(c,d);s&&v.setBlendMode(s);const w=u.newInstance();return w.setMapper(v),3===c.getPointData().getScalars().getNumberOfComponents()&&w.getProperty().setIndependentComponents(!1),await(0,f.Z)(w,l,i),r&&r({volumeActor:w,volumeId:a}),o||function(e,t,n,o){const i=n.getProperty().getRGBTransferFunction(0).getRange(),a={viewportId:t,range:{lower:i[0],upper:i[1]},volumeId:o};(0,m.triggerEvent)(e,p.Events.VOI_MODIFIED,a)}(t,n,w,a),w}},98230:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var o=n(62990),i=n(30023),a=n(56309),r=n(7187),s=n(82253);const l=0,c=r.RequestType.Prefetch;const d=async function(e,t,n){let r=function(e){const{imageIds:t,metadata:n}=e;let o;if(t.length){const e=t[Math.floor(t.length/2)],n=i.get("voiLutModule",e);if(n&&n.windowWidth&&n.windowCenter){const{windowWidth:e,windowCenter:t}=n;o={windowWidth:Array.isArray(e)?e[0]:e,windowCenter:Array.isArray(t)?t[0]:t}}}else o=n?.voiLut?.[0];if(o){const{lower:e,upper:t}=a.windowLevel.toLowHighRange(Number(o.windowWidth),Number(o.windowCenter));return{lower:e,upper:t}}}(t);!r&&t?.imageIds?.length&&(r=await async function(e,t){const{imageIds:n}=e,r=e.getScalarData(),d=Math.floor(n.length/2),u=e.imageIds[d],h=i.get("generalSeriesModule",u)||{},{modality:g}=h,m=i.get("modalityLutModule",u)||{},p=n.length,f=r.byteLength/p,v=r.length/p,w=r.BYTES_PER_ELEMENT,y={rescaleSlope:m.rescaleSlope,rescaleIntercept:m.rescaleIntercept,modality:g};let I;if("PT"===g){const e=i.get("scalingModule",u);e&&(I={...y,suvbw:e.suvbw})}const C=d*f,x={targetBuffer:{type:t?void 0:"Float32Array"},priority:l,requestType:c,useNativeDataType:t,preScale:{enabled:!0,scalingParameters:I}};let b=s.ZP.getImage(u);e.referencedImageIds?.length||(b=await(0,o.loadAndCacheImage)(u,{...x,ignoreCache:!0}));const E=b?b.getPixelData():function(e,t,n,o){const{scalarData:i}=e,{buffer:a}=i;i.BYTES_PER_ELEMENT!==n&&(t*=i.BYTES_PER_ELEMENT/n);const r=i.constructor,s=new r(o),l=new r(a,t,o);return s.set(l),s}(e,C,w,v),{min:S,max:T}=(0,a.getMinMax)(E);return{lower:S,upper:T}}(t,n),r=function(e,t){const n=e.imageIds,o=Math.floor(n.length/2),a=n[o];if(function(e,t){if("PT"!==e||!t.isPreScaled)return!1;if(!t.scaling?.PT.suvbw)return!1;return!0}((i.get("generalSeriesModule",a)||{}).modality,e))return{lower:0,upper:5};return t}(t,r)),0===r?.lower&&0===r?.upper||void 0===r?.lower||void 0===r?.upper||e.getProperty().getRGBTransferFunction(0).setMappingRange(r.lower,r.upper)}},51480:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>s});var o=n(6685),i=n(60337);const a={scalarTexture:null};function r(e,t,n={}){Object.assign(t,a,n),i.ZP.extend(e,t,n),o.ZP.setGet(e,t,["scalarTexture"]),function(e,t){t.classHierarchy.push("vtkSharedVolumeMapper");const n=e.delete;e.delete=()=>{t.scalarTexture=null,n()}}(e,t)}const s={newInstance:o.ZP.newInstance(r,"vtkSharedVolumeMapper"),extend:r}},5287:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var o=n(56309),i=n(74238),a=n(19546),r=n(84326);const s=1073741824;const l=new class{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageCacheSize=0,this._volumeCacheSize=0,this._maxCacheSize=3*s,this._maxInstanceSize=4294967288,this.setMaxCacheSize=e=>{if(!e||"number"!=typeof e){const e=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(e)}this._maxCacheSize=e},this.isCacheable=e=>{if(e>this._maxInstanceSize)return!1;return this.getBytesAvailable()+this._imageCacheSize>e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getMaxInstanceSize=()=>this._maxInstanceSize,this.getCacheSize=()=>this._imageCacheSize+this._volumeCacheSize,this._decacheImage=e=>{const t=this._imageCache.get(e);if(!t)return;const{imageLoadObject:n}=t;n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const t=this._volumeCache.get(e);if(!t)return;const{volumeLoadObject:n,volume:o}=t;o&&(o.cancelLoading&&o.cancelLoading(),o.imageData&&o.imageData.delete(),this._restoreImagesFromBuffer(o),n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(;;){const{value:t,done:n}=e.next();if(n)break;this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t})}this.purgeVolumeCache()},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:t,done:n}=e.next();if(n)break;this.removeVolumeLoadObject(t),(0,o.triggerEvent)(i.Z,a.Z.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:t})}},this.getVolumeLoadObject=e=>{if(void 0===e)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const t=this._volumeCache.get(e);if(t)return t.timeStamp=Date.now(),t.volumeLoadObject},this.getGeometry=e=>{if(null==e)throw new Error("getGeometry: geometryId must not be undefined");const t=this._geometryCache.get(e);if(t)return t.timeStamp=Date.now(),t.geometry},this.getImage=e=>{if(void 0===e)throw new Error("getImage: imageId must not be undefined");const t=this._imageCache.get(e);if(t)return t.timeStamp=Date.now(),t.image},this.getVolume=e=>{if(void 0===e)throw new Error("getVolume: volumeId must not be undefined");const t=this._volumeCache.get(e);if(t)return t.timeStamp=Date.now(),t.volume},this.getVolumes=()=>Array.from(this._volumeCache.values()).map((e=>e.volume)),this.filterVolumesByReferenceId=e=>this.getVolumes().filter((t=>t.referencedVolumeId===e)),this.removeImageLoadObject=e=>{if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");const t=this._imageCache.get(e);if(!t)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this.incrementImageCacheSize(-t.sizeInBytes);const n={image:t,imageId:e};(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_REMOVED,n),this._decacheImage(e)},this.removeVolumeLoadObject=e=>{if(void 0===e)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const t=this._volumeCache.get(e);if(!t)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");this.incrementVolumeCacheSize(-t.sizeInBytes);const n={volume:t,volumeId:e};(0,o.triggerEvent)(i.Z,a.Z.VOLUME_CACHE_VOLUME_REMOVED,n),this._decacheVolume(e)},this.putGeometryLoadObject=(e,t)=>{if(null==e)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");const n={geometryId:e,geometryLoadObject:t,loaded:!1,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,n),t.promise.then((t=>{if(!this._geometryCache.has(e))return void console.warn("putGeometryLoadObject: geometryId was removed from geometryCache");if(Number.isNaN(t.sizeInBytes))throw new Error("putGeometryLoadObject: geometry.sizeInBytes is not a number");n.loaded=!0,n.geometry=t,n.sizeInBytes=t.sizeInBytes;const r={geometry:t,geometryId:e};(0,o.triggerEvent)(i.Z,a.Z.GEOMETRY_CACHE_GEOMETRY_ADDED,r)})).catch((t=>{throw this._geometryCache.delete(e),t}))},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.incrementVolumeCacheSize=e=>{this._volumeCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.decrementVolumeCacheSize=e=>{this._volumeCacheSize-=e},this._geometryCache=new Map}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,t){let n=this.getBytesAvailable();if(n>=e)return n;let r=Array.from(this._imageCache.values());r.sort((function(e,t){return e.timeStamp>t.timeStamp?1:e.timeStamp<t.timeStamp?-1:0}));let s=r.map((e=>e.imageId)),l=s;t&&(l=s.filter((e=>!t.includes(e))));for(const t of l)if(this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t}),n=this.getBytesAvailable(),n>=e)return n;r=Array.from(this._imageCache.values()),s=r.map((e=>e.imageId));for(const t of s)if(this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t}),n=this.getBytesAvailable(),n>=e)return n}putImageLoadObject(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(this._imageCache.has(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,n),t.promise.then((t=>{if(!this._imageCache.get(e))return void console.warn("The image was purged from the cache before it completed loading.");if(void 0===t.sizeInBytes||Number.isNaN(t.sizeInBytes))throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");if(!this.isCacheable(t.sizeInBytes))throw new Error(a.Z.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(t.sizeInBytes),n.loaded=!0,n.image=t,n.sizeInBytes=t.sizeInBytes,this.incrementImageCacheSize(n.sizeInBytes);const r={image:n};(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_ADDED,r),n.sharedCacheKey=t.sharedCacheKey})).catch((t=>{throw this._imageCache.delete(e),t}))}getImageLoadObject(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");const t=this._imageCache.get(e);if(t)return t.timeStamp=Date.now(),t.imageLoadObject}isLoaded(e){const t=this._imageCache.get(e);return!!t&&t.loaded}getVolumeContainingImageId(e){const t=Array.from(this._volumeCache.keys()),n=(0,o.imageIdToURI)(e);for(const e of t){const t=this._volumeCache.get(e);if(!t)return;const{volume:o}=t;if(!o?.imageIds?.length)return;const i=o.getImageURIIndex(n);if(i>-1)return{volume:o,imageIdIndex:i}}}getCachedImageBasedOnImageURI(e){const t=(0,o.imageIdToURI)(e),n=Array.from(this._imageCache.keys()).find((e=>(0,o.imageIdToURI)(e)===t));if(n)return this._imageCache.get(n)}putVolumeLoadObject(e,t){if(void 0===e)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(void 0===t.promise)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const n={loaded:!1,volumeId:e,volumeLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,n),t.promise.then((t=>{if(!this._volumeCache.get(e))return void console.warn("The image was purged from the cache before it completed loading.");if(Number.isNaN(t.sizeInBytes))throw new Error("putVolumeLoadObject: volume.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putVolumeLoadObject: volume.sizeInBytes is not a number");this.decacheIfNecessaryUntilBytesAvailable(t.sizeInBytes,t.imageIds),n.volume=t,n.sizeInBytes=t.sizeInBytes,this.incrementVolumeCacheSize(n.sizeInBytes);const r={volume:n};(0,o.triggerEvent)(i.Z,a.Z.VOLUME_CACHE_VOLUME_ADDED,r)})).catch((t=>{throw this._volumeCache.delete(e),t}))}_restoreImagesFromBuffer(e){if(!(e instanceof r.J))return void console.warn("Volume is not an ImageVolume. Cannot restore images from buffer.");const t=e.getScalarData(),n=e.imageCacheOffsetMap;if(0!==n.size){for(const[e,{offset:o}]of n){const n=this.getImage(e);if(!n){console.warn(`Image with id ${e} not found in cache.`);continue}const i=n.getPixelData(),a=i.length,r=new i.constructor(t.buffer,o,a);n.getPixelData=()=>r,n.imageFrame&&(n.imageFrame.pixelData=r),delete n.bufferView,this.incrementImageCacheSize(n.sizeInBytes)}console.log(`Images restored from buffer for volume ${e.volumeId}.`)}}}},19247:(e,t,n)=>{"use strict";n.d(t,{EPSILON:()=>a,MPR_CAMERA_VALUES:()=>r.Z,RENDERING_DEFAULTS:()=>i,VIEWPORT_PRESETS:()=>s.Z});n(52813);const o={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(o);const i=o,a=.001;var r=n(21306),s=n(89469);n(43220)},49334:(e,t,n)=>{"use strict";var o;n.d(t,{Z:()=>i}),function(e){e.Interaction="interaction",e.Thumbnail="thumbnail",e.Prefetch="prefetch",e.Compute="compute"}(o||(o={}));const i=o},84659:(e,t,n)=>{"use strict";var o;n.d(t,{Z:()=>i}),function(e){e.NO_DATA="noData",e.LOADING="loading",e.PRE_RENDER="preRender",e.RESIZE="resize",e.RENDERED="rendered"}(o||(o={}));const i=o},7187:(e,t,n)=>{"use strict";n.d(t,{BlendModes:()=>d,CalibrationTypes:()=>y,DynamicOperatorType:()=>v,Events:()=>o.Z,GeometryType:()=>m,ImageQualityStatus:()=>C.Z,InterpolationType:()=>r.Z,MetadataModules:()=>b.Z,OrientationAxis:()=>h.Z,RequestType:()=>i.Z,SharedArrayBufferModes:()=>g.Z,VOILUTFunctionType:()=>f.Z,VideoEnums:()=>x,ViewportStatus:()=>I.Z,ViewportType:()=>a.Z});var o=n(19546),i=n(49334),a=n(68032),r=n(75677),s=n(83336);const{BlendMode:l}=s.default;var c;!function(e){e[e.COMPOSITE=0]="COMPOSITE",e[e.MAXIMUM_INTENSITY_BLEND=1]="MAXIMUM_INTENSITY_BLEND",e[e.MINIMUM_INTENSITY_BLEND=2]="MINIMUM_INTENSITY_BLEND",e[e.AVERAGE_INTENSITY_BLEND=3]="AVERAGE_INTENSITY_BLEND"}(c||(c={}));const d=c;var u,h=n(96426),g=n(91799);!function(e){e.CONTOUR="contour",e.SURFACE="Surface"}(u||(u={}));const m=u;n(2689);var p,f=n(67751);!function(e){e.SUM="SUM",e.AVERAGE="AVERAGE",e.SUBTRACT="SUBTRACT"}(p||(p={}));const v=p;var w;!function(e){e.NOT_APPLICABLE="",e.ERMF="ERMF",e.USER="User",e.PROJECTION="Proj",e.REGION="Region",e.ERROR="Error",e.UNCALIBRATED="Uncalibrated"}(w||(w={}));const y=w;var I=n(84659),C=n(83521),x=n(40373),b=n(636)},65279:(e,t,n)=>{"use strict";n.d(t,{O:()=>a,Yz:()=>r,ZP:()=>i,wN:()=>s});var o=n(9138);function i(e){if(!e)return;const{viewportUid:t,renderingEngineUid:n}=e.dataset;return a(t,n)}function a(e,t){if(!t||!e)return;const n=(0,o.ZP)(t);if(!n||n.hasBeenDestroyed)return;const i=n.getViewport(e);if(!i)return;const a=i.getFrameOfReferenceUID();return{viewport:i,renderingEngine:n,viewportId:e,renderingEngineId:t,FrameOfReferenceUID:a}}function r(e){const t=(0,o.Uu)();for(let n=0;n<t.length;n++){const o=t[n];if(o.getViewport(e))return a(e,o.id)}}function s(){const e=[];return(0,o.Uu)().forEach((t=>{t.getViewports().forEach((({element:t})=>{e.push(i(t))}))})),e}},12651:(e,t,n)=>{"use strict";n.d(t,{BaseVolumeViewport:()=>s.Z,CONSTANTS:()=>i,EVENTS:()=>o.Events,Enums:()=>o,Settings:()=>C,StackViewport:()=>l.Z,VideoViewport:()=>c.Z,VolumeViewport:()=>a.Z,VolumeViewport3D:()=>r.Z,addImageSlicesToViewports:()=>_.PN,addVolumesToViewports:()=>_.gc,cache:()=>h.ZP,eventTarget:()=>d.Z,geometryLoader:()=>M,getConfiguration:()=>f.P_,getEnabledElement:()=>m.ZP,getEnabledElementByIds:()=>m.O,getEnabledElementByViewportId:()=>m.Yz,getEnabledElements:()=>m.wN,getRenderingEngine:()=>u.Pr,getRenderingEngines:()=>u.Uu,getWebWorkerManager:()=>f.Pt,imageLoadPoolManager:()=>g.Z,imageLoader:()=>P,metaData:()=>p,triggerEvent:()=>R.Z,utilities:()=>A,volumeLoader:()=>T});var o=n(7187),i=n(19247),a=(n(69552),n(32932)),r=n(46190),s=n(36205),l=n(98715),c=n(49001),d=(n(86057),n(77614),n(74238)),u=n(9138),h=n(82253),g=(n(22717),n(96506)),m=n(65279),p=n(30023),f=n(28719);const v=Symbol("DefaultSettings"),w=Symbol("RuntimeSettings"),y=Symbol("ObjectSettingsMap"),I=Symbol("Dictionary");class C{constructor(e){const t=Object.create(e instanceof C&&I in e?e[I]:null);Object.seal(Object.defineProperty(this,I,{value:t}))}set(e,t){return b(this[I],e,t,null)}get(e){return function(e,t){return e[t]}(this[I],e)}unset(e){return function(e,t){if(t.endsWith(".")){let n=0;const o=t,i=o.slice(0,-1),a=0===i.length;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a||t.startsWith(o)||t===i)&&(delete e[t],++n);return n>0}return delete e[t]}(this[I],e+"")}forEach(e){x(this[I],e)}extend(){return new C(this)}import(e){E(e)&&Object.keys(e).forEach((t=>{b(this[I],t,e[t],null)}))}dump(){const e={};return x(this[I],((t,n)=>{void 0!==n&&S(e,t,n)})),e}static assert(e){return e instanceof C?e:C.getRuntimeSettings()}static getDefaultSettings(e=null){let t=C[v];if(t instanceof C||(t=new C,C[v]=t),e){const n={};return t.forEach((o=>{if(o.startsWith(e)){const i=o.split(`${e}.`)[1];n[i]=t.get(o)}})),n}return t}static getRuntimeSettings(){let e=C[w];return e instanceof C||(e=new C(C.getDefaultSettings()),C[w]=e),e}static getObjectSettings(e,t){let n=null;if(e instanceof C)n=e;else if("object"==typeof e&&null!==e){let o=C[y];o instanceof WeakMap||(o=new WeakMap,C[y]=o),n=o.get(e),n instanceof C||(n=new C(C.assert(C.getObjectSettings(t))),o.set(e,n))}return n}static extendRuntimeSettings(){return C.getRuntimeSettings().extend()}}function x(e,t){for(const n in e)t(n,e[n])}function b(e,t,n,o){return!!function(e){let t,n,o;if("string"!=typeof e||(t=e.length-1)<0)return!1;o=-1;for(;(n=e.indexOf(".",o+1))>=0;){if(n-o<2||n===t)return!1;o=n}return!0}(t)&&(E(n)?function(e,t,n,o){let i;if(o.has(n))return b(e,t,null,o);o.add(n),i=0;for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(b(e,0===a.length?t:`${t}.${a}`,n[a],o)||++i);return o.delete(n),0===i}(e,t,n,o instanceof WeakSet?o:new WeakSet):(e[t]=n,!0))}function E(e){if("object"==typeof e&&null!==e){const t=Object.getPrototypeOf(e);if(t===Object.prototype||null===t)return!0}return!1}function S(e,t,n){const o=t.indexOf(".");if(o>=0){const i=t.slice(0,o);let a=e[i];if("object"!=typeof a||null===a){const t=a;a={},void 0!==t&&(a[""]=t),e[i]=a}S(a,t.slice(o+1,t.length),n)}else e[t]=n}C.getDefaultSettings().set("useCursors",!0);var T=n(18588),P=n(62990),M=n(59469),A=(n(27654),n(56309)),R=n(85041),_=n(25281)},62990:(e,t,n)=>{"use strict";n.r(t),n.d(t,{cancelLoadAll:()=>x,cancelLoadImage:()=>I,cancelLoadImages:()=>C,createAndCacheDerivedImage:()=>v,createAndCacheDerivedImages:()=>w,createAndCacheDerivedSegmentationImage:()=>P,createAndCacheDerivedSegmentationImages:()=>T,createAndCacheLocalImage:()=>y,loadAndCacheImage:()=>p,loadAndCacheImages:()=>f,loadImage:()=>m,registerImageLoader:()=>b,registerUnknownImageLoader:()=>E,unregisterAllImageLoaders:()=>S});var o=n(5287),i=n(82253),a=n(19546),r=n(74238),s=n(56309),l=n(96506),c=n(12651);const d={};let u;function h(e,t){const n=e.indexOf(":"),o=e.substring(0,n),i=d[o];if(null==i){if(void 0!==u)return u(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}const l=i(e,t);return l.promise.then((function(e){(0,s.triggerEvent)(r.Z,a.Z.IMAGE_LOADED,{image:e})}),(function(t){const n={imageId:e,error:t};(0,s.triggerEvent)(r.Z,a.Z.IMAGE_LOAD_FAILED,n)})),l}function g(e,t){if(t.ignoreCache)return h(e,t);let n=o.Z.getImageLoadObject(e);if(void 0!==n)return n;const a=o.Z.getVolumeContainingImageId(e);if(a?.volume?.loadStatus?.loaded){const{volume:t,imageIdIndex:o}=a;return t instanceof i.JI&&(n=t.convertToCornerstoneImage(e,o)),n}const r=o.Z.getCachedImageBasedOnImageURI(e);return r?(n=r.imageLoadObject,n):(n=h(e,t),n)}function m(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");return g(e,t).promise}function p(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=g(e,t);return o.Z.getImageLoadObject(e)||o.Z.putImageLoadObject(e,n).catch((e=>{console.warn(e)})),n.promise}function f(e,t={priority:0,requestType:"prefetch"}){if(!e||0===e.length)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return e.map((e=>p(e,t)))}function v(e,t={},n=!1){if(void 0===e)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");void 0===t.imageId&&(t.imageId=`derived:${(0,s.uuidv4)()}`);const{imageId:i,skipCreateBuffer:a,onCacheAdd:r}=t,l=c.metaData.get("imagePlaneModule",e),d=l.rows*l.columns,{TypedArrayConstructor:u}=(0,s.getBufferConfiguration)(t.targetBufferType,d),h=new u(a?1:d),g=i;["imagePlaneModule","generalSeriesModule"].forEach((t=>{s.genericMetadataProvider.add(g,{type:t,metadata:c.metaData.get(t,e)})}));const m=c.metaData.get("imagePixelModule",e);s.genericMetadataProvider.add(g,{type:"imagePixelModule",metadata:{...m,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const p=y({scalarData:h,onCacheAdd:r,skipCreateBuffer:a},i,!0),f={promise:Promise.resolve(p)};return n||o.Z.putImageLoadObject(g,f),f.promise}function w(e,t={}){if(0===e?.length)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const n=[],o=e.map((e=>{const o={imageId:t.getDerivedImageId?.(e)||`derived:${(0,s.uuidv4)()}`,...t};return n.push(o.imageId),v(e,o)}));return{imageIds:n,promises:o}}function y(e,t,n=!1){const i=c.metaData.get("imagePlaneModule",t),a=i.rows*i.columns,r={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:!1,numComps:1,slope:1,minPixelValue:0,maxPixelValue:255,voiLUTFunction:void 0,rows:i.rows,columns:i.columns,getCanvas:void 0,height:i.rows,width:i.columns,rgba:void 0,columnPixelSpacing:i.columnPixelSpacing,rowPixelSpacing:i.rowPixelSpacing,invert:!1};if(e.scalarData){const t=e.scalarData;if(!(t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array||t instanceof Int16Array))throw new Error("To use createLocalVolume you should pass scalarData of type Uint8Array, Uint16Array, Int16Array or Float32Array");r.sizeInBytes=t.byteLength,r.getPixelData=()=>t}else if(!0!==e.skipCreateBuffer){const{numBytes:t,TypedArrayConstructor:n}=(0,s.getBufferConfiguration)(e.targetBufferType,a),o=new n(a);r.sizeInBytes=t,r.getPixelData=()=>o}e.onCacheAdd?.(r);const l={promise:Promise.resolve(r)};return n||o.Z.putImageLoadObject(r.imageId,l),r}function I(e){l.Z.filterRequests((({additionalDetails:t})=>!t.imageId||t.imageId!==e));const t=o.Z.getImageLoadObject(e);t&&t.cancelFn()}function C(e){e.forEach((e=>I(e)))}function x(){const e=l.Z.getRequestPool();Object.keys(e).forEach((t=>{const n=e[t];Object.keys(n).forEach((e=>{const t=n[e].pop().additionalDetails,{imageId:i,volumeId:a}=t;let r;i?r=o.Z.getImageLoadObject(i):a&&(r=o.Z.getVolumeLoadObject(a)),r&&r.cancel()})),l.Z.clearRequestStack(t)}))}function b(e,t){d[e]=t}function E(e){const t=u;return u=e,t}function S(){Object.keys(d).forEach((e=>delete d[e])),u=void 0}function T(e,t={targetBufferType:"Uint8Array"}){return w(e,t)}function P(e,t={targetBufferType:"Uint8Array"}){return v(e,t)}},18588:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createAndCacheDerivedSegmentationVolume:()=>M,createAndCacheDerivedVolume:()=>C,createAndCacheVolume:()=>I,createAndCacheVolumeFromImages:()=>b,createLocalSegmentationVolume:()=>A,createLocalVolume:()=>x,getUnknownVolumeLoaderSchema:()=>P,getVolumeLoaderSchemes:()=>S,loadVolume:()=>y,registerUnknownVolumeLoader:()=>T,registerVolumeLoader:()=>E});n(15e3);var o=n(8455),i=n(54131),a=n(84326),r=n(5287),s=n(19546),l=n(74238),c=n(85041),d=n(11677),u=n.n(d),h=n(56309),g=n(28719),m=n(85654);function p(e){const{dimensions:t,metadata:n,spacing:a,direction:r,origin:s}=e,{PhotometricInterpretation:l}=n;let c=1;"RGB"===l&&(c=3);const d=o.ZP.newInstance(),u={numberOfComponents:c};if(d.setDimensions(t),d.setSpacing(a),d.setDirection(r),d.setOrigin(s),e.isDynamicVolume()){!function(e,t,n){t.forEach(((t,o)=>{const a=i.default.newInstance({name:`timePoint-${o}`,values:t,...n});e.getPointData().addArray(a)})),e.getPointData().setActiveScalars("timePoint-0")}(d,e.getScalarDataArrays(),u)}else{!function(e,t,n){const o=i.default.newInstance({name:"Pixels",values:t,...n});e.getPointData().setScalars(o)}(d,e.getScalarData(),u)}return d}const f={};let v;function w(e,t){const n=e.indexOf(":"),o=e.substring(0,n);let i=f[o];if(null==i){if(null==v||"function"!=typeof v)throw new Error(`No volume loader for scheme ${o} has been registered`);i=v}const a=i(e,t);return(0,m.setupCacheOptimizationEventListener)(e),a.promise.then((function(e){(0,c.Z)(l.Z,s.Z.VOLUME_LOADED,{volume:e})}),(function(t){const n={volumeId:e,error:t};(0,c.Z)(l.Z,s.Z.VOLUME_LOADED_FAILED,n)})),a}function y(e,t={imageIds:[]}){if(void 0===e)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=r.Z.getVolumeLoadObject(e);return void 0!==n?n.promise:(n=w(e,t),n.promise.then((e=>(e.imageData=p(e),e))))}async function I(e,t){if(void 0===e)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=r.Z.getVolumeLoadObject(e);return void 0!==n||(n=w(e,t),n.promise.then((e=>{e.imageData=p(e)})),r.Z.putVolumeLoadObject(e,n).catch((e=>{throw e}))),n.promise}async function C(e,t){const n=r.Z.getVolume(e);if(!n)throw new Error(`Cannot created derived volume: Referenced volume with id ${e} does not exist.`);let{volumeId:s}=t;const{targetBuffer:l}=t;void 0===s&&(s=(0,h.uuidv4)());const{metadata:c,dimensions:d,spacing:g,origin:m,direction:p}=n,f=n.getScalarData().length,{volumeScalarData:v,numBytes:w}=R(l,f),y=i.default.newInstance({name:"Pixels",numberOfComponents:1,values:v}),I=o.ZP.newInstance();I.setDimensions(d),I.setSpacing(g),I.setDirection(p),I.setOrigin(m),I.getPointData().setScalars(y);const C=new a.J({volumeId:s,metadata:u()(c),dimensions:[d[0],d[1],d[2]],spacing:g,origin:m,direction:p,imageData:I,scalarData:v,sizeInBytes:w,imageIds:[],referencedVolumeId:e}),x={promise:Promise.resolve(C)};return await r.Z.putVolumeLoadObject(s,x),C}function x(e,t,n=!1){const{metadata:l,dimensions:c,spacing:d,origin:g,direction:m,targetBuffer:p}=e;let{scalarData:f}=e;const v=["Uint8Array","Float32Array","Uint16Array","Int16Array"],w=c[0]*c[1]*c[2];if(!f||!v.includes(f.constructor.name)){if(!p?.type||!v.includes(p.type))throw new Error("createLocalVolume: parameter scalarData must be provided and must be either Uint8Array, Float32Array, Uint16Array or Int16Array");({volumeScalarData:f}=R(p,w))}void 0===t&&(t=(0,h.uuidv4)());const y=r.Z.getVolume(t);if(y)return y;const I=f?f.buffer.byteLength:4*w;if(!r.Z.isCacheable(I))throw new Error(s.Z.CACHE_SIZE_EXCEEDED);const C=i.default.newInstance({name:"Pixels",numberOfComponents:1,values:f}),x=o.ZP.newInstance();x.setDimensions(c),x.setSpacing(d),x.setDirection(m),x.setOrigin(g),x.getPointData().setScalars(C);const b=new a.J({volumeId:t,metadata:u()(l),dimensions:[c[0],c[1],c[2]],spacing:d,origin:g,direction:m,imageData:x,scalarData:f,sizeInBytes:I,referencedImageIds:e.referencedImageIds||[],referencedVolumeId:e.referencedVolumeId,imageIds:e.imageIds||[]});if(n)return b;const E={promise:Promise.resolve(b)};return r.Z.putVolumeLoadObject(t,E),b}async function b(e,t,n={}){const{preventCache:o=!1}=n;if(void 0===t)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(void 0===e)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const i=r.Z.getVolume(e);if(i)return Promise.resolve(i);const s=(0,h.generateVolumePropsFromImageIds)(t,e),l=s.imageIds.map(((e,t)=>r.Z.getImageLoadObject(e).promise.then((e=>{const n=e.getPixelData(),o=t*e.rows*e.columns;s.scalarData.set(n,o)}))));await Promise.all(l);const c=new a.J({...s,referencedImageIds:t,...n});(0,m.performCacheOptimizationForVolume)(c);const d={promise:Promise.resolve(c)};return o||r.Z.putVolumeLoadObject(e,d),d.promise}function E(e,t){f[e]=t}function S(){return Object.keys(f)}function T(e){const t=v;return v=e,t}function P(){return v.name}async function M(e,t={}){return C(e,{...t,targetBuffer:{type:"Uint8Array"}})}async function A(e,t,n=!1){return e.scalarData||(e.scalarData=new Uint8Array(e.dimensions[0]*e.dimensions[1]*e.dimensions[2])),x(e,t,n)}function R(e,t){const{useNorm16Texture:n}=(0,g.P_)().rendering,{TypedArrayConstructor:o,numBytes:i}=(0,h.getBufferConfiguration)(e?.type,t,{use16BitTexture:n,isVolumeBuffer:!0});if(!r.Z.isCacheable(i))throw new Error(s.Z.CACHE_SIZE_EXCEEDED);let a;if(e?.sharedArrayBuffer??(0,g.hG)())switch(e.type){case"Float32Array":a=(0,h.createFloat32SharedArray)(t);break;case"Uint8Array":a=(0,h.createUint8SharedArray)(t);break;case"Uint16Array":case"Int16Array":a=(0,h.createUint16SharedArray)(t);break;default:throw new Error("generateVolumeScalarData: SharedArrayBuffer is not supported for the specified target buffer type")}else a=new o(t);return{volumeScalarData:a,numBytes:i}}},30023:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addProvider:()=>i,get:()=>s,removeAllProviders:()=>r,removeProvider:()=>a});const o=[];function i(e,t=0){let n;for(n=0;n<o.length&&!(o[n].priority<=t);n++);o.splice(n,0,{priority:t,provider:e})}function a(e){for(let t=0;t<o.length;t++)if(o[t].provider===e){o.splice(t,1);break}}function r(){for(;o.length>0;)o.pop()}function s(e,...t){for(let n=0;n<o.length;n++){const i=o[n].provider(e,...t);if(void 0!==i)return i}}},96506:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(42961),i=n(49334);const a=new o.P("imageLoadPool");a.grabDelay=0,a.setMaxSimultaneousRequests(i.Z.Interaction,1e3),a.setMaxSimultaneousRequests(i.Z.Thumbnail,1e3),a.setMaxSimultaneousRequests(i.Z.Prefetch,1e3);const r=a},42961:(e,t,n)=>{"use strict";n.d(t,{P:()=>a});var o=n(49334),i=n(56309);class a{constructor(e){this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.id=e||(0,i.uuidv4)(),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]},compute:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5,compute:1e3}}setMaxSimultaneousRequests(e,t){this.maxNumRequests[e]=t}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,t,n,o=0){const i={requestFn:e,type:t,additionalDetails:n};void 0===this.requestPool[t][o]&&(this.requestPool[t][o]=[]),this.requestPool[t][o].push(i),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach((t=>{const n=this.requestPool[t];Object.keys(n).forEach((t=>{n[t]=n[t].filter((t=>e(t)))}))}))}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const t=this.maxNumRequests[e]-this.numRequests[e];let n=0;for(let o=0;o<t;o++){const t=this.getNextRequest(e);if(null===t)return!1;if(t){let o;this.numRequests[e]++,this.awake=!0;try{o=t.requestFn()}catch(e){console.warn("sendRequest failed",e)}o?.finally?o.finally((()=>{this.numRequests[e]--,this.startAgain()})):(this.numRequests[e]--,n++)}}return n&&this.startAgain(),!0}getNextRequest(e){const t=this.getSortedPriorityGroups(e);for(const n of t)if(this.requestPool[e][n].length)return this.requestPool[e][n].shift();return null}startGrabbing(){const e=this.sendRequests(o.Z.Interaction),t=this.sendRequests(o.Z.Thumbnail),n=this.sendRequests(o.Z.Prefetch),i=this.sendRequests(o.Z.Compute);e||t||n||i||(this.awake=!1)}startAgain(){this.awake&&(void 0!==this.grabDelay?this.timeoutHandle||(this.timeoutHandle=window.setTimeout((()=>{this.timeoutHandle=null,this.startGrabbing()}),this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter((t=>this.requestPool[e][t].length)).sort(((e,t)=>e-t))}getRequestPool(){return this.requestPool}}},85654:(e,t,n)=>{"use strict";n.r(t),n.d(t,{performCacheOptimizationForVolume:()=>l,setupCacheOptimizationEventListener:()=>s});var o=n(82253),i=n(7187),a=n(74238),r=n(28719);function s(e){const{enableCacheOptimization:t}=(0,r.P_)(),n=(0,r.hG)();t&&n&&a.Z.addEventListenerOnce(i.Events.IMAGE_VOLUME_LOADING_COMPLETED,(t=>{if(t.detail.volumeId!==e)return;l(o.ZP.getVolume(e))}))}function l(e){if(!(e instanceof o.JI))return;const t=e.getScalarData();e.imageCacheOffsetMap.size>0?function(e,t){e.imageCacheOffsetMap.forEach((({offset:e},n)=>{const i=o.ZP.getImage(n);i&&(c(i,t,e),o.ZP.decrementImageCacheSize(i.sizeInBytes))}))}(e,t):function(e,t){let n=t;const i=e.imageIds.find((e=>o.ZP.getImage(e)));if(!i)return;const a=o.ZP.getImage(i),r=a.imageFrame?.pixelData||a.getPixelData();t.constructor!==r.constructor&&(n=new r.constructor(t.length),n.set(t));e.imageIds.forEach((t=>{const i=o.ZP.getImage(t);if(!i)return;const a=e.getImageIdIndex(t)*i.getPixelData().byteLength;c(i,n,a),o.ZP.decrementImageCacheSize(i.sizeInBytes)}))}(e,t)}function c(e,t,n){const o=e.imageFrame?e.imageFrame.pixelData:e.getPixelData(),i=new o.constructor(t.buffer,n,o.length);e.getPixelData=()=>i,e.imageFrame&&(e.imageFrame.pixelData=i),e.bufferView={buffer:t.buffer,offset:n}}},40589:(e,t,n)=>{"use strict";n.r(t),n.d(t,{findMatchingColormap:()=>d,getColormap:()=>l,getColormapNames:()=>c,registerColormap:()=>s});var o=n(31239),i=n(78001),a=n(1790);const r=new Map;function s(e){r.set(e.Name,e)}function l(e){return r.get(e)}function c(){return Array.from(r.keys())}function d(e,t){const n=o.Z.rgbPresetNames.map((e=>o.Z.getPresetByName(e))),r=c().map((e=>l(e))),s=n.concat(r).find((t=>{const{RGBPoints:n}=t;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=4)if(!(0,i.ZP)(n.slice(t+1,t+4),e.slice(t+1,t+4)))return!1;return!0}));if(!s)return null;const d=[];if((0,a.m)(t,"vtkVolume")){const e=t.getProperty().getScalarOpacity(0).getDataPointer();if(!e)return{name:s.Name};for(let t=0;t<e.length;t+=2)d.push({value:e[t],opacity:e[t+1]})}return{name:s.Name,opacity:d}}},16159:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(5193);function i(e){const t=o.ZP.newInstance();let n=0,i=1024;return e&&void 0!==e.lower&&void 0!==e.upper&&(n=e.lower,i=e.upper),t.addRGBPoint(n,0,0,0),t.addRGBPoint(i,1,1,1),t}},94791:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MultiTargetEventListenerManager:()=>i.P,TargetEventListeners:()=>o.X});var o=n(66872),i=n(91225)},47326:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(64936),i=n(61054);const a=function(e){const t=e.getCamera(),{spacingInNormalDirection:n,imageVolume:a}=(0,i.Z)(e,t);if(!a)return;const{viewPlaneNormal:r,focalPoint:s}=t,l=e.getActors().find((e=>e.referenceId===a.volumeId||e.uid===a.volumeId));l||console.warn("No actor found for with actorUID of",a.volumeId);const c=l.actor,d=(0,o.Z)(c,r,s),{min:u,max:h,current:g}=d,m=Math.round((h-u)/n)+1;let p=(g-u)/(h-u)*m;return p=Math.floor(p),p>m-1?p=m-1:p<0&&(p=0),{numberOfSlices:m,imageIndex:p}}},54526:(e,t,n)=>{"use strict";function o(e){const t=e.getSize(),n=[];for(let o=0;o<t;o++){const t=[];e.getNodeValue(o,t),n.push(t)}return n}function i(e,t){t?.length&&(e.removeAllPoints(),t.forEach((t=>{e.addRGBPoint(...t)})))}n.r(t),n.d(t,{getTransferFunctionNodes:()=>o,setTransferFunctionNodes:()=>i})},96765:(e,t,n)=>{"use strict";function o(e,t){return e.worldToIndex(t).map(Math.round)}n.d(t,{Z:()=>o})},85041:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(74238);function i(e=o.Z,t,n=null){if(!t)throw new Error("Event type was not defined");const i=new CustomEvent(t,{detail:n,cancelable:!0});return e.dispatchEvent(i)}},15291:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(28635),i=n(7187),a=n(42961);const r=class{constructor(){this.workerRegistry={},this.workerPoolManager=new a.P("webworker")}registerWorker(e,t,n={}){const{maxWorkerInstances:i=1,overwrite:a=!1,autoTerminateOnIdle:r={enabled:!1,idleTimeThreshold:3e3}}=n;if(this.workerRegistry[e]&&!a)return void console.warn(`Worker type '${e}' is already registered...`);a&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:r.enabled,idleCheckIntervalId:null,idleTimeThreshold:r.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let e=0;e<i;e++){const e=t();s.instances.push(o.Ud(e)),s.nativeWorkers.push(e),s.workerFn=t}this.workerRegistry[e]=s}getNextWorkerAPI(e){const t=this.workerRegistry[e];if(!t)return console.error(`Worker type '${e}' is not registered.`),null;const n=t.instances.filter((e=>null!==e));let i=0,a=t.loadCounters[0]||0;for(let e=1;e<n.length;e++){const n=t.loadCounters[e]||0;n<a&&(i=e,a=n)}if(null===t.instances[i]){const e=t.workerFn();t.instances[i]=o.Ud(e),t.nativeWorkers[i]=e}return t.loadCounters[i]+=1,{api:t.instances[i],index:i}}executeTask(e,t,n={},{requestType:a=i.RequestType.Compute,priority:r=0,options:s={},callbacks:l=[]}={}){return new Promise(((i,c)=>{this.workerPoolManager.addRequest((async()=>{const{api:a,index:r}=this.getNextWorkerAPI(e);if(!a){const t=new Error(`No available worker instance for '${e}'`);return console.error(t),void c(t)}try{let s=[];l.length&&(s=l.map((e=>o.sj(e))));const c=this.workerRegistry[e];c.processing=!0;const d=await a[t](n,...s);c.processing=!1,c.lastActiveTime[r]=Date.now(),c.autoTerminateOnIdle&&!c.idleCheckIntervalId&&c.idleTimeThreshold&&(c.idleCheckIntervalId=setInterval((()=>{this.terminateIdleWorkers(e,c.idleTimeThreshold)}),c.idleTimeThreshold)),i(d)}catch(n){console.error(`Error executing method '${t}' on worker '${e}':`,n),c(n)}finally{this.workerRegistry[e].loadCounters[r]--}}),a,s,r)}))}terminateIdleWorkers(e,t){const n=this.workerRegistry[e];if(n.processing)return;const o=Date.now();n.instances.forEach(((i,a)=>{const r=n.lastActiveTime[a];!(null!==r&&n.loadCounters[a]>0)&&o-r>t&&this.terminateWorkerInstance(e,a)}))}terminate(e){const t=this.workerRegistry[e];t?t.instances.forEach(((t,n)=>{this.terminateWorkerInstance(e,n)})):console.error(`Worker type '${e}' is not registered.`)}terminateWorkerInstance(e,t){const n=this.workerRegistry[e],i=n.instances[t];null!==i&&(i[o.Yy](),n.nativeWorkers[t].terminate(),n.instances[t]=null,n.lastActiveTime[t]=null)}}},77267:(e,t,n)=>{"use strict";n.d(t,{Sz:()=>g,zu:()=>h});const o={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="{{color}}" d="M8 16L8 0"></path>\n    <path stroke="{{color}}" d="M16 8L0 8"></path>\n  '},i={x:127,y:60},a='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n',r='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>\n',s='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',l='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',c='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',d={Angle:u(o,{iconContent:'<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n    10l50 50q10 10 10 23z" />',viewBox:{x:1792,y:1792}}),ArrowAnnotate:u(o,{iconContent:'<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',viewBox:{x:24,y:24}}),Bidirectional:u(o,{iconContent:'<g fill="{{color}}" stroke-width="3" stroke="{{color}}">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',viewBox:{x:48,y:48}}),CobbAngle:u(o,{iconContent:'<g stroke="{{color}}" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',viewBox:{x:32,y:32}}),CircleROI:u(o,{iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:u(o,{iconContent:'<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z" />',viewBox:{x:32,y:32}}),FreehandROI:u(o,{iconContent:'<g fill="{{color}}" stroke="{{color}}" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',viewBox:{x:18,y:18}}),FreehandROISculptor:u(o,{iconContent:'<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n  </g>',viewBox:{x:18,y:18}}),Length:u(o,{iconContent:'<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',viewBox:{x:24,y:24}}),Height:u(o,{iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:u(o,{iconContent:'<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z" />',viewBox:{x:1792,y:1792}}),RectangleROI:u(o,{iconContent:'<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),TextMarker:u(o,{iconContent:'<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />',viewBox:{x:1792,y:1792}}),Crosshairs:u(o,{iconContent:'<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />',viewBox:{x:1792,y:1792}}),Eraser:u(o,{iconContent:'<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n    0 69.5 20.5t47.5 54.5z" />',viewBox:{x:2048,y:1792}}),Magnify:u(o,{iconContent:'<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />',viewBox:{x:512,y:512}}),Pan:u(o,{iconContent:'<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />',viewBox:{x:1792,y:1792}}),Rotate:u(o,{iconContent:'<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n    39 17 39 59z" />',viewBox:{x:1792,y:1792}}),StackScroll:u(o,{iconContent:'<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />',viewBox:{x:24,y:28}}),WindowLevelRegion:u(o,{iconContent:'<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),WindowLevel:u(o,{iconContent:'\n    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />',viewBox:{x:18,y:18}}),Zoom:u(o,{iconContent:'\n  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />\n  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />',viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:u(o,{iconContent:`${s} ${a}`,viewBox:i}),SegmentationFreeHandFillInside:u(o,{iconContent:`${s} ${r}`,viewBox:i}),SegmentationFreeHandEraseOutside:u(o,{iconContent:`${s} ${a}`,viewBox:i}),SegmentationFreeHandFillOutside:u(o,{iconContent:`${s} ${r}`,viewBox:i}),SegmentationRectangleEraseInside:u(o,{iconContent:`${l} ${a}`,viewBox:i}),RectangleScissor:u(o,{iconContent:`${l} ${r}`,viewBox:i}),"RectangleScissor.FILL_INSIDE":u(o,{iconContent:`${l} ${r}`,viewBox:i}),"RectangleScissor.FILL_OUTSIDE":u(o,{iconContent:`${l} ${r}`,viewBox:i}),"RectangleScissor.ERASE_OUTSIDE":u(o,{iconContent:`${l} ${a}`,viewBox:i}),"RectangleScissor.ERASE_INSIDE":u(o,{iconContent:`${l} ${a}`,viewBox:i}),CircleScissor:u(o,{iconContent:`${c} ${r}`,viewBox:i}),"CircleScissor.FILL_INSIDE":u(o,{iconContent:`${c} ${r}`,viewBox:i}),"CircleScissor.ERASE_OUTSIDE":u(o,{iconContent:`${c} ${a}`,viewBox:i}),"CircleScissor.FILL_OUTSIDE":u(o,{iconContent:`${c} ${r}`,viewBox:i})};function u(e,t){return Object.assign(Object.create(e),t)}function h(e){return d[e]}const g=Object.keys(d)},10424:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var o=n(33232),i=n(12651);const a="viewport-element";function r(e,t){if(o.SB.svgNodeCache[e])return o.SB.svgNodeCache[e][t]?o.SB.svgNodeCache[e][t].domRef:void 0}function s(e,t,n,i){if(!o.SB.svgNodeCache[t])return null;o.SB.svgNodeCache[t][i]={touched:!0,domRef:n},e.appendChild(n)}function l(e,t){o.SB.svgNodeCache[e]&&o.SB.svgNodeCache[e][t]&&(o.SB.svgNodeCache[e][t].touched=!0)}function c(e,t){o.SB.svgNodeCache[t]&&Object.keys(o.SB.svgNodeCache[t]).forEach((n=>{const i=o.SB.svgNodeCache[t][n];!i.touched&&i.domRef&&(e.removeChild(i.domRef),delete o.SB.svgNodeCache[t][n])}))}const d=function(e){const t=(0,i.getEnabledElement)(e),{viewportId:n,renderingEngineId:d}=t,u=`${n}:${d}`,h=function(e){const t=`.${a}`,n=e.querySelector(t);return n.querySelector(":scope > .svg-layer")}(e);return Object.keys(o.SB.svgNodeCache[u]).forEach((e=>{o.SB.svgNodeCache[u][e].touched=!1})),{svgLayerElement:h,svgNodeCacheForCanvas:o.SB.svgNodeCache,getSvgNode:r.bind(this,u),appendNode:s.bind(this,h,u),setNodeTouched:l.bind(this,u),clearUntouched:c.bind(this,h,u)}};const u=function(e,t){const n=d(e);t(n),n.clearUntouched()}},22712:(e,t,n)=>{"use strict";var o;n.d(t,{default:()=>i}),function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(o||(o={}));const i=o},93725:(e,t,n)=>{"use strict";n.d(t,{segmentation:()=>i,utilities:()=>o});n(49507),n(33232),n(69562),n(93423),n(25876);var o=n(42975),i=(n(60020),n(35106),n(88706),n(95482));n(42486),n(51948),n(68096)},64311:(e,t,n)=>{"use strict";n.d(t,{getState:()=>o.Z,style:()=>i.Z});var o=n(91744),i=(n(88048),n(53122))},88706:(e,t,n)=>{"use strict";n.d(t,{config:()=>o,state:()=>i});var o=n(64311),i=(n(11163),n(91398),n(86614));n(41836),n(17433),n(58119)},36048:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var o=n(33232),i=n(68096),a=n(20346),r=n.n(a),s=n(11677),l=n.n(s),c=n(12651),d=n(60020),u=n(23118);const{Active:h,Passive:g,Enabled:m,Disabled:p}=i.ToolModes,f=[{mouseButton:i.MouseBindings.Primary}];class v{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map((({viewportId:e})=>e))}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const t=this._toolInstances[e];if(t)return t;console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`)}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,t={}){const n=o.SB.tools[e],i=void 0!==e&&""!==e,a=this.toolOptions[e];if(!i)return void console.warn("Tool with configuration did not produce a toolName: ",t);if(!n)return void console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);if(a)return void console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);const{toolClass:r}=n,s=new r({name:e,toolGroupId:this.id,configuration:t});this._toolInstances[e]=s}addToolInstance(e,t,n={}){let i=o.SB.tools[e]?.toolClass;if(!i){const n=o.SB.tools[t].toolClass;class a extends n{}a.toolName=e,i=a,o.SB.tools[e]={toolClass:a}}this.addTool(i.toolName,n)}addViewport(e,t){if("string"!=typeof e)throw new Error("viewportId must be defined and be a string");const n=(0,c.getRenderingEngines)();if(!t&&n.length>1)throw new Error("You must specify a renderingEngineId when there are multiple rendering engines.");const o=t||n[0].id;this.viewportsInfo.some((({viewportId:t})=>t===e))||this.viewportsInfo.push({viewportId:e,renderingEngineId:o});const a=this.getActivePrimaryMouseButtonTool();c.Settings.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(a);const r={toolGroupId:this.id,viewportId:e,renderingEngineId:o};(0,c.triggerEvent)(c.eventTarget,i.Events.TOOLGROUP_VIEWPORT_ADDED,r)}removeViewports(e,t){const n=[];if(this.viewportsInfo.forEach(((o,i)=>{let a=!1;o.renderingEngineId===e&&(a=!0,t&&o.viewportId!==t&&(a=!1)),a&&n.push(i)})),n.length)for(let e=n.length-1;e>=0;e--)this.viewportsInfo.splice(n[e],1);const o={toolGroupId:this.id,viewportId:t,renderingEngineId:e};(0,c.triggerEvent)(c.eventTarget,i.Events.TOOLGROUP_VIEWPORT_REMOVED,o)}setActiveStrategy(e,t){const n=this._toolInstances[e];void 0!==n?n.setActiveStrategy(t):console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`)}setToolMode(e,t,n={}){e?t!==i.ToolModes.Active?t!==i.ToolModes.Passive?t!==i.ToolModes.Enabled?t!==i.ToolModes.Disabled?console.warn("setToolMode: mode must be defined"):this.setToolDisabled(e):this.setToolEnabled(e):this.setToolPassive(e):this.setToolActive(e,n||this.restoreToolOptions[e]):console.warn("setToolMode: toolName must be defined")}setToolActive(e,t={}){const n=this._toolInstances[e];if(void 0===n)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);if(!n)return void console.warn(`'${e}' instance ${n} is not registered with this toolGroup, can't set tool mode.`);const o={bindings:[...this.toolOptions[e]?this.toolOptions[e].bindings:[],...t.bindings?t.bindings:[]].reduce(((e,t)=>{const n=void 0!==t.numTouchPoints,o=void 0!==t.mouseButton;return e.some((e=>w(e,t)))||!n&&!o||e.push(t),e}),[]),mode:h};this.toolOptions[e]=o,this._toolInstances[e].mode=h;const a=c.Settings.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(t)&&a)this.setViewportsCursorByToolName(e);else{if(!this.getActivePrimaryMouseButtonTool()&&a){const e=d.MouseCursor.getDefinedCursor("default");this._setCursorForViewports(e)}}this._hasMousePrimaryButtonBinding(t)&&(null===this.prevActivePrimaryToolName?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),"function"==typeof n.onSetToolActive&&n.onSetToolActive(),this._renderViewports();const r={toolGroupId:this.id,toolName:e,toolBindingsOptions:t};(0,c.triggerEvent)(c.eventTarget,i.Events.TOOL_ACTIVATED,r),this._triggerToolModeChangedEvent(e,h,t)}setToolPassive(e,t){const n=this._toolInstances[e];if(void 0===n)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const o=this.getToolOptions(e),i=Object.assign({bindings:o?o.bindings:[]},o,{mode:g}),a=Array.isArray(t?.removeAllBindings)?t.removeAllBindings:this.getDefaultPrimaryBindings();i.bindings=i.bindings.filter((e=>!0!==t?.removeAllBindings&&!a.some((t=>w(e,t)))));let r=g;0!==i.bindings.length&&(r=h,i.mode=r),this.toolOptions[e]=i,n.mode=r,"function"==typeof n.onSetToolPassive&&n.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,g)}setToolEnabled(e){const t=this._toolInstances[e];if(void 0===t)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const n={bindings:[],mode:m};this.toolOptions[e]=n,t.mode=m,"function"==typeof t.onSetToolEnabled&&t.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,m)}setToolDisabled(e){const t=this._toolInstances[e];if(void 0===t)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const n={bindings:[],mode:p};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=n,t.mode=p,"function"==typeof t.onSetToolDisabled&&t.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,p)}getToolOptions(e){const t=this.toolOptions[e];if(void 0!==t)return t}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find((e=>{const t=this.toolOptions[e];return t.mode===h&&this._hasMousePrimaryButtonBinding(t)}))}setViewportsCursorByToolName(e,t){const n=this._getCursor(e,t);this._setCursorForViewports(n)}_getCursor(e,t){let n,o;return t&&(n=`${e}.${t}`,o=d.SVGMouseCursor.getDefinedCursor(n,!0),o)?o:(n=`${e}`,o=d.SVGMouseCursor.getDefinedCursor(n,!0),o||(n=e,o=d.SVGMouseCursor.getDefinedCursor(n,!0),o||d.MouseCursor.getDefinedCursor("default")))}_setCursorForViewports(e){this.viewportsInfo.forEach((({renderingEngineId:t,viewportId:n})=>{const o=(0,c.getEnabledElementByIds)(n,t);if(!o)return;const{viewport:i}=o;(0,u.initElementCursor)(i.element,e)}))}setToolConfiguration(e,t,n){const o=this._toolInstances[e];if(void 0===o)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let i;return i=n?t:Object.assign(o.configuration,t),o.configuration=i,"function"==typeof o.onSetToolConfiguration&&o.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return i.MouseBindings.Primary}getDefaultPrimaryBindings(){return f}getToolConfiguration(e,t){if(void 0===this._toolInstances[e])return void console.warn(`Tool ${e} not present, can't set tool configuration.`);const n=r()(this._toolInstances[e].configuration,t)||this._toolInstances[e].configuration;return l()(n)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}clone(e,t=null){let n=o.fT.getToolGroup(e);return n?(console.warn(`ToolGroup ${e} already exists`),n):(n=o.fT.createToolGroup(e),t=t??(()=>!0),Object.keys(this._toolInstances).filter(t).forEach((e=>{const t=this._toolInstances[e],o=this.toolOptions[e],i=t.mode;n.addTool(e),n.setToolMode(e,i,{bindings:o.bindings??[]})})),n)}_hasMousePrimaryButtonBinding(e){const t=this.getDefaultPrimaryBindings();return e?.bindings?.some((e=>t.some((t=>w(e,t)))))}_renderViewports(){this.viewportsInfo.forEach((({renderingEngineId:e,viewportId:t})=>{(0,c.getRenderingEngine)(e).renderViewport(t)}))}_triggerToolModeChangedEvent(e,t,n){const o={toolGroupId:this.id,toolName:e,mode:t,toolBindingsOptions:n};(0,c.triggerEvent)(c.eventTarget,i.Events.TOOL_MODE_CHANGED,o)}}function w(e,t){return e.mouseButton===t.mouseButton&&(e.numTouchPoints===t.numTouchPoints&&e.modifierKey===t.modifierKey)}const y=function(e){if(o.SB.toolGroups.some((t=>t.id===e)))return void console.warn(`'${e}' already exists.`);const t=new v(e);return o.SB.toolGroups.push(t),t}},878:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(33232),i=n(85325);const a=function(){const e=[...o.SB.toolGroups];for(const t of e)(0,i.Z)(t.id);o.SB.toolGroups=[]}},85325:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(33232),i=n(95482),a=n(31131);const r=function(e){const t=o.SB.toolGroups.findIndex((t=>t.id===e));t>-1&&(a.ZW.removeToolGroup(e),(0,i.removeSegmentationsFromToolGroup)(e),o.SB.toolGroups.splice(t,1))}},20568:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(33232);const i=function(){return o.SB.toolGroups}},69160:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(33232);const i=function(e){return o.SB.toolGroups.find((t=>t.id===e))}},24321:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(33232),i=n(68096);const a=[i.ToolModes.Active,i.ToolModes.Passive,i.ToolModes.Enabled];const r=function(e){return o.SB.toolGroups.filter((({toolOptions:t})=>{const n=Object.keys(t);for(let o=0;o<n.length;o++)if(e===n[o]&&t[e]&&a.includes(t[e].mode))return!0;return!1}))}},56611:(e,t,n)=>{"use strict";n.d(t,{Z:()=>E});var o=n(72076),i=n(12651),a=n(39661),r=n(42975),s=n(93382),l=n(90685),c=n(86614),d=n(11163),u=n(41836),h=n(36705),g=n(25876),m=n(33232),p=n(68096),f=n(46966),v=n(79922),w=n(20724),y=n(23118),I=n(66878);const{transformWorldToIndex:C}=i.utilities;class x extends s.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:b}}){super(e,t),this.isPointNearTool=(e,t,n,o)=>{const a=(0,i.getEnabledElement)(e),{viewport:r}=a,{data:s}=t,{points:l}=s.handles;let c=r.worldToCanvas(l[0]),d=r.worldToCanvas(l[1]),u={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},h=v.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]]);return h<=o||(c=r.worldToCanvas(l[2]),d=r.worldToCanvas(l[3]),u={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},h=v.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]]),h<=o)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const a=(0,f.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:a,movingTextBox:!1},this._activateModify(o);const r=(0,i.getEnabledElement)(o),{renderingEngine:s}=r;(0,I.Z)(s,a),(0,y.hideElementCursor)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:a}=o,r=t.data;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=r.handles.points.findIndex((e=>e===n));const c=(0,f.getViewportIdsWithToolToRender)(a,this.getToolName());(0,y.hideElementCursor)(a),this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(a);const d=(0,i.getEnabledElement)(a),{renderingEngine:u}=d;(0,I.Z)(u,c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:a,viewportIdsToRender:r,newAnnotation:s,hasMoved:l}=this.editData,{data:d}=a;if(s&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,y.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);if(void 0!==this.editData.handleIndex){const{points:e}=d.handles,t=o.R3.distance(e[0],e[1]);if(o.R3.distance(e[2],e[3])>t){const t=[[...e[2]],[...e[3]]],n=[...e[0]],i=[...e[1]],a=o.K4.create();o.K4.set(a,t[1][0]-t[0][0],t[1][1]-t[1][0]);const r=o.K4.create();o.K4.set(r,-a[1],a[0]);const s=o.K4.create();let l;o.K4.set(s,i[0]-n[0],i[1]-n[0]),l=o.K4.dot(s,r)>0?[n,i]:[i,n],d.handles.points=[t[0],t[1],l[0],l[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,c.removeAnnotation)(a.annotationUID),(0,I.Z)(u,r),s&&(0,h.F$)(a),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:a}=t,r=(0,i.getEnabledElement)(a),{renderingEngine:s,viewport:l}=r,{worldToCanvas:c}=l,{annotation:d,viewportIdsToRender:u,handleIndex:h}=this.editData,{data:g}=d,m=n.world;g.handles.points[h]=[...m];const p=g.handles.points.map(c),f={start:{x:p[0][0],y:p[0][1]},end:{x:p[1][0],y:p[1][1]}},v=(p[2][0],p[2][1],p[3][0],p[3][1],o.K4.distance(p[0],p[1])/3),w=f.start.x-f.end.x,y=f.start.y-f.end.y,C=Math.sqrt(w*w+y*y),x=w/C,b=y/C,E=(f.start.x+f.end.x)/2,S=(f.start.y+f.end.y)/2,T=E+v*b,P=S-v*x,M=E-v*b,A=S+v*x;g.handles.points[2]=l.canvasToWorld([T,P]),g.handles.points[3]=l.canvasToWorld([M,A]),d.invalidated=!0,(0,I.Z)(s,u),this.editData.hasMoved=!0},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,o=(0,i.getEnabledElement)(n),{renderingEngine:a}=o,{annotation:r,viewportIdsToRender:s,handleIndex:l,movingTextBox:c}=this.editData,{data:d}=r;if(c){const{deltaPoints:e}=t,n=e.world,{textBox:o}=d.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===l){const{deltaPoints:e}=t,n=e.world;d.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),r.invalidated=!0}else this._dragModifyHandle(e),r.invalidated=!0;(0,I.Z)(a,s)},this._dragModifyHandle=e=>{const t=e.detail,{currentPoints:n,element:a}=t,r=(0,i.getEnabledElement)(a),{viewport:s}=r,{annotation:l,handleIndex:c}=this.editData,{data:d}=l,u=n.world,h=[s.worldToCanvas(d.handles.points[0]),s.worldToCanvas(d.handles.points[1]),s.worldToCanvas(d.handles.points[2]),s.worldToCanvas(d.handles.points[3])],g={start:{x:h[0][0],y:h[0][1]},end:{x:h[1][0],y:h[1][1]}},m={start:{x:h[2][0],y:h[2][1]},end:{x:h[3][0],y:h[3][1]}},p=[...u],f=s.worldToCanvas(p);if(0===c||1===c){const e=h[0===c?1:0],t=o.K4.set(o.K4.create(),f[0]-e[0],f[1]-e[1]),n=o.K4.set(o.K4.create(),h[c][0]-e[0],h[c][1]-e[1]);o.K4.normalize(t,t),o.K4.normalize(n,n);const i={start:{x:e[0],y:e[1]},end:{x:f[0],y:f[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(i,m))return;const a=e,r=this._getSignedAngle(n,t);let l=h[2][0],u=h[2][1],g=h[3][0],v=h[3][1];l-=a[0],u-=a[1],g-=a[0],v-=a[1];const w=l*Math.cos(r)-u*Math.sin(r),y=l*Math.sin(r)+u*Math.cos(r),I=g*Math.cos(r)-v*Math.sin(r),C=g*Math.sin(r)+v*Math.cos(r);l=w+a[0],u=y+a[1],g=I+a[0],v=C+a[1];const x=s.canvasToWorld([l,u]),b=s.canvasToWorld([g,v]);d.handles.points[c]=p,d.handles.points[2]=x,d.handles.points[3]=b}else{const e=2===c?3:2,t={longLineSegment:{start:g.start,end:g.end},shortLineSegment:{start:m.start,end:m.end}},n=o.K4.subtract(o.K4.create(),[t.longLineSegment.end.x,t.longLineSegment.end.y],[t.longLineSegment.start.x,t.longLineSegment.start.y]),i=o.K4.normalize(o.K4.create(),n),a=o.K4.subtract(o.K4.create(),[f[0],f[1]],[h[c][0],h[c][1]]),r=o.K4.length(a),l=this._getSignedAngle(i,a),u=Math.cos(l)*r,w=o.K4.scaleAndAdd(o.K4.create(),[h[e][0],h[e][1]],i,u);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:f[0],y:f[1]},end:{x:w[0],y:w[1]}},{start:{x:t.longLineSegment.start.x,y:t.longLineSegment.start.y},end:{x:t.longLineSegment.end.x,y:t.longLineSegment.end.y}}))return;if(!v.intersectLine([f[0],f[1]],[w[0],w[1]],[g.start.x,g.start.y],[g.end.x,g.end.y]))return;d.handles.points[e]=s.canvasToWorld(w),d.handles.points[c]=p}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,y.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:a}=t;t.highlighted=!1,a.handles.activeHandleIndex=null;const{renderingEngine:r}=(0,i.getEnabledElement)(e);return(0,I.Z)(r,n),o&&(0,h.F$)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{m.SB.isInteractingWithTool=!0,e.addEventListener(p.Events.MOUSE_UP,this._endCallback),e.addEventListener(p.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(p.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(p.Events.TOUCH_TAP,this._endCallback),e.addEventListener(p.Events.TOUCH_END,this._endCallback),e.addEventListener(p.Events.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=e=>{m.SB.isInteractingWithTool=!1,e.removeEventListener(p.Events.MOUSE_UP,this._endCallback),e.removeEventListener(p.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(p.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(p.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(p.Events.TOUCH_END,this._endCallback),e.removeEventListener(p.Events.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=e=>{m.SB.isInteractingWithTool=!0,e.addEventListener(p.Events.MOUSE_UP,this._endCallback),e.addEventListener(p.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(p.Events.TOUCH_END,this._endCallback),e.addEventListener(p.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(p.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{m.SB.isInteractingWithTool=!1,e.removeEventListener(p.Events.MOUSE_UP,this._endCallback),e.removeEventListener(p.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(p.Events.TOUCH_END,this._endCallback),e.removeEventListener(p.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(p.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!0;const{viewport:o}=e,{element:i}=o;let a=(0,c.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),s=o.getRenderingEngine(),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const c=a[i],{annotationUID:h,data:m}=c,{points:p,activeHandleIndex:f}=m.handles,v=p.map((e=>o.worldToCanvas(e)));l.annotationUID=h;const{color:y,lineWidth:I,lineDash:C,shadow:x}=this.getAnnotationStyle({annotation:c,styleSpecifier:l});if(m.cachedStats[r]&&null!=m.cachedStats[r].unit?c.invalidated&&this._throttledCalculateCachedStats(c,s,e):(m.cachedStats[r]={length:null,width:null,unit:null},this._calculateCachedStats(c,s,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let b;if(!(0,u.isAnnotationVisible)(h))continue;if((0,d.isAnnotationLocked)(c)||this.editData||null===f||(b=[v[f]]),b){const e="0";(0,g.drawHandles)(t,h,e,b,{color:y})}const E=`${h}-line-1`,S=`${h}-line-2`,T="0";(0,g.drawLine)(t,h,T,v[0],v[1],{color:y,lineDash:C,lineWidth:I,shadow:x},E);const P="1";(0,g.drawLine)(t,h,P,v[2],v[3],{color:y,lineDash:C,lineWidth:I,shadow:x},S),n=!0;const M=this.getLinkedTextBoxStyle(l,c);if(!M.visibility){m.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const A=this.configuration.getTextLines(m,r);if(!A||0===A.length)continue;let R;m.handles.textBox.hasMoved||(R=(0,w.getTextBoxCoordsCanvas)(v),m.handles.textBox.worldPosition=o.canvasToWorld(R));const _=o.worldToCanvas(m.handles.textBox.worldPosition),D="1",O=(0,g.drawLinkedTextBox)(t,h,D,A,_,v,{},M),{x:L,y:B,width:V,height:N}=O;m.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([L,B]),topRight:o.canvasToWorld([L+V,B]),bottomLeft:o.canvasToWorld([L,B+N]),bottomRight:o.canvasToWorld([L+V,B+N])}}return n},this._movingLongAxisWouldPutItThroughShortAxis=(e,t)=>{const n=o.K4.create();o.K4.set(n,t.end.x-t.start.x,t.end.y-t.start.y),o.K4.normalize(n,n);const i={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!v.intersectLine([i.start.x,i.start.y],[i.end.x,i.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])},this._calculateCachedStats=(e,t,n)=>{const{data:o}=e,{element:i}=n.viewport,r=o.handles.points[0],s=o.handles.points[1],l=o.handles.points[2],c=o.handles.points[3],{cachedStats:d}=o,u=Object.keys(d);for(let e=0;e<u.length;e++){const n=u[e],o=this.getTargetIdImage(n,t);if(!o)continue;const{imageData:i,dimensions:h}=o,g=C(i,r),m=C(i,s),p=C(i,l),f=C(i,c),v=[g,m],w=[p,f],{scale:y,units:I}=(0,a.mh)(o,v),{scale:x,units:b}=(0,a.mh)(o,w),E=this._calculateLength(r,s)/y,S=this._calculateLength(l,c)/x,T=E>S?E:S,P=E>S?S:E,M=E>S?I:b,A=E>S?b:I;this._isInsideVolume(g,m,p,f,h)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,d[n]={length:T,width:P,unit:I,lengthUnit:M,widthUnit:A}}return e.invalidated=!1,(0,h.hg)(e,i),d},this._isInsideVolume=(e,t,n,o,a)=>i.utilities.indexWithinDimensions(e,a)&&i.utilities.indexWithinDimensions(t,a)&&i.utilities.indexWithinDimensions(n,a)&&i.utilities.indexWithinDimensions(o,a),this._getSignedAngle=(e,t)=>Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1]),this._throttledCalculateCachedStats=(0,l.Z)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,r=(0,i.getEnabledElement)(o),{viewport:s,renderingEngine:l}=r;this.isDrawing=!0;const d=s.getCamera(),{viewPlaneNormal:u,viewUp:h}=d,g=this.getReferencedImageId(s,a,u,h),m=s.getFrameOfReferenceUID(),p={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...h],FrameOfReferenceUID:m,referencedImageId:g,...s.getViewReference({points:[a]})},data:{handles:{points:[[...a],[...a],[...a],[...a]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};(0,c.addAnnotation)(p,o);const v=(0,f.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,y.hideElementCursor)(o),e.preventDefault(),(0,I.Z)(l,v),p}_calculateLength(e,t){const n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+o*o+i*i)}}function b(e,t){const{cachedStats:n,label:o}=e,{length:i,width:a,unit:s,lengthUnit:l,widthUnit:c}=n[t],d=[];return o&&d.push(o),void 0===i||d.push(`L: ${(0,r.roundNumber)(i)} ${l||s}`,`W: ${(0,r.roundNumber)(a)} ${c||s}`),d}x.toolName="Bidirectional";const E=x},22455:(e,t,n)=>{"use strict";n.d(t,{Z:()=>L});var o=n(12651),i=n(72076),a=n(39661),r=n(42975),s=n(79390),l=n(44037),c=n(90685),d=n(46966),u=n(66878),h=n(75698),g=n(89026),m=n(58391),p=n(21879),f=n(82571),v=n(54435),w=n(36705),y=n(25876),I=n(20724),C=n(42744),x=n(31955),b=n(20752),E=n(15607),S=n(51053),T=n(3042),P=n(22955),M=n(68096);const{pointCanProjectOnLine:A}=s.polyline,{EPSILON:R}=o.CONSTANTS,_=1-R;class D extends P.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:M.KeyboardBindings.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:O,statsCalculator:S.BasicStatsCalculator}}){super(e,t),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=e=>{const t=e.detail,{element:n}=t,i=(0,o.getEnabledElement)(n),{renderingEngine:a}=i,r=this.createAnnotation(e);this.addAnnotation(r,n);const s=(0,d.getViewportIdsWithToolToRender)(n,this.getToolName());return this.activateDraw(e,r,s),e.preventDefault(),(0,u.Z)(a,s),r},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,a=(0,d.getViewportIdsWithToolToRender)(i,this.getToolName());this.activateOpenContourEndEdit(e,t,a,n)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n,i=(0,d.getViewportIdsWithToolToRender)(o,this.getToolName());t.data.contour.closed?this.activateClosedContourEdit(e,t,i):this.activateOpenContourEdit(e,t,i),e.preventDefault()},this.isPointNearTool=(e,t,n,i)=>{const a=(0,o.getEnabledElement)(e),{viewport:r}=a,{polyline:s}=t.data.contour;let l=r.worldToCanvas(s[0]);for(let e=1;e<s.length;e++){const t=l,o=r.worldToCanvas(s[e]);if(A(n,t,o,i))return!0;l=o}if(!t.data.contour.closed)return!1;const c=r.worldToCanvas(s[0]),d=r.worldToCanvas(s[s.length-1]);return A(n,c,d,i)},this.cancel=e=>{const t=this.isDrawing,n=this.isEditingOpen,o=this.isEditingClosed;t?this.cancelDrawing(e):n?this.cancelOpenContourEdit(e):o&&this.cancelClosedContourEdit(e)},this._calculateCachedStats=(e,t,n,i)=>{const{data:s}=e,{cachedStats:l}=s,{polyline:c,closed:d}=s.contour,u=Object.keys(l);for(let i=0;i<u.length;i++){const h=u[i],g=this.getTargetIdImage(h,n);if(!g)continue;const{imageData:m,metadata:p}=g,f=c.map((e=>t.worldToCanvas(e))),v={isPreScaled:(0,b.P)(t,h),isSuvScaled:this.isSuvScaled(t,h,e.metadata.referencedImageId)},w=(0,E.F)(p.Modality,e.metadata.referencedImageId,v),y=(0,a.mh)(g,(()=>{const e=s.contour.polyline,n=e.length,i=new Array(n);for(let o=0;o<n;o++)i[o]=t.worldToCanvas(e[o]);const{maxX:a,maxY:l,minX:c,minY:d}=r.math.polyline.getAABB(i),u=t.canvasToWorld([c,d]),h=o.utilities.transformWorldToIndex(m,u),g=t.canvasToWorld([a,l]);return[h,o.utilities.transformWorldToIndex(m,g)]}));d?this.updateClosedCachedStats({targetId:h,viewport:t,canvasCoordinates:f,points:c,imageData:m,metadata:p,cachedStats:l,modalityUnit:w,calibratedScale:y}):this.updateOpenCachedStats({metadata:p,canvasCoordinates:f,targetId:h,cachedStats:l,modalityUnit:w,calibratedScale:y})}return(0,w.hg)(e,i.viewport.element,M.ChangeTypes.StatsUpdated),e.invalidated=!1,l},this._renderStats=(e,t,n,o)=>{const{data:i}=e,a=this.getTargetId(t),r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},s=this.getLinkedTextBoxStyle(r,e);if(!s.visibility)return;const l=this.configuration.getTextLines(i,a);if(!l||0===l.length)return;const c=i.contour.polyline.map((e=>t.worldToCanvas(e)));if(!i.handles.textBox.hasMoved){const e=(0,I.getTextBoxCoordsCanvas)(c);i.handles.textBox.worldPosition=t.canvasToWorld(e)}const d=t.worldToCanvas(i.handles.textBox.worldPosition),u=(0,y.drawLinkedTextBox)(o,e.annotationUID??"","1",l,d,c,{},s),{x:h,y:g,width:m,height:p}=u;i.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([h,g]),topRight:t.canvasToWorld([h+m,g]),bottomLeft:t.canvasToWorld([h,g+p]),bottomRight:t.canvasToWorld([h+m,g+p])}},(0,h.Z)(this),(0,g.Z)(this),(0,m.Z)(this),(0,p.Z)(this),(0,f.Z)(this),(0,v.Z)(this),this._throttledCalculateCachedStats=(0,c.Z)(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,t){if(!t||!t.length)return;const n=(0,o.getEnabledElement)(e),{viewport:i}=n;let a;if(i instanceof o.VolumeViewport){const e=i.getCamera(),{spacingInNormalDirection:n}=o.utilities.getTargetVolumeAndSpacingInNormalDir(i,e);a=this.filterAnnotationsWithinSlice(t,e,n)}else a=(0,l.filterAnnotationsForDisplay)(i,t);return a}filterAnnotationsWithinSlice(e,t,n){const{viewPlaneNormal:o}=t,a=e.filter((e=>{const t=e.metadata.viewPlaneNormal,n=Math.abs(i.R3.dot(o,t))>_;return t&&n}));if(!a.length)return[];const r=n/2,{focalPoint:s}=t,l=[];for(const e of a){const t=e.data.contour.polyline[0];if(!e.isVisible)continue;const n=i.R3.create();i.R3.sub(n,s,t);const a=i.R3.dot(n,o);Math.abs(a)<r&&l.push(e)}return l}isContourSegmentationTool(){return!1}createAnnotation(e){const t=e.detail.currentPoints.world,n=super.createAnnotation(e);return o.utilities.deepMerge(n,{data:{contour:{polyline:[[...t]]},label:"",cachedStats:{}},onInterpolationComplete:e=>{e.data.handles.points.length=0}})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:t,targetId:n,svgDrawingHelper:o}=e,i=e.annotation;let a=!1;const{viewport:r,renderingEngine:s}=t,l=this.isDrawing,c=this.isEditingOpen,d=this.isEditingClosed;if(l||c||d){const e=this.commonData.annotation.annotationUID;if(i.annotationUID===e)if(l)this.renderContourBeingDrawn(t,o,i);else if(d)this.renderClosedContourBeingEdited(t,o,i);else{if(!c)throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);this.renderOpenContourBeingEdited(t,o,i)}else this.configuration.displayOnePointAsCrosshairs&&1===i.data.contour.polyline.length?this.renderPointContourWithMarker(t,o,i):this.renderContour(t,o,i);a=!0}else this.configuration.displayOnePointAsCrosshairs&&1===i.data.contour.polyline.length?this.renderPointContourWithMarker(t,o,i):this.renderContour(t,o,i);if(this.configuration.calculateStats)return this._calculateStatsIfActive(i,n,r,s,t),this._renderStats(i,r,t,o),a}_calculateStatsIfActive(e,t,n,o,i){const a=this.commonData?.annotation.annotationUID;if((e.annotationUID!==a||this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:a}=e;a.cachedStats[t]&&null!=a.cachedStats[t].areaUnit?e.invalidated&&this._throttledCalculateCachedStats(e,n,o,i):(a.cachedStats[t]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(e,n,o,i))}}updateClosedCachedStats({viewport:e,points:t,imageData:n,metadata:a,cachedStats:r,targetId:l,modalityUnit:c,canvasCoordinates:d,calibratedScale:u}){const{scale:h,areaUnits:g,units:m}=u,p=d[0],f=e.canvasToWorld(p),v=e.canvasToWorld([p[0]+1,p[1]]),w=e.canvasToWorld([p[0],p[1]+1]),y=i.R3.distance(f,v),I=i.R3.distance(f,w),b=o.utilities.transformWorldToIndex(n,t[0]);b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]);let E=b[0],S=b[0],P=b[1],M=b[1],A=b[2],R=b[2];for(let e=1;e<t.length;e++){const i=o.utilities.transformWorldToIndex(n,t[e]);i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i[2]=Math.floor(i[2]),E=Math.min(E,i[0]),S=Math.max(S,i[0]),P=Math.min(P,i[1]),M=Math.max(M,i[1]),A=Math.min(A,i[2]),R=Math.max(R,i[2])}const _=o.utilities.transformWorldToIndex(n,t[1]);_[0]=Math.floor(_[0]),_[1]=Math.floor(_[1]),_[2]=Math.floor(_[2]);let D=s.polyline.getArea(d)/h/h;D*=y*I;const O=.01*(S-E),L=.01*(M-P),B=.01*(R-A);E=Math.floor(E-O),S=Math.ceil(S+O),P=Math.floor(P-L),M=Math.ceil(M+L),A=Math.floor(A-B),R=Math.ceil(R+B);const V=[[E,S],[P,M],[A,R]],N=n.indexToWorld([S,M,R]),k=e.worldToCanvas(N);let Z=0,U=[],F=0;const j=(0,x.Z)(n,((t,n)=>{let o=!0;const i=e.worldToCanvas(t);return i[1]!=Z&&(F=0,Z=i[1],U=(0,C.getLineSegmentIntersectionsCoordinates)(d,i,[k[0],i[1]]),U.sort((function(e,t){return e[0]===t[0]?0:e[0]<t[0]?-1:1}))),U.length&&i[0]>U[0][0]&&(U.shift(),F++),F%2==0&&(o=!1),o}),this.configuration.statsCalculator.statsCallback,V),W=this.configuration.statsCalculator.getStatistics();r[l]={Modality:a.Modality,area:D,perimeter:(0,T.Z)(d,closed)/h,mean:W.mean?.value,max:W.max?.value,stdDev:W.stdDev?.value,statsArray:W.array,pointsInShape:j,areaUnit:g,modalityUnit:c,unit:m}}updateOpenCachedStats({targetId:e,metadata:t,canvasCoordinates:n,cachedStats:o,modalityUnit:i,calibratedScale:a}){const{scale:r,units:s}=a;o[e]={Modality:t.Modality,length:(0,T.Z)(n,!1)/r,modalityUnit:i,unit:s}}}function O(e,t){const n=e.cachedStats[t],{area:o,mean:i,stdDev:a,length:s,perimeter:l,max:c,isEmptyArea:d,areaUnit:u,modalityUnit:h,unit:g}=n||{},m=[];if(o){const e=d?"Area: Oblique not supported":`Area: ${(0,r.roundNumber)(o)} ${u}`;m.push(e)}return i&&m.push(`Mean: ${(0,r.roundNumber)(i)} ${h}`),Number.isFinite(c)&&m.push(`Max: ${(0,r.roundNumber)(c)} ${h}`),a&&m.push(`Std Dev: ${(0,r.roundNumber)(a)} ${h}`),l&&m.push(`Perimeter: ${(0,r.roundNumber)(l)} ${g}`),s&&m.push(`${(0,r.roundNumber)(s)} ${g}`),m}D.toolName="PlanarFreehandROI";const L=D},20406:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var o=n(12651),i=n(74297),a=n(95482),r=n(39949),s=n(14305),l=n(27078),c=n(93382),d=n(61958),u=n(78859),h=n(83456),g=n(33232),m=n(51593);const p=m.Z.toolName;class f extends c.ml{constructor(e={},t={configuration:{}}){super(e,t),this.renderSegmentation=e=>{const t=(0,l.getToolGroup)(e);if(!t)return;const n=(0,s.getSegmentationRepresentations)(e);if(!n||0===n.length)return;const a=t.viewportsInfo.map((({renderingEngineId:e,viewportId:t})=>{const n=(0,o.getEnabledElementByIds)(t,e);if(n)return n.viewport})),r=n.map((t=>{const n=this._getMergedRepresentationsConfig(e),o=[],r={[i.default.Labelmap]:h.Pm,[i.default.Contour]:u.p,[i.default.Surface]:d.o};t.type===i.default.Contour&&this.addPlanarFreeHandToolIfAbsent(e);const s=r[t.type];for(const e of a){const i=s.render(e,t,n);o.push(i)}return o}));Promise.allSettled(r).then((()=>{a.forEach((e=>{e.render()}))}))}}onSetToolEnabled(){const e=this.toolGroupId,t=(0,s.getSegmentationRepresentations)(e);t&&0!==t.length&&t.forEach((t=>{(0,r.setSegmentationVisibility)(e,t.segmentationRepresentationUID,!0)}))}onSetToolDisabled(){const e=this.toolGroupId,t=(0,s.getSegmentationRepresentations)(e);t&&0!==t.length&&t.forEach((t=>{(0,r.setSegmentationVisibility)(e,t.segmentationRepresentationUID,!1)}))}addPlanarFreeHandToolIfAbsent(e){p in g.SB.tools||(0,g.LK)(m.Z);const t=(0,l.getToolGroup)(e);t.hasTool(p)||(t.addTool(p),t.setToolPassive(p))}_getMergedRepresentationsConfig(e){const t=a.config.getToolGroupSpecificConfig(e),n=a.config.getGlobalConfig();return o.utilities.deepMerge(n,t)}}f.toolName="SegmentationDisplay";const v=f},42486:(e,t,n)=>{"use strict";n.d(t,{tv:()=>i.Z,A8:()=>o.A8,PlanarFreehandContourSegmentationTool:()=>s.Z,Hx:()=>r.Z,Qt:()=>O,Cd:()=>y,xX:()=>l.Z});var o=n(93382),i=(n(33908),n(78791),n(32e3),n(6090),n(61935),n(52826),n(13978),n(61495),n(95574),n(9260),n(25856),n(98386),n(60326)),a=(n(2235),n(51190),n(68049),n(69243),n(94021),n(86684),n(56611),n(3098),n(76131),n(86479),n(41495),n(10279)),r=(n(71330),n(87248),n(18215),n(69316),n(22455)),s=n(51593),l=(n(60682),n(57720),n(45248),n(37442),n(21491),n(28073),n(7003),n(32839),n(20406)),c=(n(13354),n(30809),n(30862),n(12651)),d=n(50097),u=n(11163),h=n(25876),g=n(46966),m=n(23118),p=n(66878),f=n(41836),v=n(36705);class w extends a.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,c.getEnabledElement)(o),{viewport:r,renderingEngine:s}=a;this.isDrawing=!0;const l=r.getCamera(),{viewPlaneNormal:u,viewUp:h}=l,f=this.getTargetId(r);let v,w;if(r instanceof c.StackViewport)v=f.split("imageId:")[1];else{w=c.utilities.getVolumeId(f);const e=c.cache.getVolume(w);v=c.utilities.getClosestImageId(e,i,u)}const y=r.getFrameOfReferenceUID(),I={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],enabledElement:a,viewUp:[...h],FrameOfReferenceUID:y,referencedImageId:v,toolName:this.getToolName(),volumeId:w},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},segmentationId:null}};(0,d.ud)(I,o);const C=(0,g.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:I,viewportIdsToRender:C,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,m.hideElementCursor)(o),e.preventDefault(),(0,p.Z)(s,C),I},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,d.fy)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const s=a[e],{annotationUID:l,data:c}=s,{points:d,activeHandleIndex:g}=c.handles,m=d.map((e=>o.worldToCanvas(e)));r.annotationUID=l;const p=this.getStyle("lineWidth",r,s),w=this.getStyle("lineDash",r,s),y=this.getStyle("color",r,s);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let I;if((0,v.hg)(s,i),!(0,f.isAnnotationVisible)(l))continue;if((0,u.isAnnotationLocked)(s)||this.editData||null===g||(I=[m[g]]),I){const e="0";(0,h.drawHandles)(t,l,e,I,{color:y})}const C="0";(0,h.drawRect)(t,l,C,m[0],m[3],{color:y,lineDash:w,lineWidth:p}),n=!0}return n}}}w.toolName="RectangleROIThreshold";const y=w;var I=n(39661),C=n(72076),x=n(90685),b=n(20724),E=n(88582),S=n(42975),T=n(15607),P=n(20752),M=n(51053),A=n(44037);const{transformWorldToIndex:R}=c.utilities;class _ extends a.Z{constructor(e={},t={configuration:{numSlicesToPropagate:10,computePointsInsideVolume:!1,getTextLines:D,statsCalculator:M.BasicStatsCalculator,showTextBox:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,c.getEnabledElement)(o),{viewport:r,renderingEngine:s}=a;this.isDrawing=!0;const l=r.getCamera(),{viewPlaneNormal:u,viewUp:h}=l;let f,v,w;if(r instanceof c.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(r);w=c.utilities.getVolumeId(e),v=c.cache.getVolume(w),f=c.utilities.getClosestImageId(v,i,u)}const y=c.utilities.getSpacingInNormalDirection(v,u),I=this._getStartCoordinate(i,u),C=this._getEndCoordinate(i,y,u),x=r.getFrameOfReferenceUID(),b={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],enabledElement:a,viewUp:[...h],FrameOfReferenceUID:x,referencedImageId:f,toolName:this.getToolName(),volumeId:w,spacingInNormal:y},data:{label:"",startCoordinate:I,endCoordinate:C,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[f],statistics:[]},handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(b,v),(0,d.ud)(b,o);const E=(0,g.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:b,viewportIdsToRender:E,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,m.hideElementCursor)(o),e.preventDefault(),(0,p.Z)(s,E),b},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:r}=this.editData,{data:s}=o;if(a&&!r)return;s.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,m.resetElementCursor)(n);const l=(0,c.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,d._x)(o.annotationUID);const u=this.getTargetId(l.viewport),h=c.cache.getVolume(u.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(o,u,h,l),(0,p.Z)(l.renderingEngine,i),a&&(0,v.F$)(o)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e;let i=(0,d.fy)(this.getToolName(),o.element);if(!i?.length)return n;i=(0,A.filterAnnotationsWithinSamePlane)(i,o.getCamera());const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<i.length;r++){const s=i[r],{annotationUID:l,data:d}=s,{startCoordinate:g,endCoordinate:m}=d,{points:p,activeHandleIndex:v}=d.handles,w=p.map((e=>o.worldToCanvas(e)));a.annotationUID=l;const y=this.getStyle("lineWidth",a,s),I=this.getStyle("lineDash",a,s),C=this.getStyle("color",a,s),x=o.getCamera().focalPoint,E=o.getCamera().viewPlaneNormal;let S=g,T=m;Array.isArray(g)&&(S=this._getCoordinateForViewplaneNormal(S,E)),Array.isArray(m)&&(T=this._getCoordinateForViewplaneNormal(T,E));const P=c.utilities.roundToPrecision(S),M=c.utilities.roundToPrecision(T),A=this._getCoordinateForViewplaneNormal(x,E),R=c.utilities.roundToPrecision(A);if(R<Math.min(P,M)||R>Math.max(P,M))continue;s.invalidated&&this._throttledCalculateCachedStats(s,e);let _,D=!1;if(R!==P&&R!==M||(D=!0),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,f.isAnnotationVisible)(l))continue;if((0,u.isAnnotationLocked)(s)||this.editData||null===v||!D||(_=[w[v]]),_){const e="0";(0,h.drawHandles)(t,l,e,_,{color:C})}let O=I;D||(O=2);const L="0";if((0,h.drawRect)(t,l,L,w[0],w[3],{color:C,lineDash:O,lineWidth:y}),n=!0,this.configuration.showTextBox&&this.configuration.calculatePointsInsideVolume){const e=this.getLinkedTextBoxStyle(a,s);if(!e.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const n=this.configuration.getTextLines(d);if(!n||0===n.length)continue;if(!d.handles.textBox.hasMoved){const e=(0,b.getTextBoxCoordsCanvas)(w);d.handles.textBox.worldPosition=o.canvasToWorld(e)}const i=o.worldToCanvas(d.handles.textBox.worldPosition),r="1",c=(0,h.drawLinkedTextBox)(t,l,r,n,i,w,{},e),{x:u,y:g,width:m,height:p}=c;d.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([u,g]),topRight:o.canvasToWorld([u+m,g]),bottomLeft:o.canvasToWorld([u,g+p]),bottomRight:o.canvasToWorld([u+m,g+p])}}}return n},this._throttledCalculateCachedStats=(0,x.Z)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:o}=e,{viewPlaneNormal:i,spacingInNormal:a}=o,{imageData:r}=t,{startCoordinate:s,endCoordinate:l}=n,{points:c}=n.handles,d=R(r,c[0]),u=R(r,c[0]),h=C.R3.create();r.indexToWorldVec3(d,h);const g=C.R3.create();r.indexToWorldVec3(u,g),2==this._getIndexOfCoordinatesForViewplaneNormal(i)?(h[2]=s,g[2]=l):0==this._getIndexOfCoordinatesForViewplaneNormal(i)?(h[0]=s,g[0]=l):1==this._getIndexOfCoordinatesForViewplaneNormal(i)&&(h[1]=s,g[1]=l);const m=C.R3.distance(h,g),p=[];for(let e=0;e<m;e+=a)p.push(c.map((t=>{const n=C.R3.create();return C.R3.scaleAndAdd(n,t,i,e),Array.from(n)})));n.cachedStats.projectionPoints=p}_computePointsInsideVolume(e,t,n,o){const{data:i,metadata:a}=e,{viewPlaneNormal:r,viewUp:s}=a,{viewport:l,renderingEngine:c}=o,d=i.cachedStats.projectionPoints,u=[[]],h=this.getTargetIdImage(t,c),g=i.handles.points[0],m=i.handles.points[3],{worldWidth:p,worldHeight:f}=(0,E.Z)(r,s,g,m),v=(0,I.mh)(h,i.habdles),w=Math.abs(p*f)/(v.scale*v.scale),y={isPreScaled:(0,P.P)(l,t),isSuvScaled:this.isSuvScaled(l,t,e.metadata.referencedImageId)},C=(0,T.F)(a.Modality,e.metadata.referencedImageId,y);for(let e=0;e<d.length;e++){if(!n)continue;const t=d[e][0],{dimensions:o,imageData:i}=n,a=R(i,g),s=R(i,t),l=this._getIndexOfCoordinatesForViewplaneNormal(r);a[0]=Math.floor(a[0]),a[1]=Math.floor(a[1]),a[2]=Math.floor(a[2]),a[l]=s[l];const c=R(i,m);if(c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c[2]=Math.floor(c[2]),c[l]=s[l],this._isInsideVolume(a,c,o)){this.isHandleOutsideImage=!1;const e=[[Math.min(a[0],c[0]),Math.max(a[0],c[0])],[Math.min(a[1],c[1]),Math.max(a[1],c[1])],[Math.min(a[2],c[2]),Math.max(a[2],c[2])]],t=(0,S.pointInShapeCallback)(i,(()=>!0),this.configuration.statsCalculator.statsCallback,e);u.push(t)}}const x=this.configuration.statsCalculator.getStatistics();i.cachedStats.pointsInVolume=u,i.cachedStats.statistics={Modality:a.Modality,area:w,mean:x.mean?.value,stdDev:x.stdDev?.value,max:x.max?.value,statsArray:x.array,areaUnit:v.areaUnits,modalityUnit:C}}_calculateCachedStatsTool(e,t){const n=e.data,{viewport:o}=t,{cachedStats:i}=n,a=this.getTargetId(o),r=c.cache.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,r),e.invalidated=!1,(0,v.hg)(e,o.element),i}_getStartCoordinate(e,t){const n=e;return this._getCoordinateForViewplaneNormal(n,t)}_getEndCoordinate(e,t,n){const o=this.configuration.numSlicesToPropagate,i=C.R3.create();C.R3.scaleAndAdd(i,e,n,o*t);return this._getCoordinateForViewplaneNormal(i,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t.indexOf(Math.max(...t))}_getCoordinateForViewplaneNormal(e,t){return e[this._getIndexOfCoordinatesForViewplaneNormal(t)]}}function D(e){const t=e.cachedStats.statistics,{area:n,mean:o,max:i,stdDev:a,areaUnit:r,modalityUnit:s}=t;if(void 0===o)return;const l=[];return l.push(`Area: ${(0,S.roundNumber)(n)} ${r}`),l.push(`Mean: ${(0,S.roundNumber)(o)} ${s}`),l.push(`Max: ${(0,S.roundNumber)(i)} ${s}`),l.push(`Std Dev: ${(0,S.roundNumber)(a)} ${s}`),l}_.toolName="RectangleROIStartEndThreshold";const O=_;n(2023),n(95459),n(78566),n(3402),n(45986)},81404:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addContourSegmentationAnnotation:()=>a.D,areSameSegment:()=>o.Z,isContourSegmentationAnnotation:()=>i.Z,removeContourSegmentationAnnotation:()=>r.E});var o=n(40682),i=n(75170),a=n(52577),r=n(31514)},42975:(e,t,n)=>{"use strict";n.r(t),n.d(t,{annotationFrameRange:()=>I.Z,annotationHydration:()=>b.M,boundingBox:()=>O,calibrateImageSpacing:()=>d.Z,cine:()=>D,clip:()=>c.ZP,contourSegmentation:()=>j,contours:()=>E,debounce:()=>r.Z,drawing:()=>T,dynamicVolume:()=>Z,getAnnotationNearPoint:()=>a.r,getAnnotationNearPointOnEnabledElement:()=>a.U,getCalibratedAspect:()=>u.G6,getCalibratedLengthUnitsAndScale:()=>u.mh,getCalibratedProbeUnitsAndValue:()=>u.Sh,getClosestImageIdForStackViewport:()=>b.B,getSphereBoundsInfo:()=>v.v,getViewportForAnnotation:()=>x.Z,isObject:()=>l.Z,jumpToSlice:()=>p.Z,math:()=>P,orientation:()=>o,planar:()=>M,planarFreehandROITool:()=>L,pointInShapeCallback:()=>f.Z,pointInSurroundingSphereCallback:()=>C.Z,pointToString:()=>y.s,polyDataUtils:()=>U,rectangleROITool:()=>B,roundNumber:()=>W,scroll:()=>w.Z,segmentation:()=>S,stackContextPrefetch:()=>V.l,stackPrefetch:()=>V.U,throttle:()=>s.Z,touch:()=>k,triggerAnnotationRender:()=>m.ZP,triggerAnnotationRenderForToolGroupIds:()=>g.Z,triggerAnnotationRenderForViewportIds:()=>h.Z,triggerEvent:()=>i.triggerEvent,viewport:()=>N,viewportFilters:()=>A,voi:()=>F});var o={};n.r(o),n.d(o,{getOrientationStringLPS:()=>R.Z,invertOrientationStringLPS:()=>_.Z});var i=n(12651),a=n(62358),r=n(82298),s=n(90685),l=n(73609),c=n(70232),d=n(90892),u=n(39661),h=n(66878),g=n(70180),m=n(64307),p=n(68009),f=n(31955),v=n(28921),w=n(63478),y=n(5205),I=n(52600),C=n(70134),x=n(82220),b=n(13278),E=n(11203),S=n(70184),T=n(20724),P=n(79390),M=n(44037),A=n(46966),R=n(67958),_=n(67125),D=n(51563),O=n(87758),L=n(28861),B=n(78536),V=n(2185),N=n(85217),k=n(25068),Z=n(62379),U=n(89977),F=n(54166),j=n(81404);const W=i.utilities.roundNumber},79390:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BasicStatsCalculator:()=>i,aabb:()=>o,ellipse:()=>a,lineSegment:()=>r,point:()=>s,polyline:()=>l,rectangle:()=>c,vec2:()=>d});var o=n(5260),i=n(51053),a=n(92600),r=n(79922),s=n(74474),l=n(42744),c=n(81671),d=n(13230)},70184:(e,t,n)=>{"use strict";n.r(t),n.d(t,{contourAndFindLargestBidirectional:()=>p.Z,createBidirectionalToolData:()=>f.Z,createImageIdReferenceMap:()=>m.A,createLabelmapVolumeForViewport:()=>l.Z,createMergedLabelmapForIndex:()=>a.Z,floodFill:()=>d.Z,getBrushSizeForToolGroup:()=>u.G,getBrushThresholdForToolGroup:()=>h.H,getBrushToolInstances:()=>b.Xb,getDefaultRepresentationConfig:()=>s.Z,getHoveredContourSegmentationAnnotation:()=>x.P,getSegmentAtLabelmapBorder:()=>C.T,getSegmentAtWorldPoint:()=>I.uA,getUniqueSegmentIndices:()=>y.t7,invalidateBrushCursor:()=>w.C,isValidRepresentationConfig:()=>r.Z,rectangleROIThresholdVolumeByRange:()=>i.Z,segmentContourAction:()=>v.Z,setBrushSizeForToolGroup:()=>u.d,setBrushThresholdForToolGroup:()=>h.h,thresholdSegmentationByRange:()=>g.Z,thresholdVolumeByRange:()=>o.Z,triggerSegmentationRender:()=>c.ih});var o=n(10018),i=n(69367),a=n(71880),r=n(75702),s=n(8297),l=n(64618),c=n(31131),d=n(2680),u=n(39427),h=n(78005),g=n(42425),m=n(10190),p=n(74484),f=n(36059),v=n(61999),w=n(4229),y=n(23267),I=n(47138),C=n(50972),x=n(5992),b=n(89776)},81659:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Colorbar:()=>i.Y,Enums:()=>o,ViewportColorbar:()=>a.l});var o=n(57091),i=n(53766),a=n(2091)},44031:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>s});var o=n(68470);const{vtkErrorMacro:i}=o.m;const a={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),o.m.obj(e,t),t.nodes=[],o.m.setGet(e,t,["allowDuplicateScalars","clamping"]),o.m.setArray(e,t,["range"],2),o.m.getArray(e,t,["range"]),function(e,t){t.classHierarchy.push("vtkPiecewiseFunction"),e.getSize=()=>t.nodes.length,e.getType=()=>{let e,n=0,o=0;t.nodes.length>0&&(n=t.nodes[0].y);for(let i=1;i<t.nodes.length;i++){if(e=t.nodes[i].y,e!==n)if(e>n)switch(o){case 0:case 1:o=1;break;default:o=3}else switch(o){case 0:case 2:o=2;break;default:o=3}if(n=e,3===o)break}switch(o){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";default:return"Varied"}},e.getDataPointer=()=>{const e=t.nodes.length;if(t.function=null,e>0){t.function=[];for(let n=0;n<e;n++)t.function[2*n]=t.nodes[n].x,t.function[2*n+1]=t.nodes[n].y}return t.function},e.getFirstNonZeroValue=()=>{if(0===t.nodes.length)return 0;let e=1,n=0,o=0;for(;o<t.nodes.length;o++)if(0!==t.nodes[o].y){e=0;break}return n=e?Number.MAX_VALUE:o>0?t.nodes[o-1].x:t.clamping?-Number.MAX_VALUE:t.nodes[0].x,n},e.getNodeValue=(e,n)=>{const o=t.nodes.length;return e<0||e>=o?(i("Index out of range!"),-1):(n[0]=t.nodes[e].x,n[1]=t.nodes[e].y,n[2]=t.nodes[e].midpoint,n[3]=t.nodes[e].sharpness,1)},e.setNodeValue=(n,o)=>{const a=t.nodes.length;if(n<0||n>=a)return i("Index out of range!"),-1;const r=t.nodes[n].x;return t.nodes[n].x=o[0],t.nodes[n].y=o[1],t.nodes[n].midpoint=o[2],t.nodes[n].sharpness=o[3],r!==o[0]?e.sortAndUpdateRange():e.modified(),1},e.addPoint=(t,n)=>e.addPointLong(t,n,.5,0),e.addPointLong=(n,o,a,r)=>{if(a<0||a>1)return i("Midpoint outside range [0.0, 1.0]"),-1;if(r<0||r>1)return i("Sharpness outside range [0.0, 1.0]"),-1;t.allowDuplicateScalars||e.removePoint(n);const s={x:n,y:o,midpoint:a,sharpness:r};let l;for(t.nodes.push(s),e.sortAndUpdateRange(),l=0;l<t.nodes.length&&t.nodes[l].x!==n;l++);return l<t.nodes.length?l:-1},e.setNodes=n=>{t.nodes!==n&&(t.nodes=n,e.sortAndUpdateRange())},e.sortAndUpdateRange=()=>{t.nodes.sort(((e,t)=>e.x-t.x)),e.updateRange()||e.modified()},e.updateRange=()=>{const n=t.range.slice(),o=t.nodes.length;return o?(t.range[0]=t.nodes[0].x,t.range[1]=t.nodes[o-1].x):(t.range[0]=0,t.range[1]=0),(n[0]!==t.range[0]||n[1]!==t.range[1])&&(e.modified(),!0)},e.removePoint=n=>{let o;for(o=0;o<t.nodes.length&&t.nodes[o].x!==n;o++);if(o>=t.nodes.length)return-1;const i=o;let a=!1;return t.nodes.splice(o,1),0!==o&&o!==t.nodes.length||(a=e.updateRange()),a||e.modified(),i},e.removeAllPoints=()=>{t.nodes=[],e.sortAndUpdateRange()},e.addSegment=(n,o,i,a)=>{e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n&&t.nodes[e].x<=i?t.nodes.splice(e,1):e++;e.addPoint(n,o,.5,0),e.addPoint(i,a,.5,0)},e.getValue=t=>{const n=[];return e.getTable(t,t,1,n),n[0]},e.adjustRange=n=>{if(n.length<2)return 0;const o=e.getRange();o[0]<n[0]?e.addPoint(n[0],e.getValue(n[0])):e.addPoint(n[0],e.getValue(o[0])),o[1]>n[1]?e.addPoint(n[1],e.getValue(n[1])):e.addPoint(n[1],e.getValue(o[1])),e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n[0]&&t.nodes[e].x<=n[1]?t.nodes.splice(e,1):++e;return e.sortAndUpdateRange(),1},e.estimateMinNumberOfSamples=(t,n)=>{const o=e.findMinimumXDistance();return Math.ceil((n-t)/o)},e.findMinimumXDistance=()=>{const e=t.nodes.length;if(e<2)return-1;let n=t.nodes[1].x-t.nodes[0].x;for(let o=0;o<e-1;o++){const e=t.nodes[o+1].x-t.nodes[o].x;e<n&&(n=e)}return n},e.getTable=function(e,n,o,i){let a,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=0;const l=t.nodes.length;let c=0;0!==l&&(c=t.nodes[l-1].y);let d=0,u=0,h=0,g=0,m=0,p=0,f=0;for(a=0;a<o;a++){const v=r*a;for(d=o>1?e+a/(o-1)*(n-e):.5*(e+n);s<l&&d>t.nodes[s].x;)s++,s<l&&(u=t.nodes[s-1].x,h=t.nodes[s].x,g=t.nodes[s-1].y,m=t.nodes[s].y,p=t.nodes[s-1].midpoint,f=t.nodes[s-1].sharpness,p<1e-5&&(p=1e-5),p>.99999&&(p=.99999));if(s>=l)i[v]=t.clamping?c:0;else if(0===s)i[v]=t.clamping?t.nodes[0].y:0;else{let e=(d-u)/(h-u);if(e=e<p?.5*e/p:.5+.5*(e-p)/(1-p),f>.99){if(e<.5){i[v]=g;continue}i[v]=m;continue}if(f<.01){i[v]=(1-e)*g+e*m;continue}e<.5?e=.5*(2*e)**(1+10*f):e>.5&&(e=1-.5*(2*(1-e))**(1+10*f));const t=e*e,n=t*e,o=2*n-3*t+1,a=-2*n+3*t,r=n-2*t+e,s=n-t,l=(1-f)*(m-g);i[v]=o*g+a*m+r*l+s*l;const c=g<m?g:m,w=g>m?g:m;i[v]=i[v]<c?c:i[v],i[v]=i[v]>w?w:i[v]}}}}(e,t)}var s={newInstance:o.m.newInstance(r,"vtkPiecewiseFunction"),extend:r}},34535:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});var o=n(72076),i=n(68470),a=n(59474);const{vtkDebugMacro:r}=i.m;const s={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:o._E.create(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),i.m.obj(e,t),i.m.get(e,t,["distance"]),i.m.setGet(e,t,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),i.m.getArray(e,t,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),i.m.setGetArray(e,t,["clippingRange","windowCenter"],2),i.m.setGetArray(e,t,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),function(e,t){t.classHierarchy.push("vtkCamera");const n=new Float64Array(3),i=new Float64Array([0,0,-1]),s=new Float64Array([0,1,0]),l=o._E.identity(new Float64Array(16)),c=o._E.identity(new Float64Array(16)),d=new Float64Array(3),u=new Float64Array(3),h=new Float64Array(3),g=o._E.identity(new Float64Array(16)),m=o._E.identity(new Float64Array(16)),p=new Float64Array(3),f=new Float64Array(3);function v(){t.viewPlaneNormal[0]=-t.directionOfProjection[0],t.viewPlaneNormal[1]=-t.directionOfProjection[1],t.viewPlaneNormal[2]=-t.directionOfProjection[2]}e.orthogonalizeViewUp=()=>{const n=e.getViewMatrix();t.viewUp[0]=n[4],t.viewUp[1]=n[5],t.viewUp[2]=n[6],e.modified()},e.setPosition=(n,o,i)=>{n===t.position[0]&&o===t.position[1]&&i===t.position[2]||(t.position[0]=n,t.position[1]=o,t.position[2]=i,e.computeDistance(),e.modified())},e.setFocalPoint=(n,o,i)=>{n===t.focalPoint[0]&&o===t.focalPoint[1]&&i===t.focalPoint[2]||(t.focalPoint[0]=n,t.focalPoint[1]=o,t.focalPoint[2]=i,e.computeDistance(),e.modified())},e.setDistance=n=>{if(t.distance===n)return;t.distance=n,t.distance<1e-20&&(t.distance=1e-20,r("Distance is set to minimum."));const o=t.directionOfProjection;t.focalPoint[0]=t.position[0]+o[0]*t.distance,t.focalPoint[1]=t.position[1]+o[1]*t.distance,t.focalPoint[2]=t.position[2]+o[2]*t.distance,e.modified()},e.computeDistance=()=>{const e=t.focalPoint[0]-t.position[0],n=t.focalPoint[1]-t.position[1],o=t.focalPoint[2]-t.position[2];if(t.distance=Math.sqrt(e*e+n*n+o*o),t.distance<1e-20){t.distance=1e-20,r("Distance is set to minimum.");const e=t.directionOfProjection;t.focalPoint[0]=t.position[0]+e[0]*t.distance,t.focalPoint[1]=t.position[1]+e[1]*t.distance,t.focalPoint[2]=t.position[2]+e[2]*t.distance}t.directionOfProjection[0]=e/t.distance,t.directionOfProjection[1]=n/t.distance,t.directionOfProjection[2]=o/t.distance,v()},e.dolly=n=>{if(n<=0)return;const o=t.distance/n;e.setPosition(t.focalPoint[0]-o*t.directionOfProjection[0],t.focalPoint[1]-o*t.directionOfProjection[1],t.focalPoint[2]-o*t.directionOfProjection[2])},e.roll=n=>{const i=t.position,r=t.focalPoint,s=t.viewUp,l=new Float64Array([s[0],s[1],s[2],0]);o._E.identity(g);const c=new Float64Array([r[0]-i[0],r[1]-i[1],r[2]-i[2]]);o._E.rotate(g,g,(0,a.r)(n),c),o.vh.transformMat4(l,l,g),t.viewUp[0]=l[0],t.viewUp[1]=l[1],t.viewUp[2]=l[2],e.modified()},e.azimuth=n=>{const i=t.focalPoint;o._E.identity(m),o._E.translate(m,m,i),o._E.rotate(m,m,(0,a.r)(n),t.viewUp),o._E.translate(m,m,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(p,t.position,m),e.setPosition(p[0],p[1],p[2])},e.yaw=n=>{const i=t.position;o._E.identity(m),o._E.translate(m,m,i),o._E.rotate(m,m,(0,a.r)(n),t.viewUp),o._E.translate(m,m,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(f,t.focalPoint,m),e.setFocalPoint(f[0],f[1],f[2])},e.elevation=n=>{const i=t.focalPoint,r=e.getViewMatrix(),s=[-r[0],-r[1],-r[2]];o._E.identity(m),o._E.translate(m,m,i),o._E.rotate(m,m,(0,a.r)(n),s),o._E.translate(m,m,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(p,t.position,m),e.setPosition(p[0],p[1],p[2])},e.pitch=n=>{const i=t.position,r=e.getViewMatrix(),s=[r[0],r[1],r[2]];o._E.identity(m),o._E.translate(m,m,i),o._E.rotate(m,m,(0,a.r)(n),s),o._E.translate(m,m,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(f,t.focalPoint,m),e.setFocalPoint(...f)},e.zoom=n=>{n<=0||(t.parallelProjection?t.parallelScale/=n:t.viewAngle/=n,e.modified())},e.translate=(n,o,i)=>{const r=[n,o,i];(0,a.k)(t.position,r,t.position),(0,a.k)(t.focalPoint,r,t.focalPoint),e.computeDistance(),e.modified()},e.applyTransform=n=>{const i=[...t.viewUp,1],a=[],r=[],s=[];i[0]+=t.position[0],i[1]+=t.position[1],i[2]+=t.position[2],o.vh.transformMat4(a,[...t.position,1],n),o.vh.transformMat4(r,[...t.focalPoint,1],n),o.vh.transformMat4(s,i,n),s[0]-=a[0],s[1]-=a[1],s[2]-=a[2],e.setPosition(...a.slice(0,3)),e.setFocalPoint(...r.slice(0,3)),e.setViewUp(...s.slice(0,3))},e.getThickness=()=>t.clippingRange[1]-t.clippingRange[0],e.setThickness=n=>{let o=n;o<1e-20&&(o=1e-20,r("Thickness is set to minimum.")),e.setClippingRange(t.clippingRange[0],t.clippingRange[0]+o)},e.setThicknessFromFocalPoint=n=>{let o=n;o<1e-20&&(o=1e-20,r("Thickness is set to minimum.")),e.setClippingRange(t.distance-o/2,t.distance+o/2)},e.setRoll=e=>{},e.getRoll=()=>{},e.setObliqueAngles=(e,t)=>{},e.getOrientation=()=>{},e.getOrientationWXYZ=()=>{},e.getFrustumPlanes=e=>{},e.getCameraLightTransformMatrix=e=>(o._E.copy(e,t.cameraLightTransform),e),e.computeCameraLightTransform=()=>{o._E.copy(l,e.getViewMatrix()),o._E.invert(l,l),o._E.fromScaling(c,[t.distance,t.distance,t.distance]),o._E.multiply(l,l,c),o._E.identity(t.cameraLightTransform),o._E.translate(t.cameraLightTransform,l,[0,0,-1])},e.deepCopy=e=>{},e.physicalOrientationToWorldDirection=e=>{const t=o.gf.fromValues(e[0],e[1],e[2],e[3]),n=o.gf.create(),i=o.gf.fromValues(0,0,1,0);return o.gf.conjugate(n,t),o.gf.multiply(i,t,i),o.gf.multiply(i,i,n),[i[0],i[1],i[2]]},e.getPhysicalToWorldMatrix=t=>{e.getWorldToPhysicalMatrix(t),o._E.invert(t,t)},e.getWorldToPhysicalMatrix=e=>{o._E.identity(e);const n=[3];(0,a.j)(t.physicalViewNorth,t.physicalViewUp,n),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[4]=t.physicalViewUp[0],e[5]=t.physicalViewUp[1],e[6]=t.physicalViewUp[2],e[8]=-t.physicalViewNorth[0],e[9]=-t.physicalViewNorth[1],e[10]=-t.physicalViewNorth[2],o._E.transpose(e,e),o.R3.set(d,1/t.physicalScale,1/t.physicalScale,1/t.physicalScale),o._E.scale(e,e,d),o._E.translate(e,e,t.physicalTranslation)},e.computeViewParametersFromViewMatrix=a=>{o._E.invert(l,a),o.R3.transformMat4(d,n,l),e.computeDistance();const r=t.distance;e.setPosition(d[0],d[1],d[2]),o.R3.transformMat4(u,i,l),o.R3.subtract(u,u,d),o.R3.normalize(u,u),e.setDirectionOfProjection(u[0],u[1],u[2]),o.R3.transformMat4(h,s,l),o.R3.subtract(h,h,d),o.R3.normalize(h,h),e.setViewUp(h[0],h[1],h[2]),e.setDistance(r)},e.computeViewParametersFromPhysicalMatrix=t=>{e.getWorldToPhysicalMatrix(l),o._E.multiply(l,t,l),e.computeViewParametersFromViewMatrix(l)},e.setViewMatrix=n=>{t.viewMatrix=n,t.viewMatrix&&(o._E.copy(l,t.viewMatrix),e.computeViewParametersFromViewMatrix(l),o._E.transpose(t.viewMatrix,t.viewMatrix))},e.getViewMatrix=()=>{if(t.viewMatrix)return t.viewMatrix;o._E.lookAt(l,t.position,t.focalPoint,t.viewUp),o._E.transpose(l,l);const e=new Float64Array(16);return o._E.copy(e,l),e},e.setProjectionMatrix=e=>{t.projectionMatrix=e},e.getProjectionMatrix=(e,n,i)=>{const r=new Float64Array(16);if(o._E.identity(r),t.projectionMatrix){const e=1/t.physicalScale;return o.R3.set(d,e,e,e),o._E.copy(r,t.projectionMatrix),o._E.scale(r,r,d),o._E.transpose(r,r),r}o._E.identity(l);const s=t.clippingRange[1]-t.clippingRange[0],c=[t.clippingRange[0]+(n+1)*s/2,t.clippingRange[0]+(i+1)*s/2];if(t.parallelProjection){const n=t.parallelScale*e,i=t.parallelScale,a=(t.windowCenter[0]-1)*n,r=(t.windowCenter[0]+1)*n,s=(t.windowCenter[1]-1)*i,d=(t.windowCenter[1]+1)*i;o._E.ortho(l,a,r,s,d,c[0],c[1]),o._E.transpose(l,l)}else{if(t.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const n=Math.tan((0,a.r)(t.viewAngle)/2);let o,i;!0===t.useHorizontalViewAngle?(o=t.clippingRange[0]*n,i=t.clippingRange[0]*n/e):(o=t.clippingRange[0]*n*e,i=t.clippingRange[0]*n);const r=(t.windowCenter[0]-1)*o,s=(t.windowCenter[0]+1)*o,d=(t.windowCenter[1]-1)*i,u=(t.windowCenter[1]+1)*i,h=c[0],g=c[1];l[0]=2*h/(s-r),l[5]=2*h/(u-d),l[2]=(r+s)/(s-r),l[6]=(d+u)/(u-d),l[10]=-(h+g)/(g-h),l[14]=-1,l[11]=-2*h*g/(g-h),l[15]=0}}return o._E.copy(r,l),r},e.getCompositeProjectionMatrix=(t,n,i)=>{const a=e.getViewMatrix(),r=e.getProjectionMatrix(t,n,i);return o._E.multiply(r,a,r),r},e.setDirectionOfProjection=(e,n,o)=>{if(t.directionOfProjection[0]===e&&t.directionOfProjection[1]===n&&t.directionOfProjection[2]===o)return;t.directionOfProjection[0]=e,t.directionOfProjection[1]=n,t.directionOfProjection[2]=o;const i=t.directionOfProjection;t.focalPoint[0]=t.position[0]+i[0]*t.distance,t.focalPoint[1]=t.position[1]+i[1]*t.distance,t.focalPoint[2]=t.position[2]+i[2]*t.distance,v()},e.setDeviceAngles=(n,i,r,s)=>{const l=[3];(0,a.j)(t.physicalViewNorth,t.physicalViewUp,l);const c=o._E.identity(new Float64Array(16));o._E.rotate(c,c,(0,a.r)(n),t.physicalViewUp),o._E.rotate(c,c,(0,a.r)(i),l),o._E.rotate(c,c,(0,a.r)(r),t.physicalViewNorth),o._E.rotate(c,c,(0,a.r)(-s),t.physicalViewUp);const d=new Float64Array([-t.physicalViewUp[0],-t.physicalViewUp[1],-t.physicalViewUp[2]]),u=new Float64Array(t.physicalViewNorth);o.R3.transformMat4(d,d,c),o.R3.transformMat4(u,u,c),e.setDirectionOfProjection(d[0],d[1],d[2]),e.setViewUp(u[0],u[1],u[2]),e.modified()},e.setOrientationWXYZ=(t,n,i,r)=>{const s=o._E.identity(new Float64Array(16));if(0!==t&&(0!==n||0!==i||0!==r)){const e=(0,a.r)(t),l=o.gf.create();o.gf.setAxisAngle(l,[n,i,r],e),o._E.fromQuat(s,l)}const l=new Float64Array(3);o.R3.transformMat4(l,[0,0,-1],s);const c=new Float64Array(3);o.R3.transformMat4(c,[0,1,0],s),e.setDirectionOfProjection(...l),e.setViewUp(...c),e.modified()},e.computeClippingRange=e=>{let n=null,o=null;n=t.viewPlaneNormal,o=t.position;const i=-n[0],a=-n[1],r=-n[2],s=-(i*o[0]+a*o[1]+r*o[2]),l=[i*e[0]+a*e[2]+r*e[4]+s,1e-18];for(let t=0;t<2;t++)for(let n=0;n<2;n++)for(let o=0;o<2;o++){const c=i*e[o]+a*e[2+n]+r*e[4+t]+s;l[0]=c<l[0]?c:l[0],l[1]=c>l[1]?c:l[1]}return l}}(e,t)}var c={newInstance:i.m.newInstance(l,"vtkCamera"),extend:l}},5193:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>w});var o=n(68470),i=n(59474),a=n(4666),r=n(48858);const{ColorSpace:s,Scale:l}=r.default,{ScalarMappingTarget:c}=a.default,{vtkDebugMacro:d,vtkErrorMacro:u,vtkWarningMacro:h}=o.m;function g(e,t){const n=e[0],o=e[1],i=e[2],a=Math.sqrt(n*n+o*o+i*i),r=a>.001?Math.acos(n/a):0,s=r>.001?Math.atan2(i,o):0;t[0]=a,t[1]=r,t[2]=s}function m(e,t){if(e[0]>=t-.1)return e[2];const n=e[1]*Math.sqrt(t*t-e[0]*e[0])/(e[0]*Math.sin(e[1]));return e[2]>-.3*Math.PI?e[2]+n:e[2]-n}function p(e,t,n,o){const a=[],r=[];(0,i.M)(t,a),(0,i.M)(n,r);const s=[],l=[];g(a,s),g(r,l);let c=e;if(s[1]>.05&&l[1]>.05&&function(e,t){let n=e-t;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}(s[2],l[2])>.33*Math.PI){let t=Math.max(s[0],l[0]);t=Math.max(88,t),e<.5?(l[0]=t,l[1]=0,l[2]=0,c*=2):(s[0]=t,s[1]=0,s[2]=0,c=2*c-1)}s[1]<.05&&l[1]>.05?s[2]=m(l,s[0]):l[1]<.05&&s[1]>.05&&(l[2]=m(s,l[0]));const d=[];d[0]=(1-c)*s[0]+c*l[0],d[1]=(1-c)*s[1]+c*l[1],d[2]=(1-c)*s[2]+c*l[2];const u=[];!function(e,t){const n=e[0],o=e[1],i=e[2];t[0]=n*Math.cos(o),t[1]=n*Math.sin(o)*Math.cos(i),t[2]=n*Math.sin(o)*Math.sin(i)}(d,u),(0,i.N)(u,o)}const f={clamping:!0,colorSpace:s.RGB,hSVWrap:!0,scale:l.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,f,n),a.default.extend(e,t,n),t.table=[],t.nodes=[],t.nanColor=[.5,0,0,1],t.belowRangeColor=[0,0,0,1],t.aboveRangeColor=[1,1,1,1],t.buildTime={},o.m.obj(t.buildTime),o.m.get(e,t,["buildTime","mappingRange"]),o.m.setGet(e,t,["useAboveRangeColor","useBelowRangeColor","colorSpace","discretize","numberOfValues"]),o.m.setArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"],4),o.m.getArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"]),function(e,t){t.classHierarchy.push("vtkColorTransferFunction"),e.getSize=()=>t.nodes.length,e.addRGBPoint=(t,n,o,i)=>e.addRGBPointLong(t,n,o,i,.5,0),e.addRGBPointLong=function(n,o,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(r<0||r>1)return u("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return u("Sharpness outside range [0.0, 1.0]"),-1;t.allowDuplicateScalars||e.removePoint(n);const l={x:n,r:o,g:i,b:a,midpoint:r,sharpness:s};t.nodes.push(l),e.sortAndUpdateRange();let c=0;for(;c<t.nodes.length&&t.nodes[c].x!==n;c++);return c<t.nodes.length?c:-1},e.addHSVPoint=(t,n,o,i)=>e.addHSVPointLong(t,n,o,i,.5,0),e.addHSVPointLong=function(t,n,o,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const l=[],c=[n,o,a];return(0,i.h)(c,l),e.addRGBPoint(t,l[0],l[1],l[2],r,s)},e.setNodes=n=>{if(t.nodes!==n){const o=JSON.stringify(t.nodes);t.nodes=n;const i=JSON.stringify(t.nodes);if(e.sortAndUpdateRange()||o!==i)return e.modified(),!0}return!1},e.sortAndUpdateRange=()=>{const n=JSON.stringify(t.nodes);t.nodes.sort(((e,t)=>e.x-t.x));const o=JSON.stringify(t.nodes),i=e.updateRange();return i||n===o?i:(e.modified(),!0)},e.updateRange=()=>{const n=[2];n[0]=t.mappingRange[0],n[1]=t.mappingRange[1];const o=t.nodes.length;return o?(t.mappingRange[0]=t.nodes[0].x,t.mappingRange[1]=t.nodes[o-1].x):(t.mappingRange[0]=0,t.mappingRange[1]=0),(n[0]!==t.mappingRange[0]||n[1]!==t.mappingRange[1])&&(e.modified(),!0)},e.removePoint=n=>{let o=0;for(;o<t.nodes.length&&t.nodes[o].x!==n;o++);const i=o;if(o>=t.nodes.length)return-1;let a=!1;return t.nodes.splice(o,1),0!==o&&o!==t.nodes.length||(a=e.updateRange()),a||e.modified(),i},e.movePoint=(n,o)=>{if(n!==o){e.removePoint(o);for(let i=0;i<t.nodes.length;i++)if(t.nodes[i].x===n){t.nodes[i].x=o,e.sortAndUpdateRange();break}}},e.removeAllPoints=()=>{t.nodes=[],e.sortAndUpdateRange()},e.addRGBSegment=(n,o,i,a,r,s,l,c)=>{e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n&&t.nodes[e].x<=r?t.nodes.splice(e,1):e++;e.addRGBPointLong(n,o,i,a,.5,0),e.addRGBPointLong(r,s,l,c,.5,0),e.modified()},e.addHSVSegment=(t,n,o,a,r,s,l,c)=>{const d=[n,o,a],u=[s,l,c],h=[],g=[];(0,i.h)(d,h),(0,i.h)(u,g),e.addRGBSegment(t,h[0],h[1],h[2],r,g[0],g[1],g[2])},e.mapValue=t=>{const n=[];return e.getColor(t,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},e.getColor=(n,o)=>{if(t.indexedLookup){const t=e.getSize(),i=e.getAnnotatedValueIndexInternal(n);if(i<0||0===t){const t=e.getNanColorByReference();o[0]=t[0],o[1]=t[1],o[2]=t[2]}else{const n=[];e.getNodeValue(i%t,n),o[0]=n[1],o[1]=n[2],o[2]=n[3]}}else e.getTable(n,n,1,o)},e.getRedValue=t=>{const n=[];return e.getColor(t,n),n[0]},e.getGreenValue=t=>{const n=[];return e.getColor(t,n),n[1]},e.getBlueValue=t=>{const n=[];return e.getColor(t,n),n[2]},e.getTable=(n,o,a,r)=>{const c=Number(n),d=Number(o);if((0,i.i)(c)||(0,i.i)(d)){for(let e=0;e<a;e++)r[3*e+0]=t.nanColor[0],r[3*e+1]=t.nanColor[1],r[3*e+2]=t.nanColor[2];return}let h=0;const g=t.nodes.length;let m=0,f=0,v=0;0!==g&&(m=t.nodes[g-1].r,f=t.nodes[g-1].g,v=t.nodes[g-1].b);let w=0,y=0,I=0;const C=[0,0,0],x=[0,0,0];let b=0,E=0;const S=[];let T=t.scale===l.LOG10;T&&(T=t.mappingRange[0]>0);let P=0,M=0,A=0;T&&(P=Math.log10(c),M=Math.log10(d));for(let n=0;n<a;n++){const o=3*n;if(a>1?T?(A=P+n/(a-1)*(M-P),w=10**A):w=c+n/(a-1)*(d-c):T?(A=.5*(P+M),w=10**A):w=.5*(c+d),t.discretize){const e=t.mappingRange;if(w>=e[0]&&w<=e[1]){const n=t.numberOfValues,o=e[1]-e[0];if(n<=1)w=e[0]+o/2;else{const t=(w-e[0])/o,a=(0,i.J)(n*t);w=e[0]+a/(n-1)*o}}}for(;h<g&&w>t.nodes[h].x;)h++,h<g&&(y=t.nodes[h-1].x,I=t.nodes[h].x,T&&(y=Math.log10(y),I=Math.log10(I)),C[0]=t.nodes[h-1].r,x[0]=t.nodes[h].r,C[1]=t.nodes[h-1].g,x[1]=t.nodes[h].g,C[2]=t.nodes[h-1].b,x[2]=t.nodes[h].b,b=t.nodes[h-1].midpoint,E=t.nodes[h-1].sharpness,b<1e-5&&(b=1e-5),b>.99999&&(b=.99999));if(w>t.mappingRange[1])r[o]=0,r[o+1]=0,r[o+2]=0,t.clamping&&(e.getUseAboveRangeColor()?(r[o]=t.aboveRangeColor[0],r[o+1]=t.aboveRangeColor[1],r[o+2]=t.aboveRangeColor[2]):(r[o]=m,r[o+1]=f,r[o+2]=v));else if(w<t.mappingRange[0]||(0,i.K)(w)&&w<0)r[o]=0,r[o+1]=0,r[o+2]=0,t.clamping&&(e.getUseBelowRangeColor()?(r[o]=t.belowRangeColor[0],r[o+1]=t.belowRangeColor[1],r[o+2]=t.belowRangeColor[2]):g>0&&(r[o]=t.nodes[0].r,r[o+1]=t.nodes[0].g,r[o+2]=t.nodes[0].b));else if(0===h&&(Math.abs(w-c)<1e-6||t.discretize))g>0?(r[o]=t.nodes[0].r,r[o+1]=t.nodes[0].g,r[o+2]=t.nodes[0].b):(r[o]=0,r[o+1]=0,r[o+2]=0);else{let e=0;if(e=T?(A-y)/(I-y):(w-y)/(I-y),e=e<b?.5*e/b:.5+.5*(e-b)/(1-b),E>.99){if(e<.5){r[o]=C[0],r[o+1]=C[1],r[o+2]=C[2];continue}r[o]=x[0],r[o+1]=x[1],r[o+2]=x[2];continue}if(E<.01){if(t.colorSpace===s.RGB)r[o]=(1-e)*C[0]+e*x[0],r[o+1]=(1-e)*C[1]+e*x[1],r[o+2]=(1-e)*C[2]+e*x[2];else if(t.colorSpace===s.HSV){const n=[],a=[];(0,i.L)(C,n),(0,i.L)(x,a),t.hSVWrap&&(n[0]-a[0]>.5||a[0]-n[0]>.5)&&(n[0]>a[0]?n[0]-=1:a[0]-=1);const s=[];s[0]=(1-e)*n[0]+e*a[0],s[0]<0&&(s[0]+=1),s[1]=(1-e)*n[1]+e*a[1],s[2]=(1-e)*n[2]+e*a[2],(0,i.h)(s,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]}else if(t.colorSpace===s.LAB){const t=[],n=[];(0,i.M)(C,t),(0,i.M)(x,n);const a=[];a[0]=(1-e)*t[0]+e*n[0],a[1]=(1-e)*t[1]+e*n[1],a[2]=(1-e)*t[2]+e*n[2],(0,i.N)(a,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]}else t.colorSpace===s.DIVERGING?(p(e,C,x,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]):u("ColorSpace set to invalid value.",t.colorSpace);continue}e<.5?e=.5*(2*e)**(1+10*E):e>.5&&(e=1-.5*(2*(1-e))**(1+10*E));const n=e*e,a=n*e,l=2*a-3*n+1,c=-2*a+3*n,d=a-2*n+e,h=a-n;let g,m;if(t.colorSpace===s.RGB)for(let e=0;e<3;e++)g=x[e]-C[e],m=(1-E)*g,r[o+e]=l*C[e]+c*x[e]+d*m+h*m;else if(t.colorSpace===s.HSV){const e=[],n=[];(0,i.L)(C,e),(0,i.L)(x,n),t.hSVWrap&&(e[0]-n[0]>.5||n[0]-e[0]>.5)&&(e[0]>n[0]?e[0]-=1:n[0]-=1);const a=[];for(let t=0;t<3;t++)g=n[t]-e[t],m=(1-E)*g,a[t]=l*e[t]+c*n[t]+d*m+h*m,0===t&&a[t]<0&&(a[t]+=1);(0,i.h)(a,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]}else if(t.colorSpace===s.LAB){const e=[],t=[];(0,i.M)(C,e),(0,i.M)(x,t);const n=[];for(let o=0;o<3;o++)g=t[o]-e[o],m=(1-E)*g,n[o]=l*e[o]+c*t[o]+d*m+h*m;(0,i.N)(n,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]}else t.colorSpace===s.DIVERGING?(p(e,C,x,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]):u("ColorSpace set to invalid value.");for(let e=0;e<3;e++)r[o+e]=r[o+e]<0?0:r[o+e],r[o+e]=r[o+e]>1?1:r[o+e]}}},e.getUint8Table=function(n,o,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.getMTime()<=t.buildTime&&t.tableSize===i&&t.tableWithAlpha!==a)return t.table;if(0===t.nodes.length)return u("Attempting to lookup a value with no points in the function"),t.table;const r=a?4:3;t.tableSize===i&&t.tableWithAlpha===a||(t.table=new Uint8Array(i*r),t.tableSize=i,t.tableWithAlpha=a);const s=[];e.getTable(n,o,i,s);for(let e=0;e<i;e++)t.table[e*r+0]=Math.floor(255*s[3*e+0]+.5),t.table[e*r+1]=Math.floor(255*s[3*e+1]+.5),t.table[e*r+2]=Math.floor(255*s[3*e+2]+.5),a&&(t.table[e*r+3]=255);return t.buildTime.modified(),t.table},e.buildFunctionFromArray=n=>{e.removeAllPoints();const o=n.getNumberOfComponents();for(let e=0;e<n.getNumberOfTuples();e++)switch(o){case 3:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:.5,sharpness:0});break;case 4:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:.5,sharpness:0});break;case 5:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)});break;case 6:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)})}e.sortAndUpdateRange()},e.buildFunctionFromTable=(n,o,i,a)=>{let r=0;e.removeAllPoints(),i>1&&(r=(o-n)/(i-1));for(let e=0;e<i;e++){const o={x:n+r*e,r:a[3*e],g:a[3*e+1],b:a[3*e+2],sharpness:0,midpoint:.5};t.nodes.push(o)}e.sortAndUpdateRange()},e.getNodeValue=(e,n)=>e<0||e>=t.nodes.length?(u("Index out of range!"),-1):(n[0]=t.nodes[e].x,n[1]=t.nodes[e].r,n[2]=t.nodes[e].g,n[3]=t.nodes[e].b,n[4]=t.nodes[e].midpoint,n[5]=t.nodes[e].sharpness,1),e.setNodeValue=(n,o)=>{if(n<0||n>=t.nodes.length)return u("Index out of range!"),-1;const i=t.nodes[n].x;return t.nodes[n].x=o[0],t.nodes[n].r=o[1],t.nodes[n].g=o[2],t.nodes[n].b=o[3],t.nodes[n].midpoint=o[4],t.nodes[n].sharpness=o[5],i!==o[0]?e.sortAndUpdateRange():e.modified(),1},e.getNumberOfAvailableColors=()=>t.indexedLookup&&e.getSize()?e.getSize():t.tableSize?t.tableSize:16777216,e.getIndexedColor=(t,n)=>{const o=e.getSize();if(o>0&&t>=0){const i=[];e.getNodeValue(t%o,i);for(let e=0;e<3;++e)n[e]=i[e+1];return void(n[3]=1)}const i=e.getNanColorByReference();n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1},e.fillFromDataPointer=(t,n)=>{if(!(t<=0)&&n){e.removeAllPoints();for(let o=0;o<t;o++)e.addRGBPoint(n[4*o],n[4*o+1],n[4*o+2],n[4*o+3])}},e.setMappingRange=(n,o)=>{const i=[n,o],a=e.getRange();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0])return void u("attempt to set zero width color range");const r=(i[1]-i[0])/(a[1]-a[0]),s=i[0]-a[0]*r;for(let e=0;e<t.nodes.length;++e)t.nodes[e].x=t.nodes[e].x*r+s;t.mappingRange[0]=i[0],t.mappingRange[1]=i[1],e.modified()},e.adjustRange=n=>{const o=e.getRange(),i=[];o[0]<n[0]?(e.getColor(n[0],i),e.addRGBPoint(n[0],i[0],i[1],i[2])):(e.getColor(o[0],i),e.addRGBPoint(n[0],i[0],i[1],i[2])),o[1]>n[1]?(e.getColor(n[1],i),e.addRGBPoint(n[1],i[0],i[1],i[2])):(e.getColor(o[1],i),e.addRGBPoint(n[1],i[0],i[1],i[2])),e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n[0]&&t.nodes[e].x<=n[1]?t.nodes.splice(e,1):++e;return 1},e.estimateMinNumberOfSamples=(t,n)=>{const o=e.findMinimumXDistance();return Math.ceil((n-t)/o)},e.findMinimumXDistance=()=>{if(t.nodes.length<2)return-1;let e=Number.MAX_VALUE;for(let n=0;n<t.nodes.length-1;n++){const o=t.nodes[n+1].x-t.nodes[n].x;o<e&&(e=o)}return e},e.mapScalarsThroughTable=(n,o,i,a)=>{0!==e.getSize()?t.indexedLookup?e.mapDataIndexed(n,o,i,a):e.mapData(n,o,i,a):d("Transfer Function Has No Points!")},e.mapData=(t,n,o,i)=>{if(0===e.getSize())return void h("Transfer Function Has No Points!");const a=Math.floor(255*e.getAlpha()+.5),r=t.getNumberOfTuples(),s=t.getNumberOfComponents(),l=n.getData(),d=t.getData(),u=[];if(o===c.RGBA)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,u),l[4*t]=Math.floor(255*u[0]+.5),l[4*t+1]=Math.floor(255*u[1]+.5),l[4*t+2]=Math.floor(255*u[2]+.5),l[4*t+3]=a}if(o===c.RGB)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,u),l[3*t]=Math.floor(255*u[0]+.5),l[3*t+1]=Math.floor(255*u[1]+.5),l[3*t+2]=Math.floor(255*u[2]+.5)}if(o===c.LUMINANCE)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,u),l[t]=Math.floor(76.5*u[0]+150.45*u[1]+28.05*u[2]+.5)}if(o===c.LUMINANCE_ALPHA)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,u),l[2*t]=Math.floor(76.5*u[0]+150.45*u[1]+28.05*u[2]+.5),l[2*t+1]=a}},e.applyColorMap=n=>{const o=JSON.stringify(t.colorSpace);n.ColorSpace&&(t.colorSpace=s[n.ColorSpace.toUpperCase()],void 0===t.colorSpace&&(u(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),t.colorSpace=s.RGB));let i=o!==JSON.stringify(t.colorSpace);const a=i||JSON.stringify(t.nanColor);if(n.NanColor)for(t.nanColor=[].concat(n.NanColor);t.nanColor.length<4;)t.nanColor.push(1);i=i||a!==JSON.stringify(t.nanColor);const r=i||JSON.stringify(t.nodes);if(n.RGBPoints){const e=n.RGBPoints.length;t.nodes=[];const o=.5,i=0;for(let a=0;a<e;a+=4)t.nodes.push({x:n.RGBPoints[a],r:n.RGBPoints[a+1],g:n.RGBPoints[a+2],b:n.RGBPoints[a+3],midpoint:o,sharpness:i})}const l=e.sortAndUpdateRange(),c=!l&&(i||r!==JSON.stringify(t.nodes));return c&&e.modified(),l||c}}(e,t)}var w={newInstance:o.m.newInstance(v,"vtkColorTransferFunction"),extend:v,...r.default}},31239:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(40188);const i=Object.create(null);o.v.filter((e=>e.RGBPoints)).filter((e=>"CIELAB"!==e.ColorSpace)).forEach((e=>{i[e.Name]=e}));const a=Object.keys(i);a.sort();var r={addPreset:function(e){e.RGBPoints&&"CIELAB"!==e.ColorSpace&&(i[e.Name]||(a.push(e.Name),a.sort()),i[e.Name]=e)},removePresetByName:function(e){const t=a.indexOf(e);t>-1&&a.splice(t,1),delete i[e]},getPresetByName:function(e){return i[e]},rgbPresetNames:a}},78639:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>m});var o=n(72795),i=n(68470),a=n(93751),r=n(68649),s=n(59474),l=n(84418);const{staticOffsetAPI:c,otherStaticMethods:d}=l.default,{SlicingMode:u}=o.default;const h={slicingMode:u.NONE,closestIJKAxis:{ijkMode:u.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function g(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,h,n),a.Z.extend(e,t,n),i.m.get(e,t,["slicingMode"]),i.m.setGet(e,t,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),l.default.implementCoincidentTopologyMethods(e,t),function(e,t){function n(){let n;switch(t.slicingMode){case u.X:n=0;break;case u.Y:n=1;break;case u.Z:n=2;break;default:return void(t.closestIJKAxis={ijkMode:t.slicingMode,flip:!1})}const o=e.getCurrentImage().getDirection(),i=(0,s.S)(o);let a=0;for(;a<3&&0===i[n+3*a];++a);const r=i[n+3*a]<0;t.closestIJKAxis={ijkMode:a,flip:r}}t.classHierarchy.push("vtkImageMapper"),e.getSliceAtPosition=n=>{const o=e.getCurrentImage();let i;if(3===n.length)i=n;else if(Number.isFinite(n)){const e=o.getBounds();switch(t.slicingMode){case u.X:i=[n,(e[3]+e[2])/2,(e[5]+e[4])/2];break;case u.Y:i=[(e[1]+e[0])/2,n,(e[5]+e[4])/2];break;case u.Z:i=[(e[1]+e[0])/2,(e[3]+e[2])/2,n]}}const a=[0,0,0];o.worldToIndex(i,a);const r=o.getExtent(),{ijkMode:l}=e.getClosestIJKAxis();let c=0;switch(l){case u.I:c=(0,s.C)(a[0],r[0],r[1]);break;case u.J:c=(0,s.C)(a[1],r[2],r[3]);break;case u.K:c=(0,s.C)(a[2],r[4],r[5]);break;default:return 0}return c},e.setSliceFromCamera=n=>{const o=n.getFocalPoint();switch(t.slicingMode){case u.I:case u.J:case u.K:{const t=e.getSliceAtPosition(o);e.setSlice(t)}break;case u.X:e.setSlice(o[0]);break;case u.Y:e.setSlice(o[1]);break;case u.Z:e.setSlice(o[2])}},e.setXSlice=t=>{e.setSlicingMode(u.X),e.setSlice(t)},e.setYSlice=t=>{e.setSlicingMode(u.Y),e.setSlice(t)},e.setZSlice=t=>{e.setSlicingMode(u.Z),e.setSlice(t)},e.setISlice=t=>{e.setSlicingMode(u.I),e.setSlice(t)},e.setJSlice=t=>{e.setSlicingMode(u.J),e.setSlice(t)},e.setKSlice=t=>{e.setSlicingMode(u.K),e.setSlice(t)},e.getSlicingModeNormal=()=>{const n=[0,0,0],o=e.getCurrentImage().getDirection();switch(t.slicingMode){case u.X:n[0]=1;break;case u.Y:n[1]=1;break;case u.Z:n[2]=1;break;case u.I:(0,s.R)(o,[1,0,0],n);break;case u.J:(0,s.R)(o,[0,1,0],n);break;case u.K:(0,s.R)(o,[0,0,1],n)}return n},e.setSlicingMode=o=>{t.slicingMode!==o&&(t.slicingMode=o,e.getCurrentImage()&&n(),e.modified())},e.getClosestIJKAxis=()=>(void 0!==t.closestIJKAxis&&t.closestIJKAxis.ijkMode!==u.NONE||!e.getCurrentImage()||n(),t.closestIJKAxis),e.getBounds=()=>{const n=e.getCurrentImage();if(!n)return(0,s.F)();if(!t.useCustomExtents)return n.getBounds();const o=t.customDisplayExtent.slice(),{ijkMode:i}=e.getClosestIJKAxis();let a=t.slice;switch(i!==t.slicingMode&&(a=e.getSliceAtPosition(t.slice)),i){case u.I:o[0]=a,o[1]=a;break;case u.J:o[2]=a,o[3]=a;break;case u.K:o[4]=a,o[5]=a}return n.extentToBounds(o)},e.getBoundsForSlice=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.slice,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.getCurrentImage();if(!i)return(0,s.F)();const a=i.getSpatialExtent(),{ijkMode:r}=e.getClosestIJKAxis();let l=n;switch(r!==t.slicingMode&&(l=e.getSliceAtPosition(n)),r){case u.I:a[0]=l-o,a[1]=l+o;break;case u.J:a[2]=l-o,a[3]=l+o;break;case u.K:a[4]=l-o,a[5]=l+o}return i.extentToBounds(a)},e.intersectWithLineForPointPicking=(t,n)=>(0,r.U)(t,n,e),e.intersectWithLineForCellPicking=(t,n)=>(0,r.L)(t,n,e),e.getCurrentImage=()=>e.getInputData()}(e,t)}var m={newInstance:i.m.newInstance(g,"vtkImageMapper"),extend:g,...c,...d,...o.default}},7965:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var o=n(72076),i=n(68470),a=n(91382),r=n(49445),s=n(1408);const{vtkDebugMacro:l}=i.m;const c={mapper:null,property:null,bounds:[...a.ZP.INIT_BOUNDS]};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),r.ZP.extend(e,t,n),t.boundsMTime={},i.m.obj(t.boundsMTime),i.m.set(e,t,["property"]),i.m.setGet(e,t,["mapper"]),i.m.getArray(e,t,["bounds"],6),function(e,t){t.classHierarchy.push("vtkImageSlice"),e.getActors=()=>e,e.getImages=()=>e,e.getIsOpaque=()=>{if(t.forceOpaque)return!0;if(t.forceTranslucent)return!1;t.property||e.getProperty();let n=t.property.getOpacity()>=1;return n=n&&(!t.mapper||t.mapper.getIsOpaque()),n},e.hasTranslucentPolygonalGeometry=()=>!1,e.makeProperty=s.ZP.newInstance,e.getProperty=()=>(null===t.property&&(t.property=e.makeProperty()),t.property),e.getBounds=()=>{if(null===t.mapper)return t.bounds;const n=t.mapper.getBounds();if(!n||6!==n.length)return n;if(n[0]>n[1])return t.mapperBounds=n.concat(),t.bounds=[1,-1,1,-1,1,-1],t.boundsMTime.modified(),n;if(!t.mapperBounds||!(i=[n,t.mapperBounds],i[0].map(((e,t)=>i.map((e=>e[t]))))).reduce(((e,t)=>e&&t[0]===t[1]),!0)||e.getMTime()>t.boundsMTime.getMTime()){l("Recomputing bounds..."),t.mapperBounds=n.map((e=>e)),e.computeMatrix();const i=new Float64Array(16);o._E.transpose(i,t.matrix),a.ZP.transformBounds(n,i,t.bounds),t.boundsMTime.modified()}var i;return t.bounds},e.getBoundsForSlice=(n,i)=>{const r=t.mapper.getBoundsForSlice(n,i);if(!a.ZP.isValid(r))return r;e.computeMatrix();const s=new Float64Array(16);return o._E.transpose(s,t.matrix),a.ZP.transformBounds(r,s)},e.getMinXBound=()=>e.getBounds()[0],e.getMaxXBound=()=>e.getBounds()[1],e.getMinYBound=()=>e.getBounds()[2],e.getMaxYBound=()=>e.getBounds()[3],e.getMinZBound=()=>e.getBounds()[4],e.getMaxZBound=()=>e.getBounds()[5],e.getMTime=()=>{let e=t.mtime;if(null!==t.property){const n=t.property.getMTime();e=n>e?n:e}return e},e.getRedrawMTime=()=>{let e=t.mtime;if(null!==t.mapper){let n=t.mapper.getMTime();e=n>e?n:e,null!==t.mapper.getInput()&&(t.mapper.getInputAlgorithm().update(),n=t.mapper.getInput().getMTime(),e=n>e?n:e)}if(null!==t.property){let n=t.property.getMTime();e=n>e?n:e,null!==t.property.getRGBTransferFunction()&&(n=t.property.getRGBTransferFunction().getMTime(),e=n>e?n:e)}return e},e.getSupportsSelection=()=>!!t.mapper&&t.mapper.getSupportsSelection()}(e,t)}var u={newInstance:i.m.newInstance(d,"vtkImageSlice"),extend:d}},20346:(e,t,n)=>{var o="__lodash_hash_undefined__",i=1/0,a="[object Function]",r="[object GeneratorFunction]",s="[object Symbol]",l=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,c=/^\w*$/,d=/^\./,u=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,h=/\\(\\)?/g,g=/^\[object .+?Constructor\]$/,m="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,p="object"==typeof self&&self&&self.Object===Object&&self,f=m||p||Function("return this")();var v,w=Array.prototype,y=Function.prototype,I=Object.prototype,C=f["__core-js_shared__"],x=(v=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||""))?"Symbol(src)_1."+v:"",b=y.toString,E=I.hasOwnProperty,S=I.toString,T=RegExp("^"+b.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=f.Symbol,M=w.splice,A=U(f,"Map"),R=U(Object,"create"),_=P?P.prototype:void 0,D=_?_.toString:void 0;function O(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function L(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function B(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function V(e,t){for(var n,o,i=e.length;i--;)if((n=e[i][0])===(o=t)||n!=n&&o!=o)return i;return-1}function N(e,t){var n;t=function(e,t){if(G(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||z(e))return!0;return c.test(e)||!l.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:G(n=t)?n:F(n);for(var o=0,i=t.length;null!=e&&o<i;)e=e[j(t[o++])];return o&&o==i?e:void 0}function k(e){if(!q(e)||(t=e,x&&x in t))return!1;var t,n=function(e){var t=q(e)?S.call(e):"";return t==a||t==r}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?T:g;return n.test(function(e){if(null!=e){try{return b.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function Z(e,t){var n,o,i=e.__data__;return("string"==(o=typeof(n=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function U(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return k(n)?n:void 0}O.prototype.clear=function(){this.__data__=R?R(null):{}},O.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},O.prototype.get=function(e){var t=this.__data__;if(R){var n=t[e];return n===o?void 0:n}return E.call(t,e)?t[e]:void 0},O.prototype.has=function(e){var t=this.__data__;return R?void 0!==t[e]:E.call(t,e)},O.prototype.set=function(e,t){return this.__data__[e]=R&&void 0===t?o:t,this},L.prototype.clear=function(){this.__data__=[]},L.prototype.delete=function(e){var t=this.__data__,n=V(t,e);return!(n<0)&&(n==t.length-1?t.pop():M.call(t,n,1),!0)},L.prototype.get=function(e){var t=this.__data__,n=V(t,e);return n<0?void 0:t[n][1]},L.prototype.has=function(e){return V(this.__data__,e)>-1},L.prototype.set=function(e,t){var n=this.__data__,o=V(n,e);return o<0?n.push([e,t]):n[o][1]=t,this},B.prototype.clear=function(){this.__data__={hash:new O,map:new(A||L),string:new O}},B.prototype.delete=function(e){return Z(this,e).delete(e)},B.prototype.get=function(e){return Z(this,e).get(e)},B.prototype.has=function(e){return Z(this,e).has(e)},B.prototype.set=function(e,t){return Z(this,e).set(e,t),this};var F=W((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(z(e))return D?D.call(e):"";var t=e+"";return"0"==t&&1/e==-i?"-0":t}(t);var n=[];return d.test(e)&&n.push(""),e.replace(u,(function(e,t,o,i){n.push(o?i.replace(h,"$1"):t||e)})),n}));function j(e){if("string"==typeof e||z(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}function W(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var o=arguments,i=t?t.apply(this,o):o[0],a=n.cache;if(a.has(i))return a.get(i);var r=e.apply(this,o);return n.cache=a.set(i,r),r};return n.cache=new(W.Cache||B),n}W.Cache=B;var G=Array.isArray;function q(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function z(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&S.call(e)==s}e.exports=function(e,t,n){var o=null==e?void 0:N(e,t);return void 0===o?n:o}},28635:(e,t,n)=>{"use strict";n.d(t,{Jj:()=>d,Ud:()=>h,Yy:()=>a,sj:()=>I});const o=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,c=new Map([["proxy",{canHandle:e=>l(e)&&e[o],serialize(e){const{port1:t,port2:n}=new MessageChannel;return d(e,t),[n,[n]]},deserialize:e=>(e.start(),h(e))}],["throw",{canHandle:e=>l(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function d(e,t=globalThis,n=["*"]){t.addEventListener("message",(function o(i){if(!i||!i.data)return;if(!function(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,i.origin))return void console.warn(`Invalid origin '${i.origin}' for comlink proxy`);const{id:a,type:l,path:c}=Object.assign({path:[]},i.data),h=(i.data.argumentList||[]).map(x);let g;try{const t=c.slice(0,-1).reduce(((e,t)=>e[t]),e),n=c.reduce(((e,t)=>e[t]),e);switch(l){case"GET":g=n;break;case"SET":t[c.slice(-1)[0]]=x(i.data.value),g=!0;break;case"APPLY":g=n.apply(t,h);break;case"CONSTRUCT":g=I(new n(...h));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;d(e,n),g=function(e,t){return y.set(e,t),e}(t,[t])}break;case"RELEASE":g=void 0;break;default:return}}catch(e){g={value:e,[s]:0}}Promise.resolve(g).catch((e=>({value:e,[s]:0}))).then((n=>{const[i,s]=C(n);t.postMessage(Object.assign(Object.assign({},i),{id:a}),s),"RELEASE"===l&&(t.removeEventListener("message",o),u(t),r in e&&"function"==typeof e[r]&&e[r]())})).catch((e=>{const[n,o]=C({value:new TypeError("Unserializable return value"),[s]:0});t.postMessage(Object.assign(Object.assign({},n),{id:a}),o)}))})),t.start&&t.start()}function u(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function h(e,t){return v(e,[],t)}function g(e){if(e)throw new Error("Proxy has been released and is not useable")}function m(e){return b(e,{type:"RELEASE"}).then((()=>{u(e)}))}const p=new WeakMap,f="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(p.get(e)||0)-1;p.set(e,t),0===t&&m(e)}));function v(e,t=[],n=function(){}){let o=!1;const r=new Proxy(n,{get(n,i){if(g(o),i===a)return()=>{!function(e){f&&f.unregister(e)}(r),m(e),o=!0};if("then"===i){if(0===t.length)return{then:()=>r};const n=b(e,{type:"GET",path:t.map((e=>e.toString()))}).then(x);return n.then.bind(n)}return v(e,[...t,i])},set(n,i,a){g(o);const[r,s]=C(a);return b(e,{type:"SET",path:[...t,i].map((e=>e.toString())),value:r},s).then(x)},apply(n,a,r){g(o);const s=t[t.length-1];if(s===i)return b(e,{type:"ENDPOINT"}).then(x);if("bind"===s)return v(e,t.slice(0,-1));const[l,c]=w(r);return b(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:l},c).then(x)},construct(n,i){g(o);const[a,r]=w(i);return b(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:a},r).then(x)}});return function(e,t){const n=(p.get(t)||0)+1;p.set(t,n),f&&f.register(e,t,e)}(r,e),r}function w(e){const t=e.map(C);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const y=new WeakMap;function I(e){return Object.assign(e,{[o]:!0})}function C(e){for(const[t,n]of c)if(n.canHandle(e)){const[o,i]=n.serialize(e);return[{type:"HANDLER",name:t,value:o},i]}return[{type:"RAW",value:e},y.get(e)||[]]}function x(e){switch(e.type){case"HANDLER":return c.get(e.name).deserialize(e.value);case"RAW":return e.value}}function b(e,t,n){return new Promise((o=>{const i=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===i&&(e.removeEventListener("message",t),o(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:i},t),n)}))}},63021:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(3848),i=n(85125);function a(e){let t,n,a;function s(e,o,i=0,a=e.length){if(i<a){if(0!==t(o,o))return a;do{const t=i+a>>>1;n(e[t],o)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=o.Z,n=(t,n)=>(0,o.Z)(e(t),n),a=(t,n)=>e(t)-n):(t=e===o.Z||e===i.Z?e:r,n=e,a=e),{left:s,center:function(e,t,n=0,o=e.length){const i=s(e,t,n,o-1);return i>n&&a(e[i-1],t)>-a(e[i],t)?i-1:i},right:function(e,o,i=0,a=e.length){if(i<a){if(0!==t(o,o))return a;do{const t=i+a>>>1;n(e[t],o)<=0?i=t+1:a=t}while(i<a)}return i}}}function r(){return 0}}}]);
//# sourceMappingURL=3117.bundle.a96ddd05a8116eec40ae.js.map
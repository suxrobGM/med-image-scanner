/*! For license information please see 9579.bundle.5f9ef61543e3ecccf458.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9579,6295,5250],{49001:(e,t,n)=>{n.d(t,{Z:()=>m});var o=n(72076),i=n(7187),r=n(30023),a=n(30742),s=n(56309),l=n(77614),c=n(25281),d=n(40046),u=n(82253);class g extends l.Z{constructor(e){super({...e,canvas:e.canvas||(0,c.uy)(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),!1===this.isPlaying&&this.renderFrame(),!0),this.getNumberOfSlices=()=>{const e=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(e)?this.numberOfFrames:e},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const e=this.canvas,{clientWidth:t,clientHeight:n}=e;e.width===t&&e.height===n||(e.width=t,e.height=n),this.refreshRenderValues(),!1===this.isPlaying&&this.renderFrame()},this.canvasToWorld=(e,t=[0,0,0])=>{const n=this.videoCamera.panWorld,o=this.getWorldToCanvasRatio(),i=[n[0]*o,n[1]*o],r=[e[0]-i[0],e[1]-i[1]];return t.splice(0,2,r[0]/o,r[1]/o),t},this.worldToCanvas=e=>{const t=this.videoCamera.panWorld,n=this.getWorldToCanvasRatio();return[(e[0]+t[0])*n,(e[1]+t[1])*n]},this.getRotation=()=>0,this.canvasToIndex=e=>{const t=this.getTransform();return t.invert(),t.transformPoint(e.map((e=>e*devicePixelRatio)))},this.indexToCanvas=e=>this.getTransform().transformPoint(e).map((e=>e/devicePixelRatio)),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{const e=this.getTransform().getMatrix(),t=this.canvasContext;t.resetTransform(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.drawImage(this.videoElement,0,0,this.videoWidth||1024,this.videoHeight||1024);for(const e of this.getActors())e.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),(0,s.triggerEvent)(this.element,i.Events.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(0,s.triggerEvent)(this.element,i.Events.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),this.initialRender?.();const n=this.getFrameNumber();this.isPlaying&&(n<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):n>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(i.Events.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(i.Events.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const t="string"==typeof e?e:e.imageId,n=r.get(i.MetadataModules.IMAGE_PLANE,t);let a=n.rowCosines,s=n.columnCosines;null!=a&&null!=s||(a=[1,0,0],s=[0,1,0]);const l=o.R3.fromValues(a[0],a[1],a[2]),c=o.R3.fromValues(s[0],s[1],s[2]),{rows:d,columns:u}=n,g=o.R3.create();o.R3.cross(g,l,c);let m=n.imagePositionPatient;null==m&&(m=[0,0,0]);const h=n.columnPixelSpacing||1,f=n.rowPixelSpacing||1,p=n.columns,v=n.rows;return this.hasPixelSpacing=!!n.columnPixelSpacing,{bitsAllocated:8,numComps:3,origin:m,rows:d,columns:u,direction:[...l,...c,...g],dimensions:[p,v,1],spacing:[h,f,1],hasPixelSpacing:this.hasPixelSpacing,numVoxels:p*v*1,imagePlaneModule:n}}setDataIds(e,t){this.setVideo(e[0],t?.viewReference?.sliceIndex||1)}setVideo(e,t){this.imageId=Array.isArray(e)?e[0]:e;const n=r.get(i.MetadataModules.IMAGE_URL,e);if(!n?.rendered)throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:o}=n,a=r.get(i.MetadataModules.GENERAL_SERIES,e);this.modality=a?.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:s,numberOfFrames:l}=r.get(i.MetadataModules.CINE,e);return this.numberOfFrames=l,this.setVideoURL(o).then((()=>(l&&1!==l||(l=Math.round(this.videoElement.duration*(s||30))),s||(s=Math.round(l/this.videoElement.duration)),this.fps=s,this.numberOfFrames=l,this.setFrameRange([1,l]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(t||1)},new Promise((e=>{window.setTimeout((()=>{this.setFrameNumber(t||1),e(this)}),25)})))))}async setVideoURL(e){return new Promise((t=>{this.videoElement.src=e,this.videoElement.preload="auto";const n=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",n),this.refreshRenderValues(),t(!0)};this.videoElement.addEventListener("loadedmetadata",n)}))}getImageIds(){const e=new Array(this.numberOfFrames),t=this.imageId.replace(/[0-9]+$/,"");for(let n=0;n<this.numberOfFrames;n++)e[n]=`${t}${n+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch(e){}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch(e){}}async scroll(e=1){await this.pause();const t=this.videoElement,n=this.renderFrame,o=t.currentTime+e*this.scrollSpeed/this.fps;t.currentTime=o;const i=e=>{n(),t.removeEventListener("seeked",i)};t.addEventListener("seeked",i)}async start(){const e=this.videoElement,t=this.renderFrame;if(e.currentTime=0,e.paused){const n=o=>{t(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async end(){const e=this.videoElement,t=this.renderFrame;if(e.currentTime=e.duration,e.paused){const n=o=>{t(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async setTime(e){const t=this.videoElement,n=this.renderFrame;if(t.currentTime=e,t.paused){const e=o=>{n(),t.removeEventListener("seeked",e)};t.addEventListener("seeked",e)}}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){e?2===e.length&&e[0]!==e[1]&&(this.frameRange=[e[0],e[1]]):this.frameRange=[1,this.numberOfFrames]}getFrameRange(){return this.frameRange}setProperties(e){void 0!==e.loop&&(this.videoElement.loop=e.loop),void 0!==e.muted&&(this.videoElement.muted=e.muted),void 0!==e.playbackRate&&this.setPlaybackRate(e.playbackRate),void 0!==e.scrollSpeed&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){this.playbackRate=e,e<.0625?this.pause():this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,t=i.VideoEnums.SpeedUnit.FRAME){this.scrollSpeed=t===i.VideoEnums.SpeedUnit.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){if(this.scalarData?.frameNumber===this.getFrameNumber())return this.scalarData;const e=document.createElement("canvas");e.width=this.videoWidth,e.height=this.videoHeight;const t=e.getContext("2d");t.drawImage(this.videoElement,0,0);const n=t.getImageData(0,0,this.videoWidth,this.videoHeight).data;return n.getRange=()=>[0,255],n.frameNumber=this.getFrameNumber(),this.scalarData=n,n}getImageData(){const{metadata:e}=this,t=e.spacing,n={dimensions:e.dimensions,spacing:t,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},getScalarData:()=>this.getScalarData(),imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:e=>{const t=this.worldToCanvas(e),n=this.canvasToIndex(t);return[n[0],n[1],0]},indexToWorld:(e,t)=>{const n=this.indexToCanvas([e[0],e[1]]);return this.canvasToWorld(n,t)}},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(n,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),n}hasImageURI(e){const t=e.match(g.frameRangeExtractor),n=t?e.substring(0,t.index):e;return-1!==this.imageId.indexOf(n)}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,t=128){const n=t-e/2,o=t+e/2-1;this.setVOI({lower:n,upper:o}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite)return void(this.feFilter=null);const e=this.averageWhite||[255,255,255],t=Math.max(...e),n=e.map((e=>t/e)),{lower:o=0,upper:i=255}=this.voiRange||{},r=(i-o+1)/255,a=o/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${n[0]*r} 0 0 0 ${a}           0 ${n[1]*r} 0 0 ${a}           0 0 ${n[2]*r} 0 ${a}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:t,focalPoint:n}=e;if(t&&(this.videoCamera.parallelScale=this.element.clientHeight/2/t),void 0!==n){const e=this.worldToCanvas(n),t=[this.element.clientWidth/2,this.element.clientHeight/2],o=[(e[0]-t[0])/this.videoCamera.parallelScale,(e[1]-t[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-o[0],this.videoCamera.panWorld[1]-o[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),!1===this.isPlaying&&this.renderFrame()}getCurrentImageId(){return this.imageId.replace("/frames/1",this.isPlaying?`/frames/${this.frameRange[0]}-${this.frameRange[1]}`:`/frames/${this.getFrameNumber()}`)}getReferenceId(e={}){const{sliceIndex:t}=e;if(void 0===t)return`videoId:${this.getCurrentImageId()}`;if(Array.isArray(t))return`videoId:${this.imageId.substring(0,this.imageId.length-1)}${t[0]+1}-${t[1]+1}`;return`videoId:${this.imageId.replace("/frames/1",`/frames/${1+t}`)}`}isReferenceViewable(e,t={}){let{imageURI:n}=t;const{referencedImageId:o,sliceIndex:i}=e;if(!super.isReferenceViewable(e))return!1;const r=this.getCurrentImageId();if(!n){const e=r.indexOf(":");n=r.substring(e+1,r.length-1)}if(t.withNavigation)return!0;const a=this.getSliceIndex();if(Array.isArray(i))return a>=i[0]&&a<=i[1];if(void 0!==i)return a===i;if(!o)return!1;const s=o.match(g.frameRangeExtractor);if(!s||!s[2])return!0;const l=s[2].split("-").map((e=>Number(e))),c=a+1;return l[0]<=c&&c<=(l[1]??l[0])}setViewReference(e){"number"==typeof e.sliceIndex?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){let t=e?.sliceIndex;return t||(t=this.isPlaying?[this.frameRange[0]-1,this.frameRange[1]-1]:this.getCurrentImageIdIndex()),{...super.getViewReference(e),referencedImageId:this.getReferenceId(e),sliceIndex:t}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,t=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(t),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const t=Math.floor(this.videoWidth*e),n=Math.floor(this.videoHeight*e),o=(this.canvas.offsetWidth-t)/2/e,i=(this.canvas.offsetHeight-n)/2/e;this.videoCamera.panWorld=[o,i],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,t=window.devicePixelRatio||1,n=this.getWorldToCanvasRatio(),o=this.getCanvasToWorldRatio(),i=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],r=[i[0]*o,i[1]*o],s=new a.w;return s.scale(t,t),s.translate(i[0],i[1]),s.scale(n,n),s.translate(e[0],e[1]),s.translate(-r[0],-r[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const t=this.getActors();e.forEach((e=>{const n=u.ZP.getImage(e.imageId),o=this.createActorMapper(n);o&&(t.push({uid:e.actorUID,actor:o}),e.callback&&e.callback({imageActor:o,imageId:e.imageId}))})),this.setActors(t)}createActorMapper(e){return new d.Z(this,e)}}const m=g},68467:(e,t,n)=>{n.d(t,{Z:()=>o});const o=async function(e,t,n){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!n.addImages)return void console.warn(`Viewport with Id ${t} does not have addImages. Cannot add image segmentation to this viewport.`)}const o=n.map((async n=>e.getViewport(n).addImages(t)));await Promise.all(o)}},87301:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(36205);const i=async function(e,t,n,i=!1,r=!1){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!(n instanceof o.Z))return void console.warn(`Viewport with Id ${t} is not a BaseVolumeViewport. Cannot add volume to this viewport.`)}const a=n.map((async n=>{const o=e.getViewport(n);await o.addVolumes(t,i,r)}));await Promise.all(a)}},43877:(e,t,n)=>{n.d(t,{Wl:()=>o.Z,yP:()=>l});var o=n(51945),i=n(52813);const r=[0,0,0,0];function a(e,t){let n=0,o=e.length-1;for(;n<=o;){const i=n+Math.floor((o-n)/2),r=e[i];if(r===t)return i;t<r?o=i-1:n=i+1}return n}function s(e,t,n){let o;const i=[],r=[],s=[],l=[];for(n=null===n?1:n,o=0;o<t.length;o++){const n=t[o];i.push((e-1)*n[0]),r.push(n[1]),s.push(n[1])}const c=function(e,t,n){const o=(t-e)/((n=null===n?100:n)-1),i=[];for(;n-- >0;)i.push(e),e+=o;return i[i.length-1]=t,i}(0,1,e);for(o=0;o<e;o++)c[o]=(e-1)*Math.pow(c[o],n);const d=function(e,t){let n;const o=[],i=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<i;n++)o[n]=a(e,t[n]);return o}(i,c);for(o=1;o<e-1;o++){const e=d[o],t=(c[o]-i[e-1])/(i[e]-i[e-1]),n=r[e]-s[e-1];l[o]=t*n+s[e-1]}return l[0]=s[0],l[e-1]=r[t.length-1],l}function l(e,t){let n=i.Z[e];n||(n=i.Z[e]=t||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=function(e,t,n){let o;const i=[];n=null===n?1:n;const r=s(t=null===t?256:t,e.red,n),a=s(t,e.green,n),l=s(t,e.blue,n);for(o=0;o<t;o++){const e=[Math.round(255*r[o]),Math.round(255*a[o]),Math.round(255*l[o]),255];i.push(e)}return i}(n.segmentedData,n.numColors,n.gamma));return{getId:()=>e,getColorSchemeName:()=>n.name,setColorSchemeName(e){n.name=e},getNumberOfColors:()=>n.colors.length,setNumberOfColors(e){for(;n.colors.length<e;)n.colors.push(r);n.colors.length=e},getColor(e){return this.isValidIndex(e)?n.colors[e]:r},getColorRepeating(e){const t=n.colors.length;return e=t?e%t:0,this.getColor(e)},setColor(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor(e){n.colors.push(e)},insertColor(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors(){n.colors=[]},buildLookupTable(e){if(!e)return;const t=n.colors.length;e.setNumberOfTableValues(t);for(let o=0;o<t;o++)e.setTableValue(o,n.colors[o])},createLookupTable(){const e=new o.Z;return this.buildLookupTable(e),e},isValidIndex:e=>e>=0&&e<n.colors.length}}},98165:(e,t,n)=>{function o(){return window.performance?performance.now():Date.now()}function i(e,t,n){return n?function(e){const t=Math.max(...e.lut).toString(2).length-8,n=e.lut[0]>>t,o=e.lut[e.lut.length-1]>>t,i=e.firstValueMapped+e.lut.length-1;return function(r){return r<e.firstValueMapped?n:r>=i?o:e.lut[r-e.firstValueMapped]>>t}}(n):function(e,t){return function(n){const o=255*((n-(t-.5))/(e-1)+.5);return Math.min(Math.max(o,0),255)}}(e,t)}n.d(t,{Z:()=>C});var r=n(77327);function a(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const o=(0,r.Z)(e,n).getMatrix();t.setTransform(o[0],o[1],o[2],o[3],o[4],o[5])}function s(e,t){const n=e.renderingTools.lastRenderedImageId,o=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!o||o.windowCenter!==e.viewport.voi.windowCenter||o.windowWidth!==e.viewport.voi.windowWidth||o.invert!==e.viewport.invert||o.rotation!==e.viewport.rotation||o.hflip!==e.viewport.hflip||o.vflip!==e.viewport.vflip||o.modalityLUT!==e.viewport.modalityLUT||o.voiLUT!==e.viewport.voiLUT||o.colormap!==e.viewport.colormap}function l(e,t){const n=e.renderingTools.renderCanvas;n.width=t.width,n.height=t.height;const o=n.getContext("2d");o.fillStyle="white",o.fillRect(0,0,n.width,n.height);const i=o.getImageData(0,0,t.width,t.height);e.renderingTools.renderCanvasContext=o,e.renderingTools.renderCanvasData=i}function c(e){const t=e.image.imageId,n=e.viewport,o=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=o,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools}function d(e,t){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&e.cachedLut.invert===t.invert||(function(e,t,n,o,r){const a=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0);if(void 0===e.cachedLut){const t=a-l+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(t)}const c=e.cachedLut.lutArray,d=i(Array.isArray(t)?t[0]:t,Array.isArray(n)?n[0]:n,r);if(!0===o)for(let e=s;e<=a;e++)c[e+-l]=255-d(e);else for(let e=s;e<=a;e++)c[e+-l]=d(e)}(e,t.voi.windowWidth,t.voi.windowCenter,t.invert),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert),e.cachedLut.lutArray}function u(e,t,n){const i=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&i||(e.renderingTools.renderCanvas=document.createElement("canvas"));const r=e.renderingTools.renderCanvas,{windowWidth:a,windowCenter:c}=e.viewport.voi;if((256===a||255===a)&&(128===c||127===c)&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas())return t.getCanvas();if(!1===s(e,t)&&!0!==n)return r;r.width===t.width&&r.height===t.height||l(e,t);let u=o();const g=d(t,e.viewport);t.stats=t.stats||{},t.stats.lastLutGenerateTime=o()-u;const m=e.renderingTools.renderCanvasData,h=e.renderingTools.renderCanvasContext;return t.rgba?function(e,t,n){let i=o();const r=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const a=e.minPixelValue;let s=0,l=0;const c=r.length;if(i=o(),a<0)for(;l<c;)n[s++]=t[r[l++]+-a],n[s++]=t[r[l++]+-a],n[s++]=t[r[l++]+-a],n[s++]=r[l++];else for(;l<c;)n[s++]=t[r[l++]],n[s++]=t[r[l++]],n[s++]=t[r[l++]],n[s++]=r[l++];e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,g,m.data):function(e,t,n){let i=o();const r=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const a=e.minPixelValue;let s=0,l=0;const c=r.length;if(i=o(),a<0)for(;l<c;)n[s++]=t[r[l++]+-a],n[s++]=t[r[l++]+-a],n[s]=t[r[l]+-a],l+=2,s+=2;else for(;l<c;)n[s++]=t[r[l++]],n[s++]=t[r[l++]],n[s]=t[r[l]],l+=2,s+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,g,m.data),u=o(),h.putImageData(m,0,0),t.stats.lastPutImageDataTime=o()-u,r}function g(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");const o=e.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0),o.fillStyle="black",o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,a(e,o);const i=u(e,n,t),r=e.viewport.displayedArea.tlhc.x-1,s=e.viewport.displayedArea.tlhc.y-1,l=e.viewport.displayedArea.brhc.x-r,d=e.viewport.displayedArea.brhc.y-s;o.drawImage(i,r,s,l,d,0,0,l,d),e.renderingTools=c(e)}function m(e,t){if(function(e){const t=e.voiLUT&&e.voiLUT.lut&&e.voiLUT.lut.length>0;return t||void 0!==e.voi.windowWidth&&void 0!==e.voi.windowCenter}(e))return;const n=t.maxPixelValue*t.slope+t.intercept,o=t.minPixelValue*t.slope+t.intercept,i=n-o,r=(n+o)/2;void 0===e.voi?e.voi={windowWidth:i,windowCenter:r}:(e.voi.windowWidth=i,e.voi.windowCenter=r)}function h(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}function f(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&h(e.cachedLut.modalityLUT,t.modalityLUT)&&h(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(m(t,e),function(e,t,n,o,r,a){const s=e.maxPixelValue,l=e.minPixelValue,c=Math.min(l,0);if(void 0===e.cachedLut){const t=s-c+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(t)}const d=e.cachedLut.lutArray,u=function(e,t,n){return n?function(e){const t=e.lut[0],n=e.lut[e.lut.length-1],o=e.firstValueMapped+e.lut.length;return i=>i<e.firstValueMapped?t:i>=o?n:e.lut[i]}(n):function(e,t){return n=>n*e+t}(e,t)}(e.slope,e.intercept,r),g=i(t,n,a);if(e.isPreScaled)if(!0===o)for(let e=l;e<=s;e++)d[e+-c]=255-g(e);else for(let e=l;e<=s;e++)d[e+-c]=g(e);else if(!0===o)for(let e=l;e<=s;e++)d[e+-c]=255-g(u(e));else for(let e=l;e<=s;e++)d[e+-c]=g(u(e))}(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray}function p(e,t,n,i=!0){const r=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&!r||(e.renderingTools.renderCanvas=document.createElement("canvas"),l(e,t));const a=e.renderingTools.renderCanvas;if(!1===s(e,t)&&!0!==n)return a;a.width===t.width&&a.height===t.height||l(e,t),t.stats=t.stats||{};const c=e.renderingTools.renderCanvasData,d=e.renderingTools.renderCanvasContext;let u=o();t.stats.lastLutGenerateTime=o()-u;const{viewport:g}=e;if("PT"===g.modality&&t.isPreScaled){const{windowWidth:e,windowCenter:n}=g.voi,i=n-e/2,r=255/(n+e/2-i);let a;a=g.invert?e=>255-(e-i)*r:e=>(e-i)*r,function(e,t,n){let i=o();const r=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const a=r.length;let s=3,l=0;for(i=o();l<a;)n[s]=t(r[l++]),s+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,a,c.data)}else{const e=f(t,g,n);i?function(e,t,n){let i=o();const r=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const a=r.length,s=e.minPixelValue;let l=3,c=0;if(i=o(),r instanceof Int16Array)if(s<0)for(;c<a;)n[l]=t[r[c++]+-s],l+=4;else for(;c<a;)n[l]=t[r[c++]],l+=4;else if(r instanceof Uint16Array)for(;c<a;)n[l]=t[r[c++]],l+=4;else if(s<0)for(;c<a;)n[l]=t[r[c++]+-s],l+=4;else for(;c<a;)n[l]=t[r[c++]],l+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,e,c.data):function(e,t,n){let i=o();const r=e.getPixelData();e.stats.lastGetPixelDataTime=o()-i;const a=r.length,s=e.minPixelValue;let l,c=0,d=0;if(i=o(),r instanceof Int16Array)if(s<0)for(;d<a;)l=t[r[d++]+-s],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else for(;d<a;)l=t[r[d++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else if(r instanceof Uint16Array)for(;d<a;)l=t[r[d++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else if(s<0)for(;d<a;)l=t[r[d++]+-s],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else for(;d<a;)l=t[r[d++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-i}(t,e,c.data)}return u=o(),d.putImageData(c,0,0),t.stats.lastPutImageDataTime=o()-u,a}function v(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");const o=e.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0),o.fillStyle="black",o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,a(e,o);const i=p(e,n,t),r=e.viewport.displayedArea.tlhc.x-1,s=e.viewport.displayedArea.tlhc.y-1,l=e.viewport.displayedArea.brhc.x-r,d=e.viewport.displayedArea.brhc.y-s;o.drawImage(i,r,s,l,d,0,0,l,d),e.renderingTools=c(e)}var w=n(43877);const y=function(e,t,n,i){let r=o();const a=e.getPixelData();e.stats.lastGetPixelDataTime=o()-r;const s=a.length,l=e.minPixelValue;let c,d,u,g=0,m=0;if(r=o(),u=n instanceof w.Wl?n.Table:n,l<0)for(;m<s;)c=t[a[m++]+-l],d=u[c],i[g++]=d[0],i[g++]=d[1],i[g++]=d[2],i[g++]=d[3];else for(;m<s;)c=t[a[m++]],d=u[c],i[g++]=d[0],i[g++]=d[1],i[g++]=d[2],i[g++]=d[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-r};const I=function(e,t,n,i){let r=o();const a=e.getPixelData();e.stats.lastGetPixelDataTime=o()-r;const s=a.length,l=e.minPixelValue;let c,d,u,g=0,m=0;if(r=o(),u=n instanceof w.Wl?n.Table:n,l<0)for(;m<s;)c=t(a[m++]+-l),d=u[c],i[g++]=d[0],i[g++]=d[1],i[g++]=d[2],i[g++]=d[3];else for(;m<s;)c=t(a[m++]),d=u[c],i[g++]=d[0],i[g++]=d[1],i[g++]=d[2],i[g++]=d[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=o()-r};var x=n(56309);function b(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");const i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,a(e,i);const r=function(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));const i=e.renderingTools.renderCanvas;let r=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),r&&"string"==typeof r&&(r=w.yP(r)),!r)throw new Error("renderPseudoColorImage: colormap not found.");const a=r.getId();if(!1===s(e,t)&&!0!==n&&e.renderingTools.colormapId===a)return i;i.width===t.width&&i.height===t.height||l(e,t);let c=o();e.renderingTools.colorLUT&&!n&&e.renderingTools.colormapId===a||(r.setNumberOfColors(256),e.renderingTools.colorLUT=r.createLookupTable(),e.renderingTools.colormapId=a);const d=e.renderingTools.renderCanvasData,u=e.renderingTools.renderCanvasContext,{viewport:g}=e,m=e.renderingTools.colorLUT;if("PT"===g.modality){const{windowWidth:e,windowCenter:n}=g.voi,o=n-e/2,i=255/(n+e/2-o);let r;r=g.invert?e=>(0,x.clamp)(Math.floor(255-(e-o)*i),0,255):e=>(0,x.clamp)(Math.floor((e-o)*i),0,255),I(t,r,m,d.data)}else{const i=f(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=o()-c,y(t,i,m,d.data)}return c=o(),u.putImageData(d,0,0),t.stats.lastPutImageDataTime=o()-c,i}(e,n,t),d=e.viewport.displayedArea.tlhc.x-1,u=e.viewport.displayedArea.tlhc.y-1,g=e.viewport.displayedArea.brhc.x-d,m=e.viewport.displayedArea.brhc.y-u;i.drawImage(r,d,u,g,m,0,0,g,m),e.renderingTools=c(e)}function C(e,t){const n=e.image;if(!e.canvas||!e.image)return;const i=o();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let o=n.render;o||(o=e.viewport.colormap?b:n.color?g:v),o(e,t)}const r=o()-i;n.stats.lastRenderTime=r,e.invalid=!1,e.needsRedraw=!1}},77327:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(30742);function i(e,t){const n=new o.w;if(!e.viewport.displayedArea)return n;n.translate(e.canvas.width/2,e.canvas.height/2);const i=e.viewport.rotation;0!==i&&n.rotate(i*Math.PI/180);let r=e.viewport.scale,a=e.viewport.scale;const s=e.viewport.displayedArea.brhc.x-(e.viewport.displayedArea.tlhc.x-1),l=e.viewport.displayedArea.brhc.y-(e.viewport.displayedArea.tlhc.y-1);if("NONE"===e.viewport.displayedArea.presentationSizeMode)e.image.rowPixelSpacing<e.image.columnPixelSpacing?r*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(a*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);else if(r=e.viewport.displayedArea.columnPixelSpacing,a=e.viewport.displayedArea.rowPixelSpacing,"SCALE TO FIT"===e.viewport.displayedArea.presentationSizeMode){const t=e.canvas.height/(l*a),n=e.canvas.width/(s*r);r=a=Math.min(n,t),e.viewport.displayedArea.rowPixelSpacing<e.viewport.displayedArea.columnPixelSpacing?r*=e.viewport.displayedArea.columnPixelSpacing/e.viewport.displayedArea.rowPixelSpacing:e.viewport.displayedArea.columnPixelSpacing<e.viewport.displayedArea.rowPixelSpacing&&(a*=e.viewport.displayedArea.rowPixelSpacing/e.viewport.displayedArea.columnPixelSpacing)}return n.scale(r,a),0!==i&&n.rotate(-i*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==i&&n.rotate(i*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-l/2),n}},62705:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(55469);function i(e,t){const n=(0,o.Z)(e);return n.invert(),n.transformPoint(t)}},14419:(e,t,n)=>{function o(e,t){const{hflip:n,vflip:o,rotation:i}=t;if(e.x*=n?-1:1,e.y*=o?-1:1,0!==i){const t=i*Math.PI/180,n=Math.cos(t),o=Math.sin(t),r=e.x*n-e.y*o,a=e.x*o+e.y*n;e.x=r,e.y=a}return e}n.d(t,{Z:()=>o})},69687:(e,t,n)=>{n.d(t,{Z:()=>r});const o={viewport:{}};var i=n(37023);function r(e,t,n,r){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(void 0===t)return function(){const e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}};return Object.assign({},e,o.viewport)}();const a=(0,i.Z)(e,t,0).scaleFactor;let s;return"PT"===n&&t.isPreScaled?s={windowWidth:5,windowCenter:2.5}:void 0!==t.windowWidth&&void 0!==t.windowCenter&&(s={windowWidth:Array.isArray(t.windowWidth)?t.windowWidth[0]:t.windowWidth,windowCenter:Array.isArray(t.windowCenter)?t.windowCenter[0]:t.windowCenter}),{scale:a,translation:{x:0,y:0},voi:s,invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,modality:n,voiLUT:t.voiLUT,colormap:void 0!==r?r:t.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:t.columns,y:t.rows},rowPixelSpacing:void 0===t.rowPixelSpacing?1:t.rowPixelSpacing,columnPixelSpacing:void 0===t.columnPixelSpacing?1:t.columnPixelSpacing,presentationSizeMode:"NONE"}}}},37023:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(6737),i=n(19369);function r(e,t,n=null){(0,o.T)(e,"getImageScale: parameter canvas must not be undefined"),(0,o.T)(t,"getImageScale: parameter image must not be undefined");const r=(0,i.Z)(t,n),a=t.rowPixelSpacing||1,s=t.columnPixelSpacing||1;let l=1,c=1;a<s?c=s/a:l=a/s;const d=e.height/r.height/l,u=e.width/r.width/c;return{verticalScale:d,horizontalScale:u,scaleFactor:Math.min(u,d)}}},19369:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(6737);function i(e,t=null){return(0,o.T)(e,"getImageSize: parameter image must not be undefined"),(0,o.T)(e.width,"getImageSize: parameter image must have width"),(0,o.T)(e.height,"getImageSize: parameter image must have height"),function(e){return!(null==e||0===e||180===e)}(t)?{height:e.width,width:e.height}:{width:e.width,height:e.height}}},55469:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(77327);function i(e){return(0,o.Z)(e)}},48467:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(55469);function i(e,t){return(0,o.Z)(e).transformPoint(t)}},22982:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(37023);function i(e,t=!0,n=!0){const{canvas:i,image:r,viewport:a}=e,s=(0,o.Z)(i,r,0).scaleFactor;a.vflip=!1,a.hflip=!1,t&&(a.translation.x=0,a.translation.y=0),n&&(a.displayedArea.tlhc.x=1,a.displayedArea.tlhc.y=1,a.displayedArea.brhc.x=r.columns,a.displayedArea.brhc.y=r.rows,a.scale=s)}},34343:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(37023);var i=n(19369);function r(e,t=!1){const n=e.canvas.width,r=e.canvas.height;!function(e){const{canvas:t}=e,{clientWidth:n,clientHeight:o}=t;t.width===n&&t.height===o||(t.width=n,t.height=o)}(e),void 0!==e.image&&(t||function(e,t,n){const o=e.viewport.scale,r=(0,i.Z)(e.image,e.viewport.rotation),a=Math.round(r.width*o),s=Math.round(r.height*o),l=e.viewport.translation.x,c=e.viewport.translation.y;return a===t&&s<=n||a<=t&&s===n&&0===l&&0===c}(e,n,r)?function(e){const{image:t}=e;e.viewport.scale=(0,o.Z)(e.canvas,t,e.viewport.rotation).scaleFactor,e.viewport.translation.x=0,e.viewport.translation.y=0}(e):function(e,t,n){const o=e.viewport.scale,i=e.canvas.width/t,r=e.canvas.height/n,a=Math.sqrt(i*r);e.viewport.scale=a*o}(e,n,r))}},30742:(e,t,n)=>{n.d(t,{w:()=>o});class o{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new o;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const t=this.m[0]*e[0]+this.m[2]*e[1],n=this.m[1]*e[0]+this.m[3]*e[1],o=this.m[0]*e[2]+this.m[2]*e[3],i=this.m[1]*e[2]+this.m[3]*e[3],r=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],a=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=i,this.m[4]=r,this.m[5]=a}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,o=-this.m[2]*e,i=this.m[0]*e,r=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=i,this.m[4]=r,this.m[5]=a}rotate(e){const t=Math.cos(e),n=Math.sin(e),o=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,r=this.m[0]*-n+this.m[2]*t,a=this.m[1]*-n+this.m[3]*t;this.m[0]=o,this.m[1]=i,this.m[2]=r,this.m[3]=a}translate(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}scale(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}transformPoint(e){const t=e[0],n=e[1];return[t*this.m[0]+n*this.m[2]+this.m[4],t*this.m[1]+n*this.m[3]+this.m[5]]}}},6737:(e,t,n)=>{function o(e,t){if(null==e)throw new Error(t)}n.d(t,{T:()=>o})},24109:(e,t,n)=>{n.d(t,{Z:()=>v});var o=n(72076),i=n(68470),r=n(91382),a=n(49445),s=n(6123);const{vtkDebugMacro:l}=i.m;const c={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),a.ZP.extend(e,t,n),t.boundsMTime={},i.m.obj(t.boundsMTime),i.m.set(e,t,["property"]),i.m.setGet(e,t,["mapper"]),i.m.getArray(e,t,["bounds"],6),function(e,t){t.classHierarchy.push("vtkVolume"),e.getVolumes=()=>e,e.makeProperty=s.ZP.newInstance,e.getProperty=()=>(null===t.property&&(t.property=e.makeProperty()),t.property),e.getBounds=()=>{if(null===t.mapper)return t.bounds;const n=t.mapper.getBounds();if(!n||6!==n.length)return n;if(n[0]>n[1])return t.mapperBounds=n.concat(),t.bounds=[1,-1,1,-1,1,-1],t.boundsMTime.modified(),n;if(!t.mapperBounds||!(i=[n,t.mapperBounds],i[0].map(((e,t)=>i.map((e=>e[t]))))).reduce(((e,t)=>e&&t[0]===t[1]),!0)||e.getMTime()>t.boundsMTime.getMTime()){l("Recomputing bounds..."),t.mapperBounds=n.map((e=>e));const i=[];r.ZP.getCorners(n,i),e.computeMatrix();const a=new Float64Array(16);o._E.transpose(a,t.matrix),i.forEach((e=>o.R3.transformMat4(e,e,a))),t.bounds[0]=t.bounds[2]=t.bounds[4]=Number.MAX_VALUE,t.bounds[1]=t.bounds[3]=t.bounds[5]=-Number.MAX_VALUE,t.bounds=t.bounds.map(((e,t)=>t%2==0?i.reduce(((e,n)=>e>n[t/2]?n[t/2]:e),e):i.reduce(((e,n)=>e<n[(t-1)/2]?n[(t-1)/2]:e),e))),t.boundsMTime.modified()}var i;return t.bounds},e.getMTime=()=>{let e=t.mtime;if(null!==t.property){const n=t.property.getMTime();e=n>e?n:e}return e},e.getRedrawMTime=()=>{let e=t.mtime;if(null!==t.mapper){let n=t.mapper.getMTime();e=n>e?n:e,null!==t.mapper.getInput()&&(t.mapper.getInputAlgorithm().update(),n=t.mapper.getInput().getMTime(),e=n>e?n:e)}return e}}(e,t)}var u={newInstance:i.m.newInstance(d,"vtkVolume"),extend:d},g=n(18588),m=n(49046),h=n(56309),f=n(7187),p=n(98230);const v=async function(e,t,n,o=!1,i=!1){const{volumeId:r,callback:a,blendMode:s}=e,l=await(0,g.loadVolume)(r);if(!l)throw new Error(`imageVolume with id: ${l.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:d}=l,v=(0,m.Z)(c,d);s&&v.setBlendMode(s);const w=u.newInstance();return w.setMapper(v),3===c.getPointData().getScalars().getNumberOfComponents()&&w.getProperty().setIndependentComponents(!1),await(0,p.Z)(w,l,i),a&&a({volumeActor:w,volumeId:r}),o||function(e,t,n,o){const i=n.getProperty().getRGBTransferFunction(0).getRange(),r={viewportId:t,range:{lower:i[0],upper:i[1]},volumeId:o};(0,h.triggerEvent)(e,f.Events.VOI_MODIFIED,r)}(t,n,w,r),w}},98230:(e,t,n)=>{n.d(t,{Z:()=>d});var o=n(62990),i=n(30023),r=n(56309),a=n(7187),s=n(82253);const l=0,c=a.RequestType.Prefetch;const d=async function(e,t,n){let a=function(e){const{imageIds:t,metadata:n}=e;let o;if(t.length){const e=t[Math.floor(t.length/2)],n=i.get("voiLutModule",e);if(n&&n.windowWidth&&n.windowCenter){const{windowWidth:e,windowCenter:t}=n;o={windowWidth:Array.isArray(e)?e[0]:e,windowCenter:Array.isArray(t)?t[0]:t}}}else o=n?.voiLut?.[0];if(o){const{lower:e,upper:t}=r.windowLevel.toLowHighRange(Number(o.windowWidth),Number(o.windowCenter));return{lower:e,upper:t}}}(t);!a&&t?.imageIds?.length&&(a=await async function(e,t){const{imageIds:n}=e,a=e.getScalarData(),d=Math.floor(n.length/2),u=e.imageIds[d],g=i.get("generalSeriesModule",u)||{},{modality:m}=g,h=i.get("modalityLutModule",u)||{},f=n.length,p=a.byteLength/f,v=a.length/f,w=a.BYTES_PER_ELEMENT,y={rescaleSlope:h.rescaleSlope,rescaleIntercept:h.rescaleIntercept,modality:m};let I;if("PT"===m){const e=i.get("scalingModule",u);e&&(I={...y,suvbw:e.suvbw})}const x=d*p,b={targetBuffer:{type:t?void 0:"Float32Array"},priority:l,requestType:c,useNativeDataType:t,preScale:{enabled:!0,scalingParameters:I}};let C=s.ZP.getImage(u);e.referencedImageIds?.length||(C=await(0,o.loadAndCacheImage)(u,{...b,ignoreCache:!0}));const P=C?C.getPixelData():function(e,t,n,o){const{scalarData:i}=e,{buffer:r}=i;i.BYTES_PER_ELEMENT!==n&&(t*=i.BYTES_PER_ELEMENT/n);const a=i.constructor,s=new a(o),l=new a(r,t,o);return s.set(l),s}(e,x,w,v),{min:E,max:S}=(0,r.getMinMax)(P);return{lower:E,upper:S}}(t,n),a=function(e,t){const n=e.imageIds,o=Math.floor(n.length/2),r=n[o];if(function(e,t){if("PT"!==e||!t.isPreScaled)return!1;if(!t.scaling?.PT.suvbw)return!1;return!0}((i.get("generalSeriesModule",r)||{}).modality,e))return{lower:0,upper:5};return t}(t,a)),0===a?.lower&&0===a?.upper||void 0===a?.lower||void 0===a?.upper||e.getProperty().getRGBTransferFunction(0).setMappingRange(a.lower,a.upper)}},51480:(e,t,n)=>{n.d(t,{ZP:()=>s});var o=n(6685),i=n(60337);const r={scalarTexture:null};function a(e,t,n={}){Object.assign(t,r,n),i.ZP.extend(e,t,n),o.ZP.setGet(e,t,["scalarTexture"]),function(e,t){t.classHierarchy.push("vtkSharedVolumeMapper");const n=e.delete;e.delete=()=>{t.scalarTexture=null,n()}}(e,t)}const s={newInstance:o.ZP.newInstance(a,"vtkSharedVolumeMapper"),extend:a}},5287:(e,t,n)=>{n.d(t,{Z:()=>l});var o=n(56309),i=n(74238),r=n(19546),a=n(84326);const s=1073741824;const l=new class{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageCacheSize=0,this._volumeCacheSize=0,this._maxCacheSize=3*s,this._maxInstanceSize=4294967288,this.setMaxCacheSize=e=>{if(!e||"number"!=typeof e){const e=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(e)}this._maxCacheSize=e},this.isCacheable=e=>{if(e>this._maxInstanceSize)return!1;return this.getBytesAvailable()+this._imageCacheSize>e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getMaxInstanceSize=()=>this._maxInstanceSize,this.getCacheSize=()=>this._imageCacheSize+this._volumeCacheSize,this._decacheImage=e=>{const t=this._imageCache.get(e);if(!t)return;const{imageLoadObject:n}=t;n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const t=this._volumeCache.get(e);if(!t)return;const{volumeLoadObject:n,volume:o}=t;o&&(o.cancelLoading&&o.cancelLoading(),o.imageData&&o.imageData.delete(),this._restoreImagesFromBuffer(o),n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(;;){const{value:t,done:n}=e.next();if(n)break;this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,r.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t})}this.purgeVolumeCache()},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:t,done:n}=e.next();if(n)break;this.removeVolumeLoadObject(t),(0,o.triggerEvent)(i.Z,r.Z.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:t})}},this.getVolumeLoadObject=e=>{if(void 0===e)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const t=this._volumeCache.get(e);if(t)return t.timeStamp=Date.now(),t.volumeLoadObject},this.getGeometry=e=>{if(null==e)throw new Error("getGeometry: geometryId must not be undefined");const t=this._geometryCache.get(e);if(t)return t.timeStamp=Date.now(),t.geometry},this.getImage=e=>{if(void 0===e)throw new Error("getImage: imageId must not be undefined");const t=this._imageCache.get(e);if(t)return t.timeStamp=Date.now(),t.image},this.getVolume=e=>{if(void 0===e)throw new Error("getVolume: volumeId must not be undefined");const t=this._volumeCache.get(e);if(t)return t.timeStamp=Date.now(),t.volume},this.getVolumes=()=>Array.from(this._volumeCache.values()).map((e=>e.volume)),this.filterVolumesByReferenceId=e=>this.getVolumes().filter((t=>t.referencedVolumeId===e)),this.removeImageLoadObject=e=>{if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");const t=this._imageCache.get(e);if(!t)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this.incrementImageCacheSize(-t.sizeInBytes);const n={image:t,imageId:e};(0,o.triggerEvent)(i.Z,r.Z.IMAGE_CACHE_IMAGE_REMOVED,n),this._decacheImage(e)},this.removeVolumeLoadObject=e=>{if(void 0===e)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const t=this._volumeCache.get(e);if(!t)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");this.incrementVolumeCacheSize(-t.sizeInBytes);const n={volume:t,volumeId:e};(0,o.triggerEvent)(i.Z,r.Z.VOLUME_CACHE_VOLUME_REMOVED,n),this._decacheVolume(e)},this.putGeometryLoadObject=(e,t)=>{if(null==e)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");const n={geometryId:e,geometryLoadObject:t,loaded:!1,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,n),t.promise.then((t=>{if(!this._geometryCache.has(e))return void console.warn("putGeometryLoadObject: geometryId was removed from geometryCache");if(Number.isNaN(t.sizeInBytes))throw new Error("putGeometryLoadObject: geometry.sizeInBytes is not a number");n.loaded=!0,n.geometry=t,n.sizeInBytes=t.sizeInBytes;const a={geometry:t,geometryId:e};(0,o.triggerEvent)(i.Z,r.Z.GEOMETRY_CACHE_GEOMETRY_ADDED,a)})).catch((t=>{throw this._geometryCache.delete(e),t}))},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.incrementVolumeCacheSize=e=>{this._volumeCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.decrementVolumeCacheSize=e=>{this._volumeCacheSize-=e},this._geometryCache=new Map}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,t){let n=this.getBytesAvailable();if(n>=e)return n;let a=Array.from(this._imageCache.values());a.sort((function(e,t){return e.timeStamp>t.timeStamp?1:e.timeStamp<t.timeStamp?-1:0}));let s=a.map((e=>e.imageId)),l=s;t&&(l=s.filter((e=>!t.includes(e))));for(const t of l)if(this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,r.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t}),n=this.getBytesAvailable(),n>=e)return n;a=Array.from(this._imageCache.values()),s=a.map((e=>e.imageId));for(const t of s)if(this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,r.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t}),n=this.getBytesAvailable(),n>=e)return n}putImageLoadObject(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(this._imageCache.has(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,n),t.promise.then((t=>{if(!this._imageCache.get(e))return void console.warn("The image was purged from the cache before it completed loading.");if(void 0===t.sizeInBytes||Number.isNaN(t.sizeInBytes))throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");if(!this.isCacheable(t.sizeInBytes))throw new Error(r.Z.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(t.sizeInBytes),n.loaded=!0,n.image=t,n.sizeInBytes=t.sizeInBytes,this.incrementImageCacheSize(n.sizeInBytes);const a={image:n};(0,o.triggerEvent)(i.Z,r.Z.IMAGE_CACHE_IMAGE_ADDED,a),n.sharedCacheKey=t.sharedCacheKey})).catch((t=>{throw this._imageCache.delete(e),t}))}getImageLoadObject(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");const t=this._imageCache.get(e);if(t)return t.timeStamp=Date.now(),t.imageLoadObject}isLoaded(e){const t=this._imageCache.get(e);return!!t&&t.loaded}getVolumeContainingImageId(e){const t=Array.from(this._volumeCache.keys()),n=(0,o.imageIdToURI)(e);for(const e of t){const t=this._volumeCache.get(e);if(!t)return;const{volume:o}=t;if(!o?.imageIds?.length)return;const i=o.getImageURIIndex(n);if(i>-1)return{volume:o,imageIdIndex:i}}}getCachedImageBasedOnImageURI(e){const t=(0,o.imageIdToURI)(e),n=Array.from(this._imageCache.keys()).find((e=>(0,o.imageIdToURI)(e)===t));if(n)return this._imageCache.get(n)}putVolumeLoadObject(e,t){if(void 0===e)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(void 0===t.promise)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const n={loaded:!1,volumeId:e,volumeLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,n),t.promise.then((t=>{if(!this._volumeCache.get(e))return void console.warn("The image was purged from the cache before it completed loading.");if(Number.isNaN(t.sizeInBytes))throw new Error("putVolumeLoadObject: volume.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putVolumeLoadObject: volume.sizeInBytes is not a number");this.decacheIfNecessaryUntilBytesAvailable(t.sizeInBytes,t.imageIds),n.volume=t,n.sizeInBytes=t.sizeInBytes,this.incrementVolumeCacheSize(n.sizeInBytes);const a={volume:n};(0,o.triggerEvent)(i.Z,r.Z.VOLUME_CACHE_VOLUME_ADDED,a)})).catch((t=>{throw this._volumeCache.delete(e),t}))}_restoreImagesFromBuffer(e){if(!(e instanceof a.J))return void console.warn("Volume is not an ImageVolume. Cannot restore images from buffer.");const t=e.getScalarData(),n=e.imageCacheOffsetMap;if(0!==n.size){for(const[e,{offset:o}]of n){const n=this.getImage(e);if(!n){console.warn(`Image with id ${e} not found in cache.`);continue}const i=n.getPixelData(),r=i.length,a=new i.constructor(t.buffer,o,r);n.getPixelData=()=>a,n.imageFrame&&(n.imageFrame.pixelData=a),delete n.bufferView,this.incrementImageCacheSize(n.sizeInBytes)}console.log(`Images restored from buffer for volume ${e.volumeId}.`)}}}},19247:(e,t,n)=>{n.d(t,{EPSILON:()=>r,MPR_CAMERA_VALUES:()=>a.Z,RENDERING_DEFAULTS:()=>i,VIEWPORT_PRESETS:()=>s.Z});n(52813);const o={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(o);const i=o,r=.001;var a=n(21306),s=n(89469);n(43220)},49334:(e,t,n)=>{var o;n.d(t,{Z:()=>i}),function(e){e.Interaction="interaction",e.Thumbnail="thumbnail",e.Prefetch="prefetch",e.Compute="compute"}(o||(o={}));const i=o},84659:(e,t,n)=>{var o;n.d(t,{Z:()=>i}),function(e){e.NO_DATA="noData",e.LOADING="loading",e.PRE_RENDER="preRender",e.RESIZE="resize",e.RENDERED="rendered"}(o||(o={}));const i=o},7187:(e,t,n)=>{n.d(t,{BlendModes:()=>d,CalibrationTypes:()=>w,Events:()=>o.Z,GeometryType:()=>h,ImageQualityStatus:()=>I.Z,InterpolationType:()=>a.Z,MetadataModules:()=>b.Z,OrientationAxis:()=>g.Z,RequestType:()=>i.Z,SharedArrayBufferModes:()=>m.Z,VOILUTFunctionType:()=>p.Z,VideoEnums:()=>x,ViewportStatus:()=>y.Z,ViewportType:()=>r.Z});var o=n(19546),i=n(49334),r=n(68032),a=n(75677),s=n(83336);const{BlendMode:l}=s.default;var c;!function(e){e[e.COMPOSITE=0]="COMPOSITE",e[e.MAXIMUM_INTENSITY_BLEND=1]="MAXIMUM_INTENSITY_BLEND",e[e.MINIMUM_INTENSITY_BLEND=2]="MINIMUM_INTENSITY_BLEND",e[e.AVERAGE_INTENSITY_BLEND=3]="AVERAGE_INTENSITY_BLEND"}(c||(c={}));const d=c;var u,g=n(96426),m=n(91799);!function(e){e.CONTOUR="contour",e.SURFACE="Surface"}(u||(u={}));const h=u;n(2689);var f,p=n(67751);!function(e){e.SUM="SUM",e.AVERAGE="AVERAGE",e.SUBTRACT="SUBTRACT"}(f||(f={}));var v;!function(e){e.NOT_APPLICABLE="",e.ERMF="ERMF",e.USER="User",e.PROJECTION="Proj",e.REGION="Region",e.ERROR="Error",e.UNCALIBRATED="Uncalibrated"}(v||(v={}));const w=v;var y=n(84659),I=n(83521),x=n(40373),b=n(636)},65279:(e,t,n)=>{n.d(t,{O:()=>r,Yz:()=>a,ZP:()=>i,wN:()=>s});var o=n(9138);function i(e){if(!e)return;const{viewportUid:t,renderingEngineUid:n}=e.dataset;return r(t,n)}function r(e,t){if(!t||!e)return;const n=(0,o.ZP)(t);if(!n||n.hasBeenDestroyed)return;const i=n.getViewport(e);if(!i)return;const r=i.getFrameOfReferenceUID();return{viewport:i,renderingEngine:n,viewportId:e,renderingEngineId:t,FrameOfReferenceUID:r}}function a(e){const t=(0,o.Uu)();for(let n=0;n<t.length;n++){const o=t[n];if(o.getViewport(e))return r(e,o.id)}}function s(){const e=[];return(0,o.Uu)().forEach((t=>{t.getViewports().forEach((({element:t})=>{e.push(i(t))}))})),e}},12651:(e,t,n)=>{n.d(t,{BaseVolumeViewport:()=>s.Z,CONSTANTS:()=>i,EVENTS:()=>o.Events,Enums:()=>o,Settings:()=>I,StackViewport:()=>l.Z,VolumeViewport:()=>r.Z,VolumeViewport3D:()=>a.Z,addImageSlicesToViewports:()=>R.PN,addVolumesToViewports:()=>R.gc,cache:()=>u.ZP,eventTarget:()=>c.Z,geometryLoader:()=>T,getConfiguration:()=>f.P_,getEnabledElement:()=>m.ZP,getEnabledElementByIds:()=>m.O,getEnabledElementByViewportId:()=>m.Yz,getEnabledElements:()=>m.wN,getRenderingEngine:()=>d.Pr,getRenderingEngines:()=>d.Uu,getWebWorkerManager:()=>f.Pt,imageLoadPoolManager:()=>g.Z,imageLoader:()=>S,metaData:()=>h,triggerEvent:()=>A.Z,utilities:()=>M,volumeLoader:()=>E});var o=n(7187),i=n(19247),r=(n(69552),n(32932)),a=n(46190),s=n(36205),l=n(98715),c=(n(49001),n(86057),n(77614),n(74238)),d=n(9138),u=n(82253),g=(n(22717),n(96506)),m=n(65279),h=n(30023),f=n(28719);const p=Symbol("DefaultSettings"),v=Symbol("RuntimeSettings"),w=Symbol("ObjectSettingsMap"),y=Symbol("Dictionary");class I{constructor(e){const t=Object.create(e instanceof I&&y in e?e[y]:null);Object.seal(Object.defineProperty(this,y,{value:t}))}set(e,t){return b(this[y],e,t,null)}get(e){return function(e,t){return e[t]}(this[y],e)}unset(e){return function(e,t){if(t.endsWith(".")){let n=0;const o=t,i=o.slice(0,-1),r=0===i.length;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r||t.startsWith(o)||t===i)&&(delete e[t],++n);return n>0}return delete e[t]}(this[y],e+"")}forEach(e){x(this[y],e)}extend(){return new I(this)}import(e){C(e)&&Object.keys(e).forEach((t=>{b(this[y],t,e[t],null)}))}dump(){const e={};return x(this[y],((t,n)=>{void 0!==n&&P(e,t,n)})),e}static assert(e){return e instanceof I?e:I.getRuntimeSettings()}static getDefaultSettings(e=null){let t=I[p];if(t instanceof I||(t=new I,I[p]=t),e){const n={};return t.forEach((o=>{if(o.startsWith(e)){const i=o.split(`${e}.`)[1];n[i]=t.get(o)}})),n}return t}static getRuntimeSettings(){let e=I[v];return e instanceof I||(e=new I(I.getDefaultSettings()),I[v]=e),e}static getObjectSettings(e,t){let n=null;if(e instanceof I)n=e;else if("object"==typeof e&&null!==e){let o=I[w];o instanceof WeakMap||(o=new WeakMap,I[w]=o),n=o.get(e),n instanceof I||(n=new I(I.assert(I.getObjectSettings(t))),o.set(e,n))}return n}static extendRuntimeSettings(){return I.getRuntimeSettings().extend()}}function x(e,t){for(const n in e)t(n,e[n])}function b(e,t,n,o){return!!function(e){let t,n,o;if("string"!=typeof e||(t=e.length-1)<0)return!1;o=-1;for(;(n=e.indexOf(".",o+1))>=0;){if(n-o<2||n===t)return!1;o=n}return!0}(t)&&(C(n)?function(e,t,n,o){let i;if(o.has(n))return b(e,t,null,o);o.add(n),i=0;for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(b(e,0===r.length?t:`${t}.${r}`,n[r],o)||++i);return o.delete(n),0===i}(e,t,n,o instanceof WeakSet?o:new WeakSet):(e[t]=n,!0))}function C(e){if("object"==typeof e&&null!==e){const t=Object.getPrototypeOf(e);if(t===Object.prototype||null===t)return!0}return!1}function P(e,t,n){const o=t.indexOf(".");if(o>=0){const i=t.slice(0,o);let r=e[i];if("object"!=typeof r||null===r){const t=r;r={},void 0!==t&&(r[""]=t),e[i]=r}P(r,t.slice(o+1,t.length),n)}else e[t]=n}I.getDefaultSettings().set("useCursors",!0);var E=n(18588),S=n(62990),T=n(59469),M=(n(27654),n(56309)),A=n(85041),R=n(25281)},62990:(e,t,n)=>{n.r(t),n.d(t,{cancelLoadAll:()=>b,cancelLoadImage:()=>I,cancelLoadImages:()=>x,createAndCacheDerivedImage:()=>v,createAndCacheDerivedImages:()=>w,createAndCacheDerivedSegmentationImage:()=>T,createAndCacheDerivedSegmentationImages:()=>S,createAndCacheLocalImage:()=>y,loadAndCacheImage:()=>f,loadAndCacheImages:()=>p,loadImage:()=>h,registerImageLoader:()=>C,registerUnknownImageLoader:()=>P,unregisterAllImageLoaders:()=>E});var o=n(5287),i=n(82253),r=n(19546),a=n(74238),s=n(56309),l=n(96506),c=n(12651);const d={};let u;function g(e,t){const n=e.indexOf(":"),o=e.substring(0,n),i=d[o];if(null==i){if(void 0!==u)return u(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}const l=i(e,t);return l.promise.then((function(e){(0,s.triggerEvent)(a.Z,r.Z.IMAGE_LOADED,{image:e})}),(function(t){const n={imageId:e,error:t};(0,s.triggerEvent)(a.Z,r.Z.IMAGE_LOAD_FAILED,n)})),l}function m(e,t){if(t.ignoreCache)return g(e,t);let n=o.Z.getImageLoadObject(e);if(void 0!==n)return n;const r=o.Z.getVolumeContainingImageId(e);if(r?.volume?.loadStatus?.loaded){const{volume:t,imageIdIndex:o}=r;return t instanceof i.JI&&(n=t.convertToCornerstoneImage(e,o)),n}const a=o.Z.getCachedImageBasedOnImageURI(e);return a?(n=a.imageLoadObject,n):(n=g(e,t),n)}function h(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");return m(e,t).promise}function f(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=m(e,t);return o.Z.getImageLoadObject(e)||o.Z.putImageLoadObject(e,n).catch((e=>{console.warn(e)})),n.promise}function p(e,t={priority:0,requestType:"prefetch"}){if(!e||0===e.length)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return e.map((e=>f(e,t)))}function v(e,t={},n=!1){if(void 0===e)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");void 0===t.imageId&&(t.imageId=`derived:${(0,s.uuidv4)()}`);const{imageId:i,skipCreateBuffer:r,onCacheAdd:a}=t,l=c.metaData.get("imagePlaneModule",e),d=l.rows*l.columns,{TypedArrayConstructor:u}=(0,s.getBufferConfiguration)(t.targetBufferType,d),g=new u(r?1:d),m=i;["imagePlaneModule","generalSeriesModule"].forEach((t=>{s.genericMetadataProvider.add(m,{type:t,metadata:c.metaData.get(t,e)})}));const h=c.metaData.get("imagePixelModule",e);s.genericMetadataProvider.add(m,{type:"imagePixelModule",metadata:{...h,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const f=y({scalarData:g,onCacheAdd:a,skipCreateBuffer:r},i,!0),p={promise:Promise.resolve(f)};return n||o.Z.putImageLoadObject(m,p),p.promise}function w(e,t={}){if(0===e?.length)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const n=[],o=e.map((e=>{const o={imageId:t.getDerivedImageId?.(e)||`derived:${(0,s.uuidv4)()}`,...t};return n.push(o.imageId),v(e,o)}));return{imageIds:n,promises:o}}function y(e,t,n=!1){const i=c.metaData.get("imagePlaneModule",t),r=i.rows*i.columns,a={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:!1,numComps:1,slope:1,minPixelValue:0,maxPixelValue:255,voiLUTFunction:void 0,rows:i.rows,columns:i.columns,getCanvas:void 0,height:i.rows,width:i.columns,rgba:void 0,columnPixelSpacing:i.columnPixelSpacing,rowPixelSpacing:i.rowPixelSpacing,invert:!1};if(e.scalarData){const t=e.scalarData;if(!(t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array||t instanceof Int16Array))throw new Error("To use createLocalVolume you should pass scalarData of type Uint8Array, Uint16Array, Int16Array or Float32Array");a.sizeInBytes=t.byteLength,a.getPixelData=()=>t}else if(!0!==e.skipCreateBuffer){const{numBytes:t,TypedArrayConstructor:n}=(0,s.getBufferConfiguration)(e.targetBufferType,r),o=new n(r);a.sizeInBytes=t,a.getPixelData=()=>o}e.onCacheAdd?.(a);const l={promise:Promise.resolve(a)};return n||o.Z.putImageLoadObject(a.imageId,l),a}function I(e){l.Z.filterRequests((({additionalDetails:t})=>!t.imageId||t.imageId!==e));const t=o.Z.getImageLoadObject(e);t&&t.cancelFn()}function x(e){e.forEach((e=>I(e)))}function b(){const e=l.Z.getRequestPool();Object.keys(e).forEach((t=>{const n=e[t];Object.keys(n).forEach((e=>{const t=n[e].pop().additionalDetails,{imageId:i,volumeId:r}=t;let a;i?a=o.Z.getImageLoadObject(i):r&&(a=o.Z.getVolumeLoadObject(r)),a&&a.cancel()})),l.Z.clearRequestStack(t)}))}function C(e,t){d[e]=t}function P(e){const t=u;return u=e,t}function E(){Object.keys(d).forEach((e=>delete d[e])),u=void 0}function S(e,t={targetBufferType:"Uint8Array"}){return w(e,t)}function T(e,t={targetBufferType:"Uint8Array"}){return v(e,t)}},18588:(e,t,n)=>{n.r(t),n.d(t,{createAndCacheDerivedSegmentationVolume:()=>M,createAndCacheDerivedVolume:()=>x,createAndCacheVolume:()=>I,createAndCacheVolumeFromImages:()=>C,createLocalSegmentationVolume:()=>A,createLocalVolume:()=>b,getUnknownVolumeLoaderSchema:()=>T,getVolumeLoaderSchemes:()=>E,loadVolume:()=>y,registerUnknownVolumeLoader:()=>S,registerVolumeLoader:()=>P});n(15e3);var o=n(8455),i=n(54131),r=n(84326),a=n(5287),s=n(19546),l=n(74238),c=n(85041),d=n(11677),u=n.n(d),g=n(56309),m=n(28719),h=n(85654);function f(e){const{dimensions:t,metadata:n,spacing:r,direction:a,origin:s}=e,{PhotometricInterpretation:l}=n;let c=1;"RGB"===l&&(c=3);const d=o.ZP.newInstance(),u={numberOfComponents:c};if(d.setDimensions(t),d.setSpacing(r),d.setDirection(a),d.setOrigin(s),e.isDynamicVolume()){!function(e,t,n){t.forEach(((t,o)=>{const r=i.default.newInstance({name:`timePoint-${o}`,values:t,...n});e.getPointData().addArray(r)})),e.getPointData().setActiveScalars("timePoint-0")}(d,e.getScalarDataArrays(),u)}else{!function(e,t,n){const o=i.default.newInstance({name:"Pixels",values:t,...n});e.getPointData().setScalars(o)}(d,e.getScalarData(),u)}return d}const p={};let v;function w(e,t){const n=e.indexOf(":"),o=e.substring(0,n);let i=p[o];if(null==i){if(null==v||"function"!=typeof v)throw new Error(`No volume loader for scheme ${o} has been registered`);i=v}const r=i(e,t);return(0,h.setupCacheOptimizationEventListener)(e),r.promise.then((function(e){(0,c.Z)(l.Z,s.Z.VOLUME_LOADED,{volume:e})}),(function(t){const n={volumeId:e,error:t};(0,c.Z)(l.Z,s.Z.VOLUME_LOADED_FAILED,n)})),r}function y(e,t={imageIds:[]}){if(void 0===e)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=a.Z.getVolumeLoadObject(e);return void 0!==n?n.promise:(n=w(e,t),n.promise.then((e=>(e.imageData=f(e),e))))}async function I(e,t){if(void 0===e)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=a.Z.getVolumeLoadObject(e);return void 0!==n||(n=w(e,t),n.promise.then((e=>{e.imageData=f(e)})),a.Z.putVolumeLoadObject(e,n).catch((e=>{throw e}))),n.promise}async function x(e,t){const n=a.Z.getVolume(e);if(!n)throw new Error(`Cannot created derived volume: Referenced volume with id ${e} does not exist.`);let{volumeId:s}=t;const{targetBuffer:l}=t;void 0===s&&(s=(0,g.uuidv4)());const{metadata:c,dimensions:d,spacing:m,origin:h,direction:f}=n,p=n.getScalarData().length,{volumeScalarData:v,numBytes:w}=R(l,p),y=i.default.newInstance({name:"Pixels",numberOfComponents:1,values:v}),I=o.ZP.newInstance();I.setDimensions(d),I.setSpacing(m),I.setDirection(f),I.setOrigin(h),I.getPointData().setScalars(y);const x=new r.J({volumeId:s,metadata:u()(c),dimensions:[d[0],d[1],d[2]],spacing:m,origin:h,direction:f,imageData:I,scalarData:v,sizeInBytes:w,imageIds:[],referencedVolumeId:e}),b={promise:Promise.resolve(x)};return await a.Z.putVolumeLoadObject(s,b),x}function b(e,t,n=!1){const{metadata:l,dimensions:c,spacing:d,origin:m,direction:h,targetBuffer:f}=e;let{scalarData:p}=e;const v=["Uint8Array","Float32Array","Uint16Array","Int16Array"],w=c[0]*c[1]*c[2];if(!p||!v.includes(p.constructor.name)){if(!f?.type||!v.includes(f.type))throw new Error("createLocalVolume: parameter scalarData must be provided and must be either Uint8Array, Float32Array, Uint16Array or Int16Array");({volumeScalarData:p}=R(f,w))}void 0===t&&(t=(0,g.uuidv4)());const y=a.Z.getVolume(t);if(y)return y;const I=p?p.buffer.byteLength:4*w;if(!a.Z.isCacheable(I))throw new Error(s.Z.CACHE_SIZE_EXCEEDED);const x=i.default.newInstance({name:"Pixels",numberOfComponents:1,values:p}),b=o.ZP.newInstance();b.setDimensions(c),b.setSpacing(d),b.setDirection(h),b.setOrigin(m),b.getPointData().setScalars(x);const C=new r.J({volumeId:t,metadata:u()(l),dimensions:[c[0],c[1],c[2]],spacing:d,origin:m,direction:h,imageData:b,scalarData:p,sizeInBytes:I,referencedImageIds:e.referencedImageIds||[],referencedVolumeId:e.referencedVolumeId,imageIds:e.imageIds||[]});if(n)return C;const P={promise:Promise.resolve(C)};return a.Z.putVolumeLoadObject(t,P),C}async function C(e,t,n={}){const{preventCache:o=!1}=n;if(void 0===t)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(void 0===e)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const i=a.Z.getVolume(e);if(i)return Promise.resolve(i);const s=(0,g.generateVolumePropsFromImageIds)(t,e),l=s.imageIds.map(((e,t)=>a.Z.getImageLoadObject(e).promise.then((e=>{const n=e.getPixelData(),o=t*e.rows*e.columns;s.scalarData.set(n,o)}))));await Promise.all(l);const c=new r.J({...s,referencedImageIds:t,...n});(0,h.performCacheOptimizationForVolume)(c);const d={promise:Promise.resolve(c)};return o||a.Z.putVolumeLoadObject(e,d),d.promise}function P(e,t){p[e]=t}function E(){return Object.keys(p)}function S(e){const t=v;return v=e,t}function T(){return v.name}async function M(e,t={}){return x(e,{...t,targetBuffer:{type:"Uint8Array"}})}async function A(e,t,n=!1){return e.scalarData||(e.scalarData=new Uint8Array(e.dimensions[0]*e.dimensions[1]*e.dimensions[2])),b(e,t,n)}function R(e,t){const{useNorm16Texture:n}=(0,m.P_)().rendering,{TypedArrayConstructor:o,numBytes:i}=(0,g.getBufferConfiguration)(e?.type,t,{use16BitTexture:n,isVolumeBuffer:!0});if(!a.Z.isCacheable(i))throw new Error(s.Z.CACHE_SIZE_EXCEEDED);let r;if(e?.sharedArrayBuffer??(0,m.hG)())switch(e.type){case"Float32Array":r=(0,g.createFloat32SharedArray)(t);break;case"Uint8Array":r=(0,g.createUint8SharedArray)(t);break;case"Uint16Array":case"Int16Array":r=(0,g.createUint16SharedArray)(t);break;default:throw new Error("generateVolumeScalarData: SharedArrayBuffer is not supported for the specified target buffer type")}else r=new o(t);return{volumeScalarData:r,numBytes:i}}},30023:(e,t,n)=>{n.r(t),n.d(t,{addProvider:()=>i,get:()=>s,removeAllProviders:()=>a,removeProvider:()=>r});const o=[];function i(e,t=0){let n;for(n=0;n<o.length&&!(o[n].priority<=t);n++);o.splice(n,0,{priority:t,provider:e})}function r(e){for(let t=0;t<o.length;t++)if(o[t].provider===e){o.splice(t,1);break}}function a(){for(;o.length>0;)o.pop()}function s(e,...t){for(let n=0;n<o.length;n++){const i=o[n].provider(e,...t);if(void 0!==i)return i}}},96506:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(42961),i=n(49334);const r=new o.P("imageLoadPool");r.grabDelay=0,r.setMaxSimultaneousRequests(i.Z.Interaction,1e3),r.setMaxSimultaneousRequests(i.Z.Thumbnail,1e3),r.setMaxSimultaneousRequests(i.Z.Prefetch,1e3);const a=r},42961:(e,t,n)=>{n.d(t,{P:()=>r});var o=n(49334),i=n(56309);class r{constructor(e){this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.id=e||(0,i.uuidv4)(),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]},compute:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5,compute:1e3}}setMaxSimultaneousRequests(e,t){this.maxNumRequests[e]=t}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,t,n,o=0){const i={requestFn:e,type:t,additionalDetails:n};void 0===this.requestPool[t][o]&&(this.requestPool[t][o]=[]),this.requestPool[t][o].push(i),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach((t=>{const n=this.requestPool[t];Object.keys(n).forEach((t=>{n[t]=n[t].filter((t=>e(t)))}))}))}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const t=this.maxNumRequests[e]-this.numRequests[e];let n=0;for(let o=0;o<t;o++){const t=this.getNextRequest(e);if(null===t)return!1;if(t){let o;this.numRequests[e]++,this.awake=!0;try{o=t.requestFn()}catch(e){console.warn("sendRequest failed",e)}o?.finally?o.finally((()=>{this.numRequests[e]--,this.startAgain()})):(this.numRequests[e]--,n++)}}return n&&this.startAgain(),!0}getNextRequest(e){const t=this.getSortedPriorityGroups(e);for(const n of t)if(this.requestPool[e][n].length)return this.requestPool[e][n].shift();return null}startGrabbing(){const e=this.sendRequests(o.Z.Interaction),t=this.sendRequests(o.Z.Thumbnail),n=this.sendRequests(o.Z.Prefetch),i=this.sendRequests(o.Z.Compute);e||t||n||i||(this.awake=!1)}startAgain(){this.awake&&(void 0!==this.grabDelay?this.timeoutHandle||(this.timeoutHandle=window.setTimeout((()=>{this.timeoutHandle=null,this.startGrabbing()}),this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter((t=>this.requestPool[e][t].length)).sort(((e,t)=>e-t))}getRequestPool(){return this.requestPool}}},85654:(e,t,n)=>{n.r(t),n.d(t,{performCacheOptimizationForVolume:()=>l,setupCacheOptimizationEventListener:()=>s});var o=n(82253),i=n(7187),r=n(74238),a=n(28719);function s(e){const{enableCacheOptimization:t}=(0,a.P_)(),n=(0,a.hG)();t&&n&&r.Z.addEventListenerOnce(i.Events.IMAGE_VOLUME_LOADING_COMPLETED,(t=>{if(t.detail.volumeId!==e)return;l(o.ZP.getVolume(e))}))}function l(e){if(!(e instanceof o.JI))return;const t=e.getScalarData();e.imageCacheOffsetMap.size>0?function(e,t){e.imageCacheOffsetMap.forEach((({offset:e},n)=>{const i=o.ZP.getImage(n);i&&(c(i,t,e),o.ZP.decrementImageCacheSize(i.sizeInBytes))}))}(e,t):function(e,t){let n=t;const i=e.imageIds.find((e=>o.ZP.getImage(e)));if(!i)return;const r=o.ZP.getImage(i),a=r.imageFrame?.pixelData||r.getPixelData();t.constructor!==a.constructor&&(n=new a.constructor(t.length),n.set(t));e.imageIds.forEach((t=>{const i=o.ZP.getImage(t);if(!i)return;const r=e.getImageIdIndex(t)*i.getPixelData().byteLength;c(i,n,r),o.ZP.decrementImageCacheSize(i.sizeInBytes)}))}(e,t)}function c(e,t,n){const o=e.imageFrame?e.imageFrame.pixelData:e.getPixelData(),i=new o.constructor(t.buffer,n,o.length);e.getPixelData=()=>i,e.imageFrame&&(e.imageFrame.pixelData=i),e.bufferView={buffer:t.buffer,offset:n}}},40589:(e,t,n)=>{n.r(t),n.d(t,{findMatchingColormap:()=>d,getColormap:()=>l,getColormapNames:()=>c,registerColormap:()=>s});var o=n(31239),i=n(78001),r=n(1790);const a=new Map;function s(e){a.set(e.Name,e)}function l(e){return a.get(e)}function c(){return Array.from(a.keys())}function d(e,t){const n=o.Z.rgbPresetNames.map((e=>o.Z.getPresetByName(e))),a=c().map((e=>l(e))),s=n.concat(a).find((t=>{const{RGBPoints:n}=t;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=4)if(!(0,i.ZP)(n.slice(t+1,t+4),e.slice(t+1,t+4)))return!1;return!0}));if(!s)return null;const d=[];if((0,r.m)(t,"vtkVolume")){const e=t.getProperty().getScalarOpacity(0).getDataPointer();if(!e)return{name:s.Name};for(let t=0;t<e.length;t+=2)d.push({value:e[t],opacity:e[t+1]})}return{name:s.Name,opacity:d}}},16159:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(5193);function i(e){const t=o.ZP.newInstance();let n=0,i=1024;return e&&void 0!==e.lower&&void 0!==e.upper&&(n=e.lower,i=e.upper),t.addRGBPoint(n,0,0,0),t.addRGBPoint(i,1,1,1),t}},94791:(e,t,n)=>{n.r(t),n.d(t,{MultiTargetEventListenerManager:()=>i.P,TargetEventListeners:()=>o.X});var o=n(66872),i=n(91225)},47326:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(64936),i=n(61054);const r=function(e){const t=e.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=(0,i.Z)(e,t);if(!r)return;const{viewPlaneNormal:a,focalPoint:s}=t,l=e.getActors().find((e=>e.referenceId===r.volumeId||e.uid===r.volumeId));l||console.warn("No actor found for with actorUID of",r.volumeId);const c=l.actor,d=(0,o.Z)(c,a,s),{min:u,max:g,current:m}=d,h=Math.round((g-u)/n)+1;let f=(m-u)/(g-u)*h;return f=Math.floor(f),f>h-1?f=h-1:f<0&&(f=0),{numberOfSlices:h,imageIndex:f}}},54526:(e,t,n)=>{function o(e){const t=e.getSize(),n=[];for(let o=0;o<t;o++){const t=[];e.getNodeValue(o,t),n.push(t)}return n}function i(e,t){t?.length&&(e.removeAllPoints(),t.forEach((t=>{e.addRGBPoint(...t)})))}n.r(t),n.d(t,{getTransferFunctionNodes:()=>o,setTransferFunctionNodes:()=>i})},96765:(e,t,n)=>{function o(e,t){return e.worldToIndex(t).map(Math.round)}n.d(t,{Z:()=>o})},85041:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(74238);function i(e=o.Z,t,n=null){if(!t)throw new Error("Event type was not defined");const i=new CustomEvent(t,{detail:n,cancelable:!0});return e.dispatchEvent(i)}},15291:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(28635),i=n(7187),r=n(42961);const a=class{constructor(){this.workerRegistry={},this.workerPoolManager=new r.P("webworker")}registerWorker(e,t,n={}){const{maxWorkerInstances:i=1,overwrite:r=!1,autoTerminateOnIdle:a={enabled:!1,idleTimeThreshold:3e3}}=n;if(this.workerRegistry[e]&&!r)return void console.warn(`Worker type '${e}' is already registered...`);r&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:a.enabled,idleCheckIntervalId:null,idleTimeThreshold:a.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let e=0;e<i;e++){const e=t();s.instances.push(o.Ud(e)),s.nativeWorkers.push(e),s.workerFn=t}this.workerRegistry[e]=s}getNextWorkerAPI(e){const t=this.workerRegistry[e];if(!t)return console.error(`Worker type '${e}' is not registered.`),null;const n=t.instances.filter((e=>null!==e));let i=0,r=t.loadCounters[0]||0;for(let e=1;e<n.length;e++){const n=t.loadCounters[e]||0;n<r&&(i=e,r=n)}if(null===t.instances[i]){const e=t.workerFn();t.instances[i]=o.Ud(e),t.nativeWorkers[i]=e}return t.loadCounters[i]+=1,{api:t.instances[i],index:i}}executeTask(e,t,n={},{requestType:r=i.RequestType.Compute,priority:a=0,options:s={},callbacks:l=[]}={}){return new Promise(((i,c)=>{this.workerPoolManager.addRequest((async()=>{const{api:r,index:a}=this.getNextWorkerAPI(e);if(!r){const t=new Error(`No available worker instance for '${e}'`);return console.error(t),void c(t)}try{let s=[];l.length&&(s=l.map((e=>o.sj(e))));const c=this.workerRegistry[e];c.processing=!0;const d=await r[t](n,...s);c.processing=!1,c.lastActiveTime[a]=Date.now(),c.autoTerminateOnIdle&&!c.idleCheckIntervalId&&c.idleTimeThreshold&&(c.idleCheckIntervalId=setInterval((()=>{this.terminateIdleWorkers(e,c.idleTimeThreshold)}),c.idleTimeThreshold)),i(d)}catch(n){console.error(`Error executing method '${t}' on worker '${e}':`,n),c(n)}finally{this.workerRegistry[e].loadCounters[a]--}}),r,s,a)}))}terminateIdleWorkers(e,t){const n=this.workerRegistry[e];if(n.processing)return;const o=Date.now();n.instances.forEach(((i,r)=>{const a=n.lastActiveTime[r];!(null!==a&&n.loadCounters[r]>0)&&o-a>t&&this.terminateWorkerInstance(e,r)}))}terminate(e){const t=this.workerRegistry[e];t?t.instances.forEach(((t,n)=>{this.terminateWorkerInstance(e,n)})):console.error(`Worker type '${e}' is not registered.`)}terminateWorkerInstance(e,t){const n=this.workerRegistry[e],i=n.instances[t];null!==i&&(i[o.Yy](),n.nativeWorkers[t].terminate(),n.instances[t]=null,n.lastActiveTime[t]=null)}}},77267:(e,t,n)=>{n.d(t,{Sz:()=>m,zu:()=>g});const o={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="{{color}}" d="M8 16L8 0"></path>\n    <path stroke="{{color}}" d="M16 8L0 8"></path>\n  '},i={x:127,y:60},r='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n',a='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>\n',s='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',l='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',c='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',d={Angle:u(o,{iconContent:'<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n    10l50 50q10 10 10 23z" />',viewBox:{x:1792,y:1792}}),ArrowAnnotate:u(o,{iconContent:'<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',viewBox:{x:24,y:24}}),Bidirectional:u(o,{iconContent:'<g fill="{{color}}" stroke-width="3" stroke="{{color}}">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',viewBox:{x:48,y:48}}),CobbAngle:u(o,{iconContent:'<g stroke="{{color}}" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',viewBox:{x:32,y:32}}),CircleROI:u(o,{iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:u(o,{iconContent:'<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z" />',viewBox:{x:32,y:32}}),FreehandROI:u(o,{iconContent:'<g fill="{{color}}" stroke="{{color}}" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',viewBox:{x:18,y:18}}),FreehandROISculptor:u(o,{iconContent:'<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n  </g>',viewBox:{x:18,y:18}}),Length:u(o,{iconContent:'<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',viewBox:{x:24,y:24}}),Height:u(o,{iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:u(o,{iconContent:'<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z" />',viewBox:{x:1792,y:1792}}),RectangleROI:u(o,{iconContent:'<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),TextMarker:u(o,{iconContent:'<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />',viewBox:{x:1792,y:1792}}),Crosshairs:u(o,{iconContent:'<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />',viewBox:{x:1792,y:1792}}),Eraser:u(o,{iconContent:'<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n    0 69.5 20.5t47.5 54.5z" />',viewBox:{x:2048,y:1792}}),Magnify:u(o,{iconContent:'<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />',viewBox:{x:512,y:512}}),Pan:u(o,{iconContent:'<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />',viewBox:{x:1792,y:1792}}),Rotate:u(o,{iconContent:'<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n    39 17 39 59z" />',viewBox:{x:1792,y:1792}}),StackScroll:u(o,{iconContent:'<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />',viewBox:{x:24,y:28}}),WindowLevelRegion:u(o,{iconContent:'<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),WindowLevel:u(o,{iconContent:'\n    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />',viewBox:{x:18,y:18}}),Zoom:u(o,{iconContent:'\n  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />\n  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />',viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:u(o,{iconContent:`${s} ${r}`,viewBox:i}),SegmentationFreeHandFillInside:u(o,{iconContent:`${s} ${a}`,viewBox:i}),SegmentationFreeHandEraseOutside:u(o,{iconContent:`${s} ${r}`,viewBox:i}),SegmentationFreeHandFillOutside:u(o,{iconContent:`${s} ${a}`,viewBox:i}),SegmentationRectangleEraseInside:u(o,{iconContent:`${l} ${r}`,viewBox:i}),RectangleScissor:u(o,{iconContent:`${l} ${a}`,viewBox:i}),"RectangleScissor.FILL_INSIDE":u(o,{iconContent:`${l} ${a}`,viewBox:i}),"RectangleScissor.FILL_OUTSIDE":u(o,{iconContent:`${l} ${a}`,viewBox:i}),"RectangleScissor.ERASE_OUTSIDE":u(o,{iconContent:`${l} ${r}`,viewBox:i}),"RectangleScissor.ERASE_INSIDE":u(o,{iconContent:`${l} ${r}`,viewBox:i}),CircleScissor:u(o,{iconContent:`${c} ${a}`,viewBox:i}),"CircleScissor.FILL_INSIDE":u(o,{iconContent:`${c} ${a}`,viewBox:i}),"CircleScissor.ERASE_OUTSIDE":u(o,{iconContent:`${c} ${r}`,viewBox:i}),"CircleScissor.FILL_OUTSIDE":u(o,{iconContent:`${c} ${a}`,viewBox:i})};function u(e,t){return Object.assign(Object.create(e),t)}function g(e){return d[e]}const m=Object.keys(d)},93725:(e,t,n)=>{n.d(t,{segmentation:()=>o});n(49507),n(33232),n(69562),n(93423),n(25876),n(42975),n(60020),n(35106),n(88706);var o=n(95482);n(42486),n(51948),n(68096)},64311:(e,t,n)=>{n.d(t,{getState:()=>o.Z});var o=n(91744);n(88048),n(53122)},88706:(e,t,n)=>{n.d(t,{state:()=>o});n(64311),n(11163),n(91398);var o=n(86614);n(41836),n(17433),n(58119)},56611:(e,t,n)=>{var o=n(72076),i=n(12651),r=n(39661),a=n(42975),s=n(93382),l=n(90685),c=n(86614),d=n(11163),u=n(41836),g=n(36705),m=n(25876),h=n(33232),f=n(68096),p=n(46966),v=n(79922),w=n(20724),y=n(23118),I=n(66878);const{transformWorldToIndex:x}=i.utilities;class b extends s.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:C}}){super(e,t),this.isPointNearTool=(e,t,n,o)=>{const r=(0,i.getEnabledElement)(e),{viewport:a}=r,{data:s}=t,{points:l}=s.handles;let c=a.worldToCanvas(l[0]),d=a.worldToCanvas(l[1]),u={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},g=v.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]]);return g<=o||(c=a.worldToCanvas(l[2]),d=a.worldToCanvas(l[3]),u={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},g=v.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]]),g<=o)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const r=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:r,movingTextBox:!1},this._activateModify(o);const a=(0,i.getEnabledElement)(o),{renderingEngine:s}=a;(0,I.Z)(s,r),(0,y.hideElementCursor)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:r}=o,a=t.data;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex((e=>e===n));const c=(0,p.getViewportIdsWithToolToRender)(r,this.getToolName());(0,y.hideElementCursor)(r),this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(r);const d=(0,i.getEnabledElement)(r),{renderingEngine:u}=d;(0,I.Z)(u,c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:d}=r;if(s&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,y.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);if(void 0!==this.editData.handleIndex){const{points:e}=d.handles,t=o.R3.distance(e[0],e[1]);if(o.R3.distance(e[2],e[3])>t){const t=[[...e[2]],[...e[3]]],n=[...e[0]],i=[...e[1]],r=o.K4.create();o.K4.set(r,t[1][0]-t[0][0],t[1][1]-t[1][0]);const a=o.K4.create();o.K4.set(a,-r[1],r[0]);const s=o.K4.create();let l;o.K4.set(s,i[0]-n[0],i[1]-n[0]),l=o.K4.dot(s,a)>0?[n,i]:[i,n],d.handles.points=[t[0],t[1],l[0],l[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,c.removeAnnotation)(r.annotationUID),(0,I.Z)(u,a),s&&(0,g.F$)(r),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:r}=t,a=(0,i.getEnabledElement)(r),{renderingEngine:s,viewport:l}=a,{worldToCanvas:c}=l,{annotation:d,viewportIdsToRender:u,handleIndex:g}=this.editData,{data:m}=d,h=n.world;m.handles.points[g]=[...h];const f=m.handles.points.map(c),p={start:{x:f[0][0],y:f[0][1]},end:{x:f[1][0],y:f[1][1]}},v=(f[2][0],f[2][1],f[3][0],f[3][1],o.K4.distance(f[0],f[1])/3),w=p.start.x-p.end.x,y=p.start.y-p.end.y,x=Math.sqrt(w*w+y*y),b=w/x,C=y/x,P=(p.start.x+p.end.x)/2,E=(p.start.y+p.end.y)/2,S=P+v*C,T=E-v*b,M=P-v*C,A=E+v*b;m.handles.points[2]=l.canvasToWorld([S,T]),m.handles.points[3]=l.canvasToWorld([M,A]),d.invalidated=!0,(0,I.Z)(s,u),this.editData.hasMoved=!0},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,o=(0,i.getEnabledElement)(n),{renderingEngine:r}=o,{annotation:a,viewportIdsToRender:s,handleIndex:l,movingTextBox:c}=this.editData,{data:d}=a;if(c){const{deltaPoints:e}=t,n=e.world,{textBox:o}=d.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===l){const{deltaPoints:e}=t,n=e.world;d.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),a.invalidated=!0}else this._dragModifyHandle(e),a.invalidated=!0;(0,I.Z)(r,s)},this._dragModifyHandle=e=>{const t=e.detail,{currentPoints:n,element:r}=t,a=(0,i.getEnabledElement)(r),{viewport:s}=a,{annotation:l,handleIndex:c}=this.editData,{data:d}=l,u=n.world,g=[s.worldToCanvas(d.handles.points[0]),s.worldToCanvas(d.handles.points[1]),s.worldToCanvas(d.handles.points[2]),s.worldToCanvas(d.handles.points[3])],m={start:{x:g[0][0],y:g[0][1]},end:{x:g[1][0],y:g[1][1]}},h={start:{x:g[2][0],y:g[2][1]},end:{x:g[3][0],y:g[3][1]}},f=[...u],p=s.worldToCanvas(f);if(0===c||1===c){const e=g[0===c?1:0],t=o.K4.set(o.K4.create(),p[0]-e[0],p[1]-e[1]),n=o.K4.set(o.K4.create(),g[c][0]-e[0],g[c][1]-e[1]);o.K4.normalize(t,t),o.K4.normalize(n,n);const i={start:{x:e[0],y:e[1]},end:{x:p[0],y:p[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(i,h))return;const r=e,a=this._getSignedAngle(n,t);let l=g[2][0],u=g[2][1],m=g[3][0],v=g[3][1];l-=r[0],u-=r[1],m-=r[0],v-=r[1];const w=l*Math.cos(a)-u*Math.sin(a),y=l*Math.sin(a)+u*Math.cos(a),I=m*Math.cos(a)-v*Math.sin(a),x=m*Math.sin(a)+v*Math.cos(a);l=w+r[0],u=y+r[1],m=I+r[0],v=x+r[1];const b=s.canvasToWorld([l,u]),C=s.canvasToWorld([m,v]);d.handles.points[c]=f,d.handles.points[2]=b,d.handles.points[3]=C}else{const e=2===c?3:2,t={longLineSegment:{start:m.start,end:m.end},shortLineSegment:{start:h.start,end:h.end}},n=o.K4.subtract(o.K4.create(),[t.longLineSegment.end.x,t.longLineSegment.end.y],[t.longLineSegment.start.x,t.longLineSegment.start.y]),i=o.K4.normalize(o.K4.create(),n),r=o.K4.subtract(o.K4.create(),[p[0],p[1]],[g[c][0],g[c][1]]),a=o.K4.length(r),l=this._getSignedAngle(i,r),u=Math.cos(l)*a,w=o.K4.scaleAndAdd(o.K4.create(),[g[e][0],g[e][1]],i,u);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:p[0],y:p[1]},end:{x:w[0],y:w[1]}},{start:{x:t.longLineSegment.start.x,y:t.longLineSegment.start.y},end:{x:t.longLineSegment.end.x,y:t.longLineSegment.end.y}}))return;if(!v.intersectLine([p[0],p[1]],[w[0],w[1]],[m.start.x,m.start.y],[m.end.x,m.end.y]))return;d.handles.points[e]=s.canvasToWorld(w),d.handles.points[c]=f}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,y.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:r}=t;t.highlighted=!1,r.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,i.getEnabledElement)(e);return(0,I.Z)(a,n),o&&(0,g.F$)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!0;const{viewport:o}=e,{element:i}=o;let r=(0,c.getAnnotations)(this.getToolName(),i);if(!r?.length)return n;if(r=this.filterInteractableAnnotationsForElement(i,r),!r?.length)return n;const a=this.getTargetId(o),s=o.getRenderingEngine(),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<r.length;i++){const c=r[i],{annotationUID:g,data:h}=c,{points:f,activeHandleIndex:p}=h.handles,v=f.map((e=>o.worldToCanvas(e)));l.annotationUID=g;const{color:y,lineWidth:I,lineDash:x,shadow:b}=this.getAnnotationStyle({annotation:c,styleSpecifier:l});if(h.cachedStats[a]&&null!=h.cachedStats[a].unit?c.invalidated&&this._throttledCalculateCachedStats(c,s,e):(h.cachedStats[a]={length:null,width:null,unit:null},this._calculateCachedStats(c,s,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let C;if(!(0,u.isAnnotationVisible)(g))continue;if((0,d.isAnnotationLocked)(c)||this.editData||null===p||(C=[v[p]]),C){const e="0";(0,m.drawHandles)(t,g,e,C,{color:y})}const P=`${g}-line-1`,E=`${g}-line-2`,S="0";(0,m.drawLine)(t,g,S,v[0],v[1],{color:y,lineDash:x,lineWidth:I,shadow:b},P);const T="1";(0,m.drawLine)(t,g,T,v[2],v[3],{color:y,lineDash:x,lineWidth:I,shadow:b},E),n=!0;const M=this.getLinkedTextBoxStyle(l,c);if(!M.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const A=this.configuration.getTextLines(h,a);if(!A||0===A.length)continue;let R;h.handles.textBox.hasMoved||(R=(0,w.getTextBoxCoordsCanvas)(v),h.handles.textBox.worldPosition=o.canvasToWorld(R));const D=o.worldToCanvas(h.handles.textBox.worldPosition),_="1",L=(0,m.drawLinkedTextBox)(t,g,_,A,D,v,{},M),{x:O,y:V,width:N,height:k}=L;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([O,V]),topRight:o.canvasToWorld([O+N,V]),bottomLeft:o.canvasToWorld([O,V+k]),bottomRight:o.canvasToWorld([O+N,V+k])}}return n},this._movingLongAxisWouldPutItThroughShortAxis=(e,t)=>{const n=o.K4.create();o.K4.set(n,t.end.x-t.start.x,t.end.y-t.start.y),o.K4.normalize(n,n);const i={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!v.intersectLine([i.start.x,i.start.y],[i.end.x,i.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])},this._calculateCachedStats=(e,t,n)=>{const{data:o}=e,{element:i}=n.viewport,a=o.handles.points[0],s=o.handles.points[1],l=o.handles.points[2],c=o.handles.points[3],{cachedStats:d}=o,u=Object.keys(d);for(let e=0;e<u.length;e++){const n=u[e],o=this.getTargetIdImage(n,t);if(!o)continue;const{imageData:i,dimensions:g}=o,m=x(i,a),h=x(i,s),f=x(i,l),p=x(i,c),v=[m,h],w=[f,p],{scale:y,units:I}=(0,r.mh)(o,v),{scale:b,units:C}=(0,r.mh)(o,w),P=this._calculateLength(a,s)/y,E=this._calculateLength(l,c)/b,S=P>E?P:E,T=P>E?E:P,M=P>E?I:C,A=P>E?C:I;this._isInsideVolume(m,h,f,p,g)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,d[n]={length:S,width:T,unit:I,lengthUnit:M,widthUnit:A}}return e.invalidated=!1,(0,g.hg)(e,i),d},this._isInsideVolume=(e,t,n,o,r)=>i.utilities.indexWithinDimensions(e,r)&&i.utilities.indexWithinDimensions(t,r)&&i.utilities.indexWithinDimensions(n,r)&&i.utilities.indexWithinDimensions(o,r),this._getSignedAngle=(e,t)=>Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1]),this._throttledCalculateCachedStats=(0,l.Z)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:o}=t,r=n.world,a=(0,i.getEnabledElement)(o),{viewport:s,renderingEngine:l}=a;this.isDrawing=!0;const d=s.getCamera(),{viewPlaneNormal:u,viewUp:g}=d,m=this.getReferencedImageId(s,r,u,g),h=s.getFrameOfReferenceUID(),f={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...g],FrameOfReferenceUID:h,referencedImageId:m,...s.getViewReference({points:[r]})},data:{handles:{points:[[...r],[...r],[...r],[...r]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};(0,c.addAnnotation)(f,o);const v=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,y.hideElementCursor)(o),e.preventDefault(),(0,I.Z)(l,v),f}_calculateLength(e,t){const n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+o*o+i*i)}}function C(e,t){const{cachedStats:n,label:o}=e,{length:i,width:r,unit:s,lengthUnit:l,widthUnit:c}=n[t],d=[];return o&&d.push(o),void 0===i||d.push(`L: ${(0,a.roundNumber)(i)} ${l||s}`,`W: ${(0,a.roundNumber)(r)} ${c||s}`),d}b.toolName="Bidirectional"},66809:(e,t,n)=>{n.d(t,{Z:()=>u});var o=n(12651),i=n(72076),r=n(92622),a=n(11163),s=n(41836),l=n(86614),c=n(36705);class d extends r.Z{constructor(e,t){super(e,t),this.mouseMoveCallback=(e,t)=>{if(!t)return!1;const{element:n,currentPoints:o}=e.detail,i=o.canvas;let r=!1;for(const e of t){if((0,a.isAnnotationLocked)(e)||!(0,s.isAnnotationVisible)(e.annotationUID))continue;const{data:t}=e,o=t.handles?t.handles.activeHandleIndex:void 0,l=this._imagePointNearToolOrHandle(n,e,i,6),c=l&&!e.highlighted,d=!l&&e.highlighted;c||d?(e.highlighted=!e.highlighted,r=!0):t.handles&&t.handles.activeHandleIndex!==o&&(r=!0)}return r},e.configuration?.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),e.configuration?.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}static createAnnotation(...e){let t={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(const n of e)t=o.utilities.deepMerge(t,n);return t}static createAnnotationForViewport(e,...t){return this.createAnnotation({metadata:e.getViewReference()},...t)}static createAndAddAnnotation(e,...t){const n=this.createAnnotationForViewport(e,...t);(0,l.addAnnotation)(n,e.element),(0,c.hg)(n,e.element)}getHandleNearImagePoint(e,t,n,r){const a=(0,o.getEnabledElement)(e),{viewport:s}=a,{data:l}=t,{isCanvasAnnotation:c}=l,{points:d,textBox:u}=l.handles;if(u){const{worldBoundingBox:e}=u;if(e){const t={topLeft:s.worldToCanvas(e.topLeft),topRight:s.worldToCanvas(e.topRight),bottomLeft:s.worldToCanvas(e.bottomLeft),bottomRight:s.worldToCanvas(e.bottomRight)};if(n[0]>=t.topLeft[0]&&n[0]<=t.bottomRight[0]&&n[1]>=t.topLeft[1]&&n[1]<=t.bottomRight[1])return l.handles.activeHandleIndex=null,u}}for(let e=0;e<d?.length;e++){const t=d[e],o=c?t.slice(0,2):s.worldToCanvas(t);if(!0===i.K4.distance(n,o)<r)return l.handles.activeHandleIndex=e,t}l.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,t){return{visibility:this.getStyle("textBoxVisibility",e,t),fontFamily:this.getStyle("textBoxFontFamily",e,t),fontSize:this.getStyle("textBoxFontSize",e,t),color:this.getStyle("textBoxColor",e,t),shadow:this.getStyle("textBoxShadow",e,t),background:this.getStyle("textBoxBackground",e,t),lineWidth:this.getStyle("textBoxLinkLineWidth",e,t),lineDash:this.getStyle("textBoxLinkLineDash",e,t)}}isSuvScaled(e,t,n){if(e instanceof o.BaseVolumeViewport){const e=o.utilities.getVolumeId(t),n=o.cache.getVolume(e);return void 0!==n?.scaling?.PT}const i=n&&o.metaData.get("scalingModule",n);return"number"==typeof i?.suvbw}getAnnotationStyle(e){const{annotation:t,styleSpecifier:n}=e,o=e=>this.getStyle(e,n,t),{annotationUID:i}=t,r=(0,s.isAnnotationVisible)(i),l=(0,a.isAnnotationLocked)(t),c=o("lineWidth"),d=o("lineDash"),u=o("color");return{visibility:r,locked:l,color:u,lineWidth:c,lineDash:d,lineOpacity:1,fillColor:u,fillOpacity:0,shadow:o("shadow"),textbox:this.getLinkedTextBoxStyle(n,t)}}_imagePointNearToolOrHandle(e,t,n,o){if(this.getHandleNearImagePoint(e,t,n,o))return!0;return!!this.isPointNearTool(e,t,n,o,"mouse")||void 0}}d.toolName="AnnotationTool";const u=d},35904:(e,t,n)=>{n.d(t,{Z:()=>i});const o={renderOutline:!0,outlineWidthActive:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.7,fillAlphaInactive:.65,outlineOpacity:1,outlineOpacityInactive:.85};const i=function(){return o}},42486:(e,t,n)=>{n.d(t,{tv:()=>i.Z,A8:()=>o.A8,PlanarFreehandContourSegmentationTool:()=>s.Z,Hx:()=>a.Z,xX:()=>l.Z});var o=n(93382),i=(n(33908),n(78791),n(32e3),n(6090),n(61935),n(52826),n(13978),n(61495),n(95574),n(9260),n(25856),n(98386),n(60326)),r=(n(2235),n(51190),n(68049),n(69243),n(94021),n(86684),n(56611),n(3098),n(76131),n(86479),n(41495),n(10279)),a=(n(71330),n(87248),n(18215),n(69316),n(22455)),s=n(51593),l=(n(60682),n(57720),n(45248),n(37442),n(21491),n(28073),n(7003),n(32839),n(20406)),c=(n(13354),n(30809),n(30862),n(12651)),d=n(50097),u=n(11163),g=n(25876),m=n(46966),h=n(23118),f=n(66878),p=n(41836),v=n(36705);class w extends r.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,r=(0,c.getEnabledElement)(o),{viewport:a,renderingEngine:s}=r;this.isDrawing=!0;const l=a.getCamera(),{viewPlaneNormal:u,viewUp:g}=l,p=this.getTargetId(a);let v,w;if(a instanceof c.StackViewport)v=p.split("imageId:")[1];else{w=c.utilities.getVolumeId(p);const e=c.cache.getVolume(w);v=c.utilities.getClosestImageId(e,i,u)}const y=a.getFrameOfReferenceUID(),I={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],enabledElement:r,viewUp:[...g],FrameOfReferenceUID:y,referencedImageId:v,toolName:this.getToolName(),volumeId:w},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},segmentationId:null}};(0,d.ud)(I,o);const x=(0,m.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:I,viewportIdsToRender:x,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,h.hideElementCursor)(o),e.preventDefault(),(0,f.Z)(s,x),I},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let r=(0,d.fy)(this.getToolName(),i);if(!r?.length)return n;if(r=this.filterInteractableAnnotationsForElement(i,r),!r?.length)return n;const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<r.length;e++){const s=r[e],{annotationUID:l,data:c}=s,{points:d,activeHandleIndex:m}=c.handles,h=d.map((e=>o.worldToCanvas(e)));a.annotationUID=l;const f=this.getStyle("lineWidth",a,s),w=this.getStyle("lineDash",a,s),y=this.getStyle("color",a,s);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let I;if((0,v.hg)(s,i),!(0,p.isAnnotationVisible)(l))continue;if((0,u.isAnnotationLocked)(s)||this.editData||null===m||(I=[h[m]]),I){const e="0";(0,g.drawHandles)(t,l,e,I,{color:y})}const x="0";(0,g.drawRect)(t,l,x,h[0],h[3],{color:y,lineDash:w,lineWidth:f}),n=!0}return n}}}w.toolName="RectangleROIThreshold";var y=n(39661),I=n(72076),x=n(90685),b=n(20724),C=n(88582),P=n(42975),E=n(15607),S=n(20752),T=n(51053),M=n(44037);const{transformWorldToIndex:A}=c.utilities;class R extends r.Z{constructor(e={},t={configuration:{numSlicesToPropagate:10,computePointsInsideVolume:!1,getTextLines:D,statsCalculator:T.BasicStatsCalculator,showTextBox:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,r=(0,c.getEnabledElement)(o),{viewport:a,renderingEngine:s}=r;this.isDrawing=!0;const l=a.getCamera(),{viewPlaneNormal:u,viewUp:g}=l;let p,v,w;if(a instanceof c.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(a);w=c.utilities.getVolumeId(e),v=c.cache.getVolume(w),p=c.utilities.getClosestImageId(v,i,u)}const y=c.utilities.getSpacingInNormalDirection(v,u),I=this._getStartCoordinate(i,u),x=this._getEndCoordinate(i,y,u),b=a.getFrameOfReferenceUID(),C={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],enabledElement:r,viewUp:[...g],FrameOfReferenceUID:b,referencedImageId:p,toolName:this.getToolName(),volumeId:w,spacingInNormal:y},data:{label:"",startCoordinate:I,endCoordinate:x,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[p],statistics:[]},handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(C,v),(0,d.ud)(C,o);const P=(0,m.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:C,viewportIdsToRender:P,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,h.hideElementCursor)(o),e.preventDefault(),(0,f.Z)(s,P),C},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:r,hasMoved:a}=this.editData,{data:s}=o;if(r&&!a)return;s.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,h.resetElementCursor)(n);const l=(0,c.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,d._x)(o.annotationUID);const u=this.getTargetId(l.viewport),g=c.cache.getVolume(u.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(o,u,g,l),(0,f.Z)(l.renderingEngine,i),r&&(0,v.F$)(o)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e;let i=(0,d.fy)(this.getToolName(),o.element);if(!i?.length)return n;i=(0,M.filterAnnotationsWithinSamePlane)(i,o.getCamera());const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let a=0;a<i.length;a++){const s=i[a],{annotationUID:l,data:d}=s,{startCoordinate:m,endCoordinate:h}=d,{points:f,activeHandleIndex:v}=d.handles,w=f.map((e=>o.worldToCanvas(e)));r.annotationUID=l;const y=this.getStyle("lineWidth",r,s),I=this.getStyle("lineDash",r,s),x=this.getStyle("color",r,s),C=o.getCamera().focalPoint,P=o.getCamera().viewPlaneNormal;let E=m,S=h;Array.isArray(m)&&(E=this._getCoordinateForViewplaneNormal(E,P)),Array.isArray(h)&&(S=this._getCoordinateForViewplaneNormal(S,P));const T=c.utilities.roundToPrecision(E),M=c.utilities.roundToPrecision(S),A=this._getCoordinateForViewplaneNormal(C,P),R=c.utilities.roundToPrecision(A);if(R<Math.min(T,M)||R>Math.max(T,M))continue;s.invalidated&&this._throttledCalculateCachedStats(s,e);let D,_=!1;if(R!==T&&R!==M||(_=!0),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,p.isAnnotationVisible)(l))continue;if((0,u.isAnnotationLocked)(s)||this.editData||null===v||!_||(D=[w[v]]),D){const e="0";(0,g.drawHandles)(t,l,e,D,{color:x})}let L=I;_||(L=2);const O="0";if((0,g.drawRect)(t,l,O,w[0],w[3],{color:x,lineDash:L,lineWidth:y}),n=!0,this.configuration.showTextBox&&this.configuration.calculatePointsInsideVolume){const e=this.getLinkedTextBoxStyle(r,s);if(!e.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const n=this.configuration.getTextLines(d);if(!n||0===n.length)continue;if(!d.handles.textBox.hasMoved){const e=(0,b.getTextBoxCoordsCanvas)(w);d.handles.textBox.worldPosition=o.canvasToWorld(e)}const i=o.worldToCanvas(d.handles.textBox.worldPosition),a="1",c=(0,g.drawLinkedTextBox)(t,l,a,n,i,w,{},e),{x:u,y:m,width:h,height:f}=c;d.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([u,m]),topRight:o.canvasToWorld([u+h,m]),bottomLeft:o.canvasToWorld([u,m+f]),bottomRight:o.canvasToWorld([u+h,m+f])}}}return n},this._throttledCalculateCachedStats=(0,x.Z)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:o}=e,{viewPlaneNormal:i,spacingInNormal:r}=o,{imageData:a}=t,{startCoordinate:s,endCoordinate:l}=n,{points:c}=n.handles,d=A(a,c[0]),u=A(a,c[0]),g=I.R3.create();a.indexToWorldVec3(d,g);const m=I.R3.create();a.indexToWorldVec3(u,m),2==this._getIndexOfCoordinatesForViewplaneNormal(i)?(g[2]=s,m[2]=l):0==this._getIndexOfCoordinatesForViewplaneNormal(i)?(g[0]=s,m[0]=l):1==this._getIndexOfCoordinatesForViewplaneNormal(i)&&(g[1]=s,m[1]=l);const h=I.R3.distance(g,m),f=[];for(let e=0;e<h;e+=r)f.push(c.map((t=>{const n=I.R3.create();return I.R3.scaleAndAdd(n,t,i,e),Array.from(n)})));n.cachedStats.projectionPoints=f}_computePointsInsideVolume(e,t,n,o){const{data:i,metadata:r}=e,{viewPlaneNormal:a,viewUp:s}=r,{viewport:l,renderingEngine:c}=o,d=i.cachedStats.projectionPoints,u=[[]],g=this.getTargetIdImage(t,c),m=i.handles.points[0],h=i.handles.points[3],{worldWidth:f,worldHeight:p}=(0,C.Z)(a,s,m,h),v=(0,y.mh)(g,i.habdles),w=Math.abs(f*p)/(v.scale*v.scale),I={isPreScaled:(0,S.P)(l,t),isSuvScaled:this.isSuvScaled(l,t,e.metadata.referencedImageId)},x=(0,E.F)(r.Modality,e.metadata.referencedImageId,I);for(let e=0;e<d.length;e++){if(!n)continue;const t=d[e][0],{dimensions:o,imageData:i}=n,r=A(i,m),s=A(i,t),l=this._getIndexOfCoordinatesForViewplaneNormal(a);r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r[2]=Math.floor(r[2]),r[l]=s[l];const c=A(i,h);if(c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c[2]=Math.floor(c[2]),c[l]=s[l],this._isInsideVolume(r,c,o)){this.isHandleOutsideImage=!1;const e=[[Math.min(r[0],c[0]),Math.max(r[0],c[0])],[Math.min(r[1],c[1]),Math.max(r[1],c[1])],[Math.min(r[2],c[2]),Math.max(r[2],c[2])]],t=(0,P.pointInShapeCallback)(i,(()=>!0),this.configuration.statsCalculator.statsCallback,e);u.push(t)}}const b=this.configuration.statsCalculator.getStatistics();i.cachedStats.pointsInVolume=u,i.cachedStats.statistics={Modality:r.Modality,area:w,mean:b.mean?.value,stdDev:b.stdDev?.value,max:b.max?.value,statsArray:b.array,areaUnit:v.areaUnits,modalityUnit:x}}_calculateCachedStatsTool(e,t){const n=e.data,{viewport:o}=t,{cachedStats:i}=n,r=this.getTargetId(o),a=c.cache.getVolume(r.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,a),e.invalidated=!1,(0,v.hg)(e,o.element),i}_getStartCoordinate(e,t){const n=e;return this._getCoordinateForViewplaneNormal(n,t)}_getEndCoordinate(e,t,n){const o=this.configuration.numSlicesToPropagate,i=I.R3.create();I.R3.scaleAndAdd(i,e,n,o*t);return this._getCoordinateForViewplaneNormal(i,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t.indexOf(Math.max(...t))}_getCoordinateForViewplaneNormal(e,t){return e[this._getIndexOfCoordinatesForViewplaneNormal(t)]}}function D(e){const t=e.cachedStats.statistics,{area:n,mean:o,max:i,stdDev:r,areaUnit:a,modalityUnit:s}=t;if(void 0===o)return;const l=[];return l.push(`Area: ${(0,P.roundNumber)(n)} ${a}`),l.push(`Mean: ${(0,P.roundNumber)(o)} ${s}`),l.push(`Max: ${(0,P.roundNumber)(i)} ${s}`),l.push(`Std Dev: ${(0,P.roundNumber)(r)} ${s}`),l}R.toolName="RectangleROIStartEndThreshold";n(2023),n(95459),n(78566),n(3402),n(45986)},52600:(e,t,n)=>{var o=n(12651),i=n(34539);class r{static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}static imageIdToFrames(e){const t=e.match(this.frameRangeExtractor);if(!t||!t[2])return null;const n=t[2].split("-").map((e=>Number(e)));return 1===n.length?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,t){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const o=this.framesToString(t);return e.replace(this.frameRangeExtractor,`${n[1]}${o}`)}static setFrameRange(e,t,n){const{referencedImageId:r}=e.metadata;e.metadata.referencedImageId=this.framesToImageId(r,t);const a={...n,annotation:e};(0,o.triggerEvent)(o.eventTarget,i.default.ANNOTATION_MODIFIED,a)}static getFrameRange(e){return this.imageIdToFrames(e.metadata.referencedImageId)}}},13278:(e,t,n)=>{n.d(t,{B:()=>r});var o=n(12651),i=(n(50097),n(72076));function r(e,t,n){const r=e.getImageIds();if(!r||!r.length)return;const a=r.map((e=>{const{imagePositionPatient:r}=o.metaData.get("imagePlaneModule",e),a=function(e,t,n){const o=i.R3.create();i.R3.sub(o,e,t);const r=i.R3.dot(o,n);return Math.abs(r)}(t,r,n);return{imageId:e,distance:a}}));return a.sort(((e,t)=>e.distance-t.distance)),a[0].imageId}},93341:()=>{},64652:(e,t,n)=>{n.d(t,{g:()=>a,o:()=>s});var o=n(12651);const{EPSILON:i}=o.CONSTANTS;function r(e,t,n=!1){let o=1/0,r=n?-1/0:0,a=1/0,s=n?-1/0:0,l=1/0,c=n?-1/0:0;const d=3===e[0]?.length;for(let t=0;t<e.length;t++){const n=e[t];o=Math.min(n[0],o),r=Math.max(n[0],r),a=Math.min(n[1],a),s=Math.max(n[1],s),d&&(l=Math.min(n[2]??l,l),c=Math.max(n[2]??c,c))}return t?(o=Math.max(n?t[0]+i:0,o),r=Math.min(n?t[0]-i:t[0]-1,r),a=Math.max(n?t[1]+i:0,a),s=Math.min(n?t[1]-i:t[1]-1,s),d&&3===t.length&&(l=Math.max(n?t[2]+i:0,l),c=Math.min(n?t[2]-i:t[2]-1,c))):n||(o=Math.max(0,o),r=Math.min(1/0,r),a=Math.max(0,a),s=Math.min(1/0,s),d&&(l=Math.max(0,l),c=Math.min(1/0,c))),d?[[o,r],[a,s],[l,c]]:[[o,r],[a,s],null]}function a(e,t){return r(e,t,!1)}function s(e,t){return r(e,t,!0)}},87758:(e,t,n)=>{n.d(t,{getBoundingBoxAroundShapeIJK:()=>o.g,getBoundingBoxAroundShapeWorld:()=>o.o});n(93341);var o=n(64652)},90892:(e,t,n)=>{var o=n(12651);const{calibratedPixelSpacingMetadataProvider:i}=o.utilities},51563:(e,t,n)=>{n(72076);var o,i=n(12651);!function(e){e.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",e.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED"}(o||(o={}));n(63478);const{ViewportStatus:r}=i.Enums,{triggerEvent:a}=i.utilities;new Map},70232:(e,t,n)=>{function o(e,t,n){return Math.min(Math.max(t,e),n)}n.d(t,{ZP:()=>i});const i=o},52577:(e,t,n)=>{n.d(t,{D:()=>i});var o=n(14305);function i(e){if(e.parentAnnotationUID)return;if(!e.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:t,segmentIndex:n}=e.data.segmentation,i=(0,o.getSegmentation)(t);i.representationData.CONTOUR||(i.representationData.CONTOUR={annotationUIDsMap:new Map});const{annotationUIDsMap:r}=i.representationData.CONTOUR;let a=r.get(n);a||(a=new Set,r.set(n,a)),r.set(n,a.add(e.annotationUID))}},40682:(e,t,n)=>{},81404:(e,t,n)=>{n.d(t,{addContourSegmentationAnnotation:()=>o.D,removeContourSegmentationAnnotation:()=>i.E});n(40682),n(75170);var o=n(52577),i=n(31514)},75170:(e,t,n)=>{},31514:(e,t,n)=>{n.d(t,{E:()=>i});var o=n(95482);function i(e){if(!e.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:t,segmentIndex:n}=e.data.segmentation,i=o.state.getSegmentation(t),{annotationUIDsMap:r}=i?.representationData.CONTOUR||{},a=r?.get(n);a&&(a.delete(e.annotationUID),a.size||r.delete(n))}},3042:(e,t,n)=>{n.d(t,{Z:()=>o});const o=function(e,t){let n=0;for(let t=0;t<e.length-1;t++){const o=e[t],i=e[t+1];n+=Math.sqrt(Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2))}if(t){const t=e[0],o=e[e.length-1];n+=Math.sqrt(Math.pow(o[0]-t[0],2)+Math.pow(o[1]-t[1],2))}return n}},66299:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(12651),i=n(72076);const{isEqual:r}=o.utilities;function a(e,t){const{polyline:n}=e.data.contour,{points:o}=e.data.handles,{length:a}=o;if(t===a)return n.length;if(t<0&&(t=(t+a)%a),0===t)return 0;const s=o[t],l=n.findIndex((e=>r(s,e)));if(-1!==l)return l;let c=1/0;return n.reduce(((e,t,n)=>{const o=i.R3.squaredDistance(t,s);return o<c?(c=o,n):e}),-1)}},11203:(e,t,n)=>{n.d(t,{getContourHolesDataCanvas:()=>l,updateContourPolyline:()=>c.Z});n(72076);n(12651),n(60318),n(54131),n(8455);var o=n(74297);const{Labelmap:i}=o.default;var r=n(94627);class a{constructor(){}static{this.TOOL_NAMES={}}static convert(e,t,n){!function(e){if(!e?.data)throw new Error("Tool data is empty");if(!e.metadata||e.metadata.referenceImageId)throw new Error("Tool data is not associated with any imageId")}(e);const{toolName:o}=e.metadata,i=a.TOOL_NAMES[o];if(!i)throw new Error(`Unknown tool type: ${o}, cannot convert to RTSSReport`);const r=i.getContourSequence(e,n);return{ReferencedROINumber:t+1,ROIDisplayColor:[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],ContourSequence:r}}static register(e){a.TOOL_NAMES[e.toolName]=e}}a.register(r.Z);var s=n(50097);function l(e,t){const n=function(e){return(e.childAnnotationUIDs??[]).map((e=>(0,s.AR)(e).data.contour.polyline))}(e),o=[];return n.forEach((e=>{const n=e.length,i=new Array(n);for(let o=0;o<n;o++)i[o]=t.worldToCanvas(e[o]);o.push(i)})),o}var c=n(48561);n(7966);n(61065),n(66299),n(3042)},61065:(e,t,n)=>{n.d(t,{InterpolationManager:()=>o.Z});var o=n(7966)},48561:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(12651),i=n(79390),r=n(50097);function a(e,t,n,a){const{canvasToWorld:s,worldToCanvas:l}=n,{data:c}=e,{targetWindingDirection:d}=t;let{points:u}=t;a?.decimate?.enabled&&(u=i.polyline.decimate(t.points,a?.decimate?.epsilon));let{closed:g}=t;const m=u.length,h=new Array(m),f=i.polyline.getWindingDirection(u),p=(0,r.VI)(e);if(void 0===g){let e=!1;if(u.length>3){const t=i.point.distanceToPointSquared(u[0],u[m-1]);e=o.utilities.isEqual(0,t)}g=e}let v=p?-1*p.data.contour.windingDirection:d;void 0===v&&(v=f),v!==f&&u.reverse();const w=c.handles.points.map((e=>l(e)));if(w.length>2){i.polyline.getWindingDirection(w)!==v&&c.handles.points.reverse()}for(let e=0;e<m;e++)h[e]=s(u[e]);c.contour.polyline=h,c.contour.closed=g,c.contour.windingDirection=v,(0,r.X9)(e)}},82298:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(73609);const i=function(e,t,n){let i,r,a,s,l,c,d=0,u=!1,g=!1,m=!0;const h=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){const n=i,o=r;return i=r=void 0,d=t,s=e.apply(o,n),s}function p(e,t){return h?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){const n=e-c;return void 0===c||n>=t||n<0||g&&e-d>=a}function w(){const e=Date.now();if(v(e))return y(e);l=p(w,function(e){const n=e-d,o=t-(e-c);return g?Math.min(o,a-n):o}(e))}function y(e){return l=void 0,m&&i?f(e):(i=r=void 0,s)}function I(...e){const n=Date.now(),o=v(n);if(i=e,r=this,c=n,o){if(void 0===l)return function(e){return d=e,l=p(w,t),u?f(e):s}(c);if(g)return l=p(w,t),f(c)}return void 0===l&&(l=p(w,t)),s}return t=Number(t)||0,(0,o.Z)(n)&&(u=Boolean(n.leading),g="maxWait"in n,a=g?Math.max(Number(n.maxWait)||0,t):a,m="trailing"in n?Boolean(n.trailing):m),I.cancel=function(){void 0!==l&&function(e){if(h)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),d=0,i=c=r=l=void 0},I.flush=function(){return void 0===l?s:y(Date.now())},I.pending=function(){return void 0!==l},I}},20724:(e,t,n)=>{function o(e){const t=function(e){const t=[e[0],e[1]].sort(a),n=[e[0],e[1]].sort(s),o=t[t.length-1],i=n[0],r=n[n.length-1];return{top:i,bottom:r,right:o};function a(e,t){return e[0]<t[0]?-1:1}function s(e,t){return e[1]<t[1]?-1:1}}(e),n=(t.top[1]+t.bottom[1])/2;return[t.right[0],n]}n.d(t,{getTextBoxCoordsCanvas:()=>o})},62379:(e,t,n)=>{n(12651),n(89776),n(31955)},62358:(e,t,n)=>{n(12651),n(86614),n(27078)},39661:(e,t,n)=>{n.d(t,{G6:()=>m,Sh:()=>g,mh:()=>u});var o=n(12651);const{CalibrationTypes:i}=o.Enums,r="px",a=[1],s=["3,3"],l=["4,3"],c={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm²",9:"cm²/s",12:"degrees"},d="²",u=(e,t)=>{const{calibration:n,hasPixelSpacing:l}=e;let u=l?"mm":r,g=u+d,m=1,h="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{units:u,areaUnits:g,scale:m};if(n.type===i.UNCALIBRATED)return{units:r,areaUnits:r+d,scale:m};if(n.sequenceOfUltrasoundRegions){let e,i;if(Array.isArray(t)&&2===t.length)[e,i]=t;else if("function"==typeof t){const n=t();e=n[0],i=n[1]}let l=n.sequenceOfUltrasoundRegions.filter((t=>e[0]>=t.regionLocationMinX0&&e[0]<=t.regionLocationMaxX1&&e[1]>=t.regionLocationMinY0&&e[1]<=t.regionLocationMaxY1&&i[0]>=t.regionLocationMinX0&&i[0]<=t.regionLocationMaxX1&&i[1]>=t.regionLocationMinY0&&i[1]<=t.regionLocationMaxY1));if(!l?.length)return{units:u,areaUnits:g,scale:m};if(l=l.filter((e=>a.includes(e.regionDataType)&&s.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`))),!l.length)return{units:r,areaUnits:r+d,scale:m};const f=l[0],p=Math.abs(f.physicalDeltaX),v=Math.abs(f.physicalDeltaY);if(!o.utilities.isEqual(p,v,.001))return{units:r,areaUnits:r+d,scale:m};m=1/p,h="US Region",u=c[f.physicalUnitsXDirection]||"unknown",g=u+d}else n.scale&&(m=n.scale);return[i.ERMF,i.USER,i.ERROR,i.PROJECTION].includes(n?.type)&&(h=n.type),{units:u+(h?` ${h}`:""),areaUnits:g+(h?` ${h}`:""),scale:m}},g=(e,t)=>{const[n]=t,{calibration:o}=e;let i=["raw"],r=[null],s="";if(!o||!o.type&&!o.sequenceOfUltrasoundRegions)return{units:i,values:r};if(o.sequenceOfUltrasoundRegions){const e=o.sequenceOfUltrasoundRegions.filter((e=>a.includes(e.regionDataType)&&l.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`)));if(!e?.length)return{units:i,values:r};const t=e.find((e=>n[0]>=e.regionLocationMinX0&&n[0]<=e.regionLocationMaxX1&&n[1]>=e.regionLocationMinY0&&n[1]<=e.regionLocationMaxY1));if(!t)return{units:i,values:r};const{referencePixelX0:d=0,referencePixelY0:u=0}=t,{physicalDeltaX:g,physicalDeltaY:m}=t,h=(n[1]-t.regionLocationMinY0-u)*m;s="US Region",r=[(n[0]-t.regionLocationMinX0-d)*g,h],i=[c[t.physicalUnitsXDirection],c[t.physicalUnitsYDirection]]}return{units:i,values:r,calibrationType:s}},m=e=>e.calibration?.aspect||1},28921:(e,t,n)=>{n.d(t,{v:()=>s});var o=n(12651),i=n(72076),r=n(87758);const{transformWorldToIndex:a}=o.utilities;function s(e,t,n){const[o,s]=e,l=i.R3.fromValues((o[0]+s[0])/2,(o[1]+s[1])/2,(o[2]+s[2])/2),c=i.R3.distance(o,s)/2;if(!n)throw new Error("viewport is required in order to calculate the sphere bounds");const{boundsIJK:d,topLeftWorld:u,bottomRightWorld:g}=function(e,t,n,o,s){const[l,c]=n,d=e.getDimensions(),u=t.getCamera(),g=i.R3.fromValues(u.viewUp[0],u.viewUp[1],u.viewUp[2]),m=i.R3.fromValues(u.viewPlaneNormal[0],u.viewPlaneNormal[1],u.viewPlaneNormal[2]),h=i.R3.create();i.R3.cross(h,g,m);const f=i.R3.create(),p=i.R3.create();i.R3.scaleAndAdd(f,c,m,s),i.R3.scaleAndAdd(p,l,m,-s),i.R3.scaleAndAdd(f,f,h,-s),i.R3.scaleAndAdd(p,p,h,s);const v=a(e,f),w=a(e,p),y=n.map((t=>a(e,t))),I=(0,r.getBoundingBoxAroundShapeIJK)([v,w,...y],d);return{boundsIJK:I,topLeftWorld:f,bottomRightWorld:p}}(t,n,e,0,c);return{boundsIJK:d,centerWorld:l,radiusWorld:c,topLeftWorld:u,bottomRightWorld:g}}},82220:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(22319);function i(e){const t=(0,o.Z)(e);return t.length?t[0]:void 0}},42975:(e,t,n)=>{n.d(t,{clip:()=>a.ZP,debounce:()=>i.Z,getCalibratedLengthUnitsAndScale:()=>s.mh,math:()=>m,pointInShapeCallback:()=>d.Z,pointToString:()=>g.s,polyDataUtils:()=>h,roundNumber:()=>f,scroll:()=>u.Z,throttle:()=>r.Z,triggerAnnotationRenderForToolGroupIds:()=>c.Z,triggerAnnotationRenderForViewportIds:()=>l.Z});var o=n(12651),i=(n(62358),n(82298)),r=n(90685),a=(n(73609),n(70232)),s=(n(90892),n(39661)),l=n(66878),c=n(70180),d=(n(64307),n(68009),n(31955)),u=(n(28921),n(63478)),g=n(5205),m=(n(52600),n(70134),n(82220),n(13278),n(11203),n(70184),n(20724),n(79390)),h=(n(44037),n(46966),n(67958),n(67125),n(51563),n(87758),n(28861),n(78536),n(2185),n(85217),n(25068),n(62379),n(89977));n(54166),n(81404);const f=o.utilities.roundNumber},73609:(e,t,n)=>{n.d(t,{Z:()=>o});const o=function(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}},5260:(e,t,n)=>{function o(e,t){return e.minX<=t.maxX&&e.maxX>=t.minX&&e.minY<=t.maxY&&e.maxY>=t.minY}function i(e,t){const n=e.maxX-e.minX,o=e.maxY-e.minY,i=[n,o],r=[e.minX+n/2,e.minY+o/2],a=[Math.abs(t[0]-r[0]),Math.abs(t[1]-r[1])],s=a[0]-.5*i[0],l=a[1]-.5*i[1];if(s>0&&l>0)return s*s+l*l;const c=Math.max(s,0)+Math.max(l,0);return c*c}function r(e,t){return Math.sqrt(i(e,t))}n.r(t),n.d(t,{distanceToPoint:()=>r,distanceToPointSquared:()=>i,intersectAABB:()=>o})},51053:(e,t,n)=>{n.d(t,{BasicStatsCalculator:()=>a});var o=n(12651);const i=class{},{PointsManager:r}=o.utilities;class a extends i{static{this.max=[-1/0]}static{this.min=[1/0]}static{this.sum=[0]}static{this.count=0}static{this.runMean=[0]}static{this.m2=[0]}static{this.pointsInShape=r.create3(1024)}static statsInit(e){e.noPointsCollection&&(a.pointsInShape=null)}static{this.statsCallback=({value:e,pointLPS:t=null})=>{Array.isArray(e)&&e.length>1&&1===this.max.length&&(this.max.push(this.max[0],this.max[0]),this.min.push(this.min[0],this.min[0]),this.sum.push(this.sum[0],this.sum[0]),this.runMean.push(0,0),this.m2.push(this.m2[0],this.m2[0])),this.pointsInShape?.push(t);const n=Array.isArray(e)?e:[e];this.count+=1,this.max.map(((e,t)=>{const o=n[t],i=o-this.runMean[t];this.sum[t]+=o,this.runMean[t]+=i/this.count;const r=o-this.runMean[t];this.m2[t]+=i*r,this.min[t]=Math.min(this.min[t],o),this.max[t]=Math.max(e,o)}))}}static{this.getStatistics=e=>{const t=this.sum.map((e=>e/this.count)),n=this.m2.map((e=>Math.sqrt(e/this.count))),o=e?.unit||null,i={max:{name:"max",label:"Max Pixel",value:s(this.max),unit:o},min:{name:"min",label:"Min Pixel",value:s(this.min),unit:o},mean:{name:"mean",label:"Mean Pixel",value:s(t),unit:o},stdDev:{name:"stdDev",label:"Standard Deviation",value:s(n),unit:o},count:{name:"count",label:"Pixel Count",value:this.count,unit:null},pointsInShape:this.pointsInShape,array:[]};return i.array.push(i.max,i.mean,i.stdDev,i.stdDev,i.count),this.max=[-1/0],this.min=[1/0],this.sum=[0],this.m2=[0],this.runMean=[0],this.count=0,this.pointsInShape=r.create3(1024),i}}}function s(e){return 1===e.length?e[0]:e}},92600:(e,t,n)=>{function o(e,t,n={}){return n.precalculated||i(e,n),n.precalculated(t)}n.d(t,{getCanvasEllipseCorners:()=>r,pointInEllipse:()=>o,precalculatePointInEllipse:()=>i});const i=(e,t={})=>{const{xRadius:n,yRadius:o,zRadius:i}=e;void 0!==t.invXRadiusSq&&void 0!==t.invYRadiusSq&&void 0!==t.invZRadiusSq||(t.invXRadiusSq=0!==n?1/n**2:0,t.invYRadiusSq=0!==o?1/o**2:0,t.invZRadiusSq=0!==i?1/i**2:0);const{invXRadiusSq:r,invYRadiusSq:a,invZRadiusSq:s}=t,{center:l}=e,[c,d,u]=l;return t.precalculated=e=>{const t=e[0]-c;let n=t*t*r;if(n>1)return!1;const o=e[1]-d;if(n+=o*o*a,n>1)return!1;const i=e[2]-u;return n+=i*i*s,n<=1},t};function r(e){const[t,n,o,i]=e;return[[o[0],n[1]],[i[0],t[1]]]}},79390:(e,t,n)=>{n.d(t,{aabb:()=>o,lineSegment:()=>i,point:()=>r,polyline:()=>a});var o=n(5260),i=(n(51053),n(92600),n(79922)),r=n(74474),a=n(42744);n(81671),n(13230)},79922:(e,t,n)=>{n.r(t),n.d(t,{distanceToPoint:()=>a,distanceToPointSquared:()=>r,distanceToPointSquaredInfo:()=>i,intersectLine:()=>l,isPointOnLineSegment:()=>d});var o=n(79390);function i(e,t,n){let i;const r=o.point.distanceToPointSquared(e,t);if(e[0]===t[0]&&e[1]===t[1]&&(i=e),!i){const o=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/r;i=o<0?e:o>1?t:[e[0]+o*(t[0]-e[0]),e[1]+o*(t[1]-e[1])]}return{point:[...i],distanceSquared:o.point.distanceToPointSquared(n,i)}}function r(e,t,n){return i(e,t,n).distanceSquared}function a(e,t,n){if(2!==e.length||2!==t.length||2!==n.length)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(r(e,t,n))}function s(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}function l(e,t,n,o){const[i,r]=e,[a,l]=t,[c,d]=n,[u,g]=o,m=l-r,h=i-a,f=a*r-i*l,p=m*c+h*d+f,v=m*u+h*g+f;if(0!==p&&0!==v&&s(p)===s(v))return;const w=g-d,y=c-u,I=u*d-c*g,x=w*i+y*r+I,b=w*a+y*l+I;if(0!==x&&0!==b&&s(x)===s(b))return;const C=m*y-w*h;let P;P=h*I-y*f;const E=P/C;P=w*f-m*I;return[E,P/C]}const c=.01;function d(e,t,n){const o=e[0]<=t[0]?e[0]:t[0],i=e[0]>=t[0]?e[0]:t[0],r=e[1]<=t[1]?e[1]:t[1],a=e[1]>=t[1]?e[1]:t[1];if(!(n[0]>=o-c&&n[0]<=i+c&&n[1]>=r-c&&n[1]<=a+c))return!1;const s=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return(s>=0?s:-s)<=c}},25523:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(94363);function i(e,t){return Math.sqrt((0,o.Z)(e,t))}},94363:(e,t,n)=>{function o(e,t){if(e.length!==t.length)throw Error("Both points should have the same dimensionality");const[n,o,i=0]=e,[r,a,s=0]=t,l=r-n,c=a-o,d=s-i;return l*l+c*c+d*d}n.d(t,{Z:()=>o})},18668:(e,t,n)=>{function o(e,t){const[n,o]=e,[i,r]=t;return[2*i-n,2*r-o]}n.d(t,{Z:()=>o})},42744:(e,t,n)=>{n.r(t),n.d(t,{addCanvasPointsToArray:()=>F,containsPoint:()=>a,containsPoints:()=>s,decimate:()=>L,getAABB:()=>l.Z,getArea:()=>c,getClosestLineSegmentIntersection:()=>V,getFirstLineSegmentIntersectionIndexes:()=>R,getLineSegmentIntersectionsCoordinates:()=>O,getLineSegmentIntersectionsIndexes:()=>w,getNormal2:()=>m,getNormal3:()=>g,getSignedArea:()=>d,getSubPixelSpacingAndXYDirections:()=>U,getWindingDirection:()=>u,intersectPolyline:()=>D,isClosed:()=>r,isPointInsidePolyline3D:()=>q,mergePolylines:()=>M,pointCanProjectOnLine:()=>Z,pointsAreWithinCloseContourProximity:()=>B,projectTo2D:()=>j,subtractPolylines:()=>A});var o=n(72076),i=n(79390);function r(e){if(e.length<3)return!1;const t=e.length,n=e[0],r=e[t-1],a=i.point.distanceToPointSquared(n,r);return o.DV.equals(0,a)}function a(e,t,n={closed:void 0}){if(e.length<3)return!1;const o=e.length;let i=0;const{closed:s,holes:l}=n;if(l?.length)for(const e of l)if(a(e,t))return!1;const c=!(void 0===s?r(e):s),d=e.length-(c?1:2);for(let n=0;n<=d;n++){const r=e[n],a=e[n===o-1?0:n+1],s=r[0]>=a[0]?r[0]:a[0],l=r[1]>=a[1]?r[1]:a[1],c=r[1]<=a[1]?r[1]:a[1];if(t[0]<=s&&t[1]>=c&&t[1]<l){let e=r[0]===a[0];if(!e){const n=(t[1]-r[1])*(a[0]-r[0])/(a[1]-r[1])+r[0];e=t[0]<=n}i+=e?1:0}}return!!(i%2)}function s(e,t){for(let n=0,o=t.length;n<o;n++)if(!a(e,t[n]))return!1;return!0}var l=n(13837);function c(e){const t=e.length;let n=0,o=t-1;for(let i=0;i<t;i++)n+=(e[o][0]+e[i][0])*(e[o][1]-e[i][1]),o=i;return Math.abs(n/2)}function d(e){if(e.length<3)return 0;const t=e[0];let n=0;for(let o=0,i=e.length;o<i;o++){const r=e[o],a=e[o===i-1?0:o+1],s=r[0]-t[0],l=r[1]-t[1],c=a[0]-t[0];n+=s*(a[1]-t[1])-l*c}return n*=.5,n}function u(e){return d(e)>=0?1:-1}function g(e){const t=function(e){const t=o.R3.create(),n=e[0];for(let o=0,i=e.length;o<i;o++){const r=e[o],a=e[o===i-1?0:o+1],s=r[0]-n[0],l=r[1]-n[1],c=r[2]-n[2],d=a[0]-n[0],u=a[1]-n[1],g=a[2]-n[2];t[0]+=l*g-c*u,t[1]+=c*d-s*g,t[2]+=s*u-l*d}return o.R3.scale(t,t,.5),t}(e);return o.R3.normalize(t,t)}function m(e){const t=d(e);return[0,0,t/Math.abs(t)]}var h=n(74474);function f(e,t,n,o){let i=!1;const r=e[0]<t[0]?e[0]:t[0],a=e[1]<t[1]?e[1]:t[1],s=e[0]>t[0]?e[0]:t[0],l=e[1]>t[1]?e[1]:t[1],c=n[0]<o[0]?n[0]:o[0],d=n[1]<o[1]?n[1]:o[1],u=n[0]>o[0]?n[0]:o[0],g=n[1]>o[1]?n[1]:o[1];if(r>u||s<c||a>g||l<d)return!1;const m=[p(e,t,n),p(e,t,o),p(n,o,e),p(n,o,t)];return m[0]!==m[1]&&m[2]!==m[3]||((0===m[0]&&v(e,n,t)||0===m[1]&&v(e,o,t)||0===m[2]&&v(n,e,o)||0===m[3]&&v(n,t,o))&&(i=!0),i)}function p(e,t,n){const o=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===o?0:o>0?1:2}function v(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])}function w(e,t,n,o=!0){const i=[],r=e.length,a=r-(o?1:2);for(let o=0;o<=a;o++){const a=o===r-1?0:o+1;f(t,n,e[o],e[a])&&i.push([o,a])}return i}var y=n(79922);const I=.01;function x(e,t,n,o){const i=[t[0]-e[0],t[1]-e[1]],r=[o[0]-n[0],o[1]-n[1]],a=r[1]*i[0]-r[0]*i[1];if((a>=0?a:-a)<I){const i=[e[0]<t[0]?e[0]:t[0],e[0]>t[0]?e[0]:t[0],e[1]<t[1]?e[1]:t[1],e[1]>t[1]?e[1]:t[1]],r=[n[0]<o[0]?n[0]:o[0],n[0]>o[0]?n[0]:o[0],n[1]<o[1]?n[1]:o[1],n[1]>o[1]?n[1]:o[1]];if(!(i[0]<=r[1]&&i[1]>=r[0]&&i[2]<=r[3]&&i[3]>=r[2]))return;if(!(y.isPointOnLineSegment(e,t,n)||y.isPointOnLineSegment(e,t,o)||y.isPointOnLineSegment(n,o,e)))return;return[.5*((i[0]>r[0]?i[0]:r[0])+(i[1]<r[1]?i[1]:r[1])),.5*((i[2]>r[2]?i[2]:r[2])+(i[3]<r[3]?i[3]:r[3]))]}let s=e[1]-n[1],l=e[0]-n[0];const c=i[0]*s-i[1]*l;s=(r[0]*s-r[1]*l)/a,l=c/a;return[e[0]+s*i[0],e[1]+s*i[1]]}var b,C,P;function E(e){for(let t=0,n=e.length;t<n;t++){const o=e[t];o.next||(o.next=e[t===n-1?0:t+1])}}function S(e,t){const n=[],o=[],i=new Map;let r=a(t,e[0])?P.Exiting:P.Entering;for(let o=0,s=e.length;o<s;o++){const l=e[o],c=a(t,l),d={type:b.Vertex,coordinates:l,position:c?C.Inside:C.Outside,visited:!1,next:null};n.push(d);const u=e[o===s-1?0:o+1],g=w(t,l,u).map((e=>{const n=e[0],o=t[e[0]],i=t[e[1]],r=x(l,u,o,i);return{sourceLineSegmentId:n,coordinate:r,targetStartPointDistSquared:h.distanceToPointSquared(l,r)}}));g.sort(((e,t)=>e.targetStartPointDistSquared-t.targetStartPointDistSquared)),g.forEach((e=>{const{sourceLineSegmentId:t,coordinate:o}=e,a={type:b.Intersection,coordinates:o,position:C.Edge,direction:r,visited:!1,next:null},s={...a,direction:P.Unknown,cloned:!0};r===P.Entering?a.next=s:s.next=a;let l=i.get(t);l||(l=[],i.set(t,l)),n.push(a),l.push(s),r*=-1}))}for(let e=0,n=t.length;e<n;e++){const n=e,r=t[e],a={type:b.Vertex,coordinates:r,visited:!1,next:null};o.push(a);const s=i.get(n);s?.length&&s.map((e=>({intersectionPoint:e,lineSegStartDistSquared:h.distanceToPointSquared(r,e.coordinates)}))).sort(((e,t)=>e.lineSegStartDistSquared-t.lineSegStartDistSquared)).map((({intersectionPoint:e})=>e)).forEach((e=>o.push(e)))}return E(n),E(o),{targetPolylinePoints:n,sourcePolylinePoints:o}}function T(e){for(let t=0,n=e.length;t<n;t++){const n=e[t];if(!n.visited&&n.position===C.Outside)return n}}function M(e,t){const n=m(e),i=m(t),r=o.R3.dot(i,n);o.DV.equals(1,r)||(t=t.slice().reverse());const{targetPolylinePoints:a}=S(e,t),s=T(a);if(!s)return e.slice();const l=[s.coordinates];let c=s.next;for(;c!==s;)c.type===b.Intersection&&c.cloned||l.push(c.coordinates),c=c.next;return l}function A(e,t){const n=m(e),i=m(t),r=o.R3.dot(i,n);o.DV.equals(-1,r)||(t=t.slice().reverse());const{targetPolylinePoints:a}=S(e,t);let s=null;const l=[];for(;s=T(a);){const e=[s.coordinates];let t=s.next;for(s.visited=!0;t!==s;)t.visited=!0,t.type===b.Intersection&&t.cloned||e.push(t.coordinates),t=t.next;l.push(e)}return l}function R(e,t,n,o=!0){let i,r;o?(r=e.length-1,i=0):(r=0,i=1);for(let o=i;o<e.length;o++){if(f(t,n,e[r],e[o]))return[r,o];r=o}}function D(e,t){for(let n=0,o=e.length;n<o;n++){const i=R(t,e[n],e[n===o-1?0:n+1]);if(2===i?.length)return!0}return!1}!function(e){e[e.Vertex=0]="Vertex",e[e.Intersection=1]="Intersection"}(b||(b={})),function(e){e[e.Outside=-1]="Outside",e[e.Edge=0]="Edge",e[e.Inside=1]="Inside"}(C||(C={})),function(e){e[e.Exiting=-1]="Exiting",e[e.Unknown=0]="Unknown",e[e.Entering=1]="Entering"}(P||(P={}));const _=.1;function L(e,t=_){const n=e.length;if(n<3)return e;const o=t*t,i=[[0,n-1]],r=new Array(n).fill(!1);let a=2;for(r[0]=!0,r[n-1]=!0;i.length;){const[t,n]=i.pop();if(n-t==1)continue;const s=e[t],l=e[n];let c=-1/0,d=-1;for(let o=t+1;o<n;o++){const t=e[o],n=y.distanceToPointSquared(s,l,t);n>c&&(c=n,d=o)}c<o||(r[d]=!0,a++,i.push([d,n]),i.push([t,d]))}const s=new Array(a);for(let t=0,o=0;t<n;t++)r[t]&&(s[o++]=e[t]);return s}function O(e,t,n,o=!0){const i=[],r=w(e,t,n,o);for(let o=0;o<r.length;o++){const a=x(t,n,e[r[o][0]],e[r[o][1]]);i.push(a)}return i}function V(e,t,n,i=!0){let r,a;i?(a=e.length-1,r=0):(a=0,r=1);const s=[];for(let o=r;o<e.length;o++){const i=e[a],r=e[o];f(t,n,i,r)&&s.push([a,o]),a=o}if(0===s.length)return;const l=[];s.forEach((n=>{const i=[e[n[0]],e[n[1]]],r=[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2];l.push(o.K4.distance(r,t))}));const c=Math.min(...l);return{segment:s[l.indexOf(c)],distance:c}}var N=n(12651);const k=.001,U=(e,t)=>{let n,i,r;if(e instanceof N.StackViewport){const t=e.getImageData();i=t.direction.slice(0,3),r=t.direction.slice(3,6),n=t.spacing}else{const t=e.getImageData(),{direction:a,spacing:s}=t,{viewPlaneNormal:l,viewUp:c}=e.getCamera(),d=a.slice(0,3),u=a.slice(3,6),g=a.slice(6,9),m=o.R3.create();o.R3.cross(m,c,l);const h=Math.abs(o.R3.dot(m,d)),f=Math.abs(o.R3.dot(m,u)),p=Math.abs(o.R3.dot(m,g));let v;if(Math.abs(1-h)<k)v=s[0],i=d;else if(Math.abs(1-f)<k)v=s[1],i=u;else{if(!(Math.abs(1-p)<k))throw new Error("No support yet for oblique plane planar contours");v=s[2],i=g}const w=Math.abs(o.R3.dot(c,d)),y=Math.abs(o.R3.dot(c,u)),I=Math.abs(o.R3.dot(c,g));let x;if(Math.abs(1-w)<k)x=s[0],r=d;else if(Math.abs(1-y)<k)x=s[1],r=u;else{if(!(Math.abs(1-I)<k))throw new Error("No support yet for oblique plane planar contours");x=s[2],r=g}n=[v,x]}return{spacing:[n[0]/t,n[1]/t],xDir:i,yDir:r}},B=(e,t,n)=>o.K4.dist(e,t)<n,F=(e,t,n,i)=>{const{xDir:r,yDir:a,spacing:s}=i,l=(0,N.getEnabledElement)(e),{viewport:c}=l;if(!t.length)return t.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const d=c.canvasToWorld(t[t.length-1]),u=c.canvasToWorld(n),g=o.R3.create();o.R3.subtract(g,u,d);const m=Math.abs(o.R3.dot(g,r)),h=Math.abs(o.R3.dot(g,a)),f=Math.max(Math.floor(m/s[0]),Math.floor(h/s[0]));if(f>1){const e=t[t.length-1],i=o.K4.dist(e,n),r=o.K4.create();o.K4.subtract(r,n,e),o.K4.set(r,r[0]/i,r[1]/i);const a=i/f;for(let n=1;n<=f;n++)t.push([e[0]+a*r[0]*n,e[1]+a*r[1]*n])}else t.push(n);return f},Z=(e,t,n,i)=>{const r=[e[0]-t[0],e[1]-t[1]],a=[n[0]-t[0],n[1]-t[1]],s=r[0]*a[0]+r[1]*a[1];if(s<0)return!1;const l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===l)return!1;const c=s/l,d=[a[0]/l,a[1]/l],u=[d[0]*c,d[1]*c],g=[t[0]+u[0],t[1]+u[1]];return!(o.K4.distance(e,g)>i)&&!(o.K4.distance(t,g)>o.K4.distance(t,n))},W=1e-6;function j(e){let t;const n=N.utilities.getRandomSampleFromArray(e,50);for(let e=0;e<3;e++)if(n.every(((t,n,o)=>Math.abs(t[e]-o[0][e])<W))){t=e;break}if(void 0===t)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const o=[],i=(t+1)%3,r=(t+2)%3;for(let t=0;t<e.length;t++)o.push([e[t][i],e[t][r]]);return{sharedDimensionIndex:t,projectedPolyline:o}}function q(e,t,n={}){const{sharedDimensionIndex:o,projectedPolyline:i}=j(t),{holes:r}=n,s=[];if(r)for(let e=0;e<r.length;e++){const t=r[e],n=[];for(let e=0;e<t.length;e++)n.push([t[e][(o+1)%3],t[e][(o+2)%3]]);s.push(n)}return a(i,[e[(o+1)%3],e[(o+2)%3]],{holes:s})}},81671:(e,t,n)=>{n.d(t,{distanceToPoint:()=>i});var o=n(79922);function i(e,t){if(4!==e.length||2!==t.length)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[n,i,r,a]=e;let s=655535;const l=function(e,t,n,o){return{top:[[e,t],[e+n,t]],right:[[e+n,t],[e+n,t+o]],bottom:[[e+n,t+o],[e,t+o]],left:[[e,t+o],[e,t]]}}(n,i,r,a);return Object.keys(l).forEach((e=>{const[n,i]=l[e],r=o.distanceToPoint(n,i,t);r<s&&(s=r)})),s}},34603:(e,t,n)=>{function o(e,t){const{center:n,radius:o}=e,i=e.radius2||o*o;return(t[0]-n[0])*(t[0]-n[0])+(t[1]-n[1])*(t[1]-n[1])+(t[2]-n[2])*(t[2]-n[2])<=i}n.d(t,{E:()=>o})},13230:(e,t,n)=>{n(78924),n(3467)},3467:(e,t,n)=>{n.d(t,{Z:()=>s});const o=1e-6,i=1,r=0;function a(e,t,n){const[i,r]=n;if(Math.abs(t)<o)return e<0;const a=e/t;if(t>0){if(a>r)return 0;a>i&&(n[0]=a)}else{if(a<i)return 0;a<r&&(n[1]=a)}return 1}function s(e,t,n,s,l){const[c,d]=e,[u,g]=t,m=u-c,h=g-d;if(void 0===s||void 0===l?(s=e,l=t):(s[0]=e[0],s[1]=e[1],l[0]=t[0],l[1]=t[1]),Math.abs(m)<o&&Math.abs(h)<o&&c>=n[0]&&c<=n[2]&&d>=n[1]&&d<=n[3])return i;const f=[0,1];if(a(n[0]-c,m,f)&&a(c-n[2],-m,f)&&a(n[1]-d,h,f)&&a(d-n[3],-h,f)){const[e,t]=f;return t<1&&(l[0]=c+t*m,l[1]=d+t*h),e>0&&(s[0]+=e*m,s[1]+=e*h),i}return r}},67958:(e,t,n)=>{},67125:(e,t,n)=>{},28861:(e,t,n)=>{n(2036).Z},44037:(e,t,n)=>{n.d(t,{filterAnnotationsForDisplay:()=>r.Z,filterAnnotationsWithinSamePlane:()=>l.Q,getPointInLineOfSightWithCriteria:()=>a.Z,isPlaneIntersectingAABB:()=>s.U});var o=n(88642),i=n(88582),r=n(69943),a=n(1023),s=n(61890),l=n(50630);o.Z,i.Z,r.Z,a.Z,s.U,l.Q},31955:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(72076);function i(e,t,n,i){let r,a,s,l,c,d,u;const{numComps:g}=e;if(u=e.getScalarData?e.getScalarData():e.getPointData().getScalars().getData(),!u)return void console.warn("No scalar data found for imageData",e);const m=e.getDimensions();i?[[r,a],[s,l],[c,d]]=i:(r=0,a=m[0],s=0,l=m[1],c=0,d=m[2]);const h=o.R3.fromValues(r,s,c),f=e.getDirection(),p=f.slice(0,3),v=f.slice(3,6),w=f.slice(6,9),y=e.getSpacing(),[I,x,b]=y,C=e.indexToWorld(h),P=o.R3.fromValues(p[0]*I,p[1]*I,p[2]*I),E=o.R3.fromValues(v[0]*x,v[1]*x,v[2]*x),S=o.R3.fromValues(w[0]*b,w[1]*b,w[2]*b),T=g||u.length/m[2]/m[1]/m[0],M=m[0]*T,A=m[1]*M,R=[],D=o.R3.clone(C);for(let e=c;e<=d;e++){const i=o.R3.clone(D);for(let i=s;i<=l;i++){const s=o.R3.clone(D);for(let s=r;s<=a;s++){const r=[s,i,e];if(t(D,r)){const t=e*A+i*M+s*T;let o;o=T>2?[u[t],u[t+1],u[t+2]]:u[t],R.push({value:o,index:t,pointIJK:r,pointLPS:D.slice()}),n&&n({value:o,index:t,pointIJK:r,pointLPS:D})}o.R3.add(D,D,P)}o.R3.copy(D,s),o.R3.add(D,D,E)}o.R3.copy(D,i),o.R3.add(D,D,S)}return R}},70134:(e,t,n)=>{var o=n(12651);n(72076),n(34603),n(31955),n(87758);const{transformWorldToIndex:i}=o.utilities},5205:(e,t,n)=>{function o(e,t=5){return parseFloat(e[0]).toFixed(t)+","+parseFloat(e[1]).toFixed(t)+","+parseFloat(e[2]).toFixed(t)+","}n.d(t,{s:()=>o})},89977:(e,t,n)=>{n.r(t),n.d(t,{getPoint:()=>i,getPolyDataPointIndexes:()=>r,getPolyDataPoints:()=>a});var o=n(72076);function i(e,t){const n=3*t;if(n<e.length)return o.R3.fromValues(e[n],e[n+1],e[n+2])}function r(e){const t=e.getLines().getData();let n=0;const o=new Map;for(;n<t.length;){const e=t[n++],i=[];for(let o=0;o<e;o++)i.push(t[n+o]);o.set(i[0],i),n+=e}const i=[],r=e=>{for(const[t,n]of e.entries())if(void 0!==n)return t;return-1};let a=r(o);for(;-1!==a;){const e=[a];for(;o.has(a);){const t=o.get(a)[1];o.has(t)&&e.push(t),o.delete(a),a=t}i.push(e),a=r(o)}return i.length?i:void 0}function a(e){const t=r(e);if(!t)return;const n=e.getPoints().getData();return t.map((e=>e.map((e=>i(n,e)))))}},35765:(e,t,n)=>{n(12651),n(64652),n(93341)},78536:(e,t,n)=>{n(35765),n(59941)},59941:(e,t,n)=>{n.d(t,{r:()=>s});var o=n(72076),i=n(12651);const{isEqual:r}=i.utilities,a=[o.R3.fromValues(1,0,0),o.R3.fromValues(0,1,0),o.R3.fromValues(0,0,1)];function s(e){const t=o.R3.subtract(o.R3.create(),e[0],e[1]),n=o.R3.subtract(o.R3.create(),e[0],e[2]);return[...l(t,a),...l(n,a)].every((e=>r(e,0)||r(e,90)||r(e,180)||r(e,270)))}function l(e,t){return t.map((t=>180*o.R3.angle(e,t)/Math.PI))}},63478:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(12651);function i(e,t){if(!(0,o.getEnabledElement)(e.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(e instanceof o.StackViewport&&0===e.getImageIds().length)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:n,delta:i,scrollSlabs:r}=t;e instanceof o.VolumeViewport?function(e,t,n,i=!1){const r=i,{numScrollSteps:a,currentStepIndex:s,sliceRangeInfo:l}=o.utilities.getVolumeViewportScrollInfo(e,t,r);if(!l)return;const{sliceRange:c,spacingInNormalDirection:d,camera:u}=l,{focalPoint:g,viewPlaneNormal:m,position:h}=u,{newFocalPoint:f,newPosition:p}=o.utilities.snapFocalPointToSlice(g,h,c,m,d,n);e.setCamera({focalPoint:f,position:p}),e.render();const v=s+n,w={volumeId:t,viewport:e,delta:n,desiredStepIndex:v,currentStepIndex:s,numScrollSteps:a,currentImageId:e.getCurrentImageId()};(v>a||v<0)&&e.getCurrentImageId()?o.utilities.triggerEvent(o.eventTarget,o.EVENTS.VOLUME_SCROLL_OUT_OF_BOUNDS,w):o.utilities.triggerEvent(o.eventTarget,o.EVENTS.VOLUME_VIEWPORT_SCROLL,w)}(e,n,i,r):e.scroll(i,t.debounceLoading,t.loop)}},7966:(e,t,n)=>{n.d(t,{Z:()=>m});var o=n(12651),i=n(88706),r=n(92472),a=n(28898),s=n(16524),l=n(98806),c=n(82220),d=n(52577);const{uuidv4:u}=o.utilities,g=[l.Z.HandlesUpdated,l.Z.InterpolationUpdated];class m{static{this.toolNames=[]}static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static acceptAutoGenerated(e,t={}){const{toolNames:n,segmentationId:o,segmentIndex:r,sliceIndex:a}=t;for(const t of n||m.toolNames){const n=i.state.getAnnotations(t,e);if(n?.length)for(const e of n){const{interpolationUID:t,data:n,autoGenerated:i,metadata:s}=e;t&&(e.interpolationCompleted=!0),i&&(r&&r!==n.segmentation.segmentIndex||void 0!==a&&s&&a!==s.sliceIndex||o&&o!==n.segmentation.segmentationId||((0,d.D)(e),e.autoGenerated=!1))}}}static{this.handleAnnotationCompleted=e=>{const t=e.detail.annotation;if(!t?.metadata)return;const{toolName:n,originalToolName:o}=t.metadata;if(!this.toolNames.includes(n)&&!this.toolNames.includes(o))return;const i=(0,c.Z)(t);if(!i)return void console.warn("Unable to find viewport for",t);const l={viewport:i,sliceData:h(i),annotation:t,interpolationUID:t.interpolationUID},d=!!t.interpolationUID;if(t.autoGenerated=!1,d)return(0,s.Z)(l),void(0,a.Z)(l);const g=[{key:"segmentIndex",value:t.data.segmentation.segmentIndex,parentKey:e=>e.data.segmentation},{key:"viewPlaneNormal",value:t.metadata.viewPlaneNormal,parentKey:e=>e.metadata},{key:"viewUp",value:t.metadata.viewUp,parentKey:e=>e.metadata}];let m=(0,r.Z)(l,g);const{sliceIndex:f}=t.metadata,p=new Set;m.forEach((e=>{if(e.interpolationCompleted||e.metadata.sliceIndex===f){const{interpolationUID:t}=e;p.add(t)}})),m=m.filter((e=>!p.has(e.interpolationUID))),t.interpolationUID=m[0]?.interpolationUID||u(),l.interpolationUID=t.interpolationUID,(0,a.Z)(l)}}static{this.handleAnnotationUpdate=e=>{const t=e.detail.annotation,{changeType:n=l.Z.HandlesUpdated}=e.detail;if(!t?.metadata)return;const{toolName:o,originalToolName:i}=t.metadata;if(!this.toolNames.includes(o)&&!this.toolNames.includes(i)||!g.includes(n))return;const r=(0,c.Z)(t);if(!r)return void console.warn("Unable to find matching viewport for annotation interpolation",t);t.autoGenerated&&((0,d.D)(t),t.autoGenerated=!1);const s={viewport:r,sliceData:h(r),annotation:t,interpolationUID:t.interpolationUID,isInterpolationUpdate:n===l.Z.InterpolationUpdated};(0,a.Z)(s)}}static{this.handleAnnotationDelete=e=>{const t=e.detail.annotation;if(!t?.metadata)return;const{toolName:n}=t.metadata;if(!this.toolNames.includes(n)||t.autoGenerated)return;const o=(0,c.Z)(t);if(!o)return void console.warn("No viewport, can't delete interpolated results",t);const i={viewport:o,sliceData:h(o),annotation:t,interpolationUID:t.interpolationUID};t.autoGenerated=!1,(0,s.Z)(i)}}}function h(e){return{numberOfSlices:e.getNumberOfSlices(),imageIndex:e.getCurrentImageIdIndex()}}},39427:(e,t,n)=>{n(27078),n(66878),n(12651),n(89776)},78005:(e,t,n)=>{n(27078),n(66878),n(12651),n(89776)},74484:(e,t,n)=>{n(11203);var o=n(74297);n(72076),n(12651);const{Labelmap:i}=o.default},36059:(e,t,n)=>{},10190:(e,t,n)=>{function o(e,t){return new Map(e.map(((e,n)=>[e,t[n]])))}n.d(t,{A:()=>o})},64618:(e,t,n)=>{n(11677),n(12651)},71880:(e,t,n)=>{n(12651)},2680:(e,t,n)=>{function o(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}n.d(t,{Z:()=>i});const i=function(e,t,n={}){const i=n.onFlood,r=n.onBoundary,a=n.equals,s=n.diagonals||!1,l=f(t),c=function(){const e=function(e){const t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))};for(let i=0;i<Math.pow(3,e);i+=1){const r=o(i.toString(3),"0",e);t.push(n(r))}return t}(t.length);return e.filter((function(e){const t=function(e){let t=0;for(let n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}(e);return 0!==t&&(1===t||s)}))}(),d=[],u=[],g=new Set,m=new Map;for(d.push({currentArgs:t});d.length>0;)h(d.pop());return{flooded:u,boundaries:function(){const e=Array.from(m.values());return e.reverse(),e}()};function h(e){const t=e.currentArgs,n=e.previousArgs;(function(e){const[t,n,o=0]=e,i=t+32768+65536*(n+32768+65536*(o+32768));return g.has(i)})(t)||(function(e){const[t,n,o=0]=e,i=t+32768+65536*(n+32768+65536*(o+32768));g.add(i)}(t),function(e){const t=f(e);return a?a(t,l):t===l}(t)?(function(e){u.push(e),i&&i(...e)}(t),function(e){for(let t=0;t<c.length;t+=1){const n=c[t],o=e.slice(0);for(let t=0;t<e.length;t+=1)o[t]+=n[t];d.push({currentArgs:o,previousArgs:e})}}(t)):function(e){const[t,n,o=0]=e,i=t+32768+65536*(n+32768+65536*(o+32768));m.set(i,e),r&&r(...e)}(n))}function f(t){return e(...t)}}},8297:(e,t,n)=>{n(35904),n(74297)},5992:(e,t,n)=>{n.d(t,{P:()=>r});var o=n(50097),i=n(14305);function r(e){const t=(0,i.getSegmentation)(e),{annotationUIDsMap:n}=t.representationData.CONTOUR;for(const[e,t]of n.entries()){if(Array.from(t).find((e=>(0,o.AR)(e).highlighted)))return e}}},50972:(e,t,n)=>{n.d(t,{T:()=>a});var o=n(12651),i=n(14305),r=n(88439);function a(e,t,{viewport:n,searchRadius:a}){const l=(0,i.getSegmentation)(e),c=l.representationData.LABELMAP;if((0,r.y)(c)){const{volumeId:e}=c,i=o.cache.getVolume(e);if(!i)return;const r=i.imageData,l=r.getScalarValueFromWorld(t),d=function(e,t,n,o,i){const r=(t,i)=>{const r=[e[0]+t,e[1]+i],a=n.canvasToWorld(r);return o.getScalarValueFromWorld(a)};return s(r,t,i)}(n.worldToCanvas(t),l,n,r,a);return d?l:void 0}const{imageIdReferenceMap:d}=c,u=n.getCurrentImageId(),g=d.get(u);if(!o.cache.getImage(g))return;const m=(0,i.getSegmentationIdRepresentations)(l.segmentationId),{segmentationRepresentationUID:h}=m[0],f=n.getActor(h),p=f?.actor.getMapper().getInputData(),v=o.utilities.transformWorldToIndex(p,t),w=p.getDimensions(),y=p.voxelManager||o.utilities.VoxelManager.createVolumeVoxelManager(w,p.getPointData().getScalars().getData()),I=y.getAtIJKPoint(v),x=function(e,t,n,o,i){const r=(t,o,i)=>{const r=[e[0]+t,e[1]+o,e[2]+i];return n.getAtIJK(...r)};return s(r,o,i)}(v,0,y,I);return x?I:void 0}function s(e,t,n=1){const o=Array.from({length:2*n+1},((e,t)=>t-n));for(const n of o)for(const i of o)for(const r of o){if(0===n&&0===i&&0===r)continue;const o=e(n,i,r);if(void 0!==o&&t!==o)return!0}return!1}},47138:(e,t,n)=>{n.d(t,{uA:()=>c});var o=n(12651),i=n(68096),r=n(14305),a=n(88439),s=n(50097),l=n(42744);function c(e,t,n={}){const c=(0,r.getSegmentation)(e),d=c.representationData,u=n?.representationType??Object.keys(d)[0];if(!u)throw new Error(`Segmentation ${e} does not have any representations`);switch(u){case i.SegmentationRepresentations.Labelmap:return function(e,t,{viewport:n}){const i=e.representationData.LABELMAP;if((0,a.y)(i)){const{volumeId:e}=i,n=o.cache.getVolume(e);if(!n)return;return n.imageData.getScalarValueFromWorld(t)}const{imageIdReferenceMap:s}=i,l=n.getCurrentImageId(),c=s.get(l);if(!o.cache.getImage(c))return;const d=(0,r.getSegmentationIdRepresentations)(e.segmentationId),{segmentationRepresentationUID:u}=d[0],g=n.getActor(u),m=g?.actor.getMapper().getInputData(),h=o.utilities.transformWorldToIndex(m,t),f=m.getDimensions(),p=m.voxelManager||o.utilities.VoxelManager.createVolumeVoxelManager(f,m.getPointData().getScalars().getData());return p.getAtIJKPoint(h)}(c,t,n);case i.SegmentationRepresentations.Contour:return function(e,t,{viewport:n}){const i=e.representationData.CONTOUR,r=Array.from(i.annotationUIDsMap.keys()),{viewPlaneNormal:a}=n.getCamera();for(const e of r){const n=i.annotationUIDsMap.get(e);if(n)for(const i of n){const n=(0,s.AR)(i);if(!n)continue;const{polyline:r}=n.data.contour;if(o.utilities.isEqual(a,n.metadata.viewPlaneNormal)&&(0,l.isPointInsidePolyline3D)(t,r))return Number(e)}}}(c,t,n);default:return}}},70184:(e,t,n)=>{n.d(t,{createImageIdReferenceMap:()=>i.A,getHoveredContourSegmentationAnnotation:()=>c.P,getSegmentAtLabelmapBorder:()=>l.T,getSegmentAtWorldPoint:()=>s.uA,getUniqueSegmentIndices:()=>a.t7,invalidateBrushCursor:()=>r.C,triggerSegmentationRender:()=>o.ih});n(10018),n(69367),n(71880),n(75702),n(8297),n(64618);var o=n(31131),i=(n(2680),n(39427),n(78005),n(42425),n(10190)),r=(n(74484),n(36059),n(61999),n(4229)),a=n(23267),s=n(47138),l=n(50972),c=n(5992);n(89776)},4229:(e,t,n)=>{n.d(t,{C:()=>s});var o=n(27078),i=n(66878),r=n(12651),a=n(89776);function s(e){const t=(0,o.getToolGroup)(e);if(void 0===t)return;(0,a.Xb)(e).forEach((e=>{e.invalidateBrushCursor()}));const n=t.getViewportsInfo(),s=Object.keys(n).map((e=>n[e]));if(!s.length)return;const{renderingEngineId:l}=s[0],c=t.getViewportIds(),d=(0,r.getRenderingEngine)(l);(0,i.Z)(d,c)}},75702:(e,t,n)=>{n(35904),n(74297)},69367:(e,t,n)=>{n(88706),n(42486),n(10018),n(35765)},61999:(e,t,n)=>{n(12651),n(95482),n(88706),n(85217),n(74484),n(36059),n(56611)},42425:(e,t,n)=>{n(42975),n(32140),n(89776)},10018:(e,t,n)=>{n(42975),n(32140),n(89776)},89776:(e,t,n)=>{n.d(t,{Xb:()=>r});n(12651);var o=n(27078),i=n(95459);n(64652);function r(e,t){const n=(0,o.getToolGroup)(e);if(void 0===n)return;const r=n._toolInstances;if(!Object.keys(r).length)return;if(t&&r[t])return[r[t]];return Object.values(r).filter((e=>e instanceof i.Z))}},2185:(e,t,n)=>{n(12651),n(22446),n(93471);n(42975)},90685:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(82298),i=n(73609);const r=function(e,t,n){let r=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return(0,i.Z)(n)&&(r="leading"in n?Boolean(n.leading):r,a="trailing"in n?Boolean(n.trailing):a),(0,o.Z)(e,t,{leading:r,trailing:a,maxWait:t})}},25068:(e,t,n)=>{function o(e,t){const n=l(e),o=l(t);return{page:d(n.page,o.page),client:d(n.client,o.client),canvas:d(n.canvas,o.canvas),world:(i=n.world,r=o.world,[i[0]-r[0],i[1]-r[1],i[2]-r[2]])};var i,r}function i(e,t){const n=l(e),o=l(t);return{page:g(n.page,o.page),client:g(n.client,o.client),canvas:g(n.canvas,o.canvas),world:m(n.world,o.world)}}function r(e,t){const n=u(e),o=u(t);return{page:n.page-o.page,client:n.client-o.client,canvas:n.canvas-o.canvas,world:n.world-o.world}}function a(e){return JSON.parse(JSON.stringify(e))}function s(e){return JSON.parse(JSON.stringify(e))}function l(e){return e.reduce(((t,n)=>({page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length]})),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function c(e){return e.reduce(((t,n)=>({page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length],touch:{identifier:null,radiusX:t.touch.radiusX+n.touch.radiusX/e.length,radiusY:t.touch.radiusY+n.touch.radiusY/e.length,force:t.touch.force+n.touch.force/e.length,rotationAngle:t.touch.rotationAngle+n.touch.rotationAngle/e.length}})),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function d(e,t){return[e[0]-t[0],e[1]-t[1]]}function u(e){const t=[];for(let n=0;n<e.length;n++)for(let o=0;o<e.length;o++)n<o&&t.push({page:g(e[n].page,e[o].page),client:g(e[n].client,e[o].client),canvas:g(e[n].canvas,e[o].canvas),world:m(e[n].world,e[o].world)});return t.reduce(((e,n)=>({page:e.page+n.page/t.length,client:e.client+n.client/t.length,canvas:e.canvas+n.canvas/t.length,world:e.world+n.world/t.length})),{page:0,client:0,canvas:0,world:0})}function g(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function m(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}n.d(t,{copyPoints:()=>s,copyPointsList:()=>a,getDeltaDistance:()=>i,getDeltaDistanceBetweenIPoints:()=>r,getDeltaPoints:()=>o,getMeanTouchPoints:()=>c})},70180:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(12651),i=n(64307),r=n(27078);const a=function(e){e.forEach((e=>{const t=(0,r.getToolGroup)(e);if(!t)return void console.warn(`ToolGroup not available for ${e}`);t.getViewportsInfo().forEach((e=>{const{renderingEngineId:t,viewportId:n}=e,r=(0,o.getRenderingEngine)(t);if(!r)return void console.warn(`RenderingEngine not available for ${t}`);const a=r.getViewport(n);(0,i.ZP)(a.element)}))}))}},46966:(e,t,n)=>{n.d(t,{filterViewportsWithToolEnabled:()=>l,getViewportIdsWithToolToRender:()=>m});var o=n(33232),i=n(68096);const{Active:r,Passive:a,Enabled:s}=i.ToolModes;function l(e,t){const n=e.length,i=[];for(let r=0;r<n;r++){const n=e[r],a=o.fT.getToolGroupForViewport(n.id,n.renderingEngineId);if(!a)continue;c(a,t)&&i.push(n)}return i}function c(e,t){const{toolOptions:n}=e,o=n[t];if(!o)return!1;const i=o.mode;return i===r||i===a||i===s}var d=n(12651),u=n(72076);const g=function(e,t,n=.999){return e.filter((e=>{const o=e.getCamera();return Math.abs(u.R3.dot(o.viewPlaneNormal,t.viewPlaneNormal))>n}))};function m(e,t,n=!0){const o=(0,d.getEnabledElement)(e),{renderingEngine:i,FrameOfReferenceUID:r}=o;let a=i.getViewports();a=function(e,t){const n=e.length,o=[];for(let i=0;i<n;i++){const n=e[i];n.getFrameOfReferenceUID()===t&&o.push(n)}return o}(a,r),a=l(a,t);const s=i.getViewport(o.viewportId);n&&(a=g(a,s.getCamera()));return a.map((e=>e.id))}},85217:(e,t,n)=>{n(20752),n(68009),n(94451)},20752:(e,t,n)=>{n.d(t,{P:()=>i});var o=n(12651);function i(e,t){if(e instanceof o.BaseVolumeViewport){const e=o.utilities.getVolumeId(t),n=o.cache.getVolume(e);return!!n?.scaling&&Object.keys(n.scaling).length>0}if(e instanceof o.StackViewport){const{preScale:t}=e.getImageData()||{};return!!t?.scaled}return!1}},68009:(e,t,n)=>{n(12651),n(70232),n(63478)},94451:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(12651),i=n(72076);function r(e,t){if(!(e instanceof o.VolumeViewport))return;const{focalPoint:n}=e.getCamera(),r=[0,0,0];return i.R3.sub(r,t,n),function(e,t){const n=e.getCamera(),o=n.viewPlaneNormal,r=i.R3.dot(t,o),a=i.R3.fromValues(o[0],o[1],o[2]);if(i.R3.scale(a,a,r),Math.abs(a[0])>.001||Math.abs(a[1])>.001||Math.abs(a[2])>.001){const t=[0,0,0],o=[0,0,0];i.R3.add(t,n.focalPoint,a),i.R3.add(o,n.position,a),e.setCamera({focalPoint:t,position:o}),e.render()}}(e,r),!0}},53766:(e,t,n)=>{n(72076);var o=n(12651);var i=n(91889);const{clamp:r}=o.utilities;n(57091);i.u.Right},2091:(e,t,n)=>{var o=n(12651);n(53766),n(85217);const{Events:i}=o.Enums},91889:(e,t,n)=>{var o;n.d(t,{u:()=>o}),function(e){e.Top="top",e.Left="left",e.Bottom="bottom",e.Right="right"}(o||(o={}))},57091:(e,t,n)=>{n(91889)},81659:(e,t,n)=>{n(57091),n(53766),n(2091)},54166:(e,t,n)=>{n.d(t,{windowLevel:()=>o});var o={};n.r(o),n.d(o,{calculateMinMaxMean:()=>r,extractWindowLevelRegionToolData:()=>s,getLuminanceFromRegion:()=>i});n(81659);function i(e,t,n,o,i){const r=[];let a=0;const s=e.scalarData;let l,c,d;if(e.color)for(c=0;c<i;c++)for(d=0;d<o;d++){l=4*((c+n)*e.columns+(d+t));const o=s[l],i=s[l+1],u=s[l+2];r[a++]=.2126*o+.7152*i+.0722*u}else for(c=0;c<i;c++)for(d=0;d<o;d++)l=(c+n)*e.columns+(d+t),r[a++]=s[l];return r}function r(e,t,n){const o=e.length;let i=n,r=t,a=0;if(o<2)return{min:i,max:r,mean:(t+n)/2};for(let t=0;t<o;t++){const n=e[t];i=Math.min(i,n),r=Math.max(r,n),a+=n}return{min:i,max:r,mean:a/o}}var a=n(12651);function s(e){if(e instanceof a.VolumeViewport)return function(e){const{scalarData:t,width:n,height:o}=a.utilities.getCurrentVolumeViewportSlice(e),{min:i,max:r}=a.utilities.getMinMax(t),s=e.getVolumeId(),l=a.cache.getVolume(s),{metadata:c,cornerstoneImageMetaData:d}=l,{Rows:u,Columns:g}=c,{color:m}=d;return{scalarData:t,width:n,height:o,minPixelValue:i,maxPixelValue:r,rows:u,columns:g,color:m}}(e);if(e instanceof a.StackViewport)return function(e){const t=e.getImageData(),{scalarData:n}=t,{min:o,max:i}=a.utilities.getMinMax(n),r=t.dimensions[0],s=t.dimensions[1],{rows:l,columns:c,color:d}=e.getCornerstoneImage();return{scalarData:n,width:r,height:s,minPixelValue:o,maxPixelValue:i,rows:l,columns:c,color:d}}(e);throw new Error("Viewport not supported")}},48450:(e,t,n)=>{var o,i=n(28635),r=n(8455),a=n(54131);const s=(o="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,n,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,o){t=e,n=o}));var r,a=Object.assign({},i),s=[],l="./this.program",c=(e,t)=>{throw t},d=!0,u=!1,g="";(d||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),o&&(g=o),g=0!==g.indexOf("blob:")?g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):"",u&&(r=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var m=i.print||console.log.bind(console),h=i.printErr||console.warn.bind(console);Object.assign(i,a),a=null,i.arguments&&(s=i.arguments),i.thisProgram&&(l=i.thisProgram),i.quit&&(c=i.quit);var f,p=4;i.wasmBinary&&(f=i.wasmBinary);var v,w=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&q("no native wasm support detected");var y,I,x,b,C,P,E,S,T,M,A=!1,R="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function D(e,t,n){for(var o=t+n,i=t;e[i]&&!(i>=o);)++i;if(i-t>16&&e.buffer&&R)return R.decode(e.subarray(t,i));for(var r="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var l=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&e[t++])<65536)r+=String.fromCharCode(a);else{var c=a-65536;r+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else r+=String.fromCharCode((31&a)<<6|s)}else r+=String.fromCharCode(a)}return r}function _(e,t){return e?D(b,e,t):""}function L(e,t,n,o){if(!(o>0))return 0;for(var i=n,r=n+o-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(n>=r)break;t[n++]=s}else if(s<=2047){if(n+1>=r)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=r)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=r)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i}function O(e){for(var t=0,n=0;n<e.length;++n){var o=e.charCodeAt(n);o<=127?t++:o<=2047?t+=2:o>=55296&&o<=57343?(t+=4,++n):t+=3}return t}function V(e){I=e,i.HEAP8=x=new Int8Array(e),i.HEAP16=C=new Int16Array(e),i.HEAP32=E=new Int32Array(e),i.HEAPU8=b=new Uint8Array(e),i.HEAPU16=P=new Uint16Array(e),i.HEAPU32=S=new Uint32Array(e),i.HEAPF32=T=new Float32Array(e),i.HEAPF64=M=new Float64Array(e)}i.INITIAL_MEMORY;var N,k=[],U=[],B=[],F=[],Z=0,W=null,j=null;function q(e){i.onAbort&&i.onAbort(e),h(e="Aborted("+e+")"),A=!0,y=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}var z,G,H="data:application/octet-stream;base64,";function $(e){return e.startsWith(H)}function Y(e){try{if(e==z&&f)return new Uint8Array(f);if(r)return r(e);throw"both async and sync fetching of the wasm failed"}catch(e){q(e)}}$(z="ICRPolySeg.wasm")||(G=z,z=i.locateFile?i.locateFile(G,g):g+G);var K={638383:e=>{i.updateProgress&&i.updateProgress(e)}};function X(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function J(e){for(;e.length>0;)e.shift()(i)}function Q(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){S[this.ptr+4>>2]=e},this.get_type=function(){return S[this.ptr+4>>2]},this.set_destructor=function(e){S[this.ptr+8>>2]=e},this.get_destructor=function(){return S[this.ptr+8>>2]},this.set_refcount=function(e){E[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,x[this.ptr+12|0]=e},this.get_caught=function(){return 0!=x[this.ptr+12|0]},this.set_rethrown=function(e){e=e?1:0,x[this.ptr+13|0]=e},this.get_rethrown=function(){return 0!=x[this.ptr+13|0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=E[this.ptr>>2];E[this.ptr>>2]=e+1},this.release_ref=function(){var e=E[this.ptr>>2];return E[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){S[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return S[this.ptr+16>>2]},this.get_exception_ptr=function(){if(ht(this.get_type()))return S[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}var ee={varargs:void 0,get:function(){return ee.varargs+=4,E[ee.varargs-4>>2]},getStr:function(e){return _(e)}},te={};function ne(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function oe(e){return this.fromWireType(E[e>>2])}var ie={},re={},ae={},se=48,le=57;function ce(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=se&&t<=le?"_"+e:e}function de(e,t){return e=ce(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function ue(e,t){var n=de(t,(function(e){this.name=t,this.message=e;var n=new Error(e).stack;void 0!==n&&(this.stack=this.toString()+"\n"+n.replace(/^Error(:[^\n]*)?\n/,""))}));return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var ge=void 0;function me(e){throw new ge(e)}function he(e,t,n){function o(t){var o=n(t);o.length!==e.length&&me("Mismatched type converter count");for(var i=0;i<e.length;++i)Ie(e[i],o[i])}e.forEach((function(e){ae[e]=t}));var i=new Array(t.length),r=[],a=0;t.forEach(((e,t)=>{re.hasOwnProperty(e)?i[t]=re[e]:(r.push(e),ie.hasOwnProperty(e)||(ie[e]=[]),ie[e].push((()=>{i[t]=re[e],++a===r.length&&o(i)})))})),0===r.length&&o(i)}function fe(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var pe=void 0;function ve(e){for(var t="",n=e;b[n];)t+=pe[b[n++]];return t}var we=void 0;function ye(e){throw new we(e)}function Ie(e,t,n={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var o=t.name;if(e||ye('type "'+o+'" must have a positive integer typeid pointer'),re.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;ye("Cannot register type '"+o+"' twice")}if(re[e]=t,delete ae[e],ie.hasOwnProperty(e)){var i=ie[e];delete ie[e],i.forEach((e=>e()))}}var xe=[],be=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ce(e){e>4&&0==--be[e].refcount&&(be[e]=void 0,xe.push(e))}function Pe(){for(var e=0,t=5;t<be.length;++t)void 0!==be[t]&&++e;return e}function Ee(){for(var e=5;e<be.length;++e)if(void 0!==be[e])return be[e];return null}var Se={toValue:e=>(e||ye("Cannot use deleted val. handle = "+e),be[e].value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=xe.length?xe.pop():be.length;return be[t]={refcount:1,value:e},t}}};function Te(e,t){switch(t){case 2:return function(e){return this.fromWireType(T[e>>2])};case 3:return function(e){return this.fromWireType(M[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Me(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var n=de(e.name||"unknownFunctionName",(function(){}));n.prototype=e.prototype;var o=new n,i=e.apply(o,t);return i instanceof Object?i:o}function Ae(e,t,n){i.hasOwnProperty(e)?((void 0===n||void 0!==i[e].overloadTable&&void 0!==i[e].overloadTable[n])&&ye("Cannot register public name '"+e+"' twice"),function(e,t,n){if(void 0===e[t].overloadTable){var o=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ye("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[o.argCount]=o}}(i,e,e),i.hasOwnProperty(n)&&ye("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),i[e].overloadTable[n]=t):(i[e]=t,void 0!==n&&(i[e].numArguments=n))}var Re=[];function De(e){var t=Re[e];return t||(e>=Re.length&&(Re.length=e+1),Re[e]=t=N.get(e)),t}function _e(e,t,n){return e.includes("j")?function(e,t,n){var o=i["dynCall_"+e];return n&&n.length?o.apply(null,[t].concat(n)):o.call(null,t)}(e,t,n):De(t).apply(null,n)}function Le(e,t){var n,o,i,r=(e=ve(e)).includes("j")?(n=e,o=t,i=[],function(){return i.length=0,Object.assign(i,arguments),_e(n,o,i)}):De(t);return"function"!=typeof r&&ye("unknown function pointer with signature "+e+": "+t),r}var Oe=void 0;function Ve(e){var t=mt(e),n=ve(t);return gt(t),n}function Ne(e,t,n){switch(t){case 0:return n?function(e){return x[e]}:function(e){return b[e]};case 1:return n?function(e){return C[e>>1]}:function(e){return P[e>>1]};case 2:return n?function(e){return E[e>>2]}:function(e){return S[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var ke="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function Ue(e,t){for(var n=e,o=n>>1,i=o+t/2;!(o>=i)&&P[o];)++o;if((n=o<<1)-e>32&&ke)return ke.decode(b.subarray(e,n));for(var r="",a=0;!(a>=t/2);++a){var s=C[e+2*a>>1];if(0==s)break;r+=String.fromCharCode(s)}return r}function Be(e,t,n){if(void 0===n&&(n=2147483647),n<2)return 0;for(var o=t,i=(n-=2)<2*e.length?n/2:e.length,r=0;r<i;++r){var a=e.charCodeAt(r);C[t>>1]=a,t+=2}return C[t>>1]=0,t-o}function Fe(e){return 2*e.length}function Ze(e,t){for(var n=0,o="";!(n>=t/4);){var i=E[e+4*n>>2];if(0==i)break;if(++n,i>=65536){var r=i-65536;o+=String.fromCharCode(55296|r>>10,56320|1023&r)}else o+=String.fromCharCode(i)}return o}function We(e,t,n){if(void 0===n&&(n=2147483647),n<4)return 0;for(var o=t,i=o+n-4,r=0;r<e.length;++r){var a=e.charCodeAt(r);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++r)),E[t>>2]=a,(t+=4)+4>i)break}return E[t>>2]=0,t-o}function je(e){for(var t=0,n=0;n<e.length;++n){var o=e.charCodeAt(n);o>=55296&&o<=57343&&++n,t+=4}return t}function qe(e,t){var n=re[e];return void 0===n&&ye(t+" has unknown type "+Ve(e)),n}var ze={};function Ge(e){var t=ze[e];return void 0===t?ve(e):t}var He=[];function $e(){return"object"==typeof globalThis?globalThis:Function("return this")()}var Ye=[],Ke={},Xe=[];function Je(e,t,n){var o=function(e,t){var n;for(Xe.length=0,t>>=2;n=b[e++];)t+=105!=n&t,Xe.push(105==n?E[t]:M[t++>>1]),++t;return Xe}(t,n);return K[e].apply(null,o)}function Qe(e){try{return v.grow(e-I.byteLength+65535>>>16),V(v.buffer),1}catch(e){}}var et={};function tt(){if(!tt.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in et)void 0===et[t]?delete e[t]:e[t]=et[t];var n=[];for(var t in e)n.push(t+"="+e[t]);tt.strings=n}return tt.strings}var nt=[null,[],[]];function ot(e,t){var n=nt[e];0===t||10===t?((1===e?m:h)(D(n,0)),n.length=0):n.push(t)}function it(e){return e%4==0&&(e%100!=0||e%400==0)}var rt=[31,29,31,30,31,30,31,31,30,31,30,31],at=[31,28,31,30,31,30,31,31,30,31,30,31];function st(e,t,n,o){var i=E[o+40>>2],r={tm_sec:E[o>>2],tm_min:E[o+4>>2],tm_hour:E[o+8>>2],tm_mday:E[o+12>>2],tm_mon:E[o+16>>2],tm_year:E[o+20>>2],tm_wday:E[o+24>>2],tm_yday:E[o+28>>2],tm_isdst:E[o+32>>2],tm_gmtoff:E[o+36>>2],tm_zone:i?_(i):""},a=_(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in s)a=a.replace(new RegExp(l,"g"),s[l]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=["January","February","March","April","May","June","July","August","September","October","November","December"];function u(e,t,n){for(var o="number"==typeof e?e.toString():e||"";o.length<t;)o=n[0]+o;return o}function g(e,t){return u(e,t,"0")}function m(e,t){function n(e){return e<0?-1:e>0?1:0}var o;return 0===(o=n(e.getFullYear()-t.getFullYear()))&&0===(o=n(e.getMonth()-t.getMonth()))&&(o=n(e.getDate()-t.getDate())),o}function h(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function f(e){var t=function(e,t){for(var n=new Date(e.getTime());t>0;){var o=it(n.getFullYear()),i=n.getMonth(),r=(o?rt:at)[i];if(!(t>r-n.getDate()))return n.setDate(n.getDate()+t),n;t-=r-n.getDate()+1,n.setDate(1),i<11?n.setMonth(i+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),o=new Date(t.getFullYear()+1,0,4),i=h(n),r=h(o);return m(i,t)<=0?m(r,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var p={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return d[e.tm_mon].substring(0,3)},"%B":function(e){return d[e.tm_mon]},"%C":function(e){return g((e.tm_year+1900)/100|0,2)},"%d":function(e){return g(e.tm_mday,2)},"%e":function(e){return u(e.tm_mday,2," ")},"%g":function(e){return f(e).toString().substring(2)},"%G":function(e){return f(e)},"%H":function(e){return g(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),g(t,2)},"%j":function(e){return g(e.tm_mday+function(e,t){for(var n=0,o=0;o<=t;n+=e[o++]);return n}(it(e.tm_year+1900)?rt:at,e.tm_mon-1),3)},"%m":function(e){return g(e.tm_mon+1,2)},"%M":function(e){return g(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return g(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return g(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var n=(e.tm_wday+371-e.tm_yday)%7;4==n||3==n&&it(e.tm_year)||(t=1)}}else{t=52;var o=(e.tm_wday+7-e.tm_yday-1)%7;(4==o||5==o&&it(e.tm_year%400-1))&&t++}return g(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return g(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in a=a.replace(/%%/g,"\0\0"),p)a.includes(l)&&(a=a.replace(new RegExp(l,"g"),p[l](r)));a=a.replace(/\0\0/g,"%");var v,w,y,I,b,C,P=(v=a,w=!1,I=y>0?y:O(v)+1,b=new Array(I),C=L(v,b,0,b.length),w&&(b.length=C),b);return P.length>t?0:(function(e,t){x.set(e,t)}(P,e),P.length-1)}function lt(e){y=e,w||(i.onExit&&i.onExit(e),A=!0),c(e,new X(e))}ge=i.InternalError=ue(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);pe=e}(),we=i.BindingError=ue(Error,"BindingError"),i.count_emval_handles=Pe,i.get_first_emval=Ee,Oe=i.UnboundTypeError=ue(Error,"UnboundTypeError");var ct,dt={b:function(e,t,n){throw new Q(e).init(t,n),e},J:function(e,t){},F:function(e,t,n){},L:function(e,t,n,o){ee.varargs=o},E:function(e,t,n,o){},G:function(e,t){},x:function(e){var t=te[e];delete te[e];var n=t.rawConstructor,o=t.rawDestructor,i=t.fields;he([e],i.map((e=>e.getterReturnType)).concat(i.map((e=>e.setterArgumentType))),(e=>{var r={};return i.forEach(((t,n)=>{var o=t.fieldName,a=e[n],s=t.getter,l=t.getterContext,c=e[n+i.length],d=t.setter,u=t.setterContext;r[o]={read:e=>a.fromWireType(s(l,e)),write:(e,t)=>{var n=[];d(u,e,c.toWireType(n,t)),ne(n)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var n in r)t[n]=r[n].read(e);return o(e),t},toWireType:function(e,t){for(var i in r)if(!(i in t))throw new TypeError('Missing field:  "'+i+'"');var a=n();for(i in r)r[i].write(a,t[i]);return null!==e&&e.push(o,a),a},argPackAdvance:8,readValueFromPointer:oe,destructorFunction:o}]}))},A:function(e,t,n,o,i){},O:function(e,t,n,o,i){var r=fe(n);Ie(e,{name:t=ve(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?o:i},argPackAdvance:8,readValueFromPointer:function(e){var o;if(1===n)o=x;else if(2===n)o=C;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);o=E}return this.fromWireType(o[e>>r])},destructorFunction:null})},N:function(e,t){Ie(e,{name:t=ve(t),fromWireType:function(e){var t=Se.toValue(e);return Ce(e),t},toWireType:function(e,t){return Se.toHandle(t)},argPackAdvance:8,readValueFromPointer:oe,destructorFunction:null})},v:function(e,t,n){var o=fe(n);Ie(e,{name:t=ve(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:Te(t,o),destructorFunction:null})},g:function(e,t,n,o,r,a){var s=function(e,t){for(var n=[],o=0;o<e;o++)n.push(S[t+4*o>>2]);return n}(t,n);e=ve(e),r=Le(o,r),Ae(e,(function(){!function(e,t){var n=[],o={};throw t.forEach((function e(t){o[t]||re[t]||(ae[t]?ae[t].forEach(e):(n.push(t),o[t]=!0))})),new Oe(e+": "+n.map(Ve).join([", "]))}("Cannot call "+e+" due to unbound types",s)}),t-1),he([],s,(function(n){var o=[n[0],null].concat(n.slice(1));return function(e,t,n){i.hasOwnProperty(e)||me("Replacing nonexistant public symbol"),void 0!==i[e].overloadTable&&void 0!==n?i[e].overloadTable[n]=t:(i[e]=t,i[e].argCount=n)}(e,function(e,t,n,o,i){var r=t.length;r<2&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==n,s=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){s=!0;break}var c="void"!==t[0].name,d="",u="";for(l=0;l<r-2;++l)d+=(0!==l?", ":"")+"arg"+l,u+=(0!==l?", ":"")+"arg"+l+"Wired";var g="return function "+ce(e)+"("+d+") {\nif (arguments.length !== "+(r-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(r-2)+" args!');\n}\n";s&&(g+="var destructors = [];\n");var m=s?"destructors":"null",h=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[ye,o,i,ne,t[0],t[1]];for(a&&(g+="var thisWired = classParam.toWireType("+m+", this);\n"),l=0;l<r-2;++l)g+="var arg"+l+"Wired = argType"+l+".toWireType("+m+", arg"+l+"); // "+t[l+2].name+"\n",h.push("argType"+l),f.push(t[l+2]);if(a&&(u="thisWired"+(u.length>0?", ":"")+u),g+=(c?"var rv = ":"")+"invoker(fn"+(u.length>0?", ":"")+u+");\n",s)g+="runDestructors(destructors);\n";else for(l=a?1:2;l<t.length;++l){var p=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(g+=p+"_dtor("+p+"); // "+t[l].name+"\n",h.push(p+"_dtor"),f.push(t[l].destructorFunction))}return c&&(g+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),g+="}\n",h.push(g),Me(Function,h).apply(null,f)}(e,o,null,r,a),t-1),[]}))},d:function(e,t,n,o,i){t=ve(t),-1===i&&(i=4294967295);var r=fe(n),a=e=>e;if(0===o){var s=32-8*n;a=e=>e<<s>>>s}var l=t.includes("unsigned");Ie(e,{name:t,fromWireType:a,toWireType:l?function(e,t){return this.name,t>>>0}:function(e,t){return this.name,t},argPackAdvance:8,readValueFromPointer:Ne(t,r,0!==o),destructorFunction:null})},c:function(e,t,n){var o=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=S,n=t[e>>=2],i=t[e+1];return new o(I,i,n)}Ie(e,{name:n=ve(n),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},u:function(e,t){var n="std::string"===(t=ve(t));Ie(e,{name:t,fromWireType:function(e){var t,o=S[e>>2],i=e+4;if(n)for(var r=i,a=0;a<=o;++a){var s=i+a;if(a==o||0==b[s]){var l=_(r,s-r);void 0===t?t=l:(t+=String.fromCharCode(0),t+=l),r=s+1}}else{var c=new Array(o);for(a=0;a<o;++a)c[a]=String.fromCharCode(b[i+a]);t=c.join("")}return gt(e),t},toWireType:function(e,t){var o;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ye("Cannot pass non-string to std::string"),o=n&&i?O(t):t.length;var r=ut(4+o+1),a=r+4;if(S[r>>2]=o,n&&i)L(t,b,a,o+1);else if(i)for(var s=0;s<o;++s){var l=t.charCodeAt(s);l>255&&(gt(a),ye("String has UTF-16 code units that do not fit in 8 bits")),b[a+s]=l}else for(s=0;s<o;++s)b[a+s]=t[s];return null!==e&&e.push(gt,r),r},argPackAdvance:8,readValueFromPointer:oe,destructorFunction:function(e){gt(e)}})},m:function(e,t,n){var o,i,r,a,s;n=ve(n),2===t?(o=Ue,i=Be,a=Fe,r=()=>P,s=1):4===t&&(o=Ze,i=We,a=je,r=()=>S,s=2),Ie(e,{name:n,fromWireType:function(e){for(var n,i=S[e>>2],a=r(),l=e+4,c=0;c<=i;++c){var d=e+4+c*t;if(c==i||0==a[d>>s]){var u=o(l,d-l);void 0===n?n=u:(n+=String.fromCharCode(0),n+=u),l=d+t}}return gt(e),n},toWireType:function(e,o){"string"!=typeof o&&ye("Cannot pass non-string to C++ string type "+n);var r=a(o),l=ut(4+r+t);return S[l>>2]=r>>s,i(o,l+4,r+t),null!==e&&e.push(gt,l),l},argPackAdvance:8,readValueFromPointer:oe,destructorFunction:function(e){gt(e)}})},y:function(e,t,n,o,i,r){te[e]={name:ve(t),rawConstructor:Le(n,o),rawDestructor:Le(i,r),fields:[]}},e:function(e,t,n,o,i,r,a,s,l,c){te[e].fields.push({fieldName:ve(t),getterReturnType:n,getter:Le(o,i),getterContext:r,setterArgumentType:a,setter:Le(s,l),setterContext:c})},P:function(e,t){Ie(e,{isVoid:!0,name:t=ve(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},r:function(e,t,n){e=Se.toValue(e),t=qe(t,"emval::as");var o=[],i=Se.toHandle(o);return S[n>>2]=i,t.toWireType(o,e)},i:function(e,t,n,o){(e=He[e])(t=Se.toValue(t),n=Ge(n),null,o)},a:Ce,p:function(e){return 0===e?Se.toHandle($e()):(e=Ge(e),Se.toHandle($e()[e]))},j:function(e,t){var n=function(e,t){for(var n=new Array(e),o=0;o<e;++o)n[o]=qe(S[t+o*p>>2],"parameter "+o);return n}(e,t),o=n[0],i=o.name+"_$"+n.slice(1).map((function(e){return e.name})).join("_")+"$",r=Ye[i];if(void 0!==r)return r;for(var a=["retType"],s=[o],l="",c=0;c<e-1;++c)l+=(0!==c?", ":"")+"arg"+c,a.push("argType"+c),s.push(n[1+c]);var d="return function "+ce("methodCaller_"+i)+"(handle, name, destructors, args) {\n",u=0;for(c=0;c<e-1;++c)d+="    var arg"+c+" = argType"+c+".readValueFromPointer(args"+(u?"+"+u:"")+");\n",u+=n[c+1].argPackAdvance;for(d+="    var rv = handle[name]("+l+");\n",c=0;c<e-1;++c)n[c+1].deleteObject&&(d+="    argType"+c+".deleteObject(arg"+c+");\n");o.isVoid||(d+="    return retType.toWireType(destructors, rv);\n"),d+="};\n",a.push(d);var g,m,h=Me(Function,a).apply(null,s);return g=h,m=He.length,He.push(g),r=m,Ye[i]=r,r},s:function(e,t){return e=Se.toValue(e),t=Se.toValue(t),Se.toHandle(e[t])},f:function(e){e>4&&(be[e].refcount+=1)},o:function(e,t,n,o){e=Se.toValue(e);var r=Ke[t];return r||(r=function(e){for(var t="",n=0;n<e;++n)t+=(0!==n?", ":"")+"arg"+n;var o="return function emval_allocator_"+e+"(constructor, argTypes, args) {\n  var HEAPU32 = getMemory();\n";for(n=0;n<e;++n)o+="var argType"+n+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+n+"');\nvar arg"+n+" = argType"+n+".readValueFromPointer(args);\nargs += argType"+n+"['argPackAdvance'];\nargTypes += 4;\n";return o+="var obj = new constructor("+t+");\nreturn valueToHandle(obj);\n}\n",new Function("requireRegisteredType","Module","valueToHandle","getMemory",o)(qe,i,Se.toHandle,(()=>S))}(t),Ke[t]=r),r(e,n,o)},w:function(e){return Se.toHandle(Ge(e))},q:function(e){ne(Se.toValue(e)),Ce(e)},k:function(e,t){var n=(e=qe(e,"_emval_take_value")).readValueFromPointer(t);return Se.toHandle(n)},n:function(){q("")},h:function(e,t,n){return Je(e,t,n)},D:function(){return 2147483648},M:function(e,t,n){b.copyWithin(e,t,t+n)},C:function(e){var t,n,o=b.length,i=2147483648;if((e>>>=0)>i)return!1;for(var r=1;r<=4;r*=2){var a=o*(1+.2/r);if(a=Math.min(a,e+100663296),Qe(Math.min(i,(t=Math.max(e,a))+((n=65536)-t%n)%n)))return!0}return!1},H:function(e,t){var n=0;return tt().forEach((function(o,i){var r=t+n;S[e+4*i>>2]=r,function(e,t,n){for(var o=0;o<e.length;++o)x[0|t++]=e.charCodeAt(o);n||(x[0|t]=0)}(o,r),n+=o.length+1})),0},I:function(e,t){var n=tt();S[e>>2]=n.length;var o=0;return n.forEach((function(e){o+=e.length+1})),S[t>>2]=o,0},l:function(e){return 52},K:function(e,t,n,o){return 52},z:function(e,t,n,o,i){return 70},t:function(e,t,n,o){for(var i=0,r=0;r<n;r++){var a=S[t>>2],s=S[t+4>>2];t+=8;for(var l=0;l<s;l++)ot(e,b[a+l]);i+=s}return S[o>>2]=i,0},B:function(e,t,n,o,i){return st(e,t,n,o)}},ut=(function(){var e={a:dt};function t(e,t){var n,o=e.exports;i.asm=o,V((v=i.asm.Q).buffer),N=i.asm.T,n=i.asm.R,U.unshift(n),function(e){if(Z--,i.monitorRunDependencies&&i.monitorRunDependencies(Z),0==Z&&(null!==W&&(clearInterval(W),W=null),j)){var t=j;j=null,t()}}()}function o(e){t(e.instance)}function r(t){return(f||!d&&!u||"function"!=typeof fetch?Promise.resolve().then((function(){return Y(z)})):fetch(z,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+z+"'";return e.arrayBuffer()})).catch((function(){return Y(z)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){h("failed to asynchronously prepare wasm: "+e),q(e)}))}if(Z++,i.monitorRunDependencies&&i.monitorRunDependencies(Z),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(e){h("Module.instantiateWasm callback failed with error: "+e),n(e)}(f||"function"!=typeof WebAssembly.instantiateStreaming||$(z)||"function"!=typeof fetch?r(o):fetch(z,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(o,(function(e){return h("wasm streaming compile failed: "+e),h("falling back to ArrayBuffer instantiation"),r(o)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.R).apply(null,arguments)},i._main=function(){return(i._main=i.asm.S).apply(null,arguments)},i._malloc=function(){return(ut=i._malloc=i.asm.U).apply(null,arguments)}),gt=i._free=function(){return(gt=i._free=i.asm.V).apply(null,arguments)},mt=i.___getTypeName=function(){return(mt=i.___getTypeName=i.asm.W).apply(null,arguments)},ht=(i.__embind_initialize_bindings=function(){return(i.__embind_initialize_bindings=i.asm.X).apply(null,arguments)},i.___cxa_is_pointer_type=function(){return(ht=i.___cxa_is_pointer_type=i.asm.Y).apply(null,arguments)});function ft(e){var t,n=i._main;try{var o=n(0,0);return y=t=o,lt(t),o}catch(e){return function(e){if(e instanceof X||"unwind"==e)return y;c(1,e)}(e)}}function pt(e){function n(){ct||(ct=!0,i.calledRun=!0,A||(J(U),J(B),t(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),vt&&ft(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),F.unshift(e);var e;J(F)}()))}e=e||s,Z>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),k.unshift(e);var e;J(k)}(),Z>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),n()}),1)):n()))}if(i.dynCall_viij=function(){return(i.dynCall_viij=i.asm.Z).apply(null,arguments)},i.dynCall_vij=function(){return(i.dynCall_vij=i.asm._).apply(null,arguments)},i.dynCall_iij=function(){return(i.dynCall_iij=i.asm.$).apply(null,arguments)},i.dynCall_viji=function(){return(i.dynCall_viji=i.asm.aa).apply(null,arguments)},i.dynCall_jiji=function(){return(i.dynCall_jiji=i.asm.ba).apply(null,arguments)},i.dynCall_viijii=function(){return(i.dynCall_viijii=i.asm.ca).apply(null,arguments)},i.dynCall_iiiiij=function(){return(i.dynCall_iiiiij=i.asm.da).apply(null,arguments)},i.dynCall_iiiiijj=function(){return(i.dynCall_iiiiijj=i.asm.ea).apply(null,arguments)},i.dynCall_iiiiiijj=function(){return(i.dynCall_iiiiiijj=i.asm.fa).apply(null,arguments)},i.___start_em_js=638316,i.___stop_em_js=638383,j=function e(){ct||pt(),ct||(j=e)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();var vt=!0;return i.noInitialRun&&(vt=!1),pt(),e.ready}),l=n.p+"17dd54813d5acc10bf8f.wasm";class c{constructor(){this._instance}get instance(){if(this._instance)return this._instance;throw new Error("ICRPolySeg is not initialized.")}async initialize(e={}){this._instance=await s({locateFile:e=>e.endsWith(".wasm")?l:e,...e})}}var d=n(12651),u=n(3969),g=n(1299),m=n(68470);const h={Forward:1,Backward:-1},f=new Set;const p={};function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,p,n),m.m.obj(e,t),m.m.algo(e,t,1,1),function(e,t){e.requestData=(t,n)=>{const[o]=t;n[0]||(n[0]=g.ZP.newInstance());const[i]=n;e.extractContours(o,i),i.modified()},e.traverseLoop=(e,t,n,o,i)=>{let r=n,a=o,s=!1,l=0;for(;!s;){const{cellPointIds:n}=e.getCellPoints(r);if(!n)continue;a=n[0]!==a?n[0]:n[1],l++;const c=t*l;i.push({t:c,ptId:a});const d=e.getPointCells(a);if(2!==d.length||a===o)return a;2===d.length?(r=d[0]!==r?d[0]:d[1],f.add(r)):s=!0}return a},e.extractContours=(t,n)=>{const o=[];f.clear();const i=t.getLines();n.getPoints().setData(Float32Array.from(t.getPoints().getData()));for(let n=0;n<i.getNumberOfCells();n++){if(f.has(n))continue;const{cellPointIds:i}=t.getCellPoints(n);if(!i)continue;f.add(n);const r=i[0],a=[];a.push({t:0,ptId:r}),r!==e.traverseLoop(t,h.Forward,n,r,a)&&(e.traverseLoop(t,h.Backward,n,r,a),a.sort(((e,t)=>e.t<t.t?-1:1)),a.length&&a[0].ptId!==a[a.length-1]?.ptId&&a.push({...a[a.length-1]})),a.length&&o.push(a)}const r=n.getLines();r.resize(0),o.forEach((e=>{r.insertNextCell(e.map((e=>e.ptId)))}))}}(e)}var w={newInstance:m.m.newInstance(v,"vtkContourLoopExtraction"),extend:v},y=n(2755),I=n(87758),x=n(42975),b=n(42744),C=n(44037);const P={polySeg:null,polySegInitializing:!1,polySegInitializingPromise:null,async initializePolySeg(e){this.polySegInitializing?await this.polySegInitializingPromise:this.polySeg?.instance||(this.polySegInitializing=!0,this.polySegInitializingPromise=new Promise((t=>{this.polySeg=new c,this.polySeg.initialize({updateProgress:e}).then((()=>{this.polySegInitializing=!1,t()}))})),await this.polySegInitializingPromise)},async convertContourToSurface(e,...t){const{polylines:n,numPointsArray:o}=e,[i]=t;await this.initializePolySeg(i);return await this.polySeg.instance.convertContourRoiToSurface(n,o)},async convertLabelmapToSurface(e,...t){const[n]=t;await this.initializePolySeg(n);return this.polySeg.instance.convertLabelmapToSurface(e.scalarData,e.dimensions,e.spacing,e.direction,e.origin,[e.segmentIndex])},async convertContourToVolumeLabelmap(e,...t){const[n]=t,o=await new c;await o.initialize({updateProgress:n});const{segmentIndices:i,scalarData:s,annotationUIDsInSegmentMap:l,dimensions:u,origin:g,direction:m,spacing:h}=e,f=d.utilities.VoxelManager.createVolumeVoxelManager(u,s),p=r.ZP.newInstance();p.setDimensions(u),p.setOrigin(g),p.setDirection(m),p.setSpacing(h);const v=a.default.newInstance({name:"Pixels",numberOfComponents:1,values:s});p.getPointData().setScalars(v),p.modified();for(const e of i){const t=l.get(e);for(const n of t){if(!n.polyline)continue;const{polyline:t,holesPolyline:o}=n,i=(0,I.getBoundingBoxAroundShapeWorld)(t),[r,a,s]=d.utilities.transformWorldToIndex(p,[i[0][0],i[1][0],i[2][0]]),[l,c,u]=d.utilities.transformWorldToIndex(p,[i[0][1],i[1][1],i[2][1]]),{projectedPolyline:g,sharedDimensionIndex:m}=(0,b.projectTo2D)(t),h=o?.map((e=>{const{projectedPolyline:t}=(0,b.projectTo2D)(e);return t})),v=(m+1)%3,w=(m+2)%3;(0,x.pointInShapeCallback)(p,(e=>{const t=[e[v],e[w]];return(0,b.containsPoint)(g,t,{holes:h})}),(({pointIJK:t})=>{f.setAtIJKPoint(t,e)}),[[r,l],[a,c],[s,u]])}}return f.scalarData},async convertContourToStackLabelmap(e,...t){const[n]=t,o=await new c;await o.initialize({updateProgress:n});const{segmentationsInfo:i,annotationUIDsInSegmentMap:s,segmentIndices:l}=e,u=new Map;i.forEach(((e,t)=>{const{dimensions:n,scalarData:o,direction:i,spacing:s,origin:l}=e,c=d.utilities.VoxelManager.createVolumeVoxelManager(n,o),g=r.ZP.newInstance();g.setDimensions(n),g.setOrigin(l),g.setDirection(i),g.setSpacing(s);const m=a.default.newInstance({name:"Pixels",numberOfComponents:1,values:o});g.getPointData().setScalars(m),g.modified(),u.set(t,{manager:c,imageData:g})}));for(const e of l){const t=s.get(e);for(const n of t){if(!n.polyline)continue;const{polyline:t,holesPolyline:o,referencedImageId:i}=n,r=(0,I.getBoundingBoxAroundShapeWorld)(t),{manager:a,imageData:s}=u.get(i),[l,c,g]=d.utilities.transformWorldToIndex(s,[r[0][0],r[1][0],r[2][0]]),[m,h,f]=d.utilities.transformWorldToIndex(s,[r[0][1],r[1][1],r[2][1]]),{projectedPolyline:p,sharedDimensionIndex:v}=(0,b.projectTo2D)(t),w=o?.map((e=>{const{projectedPolyline:t}=(0,b.projectTo2D)(e);return t})),y=(v+1)%3,C=(v+2)%3;(0,x.pointInShapeCallback)(s,(e=>{const t=[e[y],e[C]];return(0,b.containsPoint)(p,t,{holes:w})}),(({pointIJK:t})=>{a.setAtIJKPoint(t,e)}),[[l,m],[c,h],[g,f]])}}return i.forEach(((e,t)=>{const{manager:n}=u.get(t);e.scalarData=n.scalarData})),i},async convertSurfaceToVolumeLabelmap(e,...t){const[n]=t;await this.initializePolySeg(n);return this.polySeg.instance.convertSurfaceToLabelmap(e.points,e.polys,e.dimensions,e.spacing,e.direction,e.origin)},async convertSurfacesToVolumeLabelmap(e,...t){const[n]=t;await this.initializePolySeg(n);const{segmentsInfo:o}=e,i=Array.from(o.keys()).map((t=>{const{points:n,polys:i}=o.get(t);return{...this.polySeg.instance.convertSurfaceToLabelmap(n,i,e.dimensions,e.spacing,e.direction,e.origin),segmentIndex:t}})),s=await Promise.all(i),l=r.ZP.newInstance();l.setDimensions(e.dimensions),l.setOrigin(e.origin),l.setSpacing(e.spacing),l.setDirection(e.direction);const c=e.dimensions[0]*e.dimensions[1]*e.dimensions[2],u=a.default.newInstance({name:"Pixels",numberOfComponents:1,values:new Uint8Array(c)});l.getPointData().setScalars(u),l.modified();const g=d.utilities.VoxelManager.createVolumeVoxelManager(e.dimensions,l.getPointData().getScalars().getData()),m=s.map((e=>{const{data:t,dimensions:n,direction:o,origin:i,spacing:s}=e,l=r.ZP.newInstance();l.setDimensions(n),l.setOrigin(i),l.setSpacing(s),l.setDirection(o);const c=a.default.newInstance({name:"Pixels",numberOfComponents:1,values:t});l.getPointData().setScalars(c),l.modified();const u=d.utilities.VoxelManager.createVolumeVoxelManager(n,t),g=l.getExtent();return{volume:l,voxelManager:u,extent:g,scalarData:t,segmentIndex:e.segmentIndex}}));return(0,x.pointInShapeCallback)(l,(()=>!0),(({pointIJK:e,pointLPS:t})=>{try{for(const n of m){const{volume:o,extent:i,voxelManager:r,segmentIndex:a}=n,s=o.worldToIndex(t);if(s[0]<i[0]||s[0]>i[1]||s[1]<i[2]||s[1]>i[3]||s[2]<i[4]||s[2]>i[5])continue;const l=s.map(Math.round);if(r.getAtIJK(...l)>0){g.setAtIJKPoint(e,a);break}}}catch(e){}})),g.scalarData},getSurfacesAABBs({surfacesInfo:e}){const t=new Map;for(const{points:n,id:o}of e){const e=(0,b.getAABB)(n,{numDimensions:3});t.set(o,e)}return t},cutSurfacesIntoPlanes({planesInfo:e,surfacesInfo:t,surfacesAABB:n=new Map},o,i){const r=e.length,a=y.ZP.newInstance(),s=u.ZP.newInstance();a.setCutFunction(s);const l=g.ZP.newInstance();try{for(const[c,d]of e.entries()){const{sliceIndex:e,planes:u}=d,g=new Map;for(const e of t){const{points:t,polys:o,id:i}=e,r=n.get(i)||(0,b.getAABB)(t,{numDimensions:3});n.has(i)||n.set(i,r);const{minX:c,minY:d,minZ:m,maxX:h,maxY:f,maxZ:p}=r,{origin:v,normal:y}=u[0];if(!(0,C.isPlaneIntersectingAABB)(v,y,c,d,m,h,f,p))continue;l.getPoints().setData(t,3),l.getPolys().setData(o,3),l.modified(),a.setInputData(l),s.setOrigin(v),s.setNormal(y);try{a.update()}catch(e){console.warn("Error during clipping",e);continue}const I=a.getOutputData(),x=I;x.buildLinks();const P=w.newInstance();P.setInputData(x);const E=P.getOutputData();I&&g.set(i,{points:E.getPoints().getData(),lines:E.getLines().getData(),numberOfCells:E.getLines().getNumberOfCells()})}o({progress:(c+1)/r}),i({sliceIndex:e,polyDataResults:g})}}catch(e){console.warn("Error during processing",e)}finally{t=null,s.delete()}}};(0,i.Jj)(P)},8455:(e,t,n)=>{n.d(t,{ZP:()=>m});var o=n(68470),i=n(59474),r=n(91382),a=n(14418),s=n(57036),l=n(35368),c=n(72076);const{vtkErrorMacro:d}=o.m;const u={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:l._.EMPTY};function g(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,u,n),a.default.extend(e,t,n),t.direction?Array.isArray(t.direction)&&(t.direction=new Float64Array(t.direction.slice(0,9))):t.direction=c.wO.identity(new Float64Array(9)),t.indexToWorld=new Float64Array(16),t.worldToIndex=new Float64Array(16),o.m.get(e,t,["indexToWorld","worldToIndex"]),o.m.setGetArray(e,t,["origin","spacing"],3),o.m.setGetArray(e,t,["direction"],9),o.m.getArray(e,t,["extent"],6),function(e,t){t.classHierarchy.push("vtkImageData"),e.setExtent=function(){if(t.deleted)return d("instance deleted - cannot call any method"),!1;for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];const r=1===o.length?o[0]:o;if(6!==r.length)return!1;const a=t.extent.some(((e,t)=>e!==r[t]));return a&&(t.extent=r.slice(),t.dataDescription=s.Z.getDataDescriptionFromExtent(t.extent),e.modified()),a},e.setDimensions=function(){let n,o,i;if(t.deleted)d("instance deleted - cannot call any method");else{if(1===arguments.length){const e=arguments.length<=0?void 0:arguments[0];n=e[0],o=e[1],i=e[2]}else{if(3!==arguments.length)return void d("Bad dimension specification");n=arguments.length<=0?void 0:arguments[0],o=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2]}e.setExtent(0,n-1,0,o-1,0,i-1)}},e.getDimensions=()=>[t.extent[1]-t.extent[0]+1,t.extent[3]-t.extent[2]+1,t.extent[5]-t.extent[4]+1],e.getNumberOfCells=()=>{const t=e.getDimensions();let n=1;for(let e=0;e<3;e++){if(0===t[e])return 0;t[e]>1&&(n*=t[e]-1)}return n},e.getNumberOfPoints=()=>{const t=e.getDimensions();return t[0]*t[1]*t[2]},e.getPoint=n=>{const o=e.getDimensions();if(0===o[0]||0===o[1]||0===o[2])return d("Requesting a point from an empty image."),null;const i=new Float64Array(3);switch(t.dataDescription){case l._.EMPTY:return null;case l._.SINGLE_POINT:break;case l._.X_LINE:i[0]=n;break;case l._.Y_LINE:i[1]=n;break;case l._.Z_LINE:i[2]=n;break;case l._.XY_PLANE:i[0]=n%o[0],i[1]=n/o[0];break;case l._.YZ_PLANE:i[1]=n%o[1],i[2]=n/o[1];break;case l._.XZ_PLANE:i[0]=n%o[0],i[2]=n/o[0];break;case l._.XYZ_GRID:i[0]=n%o[0],i[1]=n/o[0]%o[1],i[2]=n/(o[0]*o[1]);break;default:d("Invalid dataDescription")}const r=[0,0,0];return e.indexToWorld(i,r),r},e.getBounds=()=>e.extentToBounds(e.getSpatialExtent()),e.extentToBounds=e=>r.ZP.transformBounds(e,t.indexToWorld),e.getSpatialExtent=()=>r.ZP.inflate([...t.extent],.5),e.computeTransforms=()=>{c._E.fromTranslation(t.indexToWorld,t.origin),t.indexToWorld[0]=t.direction[0],t.indexToWorld[1]=t.direction[1],t.indexToWorld[2]=t.direction[2],t.indexToWorld[4]=t.direction[3],t.indexToWorld[5]=t.direction[4],t.indexToWorld[6]=t.direction[5],t.indexToWorld[8]=t.direction[6],t.indexToWorld[9]=t.direction[7],t.indexToWorld[10]=t.direction[8],c._E.scale(t.indexToWorld,t.indexToWorld,t.spacing),c._E.invert(t.worldToIndex,t.indexToWorld)},e.indexToWorld=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.R3.transformMat4(n,e,t.indexToWorld),n},e.indexToWorldVec3=e.indexToWorld,e.worldToIndex=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.R3.transformMat4(n,e,t.worldToIndex),n},e.worldToIndexVec3=e.worldToIndex,e.indexToWorldBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r.ZP.transformBounds(e,t.indexToWorld,n)},e.worldToIndexBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r.ZP.transformBounds(e,t.worldToIndex,n)},e.onModified(e.computeTransforms),e.computeTransforms(),e.getCenter=()=>r.ZP.getCenter(e.getBounds()),e.computeHistogram=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=[0,0,0,0,0,0];e.worldToIndexBounds(t,o);const a=[0,0,0],s=[0,0,0];r.ZP.computeCornerPoints(o,a,s),(0,i.b)(a,a),(0,i.b)(s,s);const l=e.getDimensions();(0,i.c)(a,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],a),(0,i.c)(s,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],s);const c=l[0],d=l[0]*l[1],u=e.getPointData().getScalars().getData();let g=-1/0,m=1/0,h=0,f=0,p=0;for(let e=a[2];e<=s[2];e++)for(let t=a[1];t<=s[1];t++){let i=a[0]+t*c+e*d;for(let r=a[0];r<=s[0];r++){if(!n||n([r,t,e],o)){const e=u[i];e>g&&(g=e),e<m&&(m=e),h+=e*e,f+=e,p+=1}++i}}const v=p>0?f/p:0,w=p?Math.abs(h/p-v*v):0;return{minimum:m,maximum:g,average:v,variance:w,sigma:Math.sqrt(w),count:p}},e.computeIncrements=function(e){const t=[];let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let o=0;o<3;++o)t[o]=n,n*=e[2*o+1]-e[2*o]+1;return t},e.computeOffsetIndex=t=>{let[n,o,i]=t;const r=e.getExtent(),a=e.getPointData().getScalars().getNumberOfComponents(),s=e.computeIncrements(r,a);return Math.floor((Math.round(n)-r[0])*s[0]+(Math.round(o)-r[2])*s[1]+(Math.round(i)-r[4])*s[2])},e.getOffsetIndexFromWorld=t=>{const n=e.getExtent(),o=e.worldToIndex(t);for(let e=0;e<3;++e)if(o[e]<n[2*e]||o[e]>n[2*e+1])return d(`GetScalarPointer: Pixel ${o} is not in memory. Current extent = ${n}`),NaN;return e.computeOffsetIndex(o)},e.getScalarValueFromWorld=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=e.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=o)return d(`GetScalarPointer: Scalar Component ${n} is not within bounds. Current Scalar numberOfComponents: ${o}`),NaN;const i=e.getOffsetIndexFromWorld(t);return Number.isNaN(i)?i:e.getPointData().getScalars().getComponent(i,n)}}(e,t)}var m={newInstance:o.m.newInstance(g,"vtkImageData"),extend:g}},44031:(e,t,n)=>{n.d(t,{ZP:()=>s});var o=n(68470);const{vtkErrorMacro:i}=o.m;const r={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,r,n),o.m.obj(e,t),t.nodes=[],o.m.setGet(e,t,["allowDuplicateScalars","clamping"]),o.m.setArray(e,t,["range"],2),o.m.getArray(e,t,["range"]),function(e,t){t.classHierarchy.push("vtkPiecewiseFunction"),e.getSize=()=>t.nodes.length,e.getType=()=>{let e,n=0,o=0;t.nodes.length>0&&(n=t.nodes[0].y);for(let i=1;i<t.nodes.length;i++){if(e=t.nodes[i].y,e!==n)if(e>n)switch(o){case 0:case 1:o=1;break;default:o=3}else switch(o){case 0:case 2:o=2;break;default:o=3}if(n=e,3===o)break}switch(o){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";default:return"Varied"}},e.getDataPointer=()=>{const e=t.nodes.length;if(t.function=null,e>0){t.function=[];for(let n=0;n<e;n++)t.function[2*n]=t.nodes[n].x,t.function[2*n+1]=t.nodes[n].y}return t.function},e.getFirstNonZeroValue=()=>{if(0===t.nodes.length)return 0;let e=1,n=0,o=0;for(;o<t.nodes.length;o++)if(0!==t.nodes[o].y){e=0;break}return n=e?Number.MAX_VALUE:o>0?t.nodes[o-1].x:t.clamping?-Number.MAX_VALUE:t.nodes[0].x,n},e.getNodeValue=(e,n)=>{const o=t.nodes.length;return e<0||e>=o?(i("Index out of range!"),-1):(n[0]=t.nodes[e].x,n[1]=t.nodes[e].y,n[2]=t.nodes[e].midpoint,n[3]=t.nodes[e].sharpness,1)},e.setNodeValue=(n,o)=>{const r=t.nodes.length;if(n<0||n>=r)return i("Index out of range!"),-1;const a=t.nodes[n].x;return t.nodes[n].x=o[0],t.nodes[n].y=o[1],t.nodes[n].midpoint=o[2],t.nodes[n].sharpness=o[3],a!==o[0]?e.sortAndUpdateRange():e.modified(),1},e.addPoint=(t,n)=>e.addPointLong(t,n,.5,0),e.addPointLong=(n,o,r,a)=>{if(r<0||r>1)return i("Midpoint outside range [0.0, 1.0]"),-1;if(a<0||a>1)return i("Sharpness outside range [0.0, 1.0]"),-1;t.allowDuplicateScalars||e.removePoint(n);const s={x:n,y:o,midpoint:r,sharpness:a};let l;for(t.nodes.push(s),e.sortAndUpdateRange(),l=0;l<t.nodes.length&&t.nodes[l].x!==n;l++);return l<t.nodes.length?l:-1},e.setNodes=n=>{t.nodes!==n&&(t.nodes=n,e.sortAndUpdateRange())},e.sortAndUpdateRange=()=>{t.nodes.sort(((e,t)=>e.x-t.x)),e.updateRange()||e.modified()},e.updateRange=()=>{const n=t.range.slice(),o=t.nodes.length;return o?(t.range[0]=t.nodes[0].x,t.range[1]=t.nodes[o-1].x):(t.range[0]=0,t.range[1]=0),(n[0]!==t.range[0]||n[1]!==t.range[1])&&(e.modified(),!0)},e.removePoint=n=>{let o;for(o=0;o<t.nodes.length&&t.nodes[o].x!==n;o++);if(o>=t.nodes.length)return-1;const i=o;let r=!1;return t.nodes.splice(o,1),0!==o&&o!==t.nodes.length||(r=e.updateRange()),r||e.modified(),i},e.removeAllPoints=()=>{t.nodes=[],e.sortAndUpdateRange()},e.addSegment=(n,o,i,r)=>{e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n&&t.nodes[e].x<=i?t.nodes.splice(e,1):e++;e.addPoint(n,o,.5,0),e.addPoint(i,r,.5,0)},e.getValue=t=>{const n=[];return e.getTable(t,t,1,n),n[0]},e.adjustRange=n=>{if(n.length<2)return 0;const o=e.getRange();o[0]<n[0]?e.addPoint(n[0],e.getValue(n[0])):e.addPoint(n[0],e.getValue(o[0])),o[1]>n[1]?e.addPoint(n[1],e.getValue(n[1])):e.addPoint(n[1],e.getValue(o[1])),e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n[0]&&t.nodes[e].x<=n[1]?t.nodes.splice(e,1):++e;return e.sortAndUpdateRange(),1},e.estimateMinNumberOfSamples=(t,n)=>{const o=e.findMinimumXDistance();return Math.ceil((n-t)/o)},e.findMinimumXDistance=()=>{const e=t.nodes.length;if(e<2)return-1;let n=t.nodes[1].x-t.nodes[0].x;for(let o=0;o<e-1;o++){const e=t.nodes[o+1].x-t.nodes[o].x;e<n&&(n=e)}return n},e.getTable=function(e,n,o,i){let r,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=0;const l=t.nodes.length;let c=0;0!==l&&(c=t.nodes[l-1].y);let d=0,u=0,g=0,m=0,h=0,f=0,p=0;for(r=0;r<o;r++){const v=a*r;for(d=o>1?e+r/(o-1)*(n-e):.5*(e+n);s<l&&d>t.nodes[s].x;)s++,s<l&&(u=t.nodes[s-1].x,g=t.nodes[s].x,m=t.nodes[s-1].y,h=t.nodes[s].y,f=t.nodes[s-1].midpoint,p=t.nodes[s-1].sharpness,f<1e-5&&(f=1e-5),f>.99999&&(f=.99999));if(s>=l)i[v]=t.clamping?c:0;else if(0===s)i[v]=t.clamping?t.nodes[0].y:0;else{let e=(d-u)/(g-u);if(e=e<f?.5*e/f:.5+.5*(e-f)/(1-f),p>.99){if(e<.5){i[v]=m;continue}i[v]=h;continue}if(p<.01){i[v]=(1-e)*m+e*h;continue}e<.5?e=.5*(2*e)**(1+10*p):e>.5&&(e=1-.5*(2*(1-e))**(1+10*p));const t=e*e,n=t*e,o=2*n-3*t+1,r=-2*n+3*t,a=n-2*t+e,s=n-t,l=(1-p)*(h-m);i[v]=o*m+r*h+a*l+s*l;const c=m<h?m:h,w=m>h?m:h;i[v]=i[v]<c?c:i[v],i[v]=i[v]>w?w:i[v]}}}}(e,t)}var s={newInstance:o.m.newInstance(a,"vtkPiecewiseFunction"),extend:a}},3969:(e,t,n)=>{n.d(t,{ZP:()=>v});var o=n(59474),i=n(68470);const r=1e-6,a="coincide",s="disjoint";function l(e,t,n){const o=n[0]*(e[0]-t[0])+n[1]*(e[1]-t[1])+n[2]*(e[2]-t[2]);return Math.abs(o)}function c(e,t,n,i){const r=[];(0,o.s)(e,t,r);const a=(0,o.d)(n,r);i[0]=e[0]-a*n[0],i[1]=e[1]-a*n[1],i[2]=e[2]-a*n[2]}function d(e,t,n){const i=(0,o.d)(e,t);let r=(0,o.d)(t,t);return 0===r&&(r=1),n[0]=e[0]-i*t[0]/r,n[1]=e[1]-i*t[1]/r,n[2]=e[2]-i*t[2]/r,n}function u(e,t,n,i){const r=[];(0,o.s)(e,t,r);const a=(0,o.d)(n,r),s=(0,o.d)(n,n);0!==s?(i[0]=e[0]-a*n[0]/s,i[1]=e[1]-a*n[1]/s,i[2]=e[2]-a*n[2]/s):(i[0]=e[0],i[1]=e[1],i[2]=e[2])}function g(e,t,n,i){const a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},s=[],l=[];(0,o.s)(t,e,s),(0,o.s)(n,e,l);const c=(0,o.d)(i,l),d=(0,o.d)(i,s);let u,g;return u=d<0?-d:d,g=c<0?-c*r:c*r,u<=g||(a.t=c/d,a.x[0]=e[0]+a.t*s[0],a.x[1]=e[1]+a.t*s[1],a.x[2]=e[2]+a.t*s[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function m(e,t,n,i){const l={intersection:!1,l0:[],l1:[],error:null},c=[];(0,o.j)(t,i,c);const d=c.map((e=>Math.abs(e)));if(d[0]+d[1]+d[2]<r){const i=[];return(0,o.s)(e,n,i),0===(0,o.d)(t,i)?l.error=a:l.error=s,l}let u;u=d[0]>d[1]&&d[0]>d[2]?"x":d[1]>d[2]?"y":"z";const g=[],m=-(0,o.d)(t,e),h=-(0,o.d)(i,n);switch(u){case"x":g[0]=0,g[1]=(h*t[2]-m*i[2])/c[0],g[2]=(m*i[1]-h*t[1])/c[0];break;case"y":g[0]=(m*i[2]-h*t[2])/c[1],g[1]=0,g[2]=(h*t[0]-m*i[0])/c[1];break;case"z":g[0]=(h*t[1]-m*i[1])/c[2],g[1]=(m*i[0]-h*t[0])/c[2],g[2]=0}return l.l0=g,(0,o.k)(g,c,l.l1),l.intersection=!0,l}const h={evaluate:function(e,t,n){return e[0]*(n[0]-t[0])+e[1]*(n[1]-t[1])+e[2]*(n[2]-t[2])},distanceToPlane:l,projectPoint:c,projectVector:d,generalizedProjectPoint:u,intersectWithLine:g,intersectWithPlane:m,DISJOINT:s,COINCIDE:a};const f={normal:[0,0,1],origin:[0,0,0]};function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,f,n),i.m.obj(e,t),i.m.setGetArray(e,t,["normal","origin"],3),function(e,t){t.classHierarchy.push("vtkPlane"),e.distanceToPlane=e=>l(e,t.origin,t.normal),e.projectPoint=(e,n)=>{c(e,t.origin,t.normal,n)},e.projectVector=(e,n)=>d(e,t.normal,n),e.push=e=>{if(0!==e)for(let n=0;n<3;n++)t.origin[n]+=e*t.normal[n]},e.generalizedProjectPoint=(e,n)=>{u(e,t.origin,t.normal,n)},e.evaluateFunction=(e,n,o)=>Array.isArray(e)?t.normal[0]*(e[0]-t.origin[0])+t.normal[1]*(e[1]-t.origin[1])+t.normal[2]*(e[2]-t.origin[2]):t.normal[0]*(e-t.origin[0])+t.normal[1]*(n-t.origin[1])+t.normal[2]*(o-t.origin[2]),e.evaluateGradient=e=>[t.normal[0],t.normal[1],t.normal[2]],e.intersectWithLine=(e,n)=>g(e,n,t.origin,t.normal),e.intersectWithPlane=(e,n)=>m(e,n,t.origin,t.normal)}(e,t)}var v={newInstance:i.m.newInstance(p,"vtkPlane"),extend:p,...h}},60318:(e,t,n)=>{var o=n(68470),i=n(1299),r=n(29699),a=n(87570);const{vtkErrorMacro:s,vtkDebugMacro:l}=o.m;function c(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=n=>{t.contourValues=n,e.modified()};const n=[],o=[],c=[],d=r.Z.newInstance();e.getPixelScalars=(e,t,i,r,a,s)=>{const[l,c,d]=e;n[0]=d*t[1]*t[0]+c*t[0]+l,n[1]=n[0]+r[a],n[2]=n[0]+r[s],n[3]=n[2]+r[a];for(let e=0;e<4;++e)o[e]=i[n[e]]},e.getPixelPoints=(e,t,n,o,i)=>{const r=e[o],a=e[i];c[0]=t[o]+r*n[o],c[1]=t[i]+a*n[i],c[2]=c[0]+n[o],c[3]=c[1],c[4]=c[0],c[5]=c[1]+n[i],c[6]=c[2],c[7]=c[5]},e.produceLines=(i,r,s,l,u,g,m,h,f,p,v)=>{const w=r[t.slicingMode],y=[1,2,8,4],I=[];let x;e.getPixelScalars(r,s,g,f,p,v);let b=0;for(let e=0;e<4;e++)o[e]>=i&&(b|=y[e]);const C=a.Z.getCase(b);if(C[0]<0)return;e.getPixelPoints(r,l,u,p,v);const P=l[t.slicingMode]+w*u[t.slicingMode];for(let e=0;C[e]>=0;e+=2){h.push(2);for(let r=0;r<2;r++){const s=a.Z.getEdge(C[e+r]);if(x=void 0,t.mergePoints&&(x=d.isInsertedEdge(n[s[0]],n[s[1]])?.value),void 0===x){const e=(i-o[s[0]])/(o[s[1]]-o[s[0]]),r=c.slice(2*s[0],2*(s[0]+1)),a=c.slice(2*s[1],2*(s[1]+1));I[p]=r[0]+e*(a[0]-r[0]),I[v]=r[1]+e*(a[1]-r[1]),I[t.slicingMode]=P,x=m.length/3,m.push(I[0],I[1],I[2]),t.mergePoints&&d.insertEdge(n[s[0]],n[s[1]],x)}h.push(x)}}},e.requestData=(n,o)=>{const r=n[0];if(!r)return void s("Invalid or missing input");if(null==t.slicingMode||t.slicingMode<0||t.slicingMode>2)return void s("Invalid or missing slicing mode");console.time("msquares");const a=r.getOrigin(),c=r.getSpacing(),u=r.getDimensions(),g=r.getExtent(),m=r.computeIncrements(g),h=r.getPointData().getScalars().getData(),[f,p]=function(){let e=0,n=1;return 1===t.slicingMode?(e=0,n=2):0===t.slicingMode&&(e=1,n=2),[e,n]}(),v=[],w=[];let y=Math.round(t.slice);y>=u[t.slicingMode]&&(y=0);const I=[0,0,0];I[t.slicingMode]=y;for(let n=0;n<t.contourValues.length;++n){for(let o=0;o<u[p]-1;++o){I[p]=o;for(let o=0;o<u[f]-1;++o)I[f]=o,e.produceLines(t.contourValues[n],I,u,a,c,h,v,w,m,f,p)}d.initialize()}const x=i.ZP.newInstance();x.getPoints().setData(new Float32Array(v),3),x.getLines().setData(new Uint32Array(w)),o[0]=x,l("Produced output"),console.timeEnd("msquares")}}const d={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,d,n),o.m.obj(e,t),o.m.algo(e,t,1,1),o.m.setGet(e,t,["slicingMode","slice","mergePoints"]),o.m.algo(e,t,1,1),c(e,t)}o.m.newInstance(u,"vtkImageMarchingSquares")},34535:(e,t,n)=>{n.d(t,{ZP:()=>c});var o=n(72076),i=n(68470),r=n(59474);const{vtkDebugMacro:a}=i.m;const s={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:o._E.create(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),i.m.obj(e,t),i.m.get(e,t,["distance"]),i.m.setGet(e,t,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),i.m.getArray(e,t,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),i.m.setGetArray(e,t,["clippingRange","windowCenter"],2),i.m.setGetArray(e,t,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),function(e,t){t.classHierarchy.push("vtkCamera");const n=new Float64Array(3),i=new Float64Array([0,0,-1]),s=new Float64Array([0,1,0]),l=o._E.identity(new Float64Array(16)),c=o._E.identity(new Float64Array(16)),d=new Float64Array(3),u=new Float64Array(3),g=new Float64Array(3),m=o._E.identity(new Float64Array(16)),h=o._E.identity(new Float64Array(16)),f=new Float64Array(3),p=new Float64Array(3);function v(){t.viewPlaneNormal[0]=-t.directionOfProjection[0],t.viewPlaneNormal[1]=-t.directionOfProjection[1],t.viewPlaneNormal[2]=-t.directionOfProjection[2]}e.orthogonalizeViewUp=()=>{const n=e.getViewMatrix();t.viewUp[0]=n[4],t.viewUp[1]=n[5],t.viewUp[2]=n[6],e.modified()},e.setPosition=(n,o,i)=>{n===t.position[0]&&o===t.position[1]&&i===t.position[2]||(t.position[0]=n,t.position[1]=o,t.position[2]=i,e.computeDistance(),e.modified())},e.setFocalPoint=(n,o,i)=>{n===t.focalPoint[0]&&o===t.focalPoint[1]&&i===t.focalPoint[2]||(t.focalPoint[0]=n,t.focalPoint[1]=o,t.focalPoint[2]=i,e.computeDistance(),e.modified())},e.setDistance=n=>{if(t.distance===n)return;t.distance=n,t.distance<1e-20&&(t.distance=1e-20,a("Distance is set to minimum."));const o=t.directionOfProjection;t.focalPoint[0]=t.position[0]+o[0]*t.distance,t.focalPoint[1]=t.position[1]+o[1]*t.distance,t.focalPoint[2]=t.position[2]+o[2]*t.distance,e.modified()},e.computeDistance=()=>{const e=t.focalPoint[0]-t.position[0],n=t.focalPoint[1]-t.position[1],o=t.focalPoint[2]-t.position[2];if(t.distance=Math.sqrt(e*e+n*n+o*o),t.distance<1e-20){t.distance=1e-20,a("Distance is set to minimum.");const e=t.directionOfProjection;t.focalPoint[0]=t.position[0]+e[0]*t.distance,t.focalPoint[1]=t.position[1]+e[1]*t.distance,t.focalPoint[2]=t.position[2]+e[2]*t.distance}t.directionOfProjection[0]=e/t.distance,t.directionOfProjection[1]=n/t.distance,t.directionOfProjection[2]=o/t.distance,v()},e.dolly=n=>{if(n<=0)return;const o=t.distance/n;e.setPosition(t.focalPoint[0]-o*t.directionOfProjection[0],t.focalPoint[1]-o*t.directionOfProjection[1],t.focalPoint[2]-o*t.directionOfProjection[2])},e.roll=n=>{const i=t.position,a=t.focalPoint,s=t.viewUp,l=new Float64Array([s[0],s[1],s[2],0]);o._E.identity(m);const c=new Float64Array([a[0]-i[0],a[1]-i[1],a[2]-i[2]]);o._E.rotate(m,m,(0,r.r)(n),c),o.vh.transformMat4(l,l,m),t.viewUp[0]=l[0],t.viewUp[1]=l[1],t.viewUp[2]=l[2],e.modified()},e.azimuth=n=>{const i=t.focalPoint;o._E.identity(h),o._E.translate(h,h,i),o._E.rotate(h,h,(0,r.r)(n),t.viewUp),o._E.translate(h,h,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(f,t.position,h),e.setPosition(f[0],f[1],f[2])},e.yaw=n=>{const i=t.position;o._E.identity(h),o._E.translate(h,h,i),o._E.rotate(h,h,(0,r.r)(n),t.viewUp),o._E.translate(h,h,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(p,t.focalPoint,h),e.setFocalPoint(p[0],p[1],p[2])},e.elevation=n=>{const i=t.focalPoint,a=e.getViewMatrix(),s=[-a[0],-a[1],-a[2]];o._E.identity(h),o._E.translate(h,h,i),o._E.rotate(h,h,(0,r.r)(n),s),o._E.translate(h,h,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(f,t.position,h),e.setPosition(f[0],f[1],f[2])},e.pitch=n=>{const i=t.position,a=e.getViewMatrix(),s=[a[0],a[1],a[2]];o._E.identity(h),o._E.translate(h,h,i),o._E.rotate(h,h,(0,r.r)(n),s),o._E.translate(h,h,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(p,t.focalPoint,h),e.setFocalPoint(...p)},e.zoom=n=>{n<=0||(t.parallelProjection?t.parallelScale/=n:t.viewAngle/=n,e.modified())},e.translate=(n,o,i)=>{const a=[n,o,i];(0,r.k)(t.position,a,t.position),(0,r.k)(t.focalPoint,a,t.focalPoint),e.computeDistance(),e.modified()},e.applyTransform=n=>{const i=[...t.viewUp,1],r=[],a=[],s=[];i[0]+=t.position[0],i[1]+=t.position[1],i[2]+=t.position[2],o.vh.transformMat4(r,[...t.position,1],n),o.vh.transformMat4(a,[...t.focalPoint,1],n),o.vh.transformMat4(s,i,n),s[0]-=r[0],s[1]-=r[1],s[2]-=r[2],e.setPosition(...r.slice(0,3)),e.setFocalPoint(...a.slice(0,3)),e.setViewUp(...s.slice(0,3))},e.getThickness=()=>t.clippingRange[1]-t.clippingRange[0],e.setThickness=n=>{let o=n;o<1e-20&&(o=1e-20,a("Thickness is set to minimum.")),e.setClippingRange(t.clippingRange[0],t.clippingRange[0]+o)},e.setThicknessFromFocalPoint=n=>{let o=n;o<1e-20&&(o=1e-20,a("Thickness is set to minimum.")),e.setClippingRange(t.distance-o/2,t.distance+o/2)},e.setRoll=e=>{},e.getRoll=()=>{},e.setObliqueAngles=(e,t)=>{},e.getOrientation=()=>{},e.getOrientationWXYZ=()=>{},e.getFrustumPlanes=e=>{},e.getCameraLightTransformMatrix=e=>(o._E.copy(e,t.cameraLightTransform),e),e.computeCameraLightTransform=()=>{o._E.copy(l,e.getViewMatrix()),o._E.invert(l,l),o._E.fromScaling(c,[t.distance,t.distance,t.distance]),o._E.multiply(l,l,c),o._E.identity(t.cameraLightTransform),o._E.translate(t.cameraLightTransform,l,[0,0,-1])},e.deepCopy=e=>{},e.physicalOrientationToWorldDirection=e=>{const t=o.gf.fromValues(e[0],e[1],e[2],e[3]),n=o.gf.create(),i=o.gf.fromValues(0,0,1,0);return o.gf.conjugate(n,t),o.gf.multiply(i,t,i),o.gf.multiply(i,i,n),[i[0],i[1],i[2]]},e.getPhysicalToWorldMatrix=t=>{e.getWorldToPhysicalMatrix(t),o._E.invert(t,t)},e.getWorldToPhysicalMatrix=e=>{o._E.identity(e);const n=[3];(0,r.j)(t.physicalViewNorth,t.physicalViewUp,n),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[4]=t.physicalViewUp[0],e[5]=t.physicalViewUp[1],e[6]=t.physicalViewUp[2],e[8]=-t.physicalViewNorth[0],e[9]=-t.physicalViewNorth[1],e[10]=-t.physicalViewNorth[2],o._E.transpose(e,e),o.R3.set(d,1/t.physicalScale,1/t.physicalScale,1/t.physicalScale),o._E.scale(e,e,d),o._E.translate(e,e,t.physicalTranslation)},e.computeViewParametersFromViewMatrix=r=>{o._E.invert(l,r),o.R3.transformMat4(d,n,l),e.computeDistance();const a=t.distance;e.setPosition(d[0],d[1],d[2]),o.R3.transformMat4(u,i,l),o.R3.subtract(u,u,d),o.R3.normalize(u,u),e.setDirectionOfProjection(u[0],u[1],u[2]),o.R3.transformMat4(g,s,l),o.R3.subtract(g,g,d),o.R3.normalize(g,g),e.setViewUp(g[0],g[1],g[2]),e.setDistance(a)},e.computeViewParametersFromPhysicalMatrix=t=>{e.getWorldToPhysicalMatrix(l),o._E.multiply(l,t,l),e.computeViewParametersFromViewMatrix(l)},e.setViewMatrix=n=>{t.viewMatrix=n,t.viewMatrix&&(o._E.copy(l,t.viewMatrix),e.computeViewParametersFromViewMatrix(l),o._E.transpose(t.viewMatrix,t.viewMatrix))},e.getViewMatrix=()=>{if(t.viewMatrix)return t.viewMatrix;o._E.lookAt(l,t.position,t.focalPoint,t.viewUp),o._E.transpose(l,l);const e=new Float64Array(16);return o._E.copy(e,l),e},e.setProjectionMatrix=e=>{t.projectionMatrix=e},e.getProjectionMatrix=(e,n,i)=>{const a=new Float64Array(16);if(o._E.identity(a),t.projectionMatrix){const e=1/t.physicalScale;return o.R3.set(d,e,e,e),o._E.copy(a,t.projectionMatrix),o._E.scale(a,a,d),o._E.transpose(a,a),a}o._E.identity(l);const s=t.clippingRange[1]-t.clippingRange[0],c=[t.clippingRange[0]+(n+1)*s/2,t.clippingRange[0]+(i+1)*s/2];if(t.parallelProjection){const n=t.parallelScale*e,i=t.parallelScale,r=(t.windowCenter[0]-1)*n,a=(t.windowCenter[0]+1)*n,s=(t.windowCenter[1]-1)*i,d=(t.windowCenter[1]+1)*i;o._E.ortho(l,r,a,s,d,c[0],c[1]),o._E.transpose(l,l)}else{if(t.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const n=Math.tan((0,r.r)(t.viewAngle)/2);let o,i;!0===t.useHorizontalViewAngle?(o=t.clippingRange[0]*n,i=t.clippingRange[0]*n/e):(o=t.clippingRange[0]*n*e,i=t.clippingRange[0]*n);const a=(t.windowCenter[0]-1)*o,s=(t.windowCenter[0]+1)*o,d=(t.windowCenter[1]-1)*i,u=(t.windowCenter[1]+1)*i,g=c[0],m=c[1];l[0]=2*g/(s-a),l[5]=2*g/(u-d),l[2]=(a+s)/(s-a),l[6]=(d+u)/(u-d),l[10]=-(g+m)/(m-g),l[14]=-1,l[11]=-2*g*m/(m-g),l[15]=0}}return o._E.copy(a,l),a},e.getCompositeProjectionMatrix=(t,n,i)=>{const r=e.getViewMatrix(),a=e.getProjectionMatrix(t,n,i);return o._E.multiply(a,r,a),a},e.setDirectionOfProjection=(e,n,o)=>{if(t.directionOfProjection[0]===e&&t.directionOfProjection[1]===n&&t.directionOfProjection[2]===o)return;t.directionOfProjection[0]=e,t.directionOfProjection[1]=n,t.directionOfProjection[2]=o;const i=t.directionOfProjection;t.focalPoint[0]=t.position[0]+i[0]*t.distance,t.focalPoint[1]=t.position[1]+i[1]*t.distance,t.focalPoint[2]=t.position[2]+i[2]*t.distance,v()},e.setDeviceAngles=(n,i,a,s)=>{const l=[3];(0,r.j)(t.physicalViewNorth,t.physicalViewUp,l);const c=o._E.identity(new Float64Array(16));o._E.rotate(c,c,(0,r.r)(n),t.physicalViewUp),o._E.rotate(c,c,(0,r.r)(i),l),o._E.rotate(c,c,(0,r.r)(a),t.physicalViewNorth),o._E.rotate(c,c,(0,r.r)(-s),t.physicalViewUp);const d=new Float64Array([-t.physicalViewUp[0],-t.physicalViewUp[1],-t.physicalViewUp[2]]),u=new Float64Array(t.physicalViewNorth);o.R3.transformMat4(d,d,c),o.R3.transformMat4(u,u,c),e.setDirectionOfProjection(d[0],d[1],d[2]),e.setViewUp(u[0],u[1],u[2]),e.modified()},e.setOrientationWXYZ=(t,n,i,a)=>{const s=o._E.identity(new Float64Array(16));if(0!==t&&(0!==n||0!==i||0!==a)){const e=(0,r.r)(t),l=o.gf.create();o.gf.setAxisAngle(l,[n,i,a],e),o._E.fromQuat(s,l)}const l=new Float64Array(3);o.R3.transformMat4(l,[0,0,-1],s);const c=new Float64Array(3);o.R3.transformMat4(c,[0,1,0],s),e.setDirectionOfProjection(...l),e.setViewUp(...c),e.modified()},e.computeClippingRange=e=>{let n=null,o=null;n=t.viewPlaneNormal,o=t.position;const i=-n[0],r=-n[1],a=-n[2],s=-(i*o[0]+r*o[1]+a*o[2]),l=[i*e[0]+r*e[2]+a*e[4]+s,1e-18];for(let t=0;t<2;t++)for(let n=0;n<2;n++)for(let o=0;o<2;o++){const c=i*e[o]+r*e[2+n]+a*e[4+t]+s;l[0]=c<l[0]?c:l[0],l[1]=c>l[1]?c:l[1]}return l}}(e,t)}var c={newInstance:i.m.newInstance(l,"vtkCamera"),extend:l}},5193:(e,t,n)=>{n.d(t,{ZP:()=>w});var o=n(68470),i=n(59474),r=n(4666),a=n(48858);const{ColorSpace:s,Scale:l}=a.default,{ScalarMappingTarget:c}=r.default,{vtkDebugMacro:d,vtkErrorMacro:u,vtkWarningMacro:g}=o.m;function m(e,t){const n=e[0],o=e[1],i=e[2],r=Math.sqrt(n*n+o*o+i*i),a=r>.001?Math.acos(n/r):0,s=a>.001?Math.atan2(i,o):0;t[0]=r,t[1]=a,t[2]=s}function h(e,t){if(e[0]>=t-.1)return e[2];const n=e[1]*Math.sqrt(t*t-e[0]*e[0])/(e[0]*Math.sin(e[1]));return e[2]>-.3*Math.PI?e[2]+n:e[2]-n}function f(e,t,n,o){const r=[],a=[];(0,i.M)(t,r),(0,i.M)(n,a);const s=[],l=[];m(r,s),m(a,l);let c=e;if(s[1]>.05&&l[1]>.05&&function(e,t){let n=e-t;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}(s[2],l[2])>.33*Math.PI){let t=Math.max(s[0],l[0]);t=Math.max(88,t),e<.5?(l[0]=t,l[1]=0,l[2]=0,c*=2):(s[0]=t,s[1]=0,s[2]=0,c=2*c-1)}s[1]<.05&&l[1]>.05?s[2]=h(l,s[0]):l[1]<.05&&s[1]>.05&&(l[2]=h(s,l[0]));const d=[];d[0]=(1-c)*s[0]+c*l[0],d[1]=(1-c)*s[1]+c*l[1],d[2]=(1-c)*s[2]+c*l[2];const u=[];!function(e,t){const n=e[0],o=e[1],i=e[2];t[0]=n*Math.cos(o),t[1]=n*Math.sin(o)*Math.cos(i),t[2]=n*Math.sin(o)*Math.sin(i)}(d,u),(0,i.N)(u,o)}const p={clamping:!0,colorSpace:s.RGB,hSVWrap:!0,scale:l.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,p,n),r.default.extend(e,t,n),t.table=[],t.nodes=[],t.nanColor=[.5,0,0,1],t.belowRangeColor=[0,0,0,1],t.aboveRangeColor=[1,1,1,1],t.buildTime={},o.m.obj(t.buildTime),o.m.get(e,t,["buildTime","mappingRange"]),o.m.setGet(e,t,["useAboveRangeColor","useBelowRangeColor","colorSpace","discretize","numberOfValues"]),o.m.setArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"],4),o.m.getArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"]),function(e,t){t.classHierarchy.push("vtkColorTransferFunction"),e.getSize=()=>t.nodes.length,e.addRGBPoint=(t,n,o,i)=>e.addRGBPointLong(t,n,o,i,.5,0),e.addRGBPointLong=function(n,o,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(a<0||a>1)return u("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return u("Sharpness outside range [0.0, 1.0]"),-1;t.allowDuplicateScalars||e.removePoint(n);const l={x:n,r:o,g:i,b:r,midpoint:a,sharpness:s};t.nodes.push(l),e.sortAndUpdateRange();let c=0;for(;c<t.nodes.length&&t.nodes[c].x!==n;c++);return c<t.nodes.length?c:-1},e.addHSVPoint=(t,n,o,i)=>e.addHSVPointLong(t,n,o,i,.5,0),e.addHSVPointLong=function(t,n,o,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const l=[],c=[n,o,r];return(0,i.h)(c,l),e.addRGBPoint(t,l[0],l[1],l[2],a,s)},e.setNodes=n=>{if(t.nodes!==n){const o=JSON.stringify(t.nodes);t.nodes=n;const i=JSON.stringify(t.nodes);if(e.sortAndUpdateRange()||o!==i)return e.modified(),!0}return!1},e.sortAndUpdateRange=()=>{const n=JSON.stringify(t.nodes);t.nodes.sort(((e,t)=>e.x-t.x));const o=JSON.stringify(t.nodes),i=e.updateRange();return i||n===o?i:(e.modified(),!0)},e.updateRange=()=>{const n=[2];n[0]=t.mappingRange[0],n[1]=t.mappingRange[1];const o=t.nodes.length;return o?(t.mappingRange[0]=t.nodes[0].x,t.mappingRange[1]=t.nodes[o-1].x):(t.mappingRange[0]=0,t.mappingRange[1]=0),(n[0]!==t.mappingRange[0]||n[1]!==t.mappingRange[1])&&(e.modified(),!0)},e.removePoint=n=>{let o=0;for(;o<t.nodes.length&&t.nodes[o].x!==n;o++);const i=o;if(o>=t.nodes.length)return-1;let r=!1;return t.nodes.splice(o,1),0!==o&&o!==t.nodes.length||(r=e.updateRange()),r||e.modified(),i},e.movePoint=(n,o)=>{if(n!==o){e.removePoint(o);for(let i=0;i<t.nodes.length;i++)if(t.nodes[i].x===n){t.nodes[i].x=o,e.sortAndUpdateRange();break}}},e.removeAllPoints=()=>{t.nodes=[],e.sortAndUpdateRange()},e.addRGBSegment=(n,o,i,r,a,s,l,c)=>{e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n&&t.nodes[e].x<=a?t.nodes.splice(e,1):e++;e.addRGBPointLong(n,o,i,r,.5,0),e.addRGBPointLong(a,s,l,c,.5,0),e.modified()},e.addHSVSegment=(t,n,o,r,a,s,l,c)=>{const d=[n,o,r],u=[s,l,c],g=[],m=[];(0,i.h)(d,g),(0,i.h)(u,m),e.addRGBSegment(t,g[0],g[1],g[2],a,m[0],m[1],m[2])},e.mapValue=t=>{const n=[];return e.getColor(t,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},e.getColor=(n,o)=>{if(t.indexedLookup){const t=e.getSize(),i=e.getAnnotatedValueIndexInternal(n);if(i<0||0===t){const t=e.getNanColorByReference();o[0]=t[0],o[1]=t[1],o[2]=t[2]}else{const n=[];e.getNodeValue(i%t,n),o[0]=n[1],o[1]=n[2],o[2]=n[3]}}else e.getTable(n,n,1,o)},e.getRedValue=t=>{const n=[];return e.getColor(t,n),n[0]},e.getGreenValue=t=>{const n=[];return e.getColor(t,n),n[1]},e.getBlueValue=t=>{const n=[];return e.getColor(t,n),n[2]},e.getTable=(n,o,r,a)=>{const c=Number(n),d=Number(o);if((0,i.i)(c)||(0,i.i)(d)){for(let e=0;e<r;e++)a[3*e+0]=t.nanColor[0],a[3*e+1]=t.nanColor[1],a[3*e+2]=t.nanColor[2];return}let g=0;const m=t.nodes.length;let h=0,p=0,v=0;0!==m&&(h=t.nodes[m-1].r,p=t.nodes[m-1].g,v=t.nodes[m-1].b);let w=0,y=0,I=0;const x=[0,0,0],b=[0,0,0];let C=0,P=0;const E=[];let S=t.scale===l.LOG10;S&&(S=t.mappingRange[0]>0);let T=0,M=0,A=0;S&&(T=Math.log10(c),M=Math.log10(d));for(let n=0;n<r;n++){const o=3*n;if(r>1?S?(A=T+n/(r-1)*(M-T),w=10**A):w=c+n/(r-1)*(d-c):S?(A=.5*(T+M),w=10**A):w=.5*(c+d),t.discretize){const e=t.mappingRange;if(w>=e[0]&&w<=e[1]){const n=t.numberOfValues,o=e[1]-e[0];if(n<=1)w=e[0]+o/2;else{const t=(w-e[0])/o,r=(0,i.J)(n*t);w=e[0]+r/(n-1)*o}}}for(;g<m&&w>t.nodes[g].x;)g++,g<m&&(y=t.nodes[g-1].x,I=t.nodes[g].x,S&&(y=Math.log10(y),I=Math.log10(I)),x[0]=t.nodes[g-1].r,b[0]=t.nodes[g].r,x[1]=t.nodes[g-1].g,b[1]=t.nodes[g].g,x[2]=t.nodes[g-1].b,b[2]=t.nodes[g].b,C=t.nodes[g-1].midpoint,P=t.nodes[g-1].sharpness,C<1e-5&&(C=1e-5),C>.99999&&(C=.99999));if(w>t.mappingRange[1])a[o]=0,a[o+1]=0,a[o+2]=0,t.clamping&&(e.getUseAboveRangeColor()?(a[o]=t.aboveRangeColor[0],a[o+1]=t.aboveRangeColor[1],a[o+2]=t.aboveRangeColor[2]):(a[o]=h,a[o+1]=p,a[o+2]=v));else if(w<t.mappingRange[0]||(0,i.K)(w)&&w<0)a[o]=0,a[o+1]=0,a[o+2]=0,t.clamping&&(e.getUseBelowRangeColor()?(a[o]=t.belowRangeColor[0],a[o+1]=t.belowRangeColor[1],a[o+2]=t.belowRangeColor[2]):m>0&&(a[o]=t.nodes[0].r,a[o+1]=t.nodes[0].g,a[o+2]=t.nodes[0].b));else if(0===g&&(Math.abs(w-c)<1e-6||t.discretize))m>0?(a[o]=t.nodes[0].r,a[o+1]=t.nodes[0].g,a[o+2]=t.nodes[0].b):(a[o]=0,a[o+1]=0,a[o+2]=0);else{let e=0;if(e=S?(A-y)/(I-y):(w-y)/(I-y),e=e<C?.5*e/C:.5+.5*(e-C)/(1-C),P>.99){if(e<.5){a[o]=x[0],a[o+1]=x[1],a[o+2]=x[2];continue}a[o]=b[0],a[o+1]=b[1],a[o+2]=b[2];continue}if(P<.01){if(t.colorSpace===s.RGB)a[o]=(1-e)*x[0]+e*b[0],a[o+1]=(1-e)*x[1]+e*b[1],a[o+2]=(1-e)*x[2]+e*b[2];else if(t.colorSpace===s.HSV){const n=[],r=[];(0,i.L)(x,n),(0,i.L)(b,r),t.hSVWrap&&(n[0]-r[0]>.5||r[0]-n[0]>.5)&&(n[0]>r[0]?n[0]-=1:r[0]-=1);const s=[];s[0]=(1-e)*n[0]+e*r[0],s[0]<0&&(s[0]+=1),s[1]=(1-e)*n[1]+e*r[1],s[2]=(1-e)*n[2]+e*r[2],(0,i.h)(s,E),a[o]=E[0],a[o+1]=E[1],a[o+2]=E[2]}else if(t.colorSpace===s.LAB){const t=[],n=[];(0,i.M)(x,t),(0,i.M)(b,n);const r=[];r[0]=(1-e)*t[0]+e*n[0],r[1]=(1-e)*t[1]+e*n[1],r[2]=(1-e)*t[2]+e*n[2],(0,i.N)(r,E),a[o]=E[0],a[o+1]=E[1],a[o+2]=E[2]}else t.colorSpace===s.DIVERGING?(f(e,x,b,E),a[o]=E[0],a[o+1]=E[1],a[o+2]=E[2]):u("ColorSpace set to invalid value.",t.colorSpace);continue}e<.5?e=.5*(2*e)**(1+10*P):e>.5&&(e=1-.5*(2*(1-e))**(1+10*P));const n=e*e,r=n*e,l=2*r-3*n+1,c=-2*r+3*n,d=r-2*n+e,g=r-n;let m,h;if(t.colorSpace===s.RGB)for(let e=0;e<3;e++)m=b[e]-x[e],h=(1-P)*m,a[o+e]=l*x[e]+c*b[e]+d*h+g*h;else if(t.colorSpace===s.HSV){const e=[],n=[];(0,i.L)(x,e),(0,i.L)(b,n),t.hSVWrap&&(e[0]-n[0]>.5||n[0]-e[0]>.5)&&(e[0]>n[0]?e[0]-=1:n[0]-=1);const r=[];for(let t=0;t<3;t++)m=n[t]-e[t],h=(1-P)*m,r[t]=l*e[t]+c*n[t]+d*h+g*h,0===t&&r[t]<0&&(r[t]+=1);(0,i.h)(r,E),a[o]=E[0],a[o+1]=E[1],a[o+2]=E[2]}else if(t.colorSpace===s.LAB){const e=[],t=[];(0,i.M)(x,e),(0,i.M)(b,t);const n=[];for(let o=0;o<3;o++)m=t[o]-e[o],h=(1-P)*m,n[o]=l*e[o]+c*t[o]+d*h+g*h;(0,i.N)(n,E),a[o]=E[0],a[o+1]=E[1],a[o+2]=E[2]}else t.colorSpace===s.DIVERGING?(f(e,x,b,E),a[o]=E[0],a[o+1]=E[1],a[o+2]=E[2]):u("ColorSpace set to invalid value.");for(let e=0;e<3;e++)a[o+e]=a[o+e]<0?0:a[o+e],a[o+e]=a[o+e]>1?1:a[o+e]}}},e.getUint8Table=function(n,o,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.getMTime()<=t.buildTime&&t.tableSize===i&&t.tableWithAlpha!==r)return t.table;if(0===t.nodes.length)return u("Attempting to lookup a value with no points in the function"),t.table;const a=r?4:3;t.tableSize===i&&t.tableWithAlpha===r||(t.table=new Uint8Array(i*a),t.tableSize=i,t.tableWithAlpha=r);const s=[];e.getTable(n,o,i,s);for(let e=0;e<i;e++)t.table[e*a+0]=Math.floor(255*s[3*e+0]+.5),t.table[e*a+1]=Math.floor(255*s[3*e+1]+.5),t.table[e*a+2]=Math.floor(255*s[3*e+2]+.5),r&&(t.table[e*a+3]=255);return t.buildTime.modified(),t.table},e.buildFunctionFromArray=n=>{e.removeAllPoints();const o=n.getNumberOfComponents();for(let e=0;e<n.getNumberOfTuples();e++)switch(o){case 3:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:.5,sharpness:0});break;case 4:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:.5,sharpness:0});break;case 5:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)});break;case 6:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)})}e.sortAndUpdateRange()},e.buildFunctionFromTable=(n,o,i,r)=>{let a=0;e.removeAllPoints(),i>1&&(a=(o-n)/(i-1));for(let e=0;e<i;e++){const o={x:n+a*e,r:r[3*e],g:r[3*e+1],b:r[3*e+2],sharpness:0,midpoint:.5};t.nodes.push(o)}e.sortAndUpdateRange()},e.getNodeValue=(e,n)=>e<0||e>=t.nodes.length?(u("Index out of range!"),-1):(n[0]=t.nodes[e].x,n[1]=t.nodes[e].r,n[2]=t.nodes[e].g,n[3]=t.nodes[e].b,n[4]=t.nodes[e].midpoint,n[5]=t.nodes[e].sharpness,1),e.setNodeValue=(n,o)=>{if(n<0||n>=t.nodes.length)return u("Index out of range!"),-1;const i=t.nodes[n].x;return t.nodes[n].x=o[0],t.nodes[n].r=o[1],t.nodes[n].g=o[2],t.nodes[n].b=o[3],t.nodes[n].midpoint=o[4],t.nodes[n].sharpness=o[5],i!==o[0]?e.sortAndUpdateRange():e.modified(),1},e.getNumberOfAvailableColors=()=>t.indexedLookup&&e.getSize()?e.getSize():t.tableSize?t.tableSize:16777216,e.getIndexedColor=(t,n)=>{const o=e.getSize();if(o>0&&t>=0){const i=[];e.getNodeValue(t%o,i);for(let e=0;e<3;++e)n[e]=i[e+1];return void(n[3]=1)}const i=e.getNanColorByReference();n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1},e.fillFromDataPointer=(t,n)=>{if(!(t<=0)&&n){e.removeAllPoints();for(let o=0;o<t;o++)e.addRGBPoint(n[4*o],n[4*o+1],n[4*o+2],n[4*o+3])}},e.setMappingRange=(n,o)=>{const i=[n,o],r=e.getRange();if(r[1]===i[1]&&r[0]===i[0])return;if(i[1]===i[0])return void u("attempt to set zero width color range");const a=(i[1]-i[0])/(r[1]-r[0]),s=i[0]-r[0]*a;for(let e=0;e<t.nodes.length;++e)t.nodes[e].x=t.nodes[e].x*a+s;t.mappingRange[0]=i[0],t.mappingRange[1]=i[1],e.modified()},e.adjustRange=n=>{const o=e.getRange(),i=[];o[0]<n[0]?(e.getColor(n[0],i),e.addRGBPoint(n[0],i[0],i[1],i[2])):(e.getColor(o[0],i),e.addRGBPoint(n[0],i[0],i[1],i[2])),o[1]>n[1]?(e.getColor(n[1],i),e.addRGBPoint(n[1],i[0],i[1],i[2])):(e.getColor(o[1],i),e.addRGBPoint(n[1],i[0],i[1],i[2])),e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n[0]&&t.nodes[e].x<=n[1]?t.nodes.splice(e,1):++e;return 1},e.estimateMinNumberOfSamples=(t,n)=>{const o=e.findMinimumXDistance();return Math.ceil((n-t)/o)},e.findMinimumXDistance=()=>{if(t.nodes.length<2)return-1;let e=Number.MAX_VALUE;for(let n=0;n<t.nodes.length-1;n++){const o=t.nodes[n+1].x-t.nodes[n].x;o<e&&(e=o)}return e},e.mapScalarsThroughTable=(n,o,i,r)=>{0!==e.getSize()?t.indexedLookup?e.mapDataIndexed(n,o,i,r):e.mapData(n,o,i,r):d("Transfer Function Has No Points!")},e.mapData=(t,n,o,i)=>{if(0===e.getSize())return void g("Transfer Function Has No Points!");const r=Math.floor(255*e.getAlpha()+.5),a=t.getNumberOfTuples(),s=t.getNumberOfComponents(),l=n.getData(),d=t.getData(),u=[];if(o===c.RGBA)for(let t=0;t<a;t++){const n=d[t*s+i];e.getColor(n,u),l[4*t]=Math.floor(255*u[0]+.5),l[4*t+1]=Math.floor(255*u[1]+.5),l[4*t+2]=Math.floor(255*u[2]+.5),l[4*t+3]=r}if(o===c.RGB)for(let t=0;t<a;t++){const n=d[t*s+i];e.getColor(n,u),l[3*t]=Math.floor(255*u[0]+.5),l[3*t+1]=Math.floor(255*u[1]+.5),l[3*t+2]=Math.floor(255*u[2]+.5)}if(o===c.LUMINANCE)for(let t=0;t<a;t++){const n=d[t*s+i];e.getColor(n,u),l[t]=Math.floor(76.5*u[0]+150.45*u[1]+28.05*u[2]+.5)}if(o===c.LUMINANCE_ALPHA)for(let t=0;t<a;t++){const n=d[t*s+i];e.getColor(n,u),l[2*t]=Math.floor(76.5*u[0]+150.45*u[1]+28.05*u[2]+.5),l[2*t+1]=r}},e.applyColorMap=n=>{const o=JSON.stringify(t.colorSpace);n.ColorSpace&&(t.colorSpace=s[n.ColorSpace.toUpperCase()],void 0===t.colorSpace&&(u(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),t.colorSpace=s.RGB));let i=o!==JSON.stringify(t.colorSpace);const r=i||JSON.stringify(t.nanColor);if(n.NanColor)for(t.nanColor=[].concat(n.NanColor);t.nanColor.length<4;)t.nanColor.push(1);i=i||r!==JSON.stringify(t.nanColor);const a=i||JSON.stringify(t.nodes);if(n.RGBPoints){const e=n.RGBPoints.length;t.nodes=[];const o=.5,i=0;for(let r=0;r<e;r+=4)t.nodes.push({x:n.RGBPoints[r],r:n.RGBPoints[r+1],g:n.RGBPoints[r+2],b:n.RGBPoints[r+3],midpoint:o,sharpness:i})}const l=e.sortAndUpdateRange(),c=!l&&(i||a!==JSON.stringify(t.nodes));return c&&e.modified(),l||c}}(e,t)}var w={newInstance:o.m.newInstance(v,"vtkColorTransferFunction"),extend:v,...a.default}},31239:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(40188);const i=Object.create(null);o.v.filter((e=>e.RGBPoints)).filter((e=>"CIELAB"!==e.ColorSpace)).forEach((e=>{i[e.Name]=e}));const r=Object.keys(i);r.sort();var a={addPreset:function(e){e.RGBPoints&&"CIELAB"!==e.ColorSpace&&(i[e.Name]||(r.push(e.Name),r.sort()),i[e.Name]=e)},removePresetByName:function(e){const t=r.indexOf(e);t>-1&&r.splice(t,1),delete i[e]},getPresetByName:function(e){return i[e]},rgbPresetNames:r}},78639:(e,t,n)=>{n.d(t,{ZP:()=>h});var o=n(72795),i=n(68470),r=n(93751),a=n(68649),s=n(59474),l=n(84418);const{staticOffsetAPI:c,otherStaticMethods:d}=l.default,{SlicingMode:u}=o.default;const g={slicingMode:u.NONE,closestIJKAxis:{ijkMode:u.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function m(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,g,n),r.Z.extend(e,t,n),i.m.get(e,t,["slicingMode"]),i.m.setGet(e,t,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),l.default.implementCoincidentTopologyMethods(e,t),function(e,t){function n(){let n;switch(t.slicingMode){case u.X:n=0;break;case u.Y:n=1;break;case u.Z:n=2;break;default:return void(t.closestIJKAxis={ijkMode:t.slicingMode,flip:!1})}const o=e.getCurrentImage().getDirection(),i=(0,s.S)(o);let r=0;for(;r<3&&0===i[n+3*r];++r);const a=i[n+3*r]<0;t.closestIJKAxis={ijkMode:r,flip:a}}t.classHierarchy.push("vtkImageMapper"),e.getSliceAtPosition=n=>{const o=e.getCurrentImage();let i;if(3===n.length)i=n;else if(Number.isFinite(n)){const e=o.getBounds();switch(t.slicingMode){case u.X:i=[n,(e[3]+e[2])/2,(e[5]+e[4])/2];break;case u.Y:i=[(e[1]+e[0])/2,n,(e[5]+e[4])/2];break;case u.Z:i=[(e[1]+e[0])/2,(e[3]+e[2])/2,n]}}const r=[0,0,0];o.worldToIndex(i,r);const a=o.getExtent(),{ijkMode:l}=e.getClosestIJKAxis();let c=0;switch(l){case u.I:c=(0,s.C)(r[0],a[0],a[1]);break;case u.J:c=(0,s.C)(r[1],a[2],a[3]);break;case u.K:c=(0,s.C)(r[2],a[4],a[5]);break;default:return 0}return c},e.setSliceFromCamera=n=>{const o=n.getFocalPoint();switch(t.slicingMode){case u.I:case u.J:case u.K:{const t=e.getSliceAtPosition(o);e.setSlice(t)}break;case u.X:e.setSlice(o[0]);break;case u.Y:e.setSlice(o[1]);break;case u.Z:e.setSlice(o[2])}},e.setXSlice=t=>{e.setSlicingMode(u.X),e.setSlice(t)},e.setYSlice=t=>{e.setSlicingMode(u.Y),e.setSlice(t)},e.setZSlice=t=>{e.setSlicingMode(u.Z),e.setSlice(t)},e.setISlice=t=>{e.setSlicingMode(u.I),e.setSlice(t)},e.setJSlice=t=>{e.setSlicingMode(u.J),e.setSlice(t)},e.setKSlice=t=>{e.setSlicingMode(u.K),e.setSlice(t)},e.getSlicingModeNormal=()=>{const n=[0,0,0],o=e.getCurrentImage().getDirection();switch(t.slicingMode){case u.X:n[0]=1;break;case u.Y:n[1]=1;break;case u.Z:n[2]=1;break;case u.I:(0,s.R)(o,[1,0,0],n);break;case u.J:(0,s.R)(o,[0,1,0],n);break;case u.K:(0,s.R)(o,[0,0,1],n)}return n},e.setSlicingMode=o=>{t.slicingMode!==o&&(t.slicingMode=o,e.getCurrentImage()&&n(),e.modified())},e.getClosestIJKAxis=()=>(void 0!==t.closestIJKAxis&&t.closestIJKAxis.ijkMode!==u.NONE||!e.getCurrentImage()||n(),t.closestIJKAxis),e.getBounds=()=>{const n=e.getCurrentImage();if(!n)return(0,s.F)();if(!t.useCustomExtents)return n.getBounds();const o=t.customDisplayExtent.slice(),{ijkMode:i}=e.getClosestIJKAxis();let r=t.slice;switch(i!==t.slicingMode&&(r=e.getSliceAtPosition(t.slice)),i){case u.I:o[0]=r,o[1]=r;break;case u.J:o[2]=r,o[3]=r;break;case u.K:o[4]=r,o[5]=r}return n.extentToBounds(o)},e.getBoundsForSlice=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.slice,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.getCurrentImage();if(!i)return(0,s.F)();const r=i.getSpatialExtent(),{ijkMode:a}=e.getClosestIJKAxis();let l=n;switch(a!==t.slicingMode&&(l=e.getSliceAtPosition(n)),a){case u.I:r[0]=l-o,r[1]=l+o;break;case u.J:r[2]=l-o,r[3]=l+o;break;case u.K:r[4]=l-o,r[5]=l+o}return i.extentToBounds(r)},e.intersectWithLineForPointPicking=(t,n)=>(0,a.U)(t,n,e),e.intersectWithLineForCellPicking=(t,n)=>(0,a.L)(t,n,e),e.getCurrentImage=()=>e.getInputData()}(e,t)}var h={newInstance:i.m.newInstance(m,"vtkImageMapper"),extend:m,...c,...d,...o.default}},7965:(e,t,n)=>{n.d(t,{ZP:()=>u});var o=n(72076),i=n(68470),r=n(91382),a=n(49445),s=n(1408);const{vtkDebugMacro:l}=i.m;const c={mapper:null,property:null,bounds:[...r.ZP.INIT_BOUNDS]};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),a.ZP.extend(e,t,n),t.boundsMTime={},i.m.obj(t.boundsMTime),i.m.set(e,t,["property"]),i.m.setGet(e,t,["mapper"]),i.m.getArray(e,t,["bounds"],6),function(e,t){t.classHierarchy.push("vtkImageSlice"),e.getActors=()=>e,e.getImages=()=>e,e.getIsOpaque=()=>{if(t.forceOpaque)return!0;if(t.forceTranslucent)return!1;t.property||e.getProperty();let n=t.property.getOpacity()>=1;return n=n&&(!t.mapper||t.mapper.getIsOpaque()),n},e.hasTranslucentPolygonalGeometry=()=>!1,e.makeProperty=s.ZP.newInstance,e.getProperty=()=>(null===t.property&&(t.property=e.makeProperty()),t.property),e.getBounds=()=>{if(null===t.mapper)return t.bounds;const n=t.mapper.getBounds();if(!n||6!==n.length)return n;if(n[0]>n[1])return t.mapperBounds=n.concat(),t.bounds=[1,-1,1,-1,1,-1],t.boundsMTime.modified(),n;if(!t.mapperBounds||!(i=[n,t.mapperBounds],i[0].map(((e,t)=>i.map((e=>e[t]))))).reduce(((e,t)=>e&&t[0]===t[1]),!0)||e.getMTime()>t.boundsMTime.getMTime()){l("Recomputing bounds..."),t.mapperBounds=n.map((e=>e)),e.computeMatrix();const i=new Float64Array(16);o._E.transpose(i,t.matrix),r.ZP.transformBounds(n,i,t.bounds),t.boundsMTime.modified()}var i;return t.bounds},e.getBoundsForSlice=(n,i)=>{const a=t.mapper.getBoundsForSlice(n,i);if(!r.ZP.isValid(a))return a;e.computeMatrix();const s=new Float64Array(16);return o._E.transpose(s,t.matrix),r.ZP.transformBounds(a,s)},e.getMinXBound=()=>e.getBounds()[0],e.getMaxXBound=()=>e.getBounds()[1],e.getMinYBound=()=>e.getBounds()[2],e.getMaxYBound=()=>e.getBounds()[3],e.getMinZBound=()=>e.getBounds()[4],e.getMaxZBound=()=>e.getBounds()[5],e.getMTime=()=>{let e=t.mtime;if(null!==t.property){const n=t.property.getMTime();e=n>e?n:e}return e},e.getRedrawMTime=()=>{let e=t.mtime;if(null!==t.mapper){let n=t.mapper.getMTime();e=n>e?n:e,null!==t.mapper.getInput()&&(t.mapper.getInputAlgorithm().update(),n=t.mapper.getInput().getMTime(),e=n>e?n:e)}if(null!==t.property){let n=t.property.getMTime();e=n>e?n:e,null!==t.property.getRGBTransferFunction()&&(n=t.property.getRGBTransferFunction().getMTime(),e=n>e?n:e)}return e},e.getSupportsSelection=()=>!!t.mapper&&t.mapper.getSupportsSelection()}(e,t)}var u={newInstance:i.m.newInstance(d,"vtkImageSlice"),extend:d}},28635:(e,t,n)=>{n.d(t,{Jj:()=>d,Ud:()=>g,Yy:()=>r,sj:()=>I});const o=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,c=new Map([["proxy",{canHandle:e=>l(e)&&e[o],serialize(e){const{port1:t,port2:n}=new MessageChannel;return d(e,t),[n,[n]]},deserialize:e=>(e.start(),g(e))}],["throw",{canHandle:e=>l(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function d(e,t=globalThis,n=["*"]){t.addEventListener("message",(function o(i){if(!i||!i.data)return;if(!function(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,i.origin))return void console.warn(`Invalid origin '${i.origin}' for comlink proxy`);const{id:r,type:l,path:c}=Object.assign({path:[]},i.data),g=(i.data.argumentList||[]).map(b);let m;try{const t=c.slice(0,-1).reduce(((e,t)=>e[t]),e),n=c.reduce(((e,t)=>e[t]),e);switch(l){case"GET":m=n;break;case"SET":t[c.slice(-1)[0]]=b(i.data.value),m=!0;break;case"APPLY":m=n.apply(t,g);break;case"CONSTRUCT":m=I(new n(...g));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;d(e,n),m=function(e,t){return y.set(e,t),e}(t,[t])}break;case"RELEASE":m=void 0;break;default:return}}catch(e){m={value:e,[s]:0}}Promise.resolve(m).catch((e=>({value:e,[s]:0}))).then((n=>{const[i,s]=x(n);t.postMessage(Object.assign(Object.assign({},i),{id:r}),s),"RELEASE"===l&&(t.removeEventListener("message",o),u(t),a in e&&"function"==typeof e[a]&&e[a]())})).catch((e=>{const[n,o]=x({value:new TypeError("Unserializable return value"),[s]:0});t.postMessage(Object.assign(Object.assign({},n),{id:r}),o)}))})),t.start&&t.start()}function u(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function g(e,t){return v(e,[],t)}function m(e){if(e)throw new Error("Proxy has been released and is not useable")}function h(e){return C(e,{type:"RELEASE"}).then((()=>{u(e)}))}const f=new WeakMap,p="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(f.get(e)||0)-1;f.set(e,t),0===t&&h(e)}));function v(e,t=[],n=function(){}){let o=!1;const a=new Proxy(n,{get(n,i){if(m(o),i===r)return()=>{!function(e){p&&p.unregister(e)}(a),h(e),o=!0};if("then"===i){if(0===t.length)return{then:()=>a};const n=C(e,{type:"GET",path:t.map((e=>e.toString()))}).then(b);return n.then.bind(n)}return v(e,[...t,i])},set(n,i,r){m(o);const[a,s]=x(r);return C(e,{type:"SET",path:[...t,i].map((e=>e.toString())),value:a},s).then(b)},apply(n,r,a){m(o);const s=t[t.length-1];if(s===i)return C(e,{type:"ENDPOINT"}).then(b);if("bind"===s)return v(e,t.slice(0,-1));const[l,c]=w(a);return C(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:l},c).then(b)},construct(n,i){m(o);const[r,a]=w(i);return C(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:r},a).then(b)}});return function(e,t){const n=(f.get(t)||0)+1;f.set(t,n),p&&p.register(e,t,e)}(a,e),a}function w(e){const t=e.map(x);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const y=new WeakMap;function I(e){return Object.assign(e,{[o]:!0})}function x(e){for(const[t,n]of c)if(n.canHandle(e)){const[o,i]=n.serialize(e);return[{type:"HANDLER",name:t,value:o},i]}return[{type:"RAW",value:e},y.get(e)||[]]}function b(e){switch(e.type){case"HANDLER":return c.get(e.name).deserialize(e.value);case"RAW":return e.value}}function C(e,t,n){return new Promise((o=>{const i=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===i&&(e.removeEventListener("message",t),o(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:i},t),n)}))}},63021:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(3848),i=n(85125);function r(e){let t,n,r;function s(e,o,i=0,r=e.length){if(i<r){if(0!==t(o,o))return r;do{const t=i+r>>>1;n(e[t],o)<0?i=t+1:r=t}while(i<r)}return i}return 2!==e.length?(t=o.Z,n=(t,n)=>(0,o.Z)(e(t),n),r=(t,n)=>e(t)-n):(t=e===o.Z||e===i.Z?e:a,n=e,r=e),{left:s,center:function(e,t,n=0,o=e.length){const i=s(e,t,n,o-1);return i>n&&r(e[i-1],t)>-r(e[i],t)?i-1:i},right:function(e,o,i=0,r=e.length){if(i<r){if(0!==t(o,o))return r;do{const t=i+r>>>1;n(e[t],o)<=0?i=t+1:r=t}while(i<r)}return i}}}function a(){return 0}}}]);
//# sourceMappingURL=9579.bundle.5f9ef61543e3ecccf458.js.map
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[3497],{10424:(t,o,e)=>{"use strict";e.d(o,{Z:()=>u});var n=e(33232),i=e(12651);const r="viewport-element";function s(t,o){if(n.SB.svgNodeCache[t])return n.SB.svgNodeCache[t][o]?n.SB.svgNodeCache[t][o].domRef:void 0}function a(t,o,e,i){if(!n.SB.svgNodeCache[o])return null;n.SB.svgNodeCache[o][i]={touched:!0,domRef:e},t.appendChild(e)}function l(t,o){n.SB.svgNodeCache[t]&&n.SB.svgNodeCache[t][o]&&(n.SB.svgNodeCache[t][o].touched=!0)}function d(t,o){n.SB.svgNodeCache[o]&&Object.keys(n.SB.svgNodeCache[o]).forEach((e=>{const i=n.SB.svgNodeCache[o][e];!i.touched&&i.domRef&&(t.removeChild(i.domRef),delete n.SB.svgNodeCache[o][e])}))}const c=function(t){const o=(0,i.getEnabledElement)(t),{viewportId:e,renderingEngineId:c}=o,u=`${e}:${c}`,h=function(t){const o=`.${r}`,e=t.querySelector(o);return e.querySelector(":scope > .svg-layer")}(t);return Object.keys(n.SB.svgNodeCache[u]).forEach((t=>{n.SB.svgNodeCache[u][t].touched=!1})),{svgLayerElement:h,svgNodeCacheForCanvas:n.SB.svgNodeCache,getSvgNode:s.bind(this,u),appendNode:a.bind(this,h,u),setNodeTouched:l.bind(this,u),clearUntouched:d.bind(this,h,u)}};const u=function(t,o){const e=c(t);o(e),e.clearUntouched()}},22712:(t,o,e)=>{"use strict";var n;e.d(o,{default:()=>i}),function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"}(n||(n={}));const i=n},36048:(t,o,e)=>{"use strict";e.d(o,{Z:()=>y});var n=e(33232),i=e(68096),r=e(20346),s=e.n(r),a=e(11677),l=e.n(a),d=e(12651),c=e(60020),u=e(23118);const{Active:h,Passive:g,Enabled:p,Disabled:f}=i.ToolModes,v=[{mouseButton:i.MouseBindings.Primary}];class m{constructor(t){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=t}getViewportIds(){return this.viewportsInfo.map((({viewportId:t})=>t))}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(t){const o=this._toolInstances[t];if(o)return o;console.warn(`'${t}' is not registered with this toolGroup (${this.id}).`)}getToolInstances(){return this._toolInstances}hasTool(t){return!!this._toolInstances[t]}addTool(t,o={}){const e=n.SB.tools[t],i=void 0!==t&&""!==t,r=this.toolOptions[t];if(!i)return void console.warn("Tool with configuration did not produce a toolName: ",o);if(!e)return void console.warn(`'${t}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);if(r)return void console.warn(`'${t}' is already registered for ToolGroup ${this.id}.`);const{toolClass:s}=e,a=new s({name:t,toolGroupId:this.id,configuration:o});this._toolInstances[t]=a}addToolInstance(t,o,e={}){let i=n.SB.tools[t]?.toolClass;if(!i){const e=n.SB.tools[o].toolClass;class r extends e{}r.toolName=t,i=r,n.SB.tools[t]={toolClass:r}}this.addTool(i.toolName,e)}addViewport(t,o){if("string"!=typeof t)throw new Error("viewportId must be defined and be a string");const e=(0,d.getRenderingEngines)();if(!o&&e.length>1)throw new Error("You must specify a renderingEngineId when there are multiple rendering engines.");const n=o||e[0].id;this.viewportsInfo.some((({viewportId:o})=>o===t))||this.viewportsInfo.push({viewportId:t,renderingEngineId:n});const r=this.getActivePrimaryMouseButtonTool();d.Settings.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(r);const s={toolGroupId:this.id,viewportId:t,renderingEngineId:n};(0,d.triggerEvent)(d.eventTarget,i.Events.TOOLGROUP_VIEWPORT_ADDED,s)}removeViewports(t,o){const e=[];if(this.viewportsInfo.forEach(((n,i)=>{let r=!1;n.renderingEngineId===t&&(r=!0,o&&n.viewportId!==o&&(r=!1)),r&&e.push(i)})),e.length)for(let t=e.length-1;t>=0;t--)this.viewportsInfo.splice(e[t],1);const n={toolGroupId:this.id,viewportId:o,renderingEngineId:t};(0,d.triggerEvent)(d.eventTarget,i.Events.TOOLGROUP_VIEWPORT_REMOVED,n)}setActiveStrategy(t,o){const e=this._toolInstances[t];void 0!==e?e.setActiveStrategy(o):console.warn(`Tool ${t} not added to toolGroup, can't set tool configuration.`)}setToolMode(t,o,e={}){t?o!==i.ToolModes.Active?o!==i.ToolModes.Passive?o!==i.ToolModes.Enabled?o!==i.ToolModes.Disabled?console.warn("setToolMode: mode must be defined"):this.setToolDisabled(t):this.setToolEnabled(t):this.setToolPassive(t):this.setToolActive(t,e||this.restoreToolOptions[t]):console.warn("setToolMode: toolName must be defined")}setToolActive(t,o={}){const e=this._toolInstances[t];if(void 0===e)return void console.warn(`Tool ${t} not added to toolGroup, can't set tool mode.`);if(!e)return void console.warn(`'${t}' instance ${e} is not registered with this toolGroup, can't set tool mode.`);const n={bindings:[...this.toolOptions[t]?this.toolOptions[t].bindings:[],...o.bindings?o.bindings:[]].reduce(((t,o)=>{const e=void 0!==o.numTouchPoints,n=void 0!==o.mouseButton;return t.some((t=>T(t,o)))||!e&&!n||t.push(o),t}),[]),mode:h};this.toolOptions[t]=n,this._toolInstances[t].mode=h;const r=d.Settings.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(o)&&r)this.setViewportsCursorByToolName(t);else{if(!this.getActivePrimaryMouseButtonTool()&&r){const t=c.MouseCursor.getDefinedCursor("default");this._setCursorForViewports(t)}}this._hasMousePrimaryButtonBinding(o)&&(null===this.prevActivePrimaryToolName?this.prevActivePrimaryToolName=t:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=t),"function"==typeof e.onSetToolActive&&e.onSetToolActive(),this._renderViewports();const s={toolGroupId:this.id,toolName:t,toolBindingsOptions:o};(0,d.triggerEvent)(d.eventTarget,i.Events.TOOL_ACTIVATED,s),this._triggerToolModeChangedEvent(t,h,o)}setToolPassive(t,o){const e=this._toolInstances[t];if(void 0===e)return void console.warn(`Tool ${t} not added to toolGroup, can't set tool mode.`);const n=this.getToolOptions(t),i=Object.assign({bindings:n?n.bindings:[]},n,{mode:g}),r=Array.isArray(o?.removeAllBindings)?o.removeAllBindings:this.getDefaultPrimaryBindings();i.bindings=i.bindings.filter((t=>!0!==o?.removeAllBindings&&!r.some((o=>T(t,o)))));let s=g;0!==i.bindings.length&&(s=h,i.mode=s),this.toolOptions[t]=i,e.mode=s,"function"==typeof e.onSetToolPassive&&e.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(t,g)}setToolEnabled(t){const o=this._toolInstances[t];if(void 0===o)return void console.warn(`Tool ${t} not added to toolGroup, can't set tool mode.`);const e={bindings:[],mode:p};this.toolOptions[t]=e,o.mode=p,"function"==typeof o.onSetToolEnabled&&o.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(t,p)}setToolDisabled(t){const o=this._toolInstances[t];if(void 0===o)return void console.warn(`Tool ${t} not added to toolGroup, can't set tool mode.`);const e={bindings:[],mode:f};this.restoreToolOptions[t]=this.toolOptions[t],this.toolOptions[t]=e,o.mode=f,"function"==typeof o.onSetToolDisabled&&o.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(t,f)}getToolOptions(t){const o=this.toolOptions[t];if(void 0!==o)return o}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find((t=>{const o=this.toolOptions[t];return o.mode===h&&this._hasMousePrimaryButtonBinding(o)}))}setViewportsCursorByToolName(t,o){const e=this._getCursor(t,o);this._setCursorForViewports(e)}_getCursor(t,o){let e,n;return o&&(e=`${t}.${o}`,n=c.SVGMouseCursor.getDefinedCursor(e,!0),n)?n:(e=`${t}`,n=c.SVGMouseCursor.getDefinedCursor(e,!0),n||(e=t,n=c.SVGMouseCursor.getDefinedCursor(e,!0),n||c.MouseCursor.getDefinedCursor("default")))}_setCursorForViewports(t){this.viewportsInfo.forEach((({renderingEngineId:o,viewportId:e})=>{const n=(0,d.getEnabledElementByIds)(e,o);if(!n)return;const{viewport:i}=n;(0,u.initElementCursor)(i.element,t)}))}setToolConfiguration(t,o,e){const n=this._toolInstances[t];if(void 0===n)return console.warn(`Tool ${t} not present, can't set tool configuration.`),!1;let i;return i=e?o:Object.assign(n.configuration,o),n.configuration=i,"function"==typeof n.onSetToolConfiguration&&n.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return i.MouseBindings.Primary}getDefaultPrimaryBindings(){return v}getToolConfiguration(t,o){if(void 0===this._toolInstances[t])return void console.warn(`Tool ${t} not present, can't set tool configuration.`);const e=s()(this._toolInstances[t].configuration,o)||this._toolInstances[t].configuration;return l()(e)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}clone(t,o=null){let e=n.fT.getToolGroup(t);return e?(console.warn(`ToolGroup ${t} already exists`),e):(e=n.fT.createToolGroup(t),o=o??(()=>!0),Object.keys(this._toolInstances).filter(o).forEach((t=>{const o=this._toolInstances[t],n=this.toolOptions[t],i=o.mode;e.addTool(t),e.setToolMode(t,i,{bindings:n.bindings??[]})})),e)}_hasMousePrimaryButtonBinding(t){const o=this.getDefaultPrimaryBindings();return t?.bindings?.some((t=>o.some((o=>T(t,o)))))}_renderViewports(){this.viewportsInfo.forEach((({renderingEngineId:t,viewportId:o})=>{(0,d.getRenderingEngine)(t).renderViewport(o)}))}_triggerToolModeChangedEvent(t,o,e){const n={toolGroupId:this.id,toolName:t,mode:o,toolBindingsOptions:e};(0,d.triggerEvent)(d.eventTarget,i.Events.TOOL_MODE_CHANGED,n)}}function T(t,o){return t.mouseButton===o.mouseButton&&(t.numTouchPoints===o.numTouchPoints&&t.modifierKey===o.modifierKey)}const y=function(t){if(n.SB.toolGroups.some((o=>o.id===t)))return void console.warn(`'${t}' already exists.`);const o=new m(t);return n.SB.toolGroups.push(o),o}},878:(t,o,e)=>{"use strict";e.d(o,{Z:()=>r});var n=e(33232),i=e(85325);const r=function(){const t=[...n.SB.toolGroups];for(const o of t)(0,i.Z)(o.id);n.SB.toolGroups=[]}},85325:(t,o,e)=>{"use strict";e.d(o,{Z:()=>s});var n=e(33232),i=e(95482),r=e(31131);const s=function(t){const o=n.SB.toolGroups.findIndex((o=>o.id===t));o>-1&&(r.ZW.removeToolGroup(t),(0,i.removeSegmentationsFromToolGroup)(t),n.SB.toolGroups.splice(o,1))}},20568:(t,o,e)=>{"use strict";e.d(o,{Z:()=>i});var n=e(33232);const i=function(){return n.SB.toolGroups}},69160:(t,o,e)=>{"use strict";e.d(o,{Z:()=>i});var n=e(33232);const i=function(t){return n.SB.toolGroups.find((o=>o.id===t))}},24321:(t,o,e)=>{"use strict";e.d(o,{Z:()=>s});var n=e(33232),i=e(68096);const r=[i.ToolModes.Active,i.ToolModes.Passive,i.ToolModes.Enabled];const s=function(t){return n.SB.toolGroups.filter((({toolOptions:o})=>{const e=Object.keys(o);for(let n=0;n<e.length;n++)if(t===e[n]&&o[t]&&r.includes(o[t].mode))return!0;return!1}))}},22455:(t,o,e)=>{"use strict";e.d(o,{Z:()=>x});var n=e(12651),i=e(72076),r=e(39661),s=e(42975),a=e(79390),l=e(44037),d=e(90685),c=e(46966),u=e(66878),h=e(75698),g=e(89026),p=e(58391),f=e(21879),v=e(82571),m=e(54435),T=e(36705),y=e(25876),C=e(20724),w=e(42744),S=e(31955),b=e(20752),_=e(15607),I=e(51053),E=e(3042),O=e(22955),B=e(68096);const{pointCanProjectOnLine:M}=a.polyline,{EPSILON:P}=n.CONSTANTS,A=1-P;class N extends O.Z{constructor(t={},o={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:B.KeyboardBindings.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:D,statsCalculator:I.BasicStatsCalculator}}){super(t,o),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=t=>{const o=t.detail,{element:e}=o,i=(0,n.getEnabledElement)(e),{renderingEngine:r}=i,s=this.createAnnotation(t);this.addAnnotation(s,e);const a=(0,c.getViewportIdsWithToolToRender)(e,this.getToolName());return this.activateDraw(t,s,a),t.preventDefault(),(0,u.Z)(r,a),s},this.handleSelectedCallback=(t,o,e)=>{const n=t.detail,{element:i}=n,r=(0,c.getViewportIdsWithToolToRender)(i,this.getToolName());this.activateOpenContourEndEdit(t,o,r,e)},this.toolSelectedCallback=(t,o)=>{const e=t.detail,{element:n}=e,i=(0,c.getViewportIdsWithToolToRender)(n,this.getToolName());o.data.contour.closed?this.activateClosedContourEdit(t,o,i):this.activateOpenContourEdit(t,o,i),t.preventDefault()},this.isPointNearTool=(t,o,e,i)=>{const r=(0,n.getEnabledElement)(t),{viewport:s}=r,{polyline:a}=o.data.contour;let l=s.worldToCanvas(a[0]);for(let t=1;t<a.length;t++){const o=l,n=s.worldToCanvas(a[t]);if(M(e,o,n,i))return!0;l=n}if(!o.data.contour.closed)return!1;const d=s.worldToCanvas(a[0]),c=s.worldToCanvas(a[a.length-1]);return M(e,d,c,i)},this.cancel=t=>{const o=this.isDrawing,e=this.isEditingOpen,n=this.isEditingClosed;o?this.cancelDrawing(t):e?this.cancelOpenContourEdit(t):n&&this.cancelClosedContourEdit(t)},this._calculateCachedStats=(t,o,e,i)=>{const{data:a}=t,{cachedStats:l}=a,{polyline:d,closed:c}=a.contour,u=Object.keys(l);for(let i=0;i<u.length;i++){const h=u[i],g=this.getTargetIdImage(h,e);if(!g)continue;const{imageData:p,metadata:f}=g,v=d.map((t=>o.worldToCanvas(t))),m={isPreScaled:(0,b.P)(o,h),isSuvScaled:this.isSuvScaled(o,h,t.metadata.referencedImageId)},T=(0,_.F)(f.Modality,t.metadata.referencedImageId,m),y=(0,r.mh)(g,(()=>{const t=a.contour.polyline,e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=o.worldToCanvas(t[n]);const{maxX:r,maxY:l,minX:d,minY:c}=s.math.polyline.getAABB(i),u=o.canvasToWorld([d,c]),h=n.utilities.transformWorldToIndex(p,u),g=o.canvasToWorld([r,l]);return[h,n.utilities.transformWorldToIndex(p,g)]}));c?this.updateClosedCachedStats({targetId:h,viewport:o,canvasCoordinates:v,points:d,imageData:p,metadata:f,cachedStats:l,modalityUnit:T,calibratedScale:y}):this.updateOpenCachedStats({metadata:f,canvasCoordinates:v,targetId:h,cachedStats:l,modalityUnit:T,calibratedScale:y})}return(0,T.hg)(t,i.viewport.element,B.ChangeTypes.StatsUpdated),t.invalidated=!1,l},this._renderStats=(t,o,e,n)=>{const{data:i}=t,r=this.getTargetId(o),s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},a=this.getLinkedTextBoxStyle(s,t);if(!a.visibility)return;const l=this.configuration.getTextLines(i,r);if(!l||0===l.length)return;const d=i.contour.polyline.map((t=>o.worldToCanvas(t)));if(!i.handles.textBox.hasMoved){const t=(0,C.getTextBoxCoordsCanvas)(d);i.handles.textBox.worldPosition=o.canvasToWorld(t)}const c=o.worldToCanvas(i.handles.textBox.worldPosition),u=(0,y.drawLinkedTextBox)(n,t.annotationUID??"","1",l,c,d,{},a),{x:h,y:g,width:p,height:f}=u;i.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([h,g]),topRight:o.canvasToWorld([h+p,g]),bottomLeft:o.canvasToWorld([h,g+f]),bottomRight:o.canvasToWorld([h+p,g+f])}},(0,h.Z)(this),(0,g.Z)(this),(0,p.Z)(this),(0,f.Z)(this),(0,v.Z)(this),(0,m.Z)(this),this._throttledCalculateCachedStats=(0,d.Z)(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(t,o){if(!o||!o.length)return;const e=(0,n.getEnabledElement)(t),{viewport:i}=e;let r;if(i instanceof n.VolumeViewport){const t=i.getCamera(),{spacingInNormalDirection:e}=n.utilities.getTargetVolumeAndSpacingInNormalDir(i,t);r=this.filterAnnotationsWithinSlice(o,t,e)}else r=(0,l.filterAnnotationsForDisplay)(i,o);return r}filterAnnotationsWithinSlice(t,o,e){const{viewPlaneNormal:n}=o,r=t.filter((t=>{const o=t.metadata.viewPlaneNormal,e=Math.abs(i.R3.dot(n,o))>A;return o&&e}));if(!r.length)return[];const s=e/2,{focalPoint:a}=o,l=[];for(const t of r){const o=t.data.contour.polyline[0];if(!t.isVisible)continue;const e=i.R3.create();i.R3.sub(e,a,o);const r=i.R3.dot(e,n);Math.abs(r)<s&&l.push(t)}return l}isContourSegmentationTool(){return!1}createAnnotation(t){const o=t.detail.currentPoints.world,e=super.createAnnotation(t);return n.utilities.deepMerge(e,{data:{contour:{polyline:[[...o]]},label:"",cachedStats:{}},onInterpolationComplete:t=>{t.data.handles.points.length=0}})}getAnnotationStyle(t){return super.getAnnotationStyle(t)}renderAnnotationInstance(t){const{enabledElement:o,targetId:e,svgDrawingHelper:n}=t,i=t.annotation;let r=!1;const{viewport:s,renderingEngine:a}=o,l=this.isDrawing,d=this.isEditingOpen,c=this.isEditingClosed;if(l||d||c){const t=this.commonData.annotation.annotationUID;if(i.annotationUID===t)if(l)this.renderContourBeingDrawn(o,n,i);else if(c)this.renderClosedContourBeingEdited(o,n,i);else{if(!d)throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);this.renderOpenContourBeingEdited(o,n,i)}else this.configuration.displayOnePointAsCrosshairs&&1===i.data.contour.polyline.length?this.renderPointContourWithMarker(o,n,i):this.renderContour(o,n,i);r=!0}else this.configuration.displayOnePointAsCrosshairs&&1===i.data.contour.polyline.length?this.renderPointContourWithMarker(o,n,i):this.renderContour(o,n,i);if(this.configuration.calculateStats)return this._calculateStatsIfActive(i,e,s,a,o),this._renderStats(i,s,o,n),r}_calculateStatsIfActive(t,o,e,n,i){const r=this.commonData?.annotation.annotationUID;if((t.annotationUID!==r||this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:r}=t;r.cachedStats[o]&&null!=r.cachedStats[o].areaUnit?t.invalidated&&this._throttledCalculateCachedStats(t,e,n,i):(r.cachedStats[o]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(t,e,n,i))}}updateClosedCachedStats({viewport:t,points:o,imageData:e,metadata:r,cachedStats:s,targetId:l,modalityUnit:d,canvasCoordinates:c,calibratedScale:u}){const{scale:h,areaUnits:g,units:p}=u,f=c[0],v=t.canvasToWorld(f),m=t.canvasToWorld([f[0]+1,f[1]]),T=t.canvasToWorld([f[0],f[1]+1]),y=i.R3.distance(v,m),C=i.R3.distance(v,T),b=n.utilities.transformWorldToIndex(e,o[0]);b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]);let _=b[0],I=b[0],O=b[1],B=b[1],M=b[2],P=b[2];for(let t=1;t<o.length;t++){const i=n.utilities.transformWorldToIndex(e,o[t]);i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i[2]=Math.floor(i[2]),_=Math.min(_,i[0]),I=Math.max(I,i[0]),O=Math.min(O,i[1]),B=Math.max(B,i[1]),M=Math.min(M,i[2]),P=Math.max(P,i[2])}const A=n.utilities.transformWorldToIndex(e,o[1]);A[0]=Math.floor(A[0]),A[1]=Math.floor(A[1]),A[2]=Math.floor(A[2]);let N=a.polyline.getArea(c)/h/h;N*=y*C;const D=.01*(I-_),x=.01*(B-O),$=.01*(P-M);_=Math.floor(_-D),I=Math.ceil(I+D),O=Math.floor(O-x),B=Math.ceil(B+x),M=Math.floor(M-$),P=Math.ceil(P+$);const G=[[_,I],[O,B],[M,P]],R=e.indexToWorld([I,B,P]),V=t.worldToCanvas(R);let W=0,k=[],j=0;const U=(0,S.Z)(e,((o,e)=>{let n=!0;const i=t.worldToCanvas(o);return i[1]!=W&&(j=0,W=i[1],k=(0,w.getLineSegmentIntersectionsCoordinates)(c,i,[V[0],i[1]]),k.sort((function(t,o){return t[0]===o[0]?0:t[0]<o[0]?-1:1}))),k.length&&i[0]>k[0][0]&&(k.shift(),j++),j%2==0&&(n=!1),n}),this.configuration.statsCalculator.statsCallback,G),Z=this.configuration.statsCalculator.getStatistics();s[l]={Modality:r.Modality,area:N,perimeter:(0,E.Z)(c,closed)/h,mean:Z.mean?.value,max:Z.max?.value,stdDev:Z.stdDev?.value,statsArray:Z.array,pointsInShape:U,areaUnit:g,modalityUnit:d,unit:p}}updateOpenCachedStats({targetId:t,metadata:o,canvasCoordinates:e,cachedStats:n,modalityUnit:i,calibratedScale:r}){const{scale:s,units:a}=r;n[t]={Modality:o.Modality,length:(0,E.Z)(e,!1)/s,modalityUnit:i,unit:a}}}function D(t,o){const e=t.cachedStats[o],{area:n,mean:i,stdDev:r,length:a,perimeter:l,max:d,isEmptyArea:c,areaUnit:u,modalityUnit:h,unit:g}=e||{},p=[];if(n){const t=c?"Area: Oblique not supported":`Area: ${(0,s.roundNumber)(n)} ${u}`;p.push(t)}return i&&p.push(`Mean: ${(0,s.roundNumber)(i)} ${h}`),Number.isFinite(d)&&p.push(`Max: ${(0,s.roundNumber)(d)} ${h}`),r&&p.push(`Std Dev: ${(0,s.roundNumber)(r)} ${h}`),l&&p.push(`Perimeter: ${(0,s.roundNumber)(l)} ${g}`),a&&p.push(`${(0,s.roundNumber)(a)} ${g}`),p}N.toolName="PlanarFreehandROI";const x=N},20406:(t,o,e)=>{"use strict";e.d(o,{Z:()=>m});var n=e(12651),i=e(74297),r=e(95482),s=e(39949),a=e(14305),l=e(27078),d=e(93382),c=e(61958),u=e(78859),h=e(83456),g=e(33232),p=e(51593);const f=p.Z.toolName;class v extends d.ml{constructor(t={},o={configuration:{}}){super(t,o),this.renderSegmentation=t=>{const o=(0,l.getToolGroup)(t);if(!o)return;const e=(0,a.getSegmentationRepresentations)(t);if(!e||0===e.length)return;const r=o.viewportsInfo.map((({renderingEngineId:t,viewportId:o})=>{const e=(0,n.getEnabledElementByIds)(o,t);if(e)return e.viewport})),s=e.map((o=>{const e=this._getMergedRepresentationsConfig(t),n=[],s={[i.default.Labelmap]:h.Pm,[i.default.Contour]:u.p,[i.default.Surface]:c.o};o.type===i.default.Contour&&this.addPlanarFreeHandToolIfAbsent(t);const a=s[o.type];for(const t of r){const i=a.render(t,o,e);n.push(i)}return n}));Promise.allSettled(s).then((()=>{r.forEach((t=>{t.render()}))}))}}onSetToolEnabled(){const t=this.toolGroupId,o=(0,a.getSegmentationRepresentations)(t);o&&0!==o.length&&o.forEach((o=>{(0,s.setSegmentationVisibility)(t,o.segmentationRepresentationUID,!0)}))}onSetToolDisabled(){const t=this.toolGroupId,o=(0,a.getSegmentationRepresentations)(t);o&&0!==o.length&&o.forEach((o=>{(0,s.setSegmentationVisibility)(t,o.segmentationRepresentationUID,!1)}))}addPlanarFreeHandToolIfAbsent(t){f in g.SB.tools||(0,g.LK)(p.Z);const o=(0,l.getToolGroup)(t);o.hasTool(f)||(o.addTool(f),o.setToolPassive(f))}_getMergedRepresentationsConfig(t){const o=r.config.getToolGroupSpecificConfig(t),e=r.config.getGlobalConfig();return n.utilities.deepMerge(e,o)}}v.toolName="SegmentationDisplay";const m=v},20346:(t,o,e)=>{var n="__lodash_hash_undefined__",i=1/0,r="[object Function]",s="[object GeneratorFunction]",a="[object Symbol]",l=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,d=/^\w*$/,c=/^\./,u=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,h=/\\(\\)?/g,g=/^\[object .+?Constructor\]$/,p="object"==typeof e.g&&e.g&&e.g.Object===Object&&e.g,f="object"==typeof self&&self&&self.Object===Object&&self,v=p||f||Function("return this")();var m,T=Array.prototype,y=Function.prototype,C=Object.prototype,w=v["__core-js_shared__"],S=(m=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"",b=y.toString,_=C.hasOwnProperty,I=C.toString,E=RegExp("^"+b.call(_).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),O=v.Symbol,B=T.splice,M=k(v,"Map"),P=k(Object,"create"),A=O?O.prototype:void 0,N=A?A.toString:void 0;function D(t){var o=-1,e=t?t.length:0;for(this.clear();++o<e;){var n=t[o];this.set(n[0],n[1])}}function x(t){var o=-1,e=t?t.length:0;for(this.clear();++o<e;){var n=t[o];this.set(n[0],n[1])}}function $(t){var o=-1,e=t?t.length:0;for(this.clear();++o<e;){var n=t[o];this.set(n[0],n[1])}}function G(t,o){for(var e,n,i=t.length;i--;)if((e=t[i][0])===(n=o)||e!=e&&n!=n)return i;return-1}function R(t,o){var e;o=function(t,o){if(F(t))return!1;var e=typeof t;if("number"==e||"symbol"==e||"boolean"==e||null==t||H(t))return!0;return d.test(t)||!l.test(t)||null!=o&&t in Object(o)}(o,t)?[o]:F(e=o)?e:j(e);for(var n=0,i=o.length;null!=t&&n<i;)t=t[U(o[n++])];return n&&n==i?t:void 0}function V(t){if(!L(t)||(o=t,S&&S in o))return!1;var o,e=function(t){var o=L(t)?I.call(t):"";return o==r||o==s}(t)||function(t){var o=!1;if(null!=t&&"function"!=typeof t.toString)try{o=!!(t+"")}catch(t){}return o}(t)?E:g;return e.test(function(t){if(null!=t){try{return b.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function W(t,o){var e,n,i=t.__data__;return("string"==(n=typeof(e=o))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e)?i["string"==typeof o?"string":"hash"]:i.map}function k(t,o){var e=function(t,o){return null==t?void 0:t[o]}(t,o);return V(e)?e:void 0}D.prototype.clear=function(){this.__data__=P?P(null):{}},D.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},D.prototype.get=function(t){var o=this.__data__;if(P){var e=o[t];return e===n?void 0:e}return _.call(o,t)?o[t]:void 0},D.prototype.has=function(t){var o=this.__data__;return P?void 0!==o[t]:_.call(o,t)},D.prototype.set=function(t,o){return this.__data__[t]=P&&void 0===o?n:o,this},x.prototype.clear=function(){this.__data__=[]},x.prototype.delete=function(t){var o=this.__data__,e=G(o,t);return!(e<0)&&(e==o.length-1?o.pop():B.call(o,e,1),!0)},x.prototype.get=function(t){var o=this.__data__,e=G(o,t);return e<0?void 0:o[e][1]},x.prototype.has=function(t){return G(this.__data__,t)>-1},x.prototype.set=function(t,o){var e=this.__data__,n=G(e,t);return n<0?e.push([t,o]):e[n][1]=o,this},$.prototype.clear=function(){this.__data__={hash:new D,map:new(M||x),string:new D}},$.prototype.delete=function(t){return W(this,t).delete(t)},$.prototype.get=function(t){return W(this,t).get(t)},$.prototype.has=function(t){return W(this,t).has(t)},$.prototype.set=function(t,o){return W(this,t).set(t,o),this};var j=Z((function(t){var o;t=null==(o=t)?"":function(t){if("string"==typeof t)return t;if(H(t))return N?N.call(t):"";var o=t+"";return"0"==o&&1/t==-i?"-0":o}(o);var e=[];return c.test(t)&&e.push(""),t.replace(u,(function(t,o,n,i){e.push(n?i.replace(h,"$1"):o||t)})),e}));function U(t){if("string"==typeof t||H(t))return t;var o=t+"";return"0"==o&&1/t==-i?"-0":o}function Z(t,o){if("function"!=typeof t||o&&"function"!=typeof o)throw new TypeError("Expected a function");var e=function(){var n=arguments,i=o?o.apply(this,n):n[0],r=e.cache;if(r.has(i))return r.get(i);var s=t.apply(this,n);return e.cache=r.set(i,s),s};return e.cache=new(Z.Cache||$),e}Z.Cache=$;var F=Array.isArray;function L(t){var o=typeof t;return!!t&&("object"==o||"function"==o)}function H(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&I.call(t)==a}t.exports=function(t,o,e){var n=null==t?void 0:R(t,o);return void 0===n?e:n}}}]);
//# sourceMappingURL=3497.bundle.170738b1040ef4709afc.js.map
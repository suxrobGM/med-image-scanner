"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[8315],{88315:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(3827),a=n.n(r),s=n(43001),o=n(69190),i=n(38604);const l=function(e,t,n){const{tools:r}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,r)},c={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const u=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:r,hydrateSEGDisplaySet:a}){const{uiViewportDialogService:s}=e.services,o=e._extensionManager._appConfig;return new Promise((async function(e,l){const u=o?.disableConfirmationPrompts?c.HYDRATE_SEG:await function(e,t){return new Promise((function(n,r){const a="Do you want to open this Segmentation?",s=[{id:"no-hydrate",type:i.LZ.dt.secondary,text:"No",value:c.CANCEL},{id:"yes-hydrate",type:i.LZ.dt.primary,text:"Yes",value:c.HYDRATE_SEG}],o=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:a,actions:s,onSubmit:o,onOutsideClick:()=>{e.hide(),n(c.CANCEL)},onKeyPress:e=>{"Enter"===e.key&&o(c.HYDRATE_SEG)}})}))}(s,n);u===c.HYDRATE_SEG&&(r?.forEach((e=>{e()})),window.setTimeout((async()=>{const r=await a({segDisplaySet:t,viewportId:n});e(r)}),0))}))};function p({isHydrated:e,onStatusClick:t}){let n=null,r=null;switch(e){case!0:r=()=>s.createElement(i.JO,{name:"status-alert"}),n=()=>s.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:r=()=>s.createElement(i.JO,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>s.createElement("div",null,"Click LOAD to load segmentation.")}const a=()=>{const{t:n}=(0,o.$G)("Common"),a=n("LOAD");return s.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},s.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},s.createElement(r,null),s.createElement("span",{className:"ml-1"},"SEG")),!e&&s.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},a))};return s.createElement(s.Fragment,null,n&&s.createElement(i.u,{content:s.createElement(n,null),position:"bottom-left"},s.createElement(a,null)),!n&&s.createElement(a,null))}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(null,arguments)}function m(e){const{children:t,displaySets:n,viewportOptions:r,servicesManager:a,extensionManager:c,commandsManager:m}=e,{t:S}=(0,o.$G)("SEGViewport"),E=r.viewportId,{displaySetService:y,toolGroupService:g,segmentationService:v,customizationService:w,viewportActionCornersService:f}=a.services,I=`SEGToolGroup-${E}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const b=n[0],[h,D]=(0,i.O_)(),[C,T]=(0,s.useState)(1),[N,A]=(0,s.useState)(b.isHydrated),[k,G]=(0,s.useState)(!b.isLoaded),[P,O]=(0,s.useState)(null),[x,M]=(0,s.useState)({percentComplete:null,totalSegments:null}),L=(0,s.useRef)(null),{viewports:_,activeViewportId:R}=h,H=b.getReferenceDisplaySet(),U=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,r=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:a}=r,s=Array.isArray(a)?a[0]:a,{SpacingBetweenSlices:o,SliceThickness:i}=s,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||i,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||o};return c}(H,b);L.current={displaySet:H,metadata:U};const V=()=>{O(null)},F=(0,s.useCallback)((()=>{h?.viewports.forEach((({viewportId:e})=>{m.runCommand("storePresentation",{viewportId:e})}))}),[h]),Y=(0,s.useCallback)((()=>{const{component:t}=c.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=L.current;return s.createElement(t,d({},e,{displaySets:[n,b],viewportOptions:{viewportType:"volume",toolGroupId:I,orientation:r.orientation,viewportId:r.viewportId},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{O(e.detail.element)})(t)},onElementDisabled:V}))}),[E,b,I]),j=(0,s.useCallback)((e=>{const t=b.displaySetInstanceUID,n=v.getSegmentation(t),{segments:r}=n,a=Object.keys(r).length;let s=C+e;s>a-1?s=1:0===s&&(s=a-1),v.jumpToSegmentCenter(t,s,I),T(s)}),[C]);(0,s.useEffect)((()=>{k||u({servicesManager:a,viewportId:E,segDisplaySet:b,preHydrateCallbacks:[F],hydrateSEGDisplaySet:q}).then((e=>{e&&A(!0)}))}),[a,E,b,k]),(0,s.useEffect)((()=>{const{unsubscribe:e}=v.subscribe(v.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.segDisplaySet.displaySetInstanceUID===b.displaySetInstanceUID&&G(!1)}));return()=>{e()}}),[b]),(0,s.useEffect)((()=>{const{unsubscribe:e}=v.subscribe(v.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{M({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[b]),(0,s.useEffect)((()=>{const e=y.subscribe(y.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=_.get(R);e.includes(t.displaySetInstanceUID)&&D.setDisplaySetsForViewport({viewportId:R,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,s.useEffect)((()=>{let e=g.getToolGroup(I);if(!e)return e=l(g,w,I),()=>{v.removeSegmentationRepresentationFromToolGroup(I),g.destroyToolGroup(I)}}),[]),(0,s.useEffect)((()=>(A(b.isHydrated),()=>{v.removeSegmentationRepresentationFromToolGroup(I),L.current=null})),[b]);const q=(0,s.useCallback)((({segDisplaySet:e,viewportId:t})=>{m.runCommand("loadSegmentationDisplaySetsForViewport",{displaySets:[e],viewportId:t})}),[m]),B=(0,s.useCallback)((async()=>{F();const e=await q({segDisplaySet:b,viewportId:E});A(e)}),[q,b,F,E]);(0,s.useEffect)((()=>{f.setComponents([{viewportId:E,id:"viewportStatusComponent",component:p({isHydrated:N,onStatusClick:B}),indexPriority:-100,location:f.LOCATIONS.topLeft},{viewportId:E,id:"viewportActionArrowsComponent",component:s.createElement(i.PG,{key:"actionArrows",onArrowsClick:j,className:E===R?"visible":"invisible group-hover:visible"}),indexPriority:0,location:f.LOCATIONS.topRight}])}),[R,N,j,B,f,E]);let $=null;if(!L.current||H.displaySetInstanceUID!==L.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&($=t.map(((e,t)=>e&&s.cloneElement(e,{viewportId:E,key:t}))));const{PatientID:J,PatientName:Z,PatientSex:z,PatientAge:K,SliceThickness:Q,ManufacturerModelName:W,StudyDate:X,SeriesDescription:ee,SpacingBetweenSlices:te}=L.current.metadata;return s.createElement(s.Fragment,null,s.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},k&&s.createElement(i.bk,{className:"h-full w-full",totalNumbers:x.totalSegments,percentComplete:x.percentComplete,loadingText:"Loading SEG..."}),Y(),$))}m.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node};const S=m}}]);
//# sourceMappingURL=8315.bundle.bd4bfe824e654b167425.js.map
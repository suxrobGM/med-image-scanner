"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[8714],{78714:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var r=n(3827),a=n.n(r),s=n(43001),i=n(84793),o=n(69190),l=n(75449),c=n(38604),u=n(83330),d=n(52490),m=n(92522);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(null,arguments)}function S(e){const{children:t,dataSource:n,displaySets:r,viewportOptions:a,servicesManager:i,extensionManager:S}=e,[I]=(0,d.M)(),{displaySetService:y,cornerstoneViewportService:g,measurementService:v,viewportActionCornersService:E}=i.services,b=a.viewportId;if(r.length>1)throw new Error("SR viewport should only have a single display set");const w=r[0],[h,D]=(0,c.O_)(),[T,x]=(0,s.useState)(0),[C,O]=(0,s.useState)(1),[M,N]=(0,s.useState)(null),[k,U]=(0,s.useState)(null),[R,j]=(0,s.useState)(null),{viewports:A,activeViewportId:P}=h,{t:q}=(0,o.$G)("Common");let V,L;if(S.registeredExtensionIds.includes("@ohif/extension-measurement-tracking")){const e=S.getModuleEntry("@ohif/extension-measurement-tracking.contextModule.TrackedMeasurementsContext"),t=(0,s.useContext)(e.context);V=t?.[0],L=t?.[1]}L||(V=null,L=(e,{displaySetInstanceUID:t})=>{v.clearMeasurements();const{SeriesInstanceUIDs:n}=(0,u.Z)({servicesManager:i,extensionManager:S,appConfig:I},t),r=y.getDisplaySetsForSeries(n[0]);r.length&&D.setDisplaySetsForViewports([{viewportId:P,displaySetInstanceUIDs:[r[0].displaySetInstanceUID]}])});const F=(0,s.useCallback)((e=>{const{measurements:t}=w;(0,l.l2)(R,t.map((e=>e.TrackingUniqueIdentifier)),e)}),[R,T,w]),$=(0,s.useCallback)((e=>{const{StudyInstanceUID:t,displaySetInstanceUID:n,sopClassUids:r}=w;t&&n&&(r&&r.length>1&&console.warn("More than one SOPClassUID in the same series is not yet supported."),async function(e,t,n){const{measurements:r}=e,a=r[t],{displaySetInstanceUID:s}=a;e.keyImageDisplaySet||(e.keyImageDisplaySet=(0,m.Z)(n,e));const i=n.getDisplaySetByUID(s),o=i.images[0],l={PatientID:o.PatientID,PatientName:o.PatientName,PatientSex:o.PatientSex,PatientAge:o.PatientAge,SliceThickness:o.SliceThickness,StudyDate:o.StudyDate,SeriesDescription:o.SeriesDescription,SeriesInstanceUID:o.SeriesInstanceUID,SeriesNumber:o.SeriesNumber,ManufacturerModelName:o.ManufacturerModelName,SpacingBetweenSlices:o.SpacingBetweenSlices};return{referencedDisplaySetMetadata:l,referencedDisplaySet:i}}(w,e,y).then((({referencedDisplaySet:t,referencedDisplaySetMetadata:n})=>{if(x(e),N(t),U(n),t.displaySetInstanceUID===M?.displaySetInstanceUID){const{measurements:t}=w,n=g.getCornerstoneViewport(b),r=n.getImageIds().indexOf(t[e].imageId);-1!==r&&n.setImageIdIndex(r)}})))}),[n,w,M,b]),Z=(0,s.useCallback)((()=>{if(!M)return null;const{component:t}=S.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{measurements:n}=w,r=n[T];if(!r)return null;const i=M.images.findIndex((e=>e.imageId===r.imageId));return s.createElement(t,p({},e,{displaySets:[M],viewportOptions:{...a,toolGroupId:"SRToolGroup",viewportType:"stack",positionIds:null},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{j(e.detail.element)})(t)},initialImageIndex:i,isJumpToMeasurementDisabled:!0}))}),[M,b,T]),G=(0,s.useCallback)((e=>{let t=T;t+=e,t>=C?t=0:t<0&&(t=C-1),F(t),$(t)}),[T,C,$,F]);(0,s.useEffect)((()=>{const e=y.subscribe(y.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=A.get(P);e.includes(t.displaySetInstanceUID)&&D.setDisplaySetsForViewport({viewportId:P,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,s.useEffect)((()=>{(async()=>{w.isLoaded||await w.load();const e=w.measurements.length;O(e),$(T)})()}),[w]),(0,s.useEffect)((()=>{(async()=>{w.isLoaded||await w.load(),R&&w.isLoaded&&F(T)})()}),[T,R,F,w]);const[J,_]=(0,s.useState)(V?.context?.trackedSeries?.length>0);(0,s.useEffect)((()=>{_(V?.context?.trackedSeries?.length>0)}),[V]),(0,s.useEffect)((()=>{E.setComponents([{viewportId:b,id:"viewportStatusComponent",component:f({srDisplaySet:w,viewportId:b,isRehydratable:w.isRehydratable,isLocked:J,sendTrackedMeasurementsEvent:L,t:q}),indexPriority:-100,location:E.LOCATIONS.topLeft},{viewportId:b,id:"viewportActionArrowsComponent",index:0,component:s.createElement(c.PG,{key:"actionArrows",onArrowsClick:G}),indexPriority:0,location:E.LOCATIONS.topRight}])}),[J,G,L,w,q,E,b]);let B=null;return M&&k?(t&&t.length&&(B=t.map(((e,t)=>e&&s.cloneElement(e,{viewportId:b,key:t})))),s.createElement(s.Fragment,null,s.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},Z(),B))):null}function f({srDisplaySet:e,viewportId:t,isRehydratable:n,isLocked:r,sendTrackedMeasurementsEvent:a,t:i}){const o=()=>{a("HYDRATE_SR",{displaySetInstanceUID:e.displaySetInstanceUID,viewportId:t})},l=i("LOAD"),u=n&&!r?3:n&&r?2:1;let d=null,m=null;switch(u){case 1:m=()=>s.createElement(c.JO,{name:"status-alert"}),d=()=>s.createElement("div",null,"This structured report is not compatible",s.createElement("br",null),"with this application.");break;case 2:m=()=>s.createElement(c.JO,{name:"status-locked"}),d=()=>s.createElement("div",null,"This structured report is currently read-only",s.createElement("br",null),"because you are tracking measurements in",s.createElement("br",null),"another viewport.");break;case 3:m=()=>s.createElement(c.JO,{className:"text-aqua-pale",name:"status-untracked"}),d=()=>s.createElement("div",null,`Click ${l} to restore measurements.`)}const p=()=>s.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},s.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},s.createElement(m,null),s.createElement("span",{className:"ml-1"},"SR")),3===u&&s.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:o},l));return s.createElement(s.Fragment,null,d&&s.createElement(c.u,{content:s.createElement(d,null),position:"bottom-left"},s.createElement(p,null)),!d&&s.createElement(p,null))}S.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node,viewportLabel:a().string,viewportOptions:a().object,servicesManager:a().object.isRequired,extensionManager:a().instanceOf(i.W$).isRequired};const I=S;var y=n(91851);const g={TEXT:e=>e.TextValue,CODE:e=>e.ConceptCodeSequence?.[0]?.CodeMeaning,UIDREF:e=>e.UID,NUM:e=>{const t=e.MeasuredValueSequence?.[0];if(!t)return;const{NumericValue:n,MeasurementUnitsCodeSequence:r}=t,{CodeValue:a}=r;return`${n} ${a}`},PNAME:e=>{const t=e.PersonName?.[0]?.Alphabetic;return t?i.utils.formatPN(t):void 0},DATE:e=>{const{Date:t}=e;return t?i.utils.formatDate(t):void 0},TIME:e=>{const{Time:t}=e;return t?i.utils.formatTime(t):void 0},DATETIME:e=>{const{DateTime:t}=e;if("string"!=typeof t)return;if(t.length<14)return t;const n=t.substring(0,8),r=t.substring(8,14);return`${i.utils.formatDate(n)} ${i.utils.formatTime(r)}`}};const v="[empty]";function E(e){const{contentItem:t,nodeIndexesTree:n,continuityOfContent:r}=e,{ConceptNameCodeSequence:a}=t,{CodeValue:i,CodeMeaning:o}=a,l=0===n[n.length-1],c=function(e){const{ValueType:t}=e,n=g[t];return n?n(e):`[${t} is not supported]`}(t)??v,u="CONTINUOUS"===r,d=i===y.Z.Finding,m=u&&!l&&/^[a-zA-Z0-9]/.test(c?.[0]);let p="whitespace-pre-line";return i===y.Z.Finding&&(p="whitespace-pre-wrap"),u?s.createElement(s.Fragment,null,s.createElement("span",{className:p,title:o},m?" ":"",c)):s.createElement(s.Fragment,null,s.createElement("div",{className:"mb-2"},s.createElement("span",{className:"font-bold"},o,": "),d?s.createElement("pre",null,c):s.createElement("span",{className:p},c)))}function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b.apply(null,arguments)}function w(e){const{container:t,nodeIndexesTree:n=[0],containerNumberedTree:r=[1]}=e,{ContinuityOfContent:a,ConceptNameCodeSequence:i}=t,{CodeMeaning:o}=i??{};let l=1;const c=t.ContentSequence?.map(((e,t)=>{const{ValueType:i}=e,o=[...n,t],c=o.join(".");let u,d;if("CONTAINER"===i){u=w,d={container:e,nodeIndexesTree:o,containerNumberedTree:[...r,l++]}}else u=E,d={contentItem:e,nodeIndexesTree:o,continuityOfContent:a};return s.createElement(u,b({key:c},d))}));return s.createElement("div",null,s.createElement("div",{className:"font-bold"},r.join("."),".Â ",o),s.createElement("div",{className:"ml-4 mb-2"},c))}function h(e){const{displaySets:t}=e,n=t[0].instances[0];return s.createElement("div",{className:"relative flex h-full w-full flex-col overflow-auto p-4 text-white"},s.createElement("div",null,s.createElement(w,{container:n})))}E.propTypes={contentItem:a().object,nodeIndexesTree:a().arrayOf(a().number),continuityOfContent:a().string},w.propTypes={container:a().object,nodeIndexesTree:a().arrayOf(a().number),containerNumberedTree:a().arrayOf(a().number)},h.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node,viewportLabel:a().string,viewportOptions:a().object,servicesManager:a().object.isRequired,extensionManager:a().instanceOf(i.W$).isRequired};const D=h;function T(e){const{displaySets:t}=e,{isImagingMeasurementReport:n}=t[0];return n?s.createElement(I,e):s.createElement(D,e)}T.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node,viewportLabel:a().string,viewportOptions:a().object,servicesManager:a().object.isRequired,extensionManager:a().instanceOf(i.W$).isRequired};const x=T}}]);
//# sourceMappingURL=8714.bundle.9bdef0621f699c9ada86.js.map